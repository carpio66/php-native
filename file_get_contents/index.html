<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="jquery-2.2.3.min.js"></script>
    <script src="funciones.js"></script>
    <script src="html2canvas.js"></script>
<script>
    function iframeLoad(iframe) {
        var body = $(iframe).contents().find('body');
        html2canvas(body, {
            onrendered: function( canvas ) {
                $("#content").empty().append(canvas);
            },
            logging: true
        });
        allowTaint: true;
        taintTest: false;
    }
    $(document).ready(function() {
        /*
        var parametro = "http://www.milanuncios.com/datos-contacto/?id=207449088";
        var url       = "http://html2canvas.appspot.com/query?callback=?";
        var data      = {
            "xhr2":false,
            "url":parametro
        }
        $.ajax({
            dataType: "json",
            url: url,
            data: data,
            success: function($html){
                console.log("Hola");
                $("#respuesta").html($html);
            },
            done: function($html){
                $("#respuesta").html($html);
            }
        });
        */

        var url = "http://www.milanuncios.com/datos-contacto/?id=207449088";
        var urlParts = document.createElement('a');
        urlParts.href = url;
        $.getJSON("http://html2canvas.appspot.com/query?callback=?", { xhr2:false, url:urlParts.href }, function(html) {
            iframe = document.createElement('iframe');
            $(iframe).css({ 'visibility':'hidden'}).width($(window).width()).height($(window).height());
            $('#content').append(iframe);
            d = iframe.contentWindow.document;
            d.open();
            $(iframe.contentWindow).load(iframeLoad.bind(null, iframe));
            $('base').attr('href',urlParts.protocol+"//"+urlParts.hostname+"/" + urlParts.pathname);
            html = html.replace("<head>","<head><base href='"+urlParts.protocol+"//"+urlParts.hostname+"/" + urlParts.pathname + "'  />");
            if($("#disablejs").prop('checked')){
                html = html.replace(/\<script/gi,"<!--<script");
                html = html.replace(/\<\/script\>/gi,"<\/script>-->");
            }
            d.write(html);
            d.close();
            var canvas = $("#content canvas");
            var data = {'id' : $id};
            $url = window.location.href;
            $.ajax({
                    type: "GET",
                    dataType: "json",
                    url: "recibir", //Relative or absolute path to response.php file
                    data: data,
                    success: function(data) {
                        //console.log(data);
                        //console.log(data['response']);
                        if(data.response == false){
                            console.log('No se ha podido actualizar');
                        }else if(data.response == true){
                            console.log('Se ha podido eliminar todo');
                            setTimeout(function(){ window.location.href = $url ; }, 2000);
                        }
                    }

                },'json');
            });
            /*
            .done(function() {
                var canvas  = document.getElementById("canvas");
                var dataURL = canvas.toDataURL();
                console.log("hola"+dataURL);
            })
            */
        });

    });
</script>
</head>
<body>
<div id="content"></div>
<div id="respuesta"></div>
</body>
</html>