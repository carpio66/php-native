<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="es" lang="es"><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Finca Resalso 2015 | Comprar vino | vinoseleccion.com</title><meta name="description" content="Comprar Finca Resalso 2015 desde 20,00 € en vinoseleccion.com, la Tienda de Vinos online con los mejores precios. Venta de vinos con las mejores ofertas y los mejores vinos." /><meta name="keywords" content="vino, vinos, comprar vino, comprar vinos, venta de vino, venta de vinos, cata de vinos, vinos online, oferta vino, oferta vinos, vinoteca,  los mejores vinos, tienda de vinos, comprar vino online, venta vinos, buenos vinos,  vinoselección, vinoseleccion, vinoseleccion.com, vino seleccion, vino selección, club del vino, club vinos, club vino, club de vinos, club de vino" /><meta name="robots" content="INDEX,FOLLOW" /><link rel="icon" href="http://www.vinoseleccion.com/media/favicon/default/favicon.ico" type="image/x-icon" /><link rel="shortcut icon" href="http://www.vinoseleccion.com/media/favicon/default/favicon.ico" type="image/x-icon" /><link rel="alternate" href="http://www.vinoseleccion.com/?___store=mobile" /> <!--[if lt IE 7]> <script type="text/javascript"> //<![CDATA[
var BLANK_URL = 'http://www.vinoseleccion.com/js/blank.html';
var BLANK_IMG = 'http://www.vinoseleccion.com/js/spacer.gif';
//]]> </script> <![endif]--><style type="text/css" style="display:none">/* The main calendar widget.  DIV containing a table. */

    .calendar {
    position: relative;
    display: none;
    border-top: 2px solid #fff;
    border-right: 2px solid #000;
    border-bottom: 2px solid #000;
    border-left: 2px solid #fff;
    font-size: 11px;
    color: #000;
    cursor: default;
    background: #d4d0c8;
    font-family: tahoma,verdana,sans-serif;
    }

    .calendar table {
    border-top: 1px solid #000;
    border-right: 1px solid #fff;
    border-bottom: 1px solid #fff;
    border-left: 1px solid #000;
    font-size: 11px;
    color: #000;
    cursor: default;
    background: #d4d0c8;
    font-family: tahoma,verdana,sans-serif;
    }

    /* Header part -- contains navigation buttons and day names. */

    .calendar .button { /* "<<", "<", ">", ">>" buttons have this class */
    text-align: center;
    padding: 1px;
    border-top: 1px solid #fff;
    border-right: 1px solid #000;
    border-bottom: 1px solid #000;
    border-left: 1px solid #fff;
    }

    .calendar .nav {
    background: transparent url(http://www.vinoseleccion.com/js/calendar/menuarrow.gif) no-repeat 100% 100%;
    }

    .calendar thead .title { /* This holds the current "month, year" */
    font-weight: bold;
    padding: 1px;
    border: 1px solid #000;
    background: #848078;
    color: #fff;
    text-align: center;
    }

    .calendar thead .headrow { /* Row <TR> containing navigation buttons */
        }

        .calendar thead .daynames { /* Row <TR> containing the day names */
        }

        .calendar thead .name { /* Cells <TD> containing the day names */
            border-bottom: 1px solid #000;
            padding: 2px;
            text-align: center;
            background: #f4f0e8;
            }

            .calendar thead .weekend { /* How a weekend day name shows in header */
            color: #f00;
            }

            .calendar thead .hilite { /* How do the buttons in header appear when hover */
            border-top: 2px solid #fff;
            border-right: 2px solid #000;
            border-bottom: 2px solid #000;
            border-left: 2px solid #fff;
            padding: 0px;
            background-color: #e4e0d8;
            }

            .calendar thead .active { /* Active (pressed) buttons in header */
            padding: 2px 0px 0px 2px;
            border-top: 1px solid #000;
            border-right: 1px solid #fff;
            border-bottom: 1px solid #fff;
            border-left: 1px solid #000;
            background-color: #c4c0b8;
            }

            /* The body part -- contains all the days in month. */

            .calendar tbody .day { /* Cells <TD> containing month days dates */
            width: 2em;
            text-align: right;
            padding: 2px 4px 2px 2px;
            }
            .calendar tbody .day.othermonth {
            font-size: 80%;
            color: #aaa;
            }
            .calendar tbody .day.othermonth.oweekend {
            color: #faa;
            }

            .calendar table .wn {
            padding: 2px 3px 2px 2px;
            border-right: 1px solid #000;
            background: #f4f0e8;
            }

            .calendar tbody .rowhilite td {
            background: #e4e0d8;
            }

            .calendar tbody .rowhilite td.wn {
            background: #d4d0c8;
            }

            .calendar tbody td.hilite { /* Hovered cells <TD> */
            padding: 1px 3px 1px 1px;
            border-top: 1px solid #fff;
            border-right: 1px solid #000;
            border-bottom: 1px solid #000;
            border-left: 1px solid #fff;
            }

            .calendar tbody td.active { /* Active (pressed) cells <TD> */
            padding: 2px 2px 0px 2px;
            border-top: 1px solid #000;
            border-right: 1px solid #fff;
            border-bottom: 1px solid #fff;
            border-left: 1px solid #000;
            }

            .calendar tbody td.selected { /* Cell showing selected date */
            font-weight: bold;
            border-top: 1px solid #000;
            border-right: 1px solid #fff;
            border-bottom: 1px solid #fff;
            border-left: 1px solid #000;
            padding: 2px 2px 0px 2px;
            background: #e4e0d8;
            }

            .calendar tbody td.weekend { /* Cells showing weekend days */
            color: #f00;
            }

            .calendar tbody td.today { /* Cell showing today date */
            font-weight: bold;
            color: #00f;
            }

            .calendar tbody .disabled { color: #999; }

            .calendar tbody .emptycell { /* Empty cells (the best is to hide them) */
            visibility: hidden;
            }

            .calendar tbody .emptyrow { /* Empty row (some months need less than 6 rows) */
            display: none;
            }

            /* The footer part -- status bar and "Close" button */

            .calendar tfoot .footrow { /* The <TR> in footer (only one right now) */
        }

        .calendar tfoot .ttip { /* Tooltip (status bar) cell <TD> */
            background: #f4f0e8;
            padding: 1px;
            border: 1px solid #000;
            background: #848078;
            color: #fff;
            text-align: center;
            }

            .calendar tfoot .hilite { /* Hover style for buttons in footer */
            border-top: 1px solid #fff;
            border-right: 1px solid #000;
            border-bottom: 1px solid #000;
            border-left: 1px solid #fff;
            padding: 1px;
            background: #e4e0d8;
            }

            .calendar tfoot .active { /* Active (pressed) style for buttons in footer */
            padding: 2px 0px 0px 2px;
            border-top: 1px solid #000;
            border-right: 1px solid #fff;
            border-bottom: 1px solid #fff;
            border-left: 1px solid #000;
            }

            /* Combo boxes (menus that display months/years for direct selection) */

            .calendar .combo {
            position: absolute;
            display: none;
            width: 4em;
            top: 0px;
            left: 0px;
            cursor: default;
            border-top: 1px solid #fff;
            border-right: 1px solid #000;
            border-bottom: 1px solid #000;
            border-left: 1px solid #fff;
            background: #e4e0d8;
            font-size: 90%;
            padding: 1px;
            z-index: 100;
            }

            .calendar .combo .label,
            .calendar .combo .label-IEfix {
            text-align: center;
            padding: 1px;
            }

            .calendar .combo .label-IEfix {
            width: 4em;
            }

            .calendar .combo .active {
            background: #c4c0b8;
            padding: 0px;
            border-top: 1px solid #000;
            border-right: 1px solid #fff;
            border-bottom: 1px solid #fff;
            border-left: 1px solid #000;
            }

            .calendar .combo .hilite {
            background: #048;
            color: #fea;
            }

            .calendar td.time {
            border-top: 1px solid #000;
            padding: 1px 0px;
            text-align: center;
            background-color: #f4f0e8;
            }

            .calendar td.time .hour,
            .calendar td.time .minute,
            .calendar td.time .ampm {
            padding: 0px 3px 0px 4px;
            border: 1px solid #889;
            font-weight: bold;
            background-color: #fff;
            }

            .calendar td.time .ampm {
            text-align: center;
            }

            .calendar td.time .colon {
            padding: 0px 2px 0px 3px;
            font-weight: bold;
            }

            .calendar td.time span.hilite {
            border-color: #000;
            background-color: #766;
            color: #fff;
            }

            .calendar td.time span.active {
            border-color: #f00;
            background-color: #000;
            color: #0f0;
            }


</style>
    <style media="all" type="text/css" style="display:none">/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     default_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

    /* Reset ================================================================================= */
    * { margin:0; padding:0; }

    body          { background:#fff; font:12px/1.5 'Open Sans', Arial, Helvetica, sans-serif; color:#000; text-align:center; font-weight: 400; text-rendering: optimizeLegibility; }

    img           { border:0; vertical-align:top; }

    a             { color:#5e5e5e; text-decoration:none; }
    a:hover       { text-decoration:underline; }
    :focus        { outline:0; }

    /* Headings */
    h1,h2,h3,
    h4,h5,h6      { margin:0 0 5px; line-height:1.35; color:#000000; }
    h1            { font-size:20px; font-weight:normal; }
    h2            { font-size:18px; font-weight:normal; }
    h3            { font-size:16px; font-weight:bold; }
    h4            { font-size:14px; font-weight:bold; }
    h5            { font-size:12px; font-weight:bold; }
    h6            { font-size:11px; font-weight:bold; }

    /* Forms */
    form          { display:inline; }
    fieldset      { border:0; }
    legend        { display:none; }

    /* Table */
    table         { border:0; /*border-collapse:collapse;*/ border-spacing:0; empty-cells:show; font-size:100%; }
    caption,th,td { vertical-align:top; text-align:left; font-weight:normal; }

    /* Content */
    p             { margin:0 0 10px; }
    strong        { font-weight:bold; }
    address       { font-style:normal; line-height:1.35; }
    cite          { font-style:normal; }
    q,
    blockquote    { quotes:none; }
    q:before,
    q:after       { content:''; }
    small,big     { font-size:1em; }
    /*sup           { font-size:1em; vertical-align:top; }*/

    /* Lists */
    ul,ol         { list-style:none; }

    /* Tools */
    .hidden       { display:block !important; border:0 !important; margin:0 !important; padding:0 !important; font-size:0 !important; line-height:0 !important; width:0 !important; height:0 !important; overflow:hidden !important; }
    .nobr         { white-space:nowrap !important; }
    .wrap         { white-space:normal !important; }
    .a-left       { text-align:left !important; }
    .a-center     { text-align:center !important; }
    .a-right      { text-align:right !important; }
    .v-top        { vertical-align:top; }
    .v-middle     { vertical-align:middle; }
    .f-left,
    .left         { float:left !important; }
    .f-right,
    .right        { float:right !important; }
    .f-none       { float:none !important; }
    .f-fix        { float:left; width:100%; }
    .no-display   { display:none; }
    .no-margin    { margin:0 !important; }
    .no-padding   { padding:0 !important; }
    .no-bg        { background:none !important; }
    .no-border 	  { border: 0 !important; }
    /* ======================================================================================= */


    /* Layout ================================================================================ */
    .wrapper { min-width:954px; }
    .page {}
    .page-print { background:#fff; padding:25px 30px; text-align:left; }
    .page-empty { background:#fff; padding:20px; text-align:left; }
    .page-popup { background:#fff; padding:25px 30px; text-align:left; }
    .main-container { }
    .main { width:920px; margin:0 auto; min-height:400px; padding:10px 20px 70px; text-align:left; }
    .postcontent { border-top: 1px solid #ccccca; padding: 12px 0; clear: both;
        background: #fff url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bg_postcontent_fb.png) 0 100% repeat-x;
        background: -webkit-gradient(linear, left bottom, left top, from(#e9e8e8), to(#fff));
        background: -webkit-linear-gradient(bottom, #e9e8e8, #fff);
        background:    -moz-linear-gradient(bottom, #e9e8e8, #fff);
        background:      -o-linear-gradient(bottom, #e9e8e8, #fff);
        background:         linear-gradient(to top, #e9e8e8, #fff);
    }

    /* Base Columns */
    .col-left { float:left; width:212px; padding:0 0 1px; }
    .col-main { float:left; width:685px; padding:0 0 1px; }
    .col-right { float:right; width:212px; padding:0 0 1px; }
    .cms-index-index .col-right { margin-top: 10px; }

    /* 1 Column Layout */
    .col1-layout .col-main { float:none; width:auto; }

    /* 2 Columns Layout */
    .col2-left-layout .col-main { float:right; }
    .col2-right-layout .col-main {}

    /* 3 Columns Layout */
    .col3-layout .col-main { width:475px; margin-left:17px; }
    .col3-layout .col-wrapper { float:left; width:687px; }
    .col3-layout .col-wrapper .col-main { float:right; }

    /* Content Columns */
    .col2-set .col-1 { float:left; width:48.5%; }
    .col2-set .col-2 { float:right; width:48.5%; }
    .col2-set .col-narrow { width:32%; }
    .col2-set .col-wide { width:65%; }

    .col3-set .col-1 { float:left; width:32%; }
    .col3-set .col-2 { float:left; width:32%; margin-left:2%; }
    .col3-set .col-3 { float:right; width:32%; }

    .col4-set .col-1 { float:left; width:23.5%; }
    .col4-set .col-2 { float:left; width:23.5%; margin:0 2%; }
    .col4-set .col-3 { float:left; width:23.5%; }
    .col4-set .col-4 { float:right; width:23.5%; }
    /* ======================================================================================= */


    /* Global Styles ========================================================================= */
    /* Form Elements */
    input,select,textarea,button { font:12px/15px Arial, Helvetica, sans-serif; vertical-align:middle; color:#2f2f2f; }
    input.input-text,select,textarea { background:#fff; border:1px solid #b6b6b6; }
    input.input-text,textarea { padding:2px; }
    select { padding:1px; }
    select option { padding-right:10px; }
    select.multiselect option { border-bottom:1px solid #b6b6b6; padding:2px 5px; }
    select.multiselect option:last-child { border-bottom:0; }
    textarea { overflow:auto; }
    input.radio { margin-right:3px; }
    input.checkbox { margin-right:3px; }
    input.qty { width:2.5em !important; }
    button.button::-moz-focus-inner { padding:0; border:0; } /* FF Fix */
    button.button { -webkit-border-fit:lines; } /* <- Safari & Google Chrome Fix */
    button.button { overflow:visible; width:auto; border:0; padding:0; margin:0; background:transparent; cursor:pointer; }
    button.button span { display:block; height:19px; border:1px solid #de5400; background:#f18200; padding:0 8px; font:bold 12px/19px 'Open Sans', Arial, Helvetica, sans-serif; text-align:center; white-space:nowrap; color:#fff; }
    button.button span span { border:0; padding:0; }
    button.button span { height: 26px; line-height: 26px; padding: 0 24px; font-size: 14px; color: #fff; background: #333; border: 0; font-weight: 400; }
    button.button span span { padding: 0; }
    button.disabled span { border-color:#bbb !important; background:#bbb !important; }

    button.btn-checkout span { height:40px; border:0; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/btn_checkout.gif) 0 0 no-repeat; padding:0 0 0 9px; font:bold 15px/40px Arial, Helvetica, sans-serif; color:#fff; }
    button.btn-checkout span span { background-position:100% 0; padding:0 25px 0 16px; }
    button.btn-checkout.no-checkout span { background-position:0 100%; color:#b8baba; }
    button.btn-checkout.no-checkout span span { background-position:100% 100%; }

    p.control input.checkbox,
    p.control input.radio { margin-right:6px; }
    /* Form Highlight */
    input.input-text:focus,select:focus,textarea:focus { background-color:#edf7fd; }
    /*.highlight { background:#efefef; }*/

    /* Form lists */
    /* Grouped fields */
    /*.form-list { width:535px; margin:0 auto; overflow:hidden; }*/
    .form-list li { margin:0 0 8px; }
    .form-list label { float:left; color:#666; font-weight:bold; position:relative; z-index:0; }
    .form-list label.required {}
    .form-list label.required em { float:right; font-style:normal; color:#eb340a; position:absolute; top:0; right:-8px; }
    .form-list li.control label { float:none; }
    .form-list li.control input.radio,
    .form-list li.control input.checkbox { margin-right:6px; }
    .form-list li.control .input-box { clear:none; display:inline; width:auto; }
    /*.form-list li.fields { margin-right:-15px; }*/
    .form-list .input-box { display:block; clear:both; width:260px; }
    .form-list .field { float:left; width:275px; }
    .form-list input.input-text { width:254px; }
    .form-list textarea { width:254px; height:10em; }
    .form-list select { width:260px; }
    .form-list li.wide .input-box { width:535px; }
    .form-list li.wide input.input-text { width:529px; }
    .form-list li.wide textarea { width:529px; }
    .form-list li.wide select { width:535px; }
    .form-list li.additional-row { border-top:1px solid #ccc; margin-top:10px; padding-top:7px; }
    .form-list li.additional-row .btn-remove { float:right; margin:5px 0 0; }
    .form-list .input-range input.input-text { width:74px; }

    .form-list-narrow li  { margin-bottom:0; }
    .form-list-narrow li .input-box { margin-bottom:6px; }
    .form-list-narrow li.wide .input-box { width:260px; }
    .form-list-narrow li.wide input.input-text,
    .form-list-narrow li.wide textarea { width:254px }
    .form-list-narrow li.wide select { width:260px; }

    /* Customer */
    .form-list .customer-name-prefix .input-box,
    .form-list .customer-name-suffix .input-box,
    .form-list .customer-name-prefix-suffix .input-box,
    .form-list .customer-name-prefix-middlename .input-box,
    .form-list .customer-name-middlename-suffix .input-box,
    .form-list .customer-name-prefix-middlename-suffix .input-box { width:auto; }

    .form-list .name-prefix { width:65px; }
    .form-list .name-prefix select { width:55px; }
    .form-list .name-prefix input.input-text { width:49px; }

    .form-list .name-suffix { width:65px; }
    .form-list .name-suffix select { width:55px; }
    .form-list .name-suffix input.input-text { width:49px; }

    .form-list .customer-name-prefix-middlename-suffix .name-firstname,
    .form-list .customer-name-prefix-middlename .name-firstname { width:140px; }
    .form-list .customer-name-prefix-middlename-suffix .name-firstname input.input-text,
    .form-list .customer-name-prefix-middlename .name-firstname input.input-text { width:124px; }
    .form-list .customer-name-prefix-middlename-suffix .name-lastname { width:205px; }
    .form-list .customer-name-prefix-middlename-suffix .name-lastname input.input-text { width:189px; }

    .form-list .customer-name-prefix-suffix .name-firstname { width:210px; }
    .form-list .customer-name-prefix-suffix .name-lastname { width:205px; }
    .form-list .customer-name-prefix-suffix .name-firstname input.input-text,
    .form-list .customer-name-prefix-suffix .name-lastname input.input-text { width:189px; }

    .form-list .customer-name-prefix-suffix .name-firstname { width:210px; }
    .form-list .customer-name-prefix-suffix .name-lastname { width:205px; }
    .form-list .customer-name-prefix-suffix .name-firstname input.input-text,
    .form-list .customer-name-prefix-suffix .name-lastname input.input-text { width:189px; }

    .form-list .customer-name-prefix .name-firstname,
    .form-list .customer-name-middlename .name-firstname { width:210px; }

    .form-list .customer-name-suffix .name-lastname,
    .form-list .customer-name-middlename .name-firstname,
    .form-list .customer-name-middlename-suffix .name-firstname,
    .form-list .customer-name-middlename-suffix .name-lastname { width:205px; }

    .form-list .customer-name-prefix .name-firstname input.input-text,
    .form-list .customer-name-suffix .name-lastname input.input-text,
    .form-list .customer-name-middlename .name-firstname input.input-text,
    .form-list .customer-name-middlename-suffix .name-firstname input.input-text,
    .form-list .customer-name-middlename-suffix .name-lastname input.input-text { width:189px; }

    .form-list .customer-dob .dob-month,
    .form-list .customer-dob .dob-day,
    .form-list .customer-dob .dob-year { float:left; width:85px; }
    .form-list .customer-dob input.input-text { display:block; width:74px; }
    .form-list .customer-dob label { font-size:10px; font-weight:normal; color:#888; }
    .form-list .customer-dob .dob-day,
    .form-list .customer-dob .dob-month { width:30px !important; }
    .form-list .customer-dob .dob-day input.input-text,
    .form-list .customer-dob .dob-month input.input-text { width:20px !important; }
    .form-list .customer-dob .dob-year { width:150px !important; }
    .form-list .customer-dob .dob-year input.input-text { width:30px !important; }
    #billing-new-address-form .dob-day,
    #billing-new-address-form .dob-month,
    #billing-new-address-form .dob-year {
        margin-right: 5px;
    }
    /* Independent fields */
    /*.form-list li { margin:0 0 8px; }
.form-list li.fields { margin:0; }
.form-list .field { display:block; margin:0 0 8px; }
.form-list li.control {}
.form-list label { float:left; width:150px; padding:2px 10px 0 0; text-align:right; }
.form-list label.required { font-weight:bold; }
.form-list label.required em { font-variant:normal; color:#eb340a; margin-right:3px; }
.form-list .input-box { float:left; width:260px; }
.form-list input.input-text,
.form-list textarea { width:254px; }
.form-list select { width:260px; }
.form-list li.additional-row { border-top:1px solid #ddd; margin-top:10px; }
.form-list li.additional-row .btn-remove { float:right; margin:5px 5px 0 0; }
.form-list .input-range input.input-text { width:96px; }*/
    /* Customer */
    /*.form-list .customer-dob .dob-month,
.form-list .customer-dob .dob-day,
.form-list .customer-dob .dob-year { float:left; width:85px; }
.form-list .customer-dob input.input-text { display:block; width:74px; }
.form-list .customer-dob label { font-size:11px; font-weight:normal; color:#777; text-align:left; }
.form-list .customer-dob .dob-day,
.form-list .customer-dob .dob-month { width:60px; }
.form-list .customer-dob .dob-day input.input-text,
.form-list .customer-dob .dob-month input.input-text { width:46px; }
.form-list .customer-dob .dob-year { width:140px; }
.form-list .customer-dob .dob-year input.input-text { width:134px; }*/

    .buttons-set { clear:both; /*margin:4em 0 0;*/ padding:8px 0 0; border-top:1px solid #e4e4e4; text-align:right; }
    .buttons-set p.required { margin:0 0 10px; }
    .buttons-set .back-link { float:left; margin:0; }
    .buttons-set button.button { float:right; margin-left:5px; }

    .buttons-set-order { margin:10px 0 0; }
    .buttons-set-order .please-wait { padding:12px 7px 0 0; }

    .fieldset { margin:28px 0; }
    .fieldset .legend { font-weight: 300; line-height: 1.5; font-size: 18px; border-bottom: 1px solid #ccccca; margin: 0 0 13px; }

    /* Form Validation */
    .validation-advice { clear:both; min-height:13px; margin:3px 0 0; padding-left:17px; font-size:11px; font-weight:bold; line-height:13px; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/validation_advice_bg.gif) 2px 0 no-repeat; color:#eb340a; }
    .validation-failed { border:1px dashed #eb340a !important; background:#faebe7 !important; }
    .validation-passed {}
    p.required { font-size:11px; text-align:right; color:#EB340A; }
    /* Expiration date and CVV number validation fix */
    .v-fix { float:left; }
    .v-fix .validation-advice { display:block; width:12em; margin-right:-12em; position:relative; }

    /* Global Messages  */
    .success { color:#3d6611; font-weight:bold; }
    .error { color:#df280a; font-weight:bold; }
    .notice { color:#000000; }

    .messages,
    .messages ul { list-style:none !important; margin:0 !important; padding:0 !important; }
    .messages { width:100%; overflow:hidden; }
    .messages li { margin:0 0 10px !important; }
    .messages li li { margin:0 0 3px !important; line-height: 2.1; }
    .error-msg,
    .success-msg,
    .note-msg,
    .notice-msg { border-style:solid !important; border-width:1px !important; background-position:10px 9px !important; background-repeat:no-repeat !important; min-height:24px !important; padding:8px 8px 8px 40px !important; font-size:11px !important; font-weight:bold !important; }
    .error-msg { border-color:#ededee; background-color:#eb340a; background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_message_wht.png); color:#fefefe; }
    .success-msg { border-color:#ededee; background-color:#ededee; background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_message.png); color:#000; }
    .note-msg,
    .notice-msg { border-color:#ededee; background-color:#ededee; background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_message.png); color:#000; }

    /* BreadCrumbs */
    .breadcrumbs { font: normal 12px/1 Arial,sans-serif; color: #000; margin: 5px 0 20px; }
    .breadcrumbs a,
    .breadcrumbs a:visited { color: #5e5e5d; text-decoration: none; }
    .breadcrumbs a:hover,
    .breadcrumbs a:focus { text-decoration: underline; }
    .breadcrumbs li { display:inline; padding: 0; margin: 0 5px 0 0; }
    .breadcrumbs .icon-sep { display: inline-block; width: 5px; height: 9px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -271px 0; margin: 0 0 0 9px; }

    /* Page Heading */
    .page-title { width:100%; overflow:hidden; margin:0 0 25px; }
    .page-title h1,
    .page-title h2 { font-weight: 300; line-height: 1.5; font-size: 30px; margin: 0 0 13px; }
    .page-title .separator { margin:0 3px; }
    .page-title .link-rss { float:right; margin:7px 0 0; }
    .title-buttons { text-align:right; }
    .title-buttons h1,
    .title-buttons h2,
    .title-buttons h3,
    .title-buttons h4,
    .title-buttons h5,
    .title-buttons h6 { float:left; }

    .subtitle,
    .sub-title { clear:both; padding:15px 0 0; font-size:15px; font-weight:bold; margin:0 0 6px; color:#e25203; }

    /* Pager */
    /*.pager {  }
.pager .amount { float:left; margin:0; }
.pager .limiter { float:right; }
.pager .limiter label { vertical-align:middle; }
.pager .limiter select { padding:0; margin:0 0 1px; vertical-align:middle; }
.pager .pages { margin:0 140px; }
.pager .pages ol { display:inline; }
.pager .pages li { display:inline; margin:0 2px; }
.pager .pages .current {}*/

    /* Sorter */
    /*.sorter { font-size:11px; background:#fff url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_toolbar.gif) 0 100% repeat-x; padding:3px 8px; border-top:1px solid #e2e2e2; }
.sorter .view-mode { float:left; margin:0; }
.sorter .sort-by { float:right; padding-right:36px; }
.sorter .sort-by label { vertical-align:middle; }
.sorter .sort-by select { padding:0; margin:0 0 1px; vertical-align:middle; }
.sorter .link-feed {}*/

    /* Toolbar */
    .toolbar { border: 1px solid #ccccca; border-width: 1px 0; padding: 6px 0 7px; background: #fff; margin: 0 0 30px; }
    /*.toolbar select { -webkit-appearance:none; -moz-appearance:none; appearance: none; border: 1px solid #ccccca; background: #fff; border-radius: 0; padding-right: 30px; position: relative; }
.toolbar select:after {  content: "▼";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        font-size: 60%;
        line-height: 30px;
        padding: 0 7px;
        background: #fff;
        color: #ccccca; }*/
    .toolbar .limiter { float: left; margin: 0 21px 0 0; }
    .toolbar .sort-by { float: left; margin: 0 21px 0 0; }
    .toolbar-bottom { margin: 30px 0 0; }
    .toolbar .pages ol { display:inline; }
    .toolbar .pages li { display:inline; margin:0 2px; }
    .toolbar strong { font-weight: normal; }

    /* Data Table */
    .data-table { width:100%; border:1px solid #bebcb7; }
    .data-table .odd  { background:#f8f7f5 }
    .data-table .even { background:#eeeded; }
    /*.data-table tr.odd:hover,
.data-table tr.even:hover { background:#ebf1f6; }*/
    .data-table td.last,
    .data-table th.last { border-right:0; }
    .data-table tr.last th,
    .data-table tr.last td { border-bottom:0 !important; }
    .data-table th { padding:3px 8px; font-weight:bold; }
    .data-table td { padding:3px 8px; }

    .data-table thead th { font-weight:bold; border-right:1px solid #c2d3e0; padding:2px 8px; color:#0a263c; white-space:nowrap; vertical-align:middle; }
    .data-table thead th.wrap { white-space:normal; }
    .data-table thead th a,
    .data-table thead th a:hover { color:#fff; }
    .data-table thead th { background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_th.gif) repeat-x 0 100% #d9e5ee; }
    .data-table thead th .tax-flag { font-size:11px; white-space:nowrap; }

    .data-table tfoot { border-bottom:1px solid #d9dde3; }
    .data-table tfoot tr.first td { background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_tfoot.gif) 0 0 repeat-x; }
    .data-table tfoot tr { background-color:#dee5e8 !important; }
    .data-table tfoot td { padding-top:1px; padding-bottom:1px; border-bottom:0; border-right:1px solid #d9dde3; }
    .data-table tfoot strong { font-size:16px; }

    .data-table tbody th,
    .data-table tbody td { border-bottom:1px solid #d9dde3; border-right:1px solid #d9dde3; }
    /* Bundle products tables */
    .data-table tbody.odd tr { background:#f8f7f5 !important; }
    .data-table tbody.even tr { background:#f6f6f6 !important; }
    .data-table tbody.odd tr td,
    .data-table tbody.even tr td { border-bottom:0; }
    .data-table tbody.odd tr.border td,
    .data-table tbody.even tr.border td { border-bottom:1px solid #d9dde3; }

    .data-table tbody td .option-label { font-weight:bold; font-style:italic; }
    .data-table tbody td .option-value { padding-left:10px; }

    /* Generic Info Box */
    .info-box { background:#fff url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_block-title.gif) 0 0 repeat-x; border:1px solid #d0cbc1; padding:12px 15px; margin:0 0 15px; }
    .info-box h2 { font-weight:bold; font-size:13px; }

    .info-table th { font-weight:bold; padding:2px 15px 2px 0; }
    .info-table td { padding:2px 0; }

    /* Shopping cart total summary row expandable to details */
    tr.summary-total { cursor:pointer; }
    tr.summary-total td {}
    tr.summary-total .summary-collapse { float:right; text-align:right; padding-left:20px; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_collapse.gif) 0 5px no-repeat; cursor:pointer; }
    tr.show-details .summary-collapse { background-position:0 -52px; }
    tr.show-details td {}
    tr.summary-details td { font-size:11px; background-color:#dae1e4; color:#626465; }
    tr.summary-details-first td { border-top:1px solid #d2d8db; }
    tr.summary-details-excluded { font-style:italic; }

    /* Shopping cart tax info */
    .cart-tax-info { display:block; }
    .cart-tax-info,
    .cart-tax-info .cart-price { padding-right:20px; }
    .cart-tax-total { display:block; padding-right:20px; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_collapse.gif) 100% 5px no-repeat; cursor:pointer; }
    .cart-tax-info .price,
    .cart-tax-total .price { display:inline !important; font-weight:normal !important; }
    .cart-tax-total-expanded { background-position:100% -52px; }

    /* Class: std - styles for admin-controlled content */
    .std .subtitle { padding:0; }
    .std ol.ol { list-style:decimal outside; padding-left:1.5em; }
    .std ul.disc { list-style:disc outside; padding-left:18px; margin:0 0 10px; }
    .std dl dt { font-weight:bold; }
    .std dl dd { margin:0 0 10px; }
    .std ul,
    .std ol,
    .std dl,
    .std p,
    .std address,
    .std blockquote { margin:0 0 1em; padding:0; }
    .std ul { list-style:disc outside; padding-left:1.5em; }
    .std ol { list-style:decimal outside; padding-left:1.5em; }
    .std ul ul { list-style-type:circle; }
    .std ul ul,
    .std ol ol,
    .std ul ol,
    .std ol ul { margin:.5em 0; }
    .std dt { font-weight:bold; }
    .std dd { padding:0 0 0 1.5em; }
    .std blockquote { font-style:italic; padding:0 0 0 1.5em; }
    .std address { font-style:normal; }
    .std b,
    .std strong { font-weight:bold; }
    .std i,
    .std em { font-style:italic; }

    /* Misc */
    .links li { display:inline; }
    .links li.first { padding-left:0 !important; }
    .links li.last { background:none !important; padding-right:0 !important; }

    .link-cart { color:#dc6809 !important; font-weight:bold; }
    .link-reorder { font-weight:bold; color:#000000 !important; }
    .link-compare { font-weight:bold; }
    .link-print { /*background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_print.gif) 0 2px no-repeat; padding:2px 0 2px 25px;*/ font-weight:bold; color:#dc6809; }
    .link-rss { display: none; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_rss.gif) 0 2px no-repeat; padding-left:18px; line-height:14px; white-space:nowrap; }
    .btn-remove  { display:block; width:11px; height:11px; font-size:0; line-height:0; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/btn_remove.gif) 0 0 no-repeat; text-indent:-999em; overflow:hidden; }
    .btn-previous  { display:block; width:11px; height:11px; font-size:0; line-height:0; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/btn_previous.gif) 0 0 no-repeat; text-indent:-999em; overflow:hidden; }
    .btn-remove2 { display:block; width:16px; height:16px; font-size:0; line-height:0; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/btn_trash.gif) 0 0 no-repeat; text-indent:-999em; overflow:hidden; }
    .btn-edit    { display:block; width:11px; height:11px; font-size:0; line-height:0; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/btn_edit.gif) 0 0 no-repeat; text-indent:-999em; overflow:hidden; }

    .cards-list dt { margin:5px 0 0; }
    .cards-list .offset { padding:2px 0 2px 20px; }

    .separator { margin:0 3px; }

    .divider { clear:both; display:block; font-size:0; line-height:0; height:1px; margin:10px 0; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_divider1.gif) 0 50% repeat-x; text-indent:-999em; overflow:hidden; }

    /* Global site notices */
    .global-site-notice { border:1px solid #cfcfcf; border-width:0 0 1px; background:#ffff90; font-size:12px; line-height:1.25; text-align:center; color:#2f2f2f; }
    .global-site-notice .notice-inner { width:860px; margin:0 auto; padding:12px 0 12px 80px; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_notice.gif) 20px 25px no-repeat; text-align:left; }
    .global-site-notice .notice-inner p { margin:0; border:1px dotted #cccc73; padding:10px; }
    .global-site-notice .notice-inner .actions { padding-top:10px; }

    /* Cookie Notice */
    .notice-cookie { }

    /* Noscript Notice */
    .noscript {}


    /* ======================================================================================= */


    /* Header ================================================================================ */
    .logo { float:left; }
    .header-container {  }
    .header { width:920px; margin:0 auto; padding:0 20px; text-align:right; position:relative; z-index:10; height: 143px;}
    .header .logo { float:left; margin:24px 0 10px 12px; text-decoration:none !important; }
    .header .logo strong { position:absolute; top:-999em; left:-999em; width:0; height:0; font-size:0; line-height:0; text-indent:-999em; overflow:hidden; }
    .header h1.logo { margin:0; }

    .header form { position: absolute; top: 30px; left: 296px; }
    .header .form-search { padding: 8px 12px; background: #f3f3f3; overflow: hidden; width: 380px; position: relative; box-shadow: 0 3px 10px #888;}
    .header .form-search label { display: none; }
    .header .form-search input.input-text { background: #fff; float:left; height: 29px; width: 337px;padding: 0 35px 0 8px; border: 0; font: normal 16px/29px Arial; color: #ccc; font-style: italic; }
    .header .form-search button.button { position: absolute; top: 10px; right: 15px; width: 30px; height: 25px; }
    .header .form-search button.button span { border:0; width: 30px; height:25px; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) 0 0 no-repeat; padding:0; text-indent: -9999em; }
    .header .form-search button.button span span {  }
    .header .links { float:right; margin:3px 0 6px; }
    .header .links li { float:left; border-right: 1px solid #7b7b7a; padding:0 17px 0 0; margin: 0 14px 0 0; line-height: 1; }
    .header .links li.last { border: 0; margin: 0; padding: 0; }
    .header .links li.last .icon-wishlist { background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -203px 0 no-repeat; float: left; width: 13px; height: 17px; margin: 2px 7px 0 0; }
    .header .links a { color:#7b7b7a; font-size: 13px; text-decoration: none;}
    .header .links a:hover { text-decoration: underline;}
    .header-container .top-container { clear:both; padding:5px 10px 0 12px; text-align:right; }
    .header-container .top-container a { font-size:11px; color:#ebbc58; }

    /* Header cart */
    .header .block-header-cart { border: 0; width: 119px; text-align: left; float: right; margin: 0 0 0 15px; position: relative; }
    .header .block-header-cart .block-title { background: #f3f3f3; border: 0; padding: 5px 15px; border-bottom: 2px dotted #cfcdcd; }
    .category-comprar-con-avios .header .block-header-cart .block-title,
    .iberia-cart .header .block-header-cart .block-title { background: #d7192d; color: #ffffff; }
    .header .block-header-cart .cart-icon { float: left; width:21px; height: 16px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -106px 0 no-repeat; margin: 0 6px 0 0; }
    .category-comprar-con-avios .header .block-header-cart .cart-icon,
    .iberia-cart .header .block-header-cart .cart-icon { background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bg-cart-top-iberia.png) no-repeat top left; }
    .header .block-header-cart .block-content { background: #f3f3f3 url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bg-header-cart.png) 0 100% no-repeat; border: 0; padding: 5px 13px 13px; }
    .header .block-header-cart .summary { line-height: 28px; margin: 0; color: #7b7b7a; font-size: 14px; }
    .header .block-header-cart .amount { width: 28px; height: 28px; background: #333; color: #fffef3; border-radius: 28px; margin: 0 5px 0 0; float: left; text-align: center; font-size: 16px;font-weight: 600px;}
    .category-comprar-con-avios .header .block-header-cart .amount,
    .iberia-cart .header .block-header-cart .amount { background: #d7192d; }
    .header .block-header-cart .cart-top-link { position: absolute; display: block; top: 0; left: 0; width: 119px; height: 83px; }

    .header-container .home-top-menu { text-align: left; width: 960px; margin: -40px auto 0; position: relative; z-index: 10000; }
    .header-container .home-top-menu ul { width: 920px; margin: 0 auto; padding: 0 20px; }
    .header-container .home-top-menu li { display: inline-block; margin: 0 3px 0 0; }
    .header-container .home-top-menu a { display: block; font-size: 17px; color: #333; text-decoration: none; background: #ededee; line-height: 33px; font-weight: 400; text-align: center; }
    .header-container .home-top-menu .hover a,
    .header-container .home-top-menu a.hover,
    .header-container .home-top-menu a:hover { font-weight: 700; background-color: #333; color: #fff; }
    .header-container .home-top-menu #tienda { width: 109px; }
    .header-container .home-top-menu #club-vinos { width: 190px; }
    .header-container .home-top-menu #saber-de-vinos { width: 140px; }
    .header-container .home-top-menu .iberia { background: #ededee; padding: 9px 20px 10px; position: relative; top: 9px; }
    .header-container .home-top-menu .iberia.hover,
    .header-container .home-top-menu .iberia:hover { background: #333; }
    .header-container .home-top-menu .iberia a { text-indent: -9999em; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/logo_iberia.png) no-repeat center center; width: 92px; height: 14px; padding: 0; }

    .header-container .home-top-menu .selecciones,
    .header-container .home-top-menu .saber_sub,
    .header-container .home-top-menu .iberia_sub { position: absolute; background: #333; height: 40px; z-index: 1000; }
    .header-container .home-top-menu .selecciones li,
    .header-container .home-top-menu .saber_sub li,
    .header-container .home-top-menu .iberia_sub li { height: 40px; position: relative; margin: 6px 32px 0 0; }
    .header-container .home-top-menu .selecciones li:after,
    .header-container .home-top-menu .saber_sub li:after,
    .header-container .home-top-menu .iberia_sub li:after {
        content: '';
        width: 7px;
        height: 7px;
        background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -215px 0 no-repeat;
        position: absolute;
        right: -20px;
        top: 12px;
        z-index: 1001;
    }
    .header-container .home-top-menu .iberia_sub li:last-child:after,
    .header-container .home-top-menu .saber_sub li:last-child:after,
    .header-container .home-top-menu .selecciones li:last-child:after { content: none; }

    .header-container .home-top-menu .iberia_sub li a,
    .header-container .home-top-menu .saber_sub li a,
    .header-container .home-top-menu .selecciones li a { background: #333; color: #fff;  line-height: 1.5; font-size: 16px; color: #fff; font-weight: 700; position: relative; padding: 2px 7px; }
    .header-container .home-top-menu .iberia_sub li a:hover,
    .header-container .home-top-menu .iberia_sub li a:focus,
    .header-container .home-top-menu .saber_sub li a:hover,
    .header-container .home-top-menu .saber_sub li a:focus,
    .header-container .home-top-menu .selecciones li a:hover,
    .header-container .home-top-menu .selecciones li a:focus { color: #bc1724; background-color: #fff; border-width: 1px 1px 0; }

    /* Header social */
    .home-top-menu .social-header { background: none; border: 0; width: 212px; height: 25px; text-align: left; margin: 25px 20px 7px 0; position: absolute; bottom: 0; right: 0;}
    .home-top-menu .social-header .block-content { background: none; }
    .home-top-menu .social-header ul { margin: 2px 0 0 7px; padding: 0; overflow: hidden; float: left; width: auto;}
    .home-top-menu .social-header li { float: left; margin: 0 3px 0 0; }
    .home-top-menu .social-header li a { display: block; width: 20px; height: 20px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) 0 0 no-repeat; text-indent: -9999em; overflow: hidden; }
    .home-top-menu .social-header ul li a.fb { background-position: -210px -114px; }
    .home-top-menu .social-header ul li a.tw { background-position: -230px -114px; }
    .home-top-menu .social-header ul li a.rss { background-position: -250px -114px; }
    .home-top-menu .social-header ul li a.fb:hover { background-position: -30px 0; background-color: transparent; }
    .home-top-menu .social-header ul li a.tw:hover { background-position: -50px 0; background-color: transparent; }
    .home-top-menu .social-header ul li a.rss:hover { background-position: -70px 0; background-color: transparent; }
    .home-top-menu .social-header .phone { background: #333; float: right; color: #fff; font-size: 16px; margin: 0; padding: 0 7px 0 0; }
    .home-top-menu .social-header .icon-phone { background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -91px 0; width: 16px; height: 13px; float: left; margin: 5px 12px 0 5px; }

    /********** < Navigation */
    .nav-container { background:#333; height: 40px; }
    #nav { width:918px; margin:0 auto; padding:0 16px; font-size:13px; }

    /* All Levels */ /* Style consistent throughout all nav levels */
    #nav li { position:relative; text-align:left; }
    #nav li.over { z-index:998; }
    #nav a,
    #nav a:hover { display:block; line-height:1.3em; text-decoration:none; }
    #nav span { display:block; cursor:pointer; white-space:nowrap; }
    #nav li ul span {white-space:normal; }
    #nav ul li.parent a { background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_nav2.gif) 100% 100% no-repeat; }
    #nav ul li.parent li a { background-image:none; }

    /* 0 Level */
    #nav li { float:left; }
    #nav li.active a { color:#d96708; }
    #nav a { float:left; padding:5px 12px 6px 8px; color:#a7c6dd; font-weight:bold; }
    #nav li.over a,
    #nav a:hover { color:#d96708; }

    /* 1st Level */
    #nav ul li,
    #nav ul li.active { float:none; margin:0; padding-bottom:1px; background:#ecf3f6 url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_nav1.gif) 0 100% repeat-x; }
    #nav ul li.last { background:#ecf3f6; padding-bottom:0; }

    #nav ul a,
    #nav ul a:hover { float:none; padding:0; background:none; }
    #nav ul li a { font-weight:normal !important; }

    /* 2nd Level */
    #nav ul,
    #nav div { position:absolute; width:15em; top:27px; left:-10000px; border:1px solid #899ba5; }
    #nav div ul { position:static; width:auto; border:none; }

    /* 3rd+ Level */
    #nav ul ul,
    #nav ul div { top:5px; }

    #nav ul li a { background:#ecf3f6; }
    #nav ul li a:hover { background:#d5e4eb; }
    #nav ul li a,
    #nav ul li a:hover { color:#2f2f2f !important; }
    #nav ul span,
    #nav ul li.last li span { padding:3px 15px 4px 15px; }

    /* Show menu */
    #nav li ul.shown-sub,
    #nav li div.shown-sub { left:0; z-index:999; }
    #nav li .shown-sub ul.shown-sub,
    #nav li .shown-sub li div.shown-sub { left:100px; }
    /********** Navigation > */
    /* ======================================================================================= */


    /* Sidebar =============================================================================== */
    .block { border:1px solid #c4c1bc; margin:0 0 15px; }
    .block .block-title { background: #333; position: relative; border-bottom:1px solid #ddd; padding:2px 9px; }
    .block .block-title strong { display:block; min-height:16px; color: #fff; font: 300 18px/1 'Open Sans', Arial; background-image: none; text-transform: none; padding: 10px 5px; }
    .block .block-title strong span {}
    .block .block-title strong a { color: #fff; text-decoration:none !important; }
    .block .block-title strong a:hover { text-decoration:underline !important; }
    .block .block-subtitle { margin:0; padding:5px 9px; font-size:1em; font-weight:bold; color:#0a263c; }
    .block .block-content { background:#f8f7f5; }
    .block .block-content li.item { padding:7px 9px; }
    .block .block-content .product-name { color:#1e7ec8; }
    .block .btn-remove,
    .block .btn-edit { float:right; margin:1px 0 2px 5px; }
    .block .actions { background:#dee5e8 url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_block-actions.gif) 0 0 repeat-x; padding:6px 9px; text-align:right; }
    .block .actions a { float:left; }
    .block .actions button.button { float:right; }
    .block .empty { margin:0; padding:5px 9px; }

    .block li.odd { background-color:#f4f3f3; }
    .block li.even { background-color:#fafafa; }

    /* Mini Blocks */
    .block-cart,
    .block-wishlist,
    .block-subscribe,
    .block-compare,
    .block-reorder,
    .block-poll,
    .block-viewed,
    .block-compared,
    .block-related,
    .block-tags,
    .block-login { font-size:11px; line-height:1.25; }
    .block-cart .block-title strong,
    .block-wishlist .block-title strong,
    .block-subscribe .block-title strong,
    .block-compare .block-title strong,
    .block-reorder .block-title strong,
    .block-poll .block-title strong,
    .block-viewed .block-title strong,
    .block-compared .block-title strong,
    .block-related .block-title strong,
    .block-tags .block-title strong,
    .block-login .block-title strong {  background-position:0 0; background-repeat:no-repeat; }

    /* Mini Products List */
    .mini-products-list .product-image { float:left; width:50px; border:1px solid #a9a9a9; }
    .mini-products-list .product-details { margin-left:60px; }
    .block-cart .mini-products-list .product-details .product-name,
    .block-cart .mini-products-list .product-details .nobr small { word-wrap:break-word; }
    .block-cart .mini-products-list .product-details .nobr { white-space:normal !important; }

    /* Block: Condiciones transporte */
    .block-condiciones-transporte { width: 447px; }
    .block-condiciones-transporte .block-title { height: 33px; padding: 0 18px; background: #333; color: #fff; }
    .block-condiciones-transporte .block-title h2 { font-weight: 300; font-size: 18px; color: #fff; line-height: 33px; }
    .block-condiciones-transporte .block-content { background: #ededee; font-size: 12px; line-height: 18px; padding: 15px 24px; }

    /* Block: Condiciones transporte */
    .envio-regalo { font-weight: 700; color: #bc1724; margin: 20px 0; }
    .envio-regalo p { margin: 0; }

    /* Block: Account */
    .block-account { border-color:#bbb; }
    .block-account .block-content { background:#ededee; padding:7px 10px 7px; }
    .block-account .block-content li a { display:block; border-bottom:1px solid #ddd; padding:3px 0; color:#5f5d5c; text-decoration:none !important; }
    .block-account .block-content li a:hover { color:#000000; }
    .block-account .block-content li.last a { border-bottom:0; }
    .block-account .block-content li.current { border-bottom:1px solid #ddd; padding:3px 0; color:#000000; }
    .block-account .block-content li.current.last { border-bottom:0; }

    /* Block: Currency Switcher */
    .block-currency { border:0; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_block-currency.gif) 0 0 no-repeat; padding:7px 12px 10px; height:51px; }
    .block-currency .block-title { background:none; border:0; padding:0; margin:0 0 5px; }
    .block-currency .block-title strong { font:bold 13px/21px Arial, Helvetica, sans-serif; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_block-currency.gif) 0 50% no-repeat; padding:0 0 0 21px; text-transform:none; color:#fff; }
    .block-currency .block-content { background:none; padding:0; }
    .block-currency .block-content select { width:100%; padding:0; }

    /* Block: Layered Navigation */
    .block-layered-nav { border:0; }
    .block-layered-nav .block-title { display: none; }

    .block-layered-nav .block-content { background: none; }
    .block-layered-nav .block-content .actions,
    .block-layered-nav .block-content .block-subtitle{ display: none; }
    .block-layered-nav dt { background: #333; padding:8px; font-weight:300; font-size: 18px; color: #fff; }
    .block-layered-nav dd { padding: 17px 9px; background: #ededee; margin: 0 0 30px; }
    .block-layered-nav dd a { font-size: 12px; color: #000; text-decoration: none; }
    .block-layered-nav dd a:hover,
    .block-layered-nav dd a:focus { text-decoration: underline; }

    .block-layered-nav .currently .block-subtitle{ display: block; color: #000000; font-size: 18px; font-weight: 300; }
    .block-layered-nav .currently { margin: 0 0 30px; background: #ededee; }
    .no-boxshadow .block-layered-nav .currently { border: 1px solid #e7e7e7; }
    .block-layered-nav .currently .block-subtitle { font-weight: 300; font-size: 18px; background: #333; padding:8px; color: #ffffff; }
    .block-layered-nav .currently li { position: relative; margin: 0 0 14px; }
    .block-layered-nav .currently li:last-child { margin: 0; }
    .block-layered-nav .currently .label { font-weight: 600; display: block; }
    .block-layered-nav .currently .value { display: block;  }
    .block-layered-nav .currently .btn-previous,
    .block-layered-nav .currently .btn-remove { position:absolute; right:4px; top:9px; margin:0; width: 16px; height: 16px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -222px 0; text-decoration: none; }
    .block-layered-nav .currently .btn-previous { right:17px; }
    .block-layered-nav .actions { font-size:11px; padding:4px 5px 4px 9px; background:#cad6e4; border:1px solid #dee5e8; border-width:1px 0; text-align:right; }
    .block-layered-nav .actions a { float:none; }
    .block-layered-nav .m-more-less { margin: 20px 0 0; text-align: left; }

    /* Custom filters: Cosecha */
    /*dd.cosecha {}
dt[data-id="m_left_cosecha_filter"] + dd ol.m-filter-item-list { overflow: hidden; height: auto !important; }
dt[data-id="m_left_cosecha_filter"] + dd li { float: left; width: 50%; margin: 0 0 6px; }*/

    /* Custom filter: Price */
    .block-layered-nav .m-filter-slider > .m-slider-span { border-bottom-color: #000; }

    .block-layered-nav .m-filter-slider > .m-slider-from,
    .block-layered-nav .m-filter-slider > .m-slider-to,
    .block-layered-nav .m-filter-slider { background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) 0 0 no-repeat; }

    .block-layered-nav .m-filter-slider { background-position: 17px -191px; }
    .block-layered-nav .m-filter-slider > .m-slider-from { background-position: -237px 0; }
    .block-layered-nav .m-filter-slider > .m-slider-to { background-position: -253px 0; }

    .block-layered-nav .m-slider-selected-value{ color: #bc1724; text-align: center; }

    .block-layered-nav .m-more-less a { padding-left: 17px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -290px 6px no-repeat; }
    .block-layered-nav .m-more-less a.m-show-less-action { background-position: -290px -10px; }


    /* Block: Cart */
    .block-cart .block-title { /*border-bottom:0;*/ }
    .block-cart .block-title strong { background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_block-cart.gif); }
    .block-cart .summary { background:#fff; padding:2px 8px 8px; margin:-1px 0 0; position:relative; z-index:1; }
    .block-cart .amount { margin:0; }
    .block-cart .amount a { font-weight:bold; }
    .block-cart .subtotal { margin:5px 0 0; padding:2px 0; background:#fbebd9; text-align:center; }
    .block-cart .subtotal .price { font-weight:bold; }
    .block-cart .actions { border-bottom:1px solid #c2c2c2; }
    .block-cart .actions .paypal-logo { float:left; width:100%; margin:3px 0 0; text-align:right; }
    .block-cart .actions .paypal-logo .paypal-or { clear:both; display:block; padding:0 55px 8px 0; }

    /* Block: Wishlist */
    .block-wishlist .block-title strong { background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_block-wishlist.gif); }
    .block-wishlist .actions { text-align:right; }
    .block-wishlist .actions a { float:none; }

    /* Block: Related */
    .block-related .block-title strong { background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_block-related.gif); background-position:0 1px; }
    .block-related input.checkbox { float:left; }
    .block-related .product { margin-left:20px; }

    /* Block: Compare Products */
    .block-compare .block-title strong { background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_block-list.gif); background-position:0 1px; }
    .block-compare button.button span { border-color:#406a83; background:#618499; }
    .page-popup .link-print { background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_print.gif) 0 2px no-repeat; padding:2px 0 2px 25px; font-weight:bold; color:#1e7ec8; }
    .compare-table { border:0; }
    .compare-table thead tr.first th,
    .compare-table thead tr.first td { border:0; background:none; padding:0; font-size:0; line-height:0; }
    .compare-table .btn-remove { float:right; background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/btn_remove2.gif); width:72px; height:15px; }
    .compare-table tbody th { background:#d9e5ee url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_th-v.gif) 100% 0 repeat-y; }
    .compare-table tbody th,
    .compare-table tbody td { padding:10px; border:0; border-top:1px solid #ccc; border-left:1px solid #ccc; }
    .compare-table tbody td.last { border-right:1px solid #ccc; }
    .compare-table tbody tr.last th,
    .compare-table tbody tr.last td { border-bottom:1px solid #ccc !important; }
    .compare-table tr.add-to-row td { background:#fffada; text-align:center; }
    .compare-table tr.first td { text-align:center; }
    .compare-table tr.first td .product-name { font-size:13px; font-weight:bold; margin:0 0 5px; color:#203548; }
    .compare-table tr.first td .product-name a { color:#203548; }
    .compare-table tr.first td .ratings { width:69px; margin:0 auto; }
    .compare-table tr.first td p,
    .compare-table tr.add-to-row td p { margin:0; }

    /* Block: Recently Viewed */
    .block-viewed { background: #ffffff; border: 0; box-shadow: 0 0 6px rgba(0,0,0,.3); margin-bottom: 30px; }
    .block-viewed .block-title { margin-bottom: 10px; background: none; border-bottom: 0; }
    .block-viewed .block-title strong { font-weight: 300; font-size: 18px; color: #000000; text-transform: none; }
    .block-viewed .block-content,
    .block-viewed li.odd { background: #ffffff; }
    .block-viewed li.even { background: #fff; }
    .block-viewed .block-content li.item { padding: 0 10px; margin: 0 0 18px; }
    .block-viewed .block-content .img { float: left; width: 40px; margin: 0 10px 0 0; }
    .block-viewed .block-content .product-name,
    .block-viewed .block-content .do { float: left; width: 140px; }
    .block-viewed .block-content .product-name a { color: #000; text-decoration: none; font-size: 12px; }
    .block-viewed .block-content .product-name a:hover,
    .block-viewed .block-content .product-name a:focus { text-decoration: underline; }
    .block-viewed .block-content .do { color: #5e5e5d; font-size: 12px; }
    .block-viewed .block-content .do a { text-decoration: none; }
    .block-viewed .block-content .do a:hover { text-decoration: underline; }



    /* Block: Recently Compared */
    .block-compared .block-title strong { background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_block-list.gif); background-position:0 1px; }

    /* Block: Poll */
    .block-poll .block-title strong { background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_block-poll.gif); }
    .block-poll .block-subtitle { font-size:12px; }
    .block-poll label { color:#777; font-weight:bold; }
    .block-poll input.radio { float:left; margin:1px -18px 0 0; }
    .block-poll .label { display:block; margin-left:18px; }
    .block-poll li { padding:3px 9px; }
    .block-poll .actions { margin:5px 0 0; }
    .block-poll button.button span { border-color:#406a83; background:#618499; }
    .block-poll .answer { font-weight:bold; }
    .block-poll .votes { float:right; margin-left:10px; }

    /* Block: Tags */
    .block-tags .block-title strong { background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_block-tags.gif); }
    .block-tags .block-content .tags-list { background:none; border:0; font-size:12px; }
    .block-tags .block-content a { color:#1b2d3b; }
    .block-tags .actions { text-align:right; }
    .block-tags .actions a { float:none; }

    /* Block: Subscribe */
    .block-subscribe { margin-top: 40px; background: #fff; border: 0; }
    .block-subscribe .block-title { margin: 0; background: none; background: #333; }
    .block-subscribe .block-title strong { color: #fff; font: 300 18px/1 'Open Sans', Arial; background-image: none; text-transform: none; padding: 10px 5px; }
    .block-subscribe .block-content { padding: 8px 12px; font-size: 15px; color: #000; background: #ededee; }
    .block-subscribe label { font-size: 12px; color: #000; margin-bottom: 10px; font-weight: 400; display: block; }
    .block-subscribe input.input-text { background: #fff; border: 0; padding: 0; margin: 0; width: 100%; height: 22px; line-height: 22px; color: #898988; font-style: italic; text-indent: 10px; }
    .block-subscribe .actions { text-align: right; margin: 17px 0 15px; background: none; }

    /* Block: Latest posts; */
    .block-latest-news .block-title { margin: 0; background: none; background: #333; border-bottom: none; }
    .block-latest-news .block-title strong { color: #fff; font: 300 17px/1 'Open Sans', Arial; background-image: none; text-transform: none; padding: 10px 5px; }
    .block-latest-news ul li { width: 210px; height: 275px; position: relative; }
    .block-latest-news ul li h3 { padding: 0 5px 0; margin-bottom: 45px; line-height: 16px; }
    .block-latest-news ul li h3 a { color: #000000; text-decoration: none; font-weight: 600; font-size: 14px; }
    .block-latest-news ul li h3 a:hover { text-decoration: underline; }
    .block-latest-news ul li .date { color: #bf2531; padding: 15px 5px 0; }
    .block-latest-news ul li a.button { padding: 2px 17px; background: #333333; color: #ffffff; font-size: 15px; font-weight: 300; text-decoration: none; position: absolute; bottom: 10px; right: 10px; }
    .block-latest-news ul li .blogImage { height: 141px; overflow: hidden; }


    /* Block: Reorder */
    .block-reorder .block-title strong { background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_block-list.gif); }
    .block-reorder input.checkbox { float:left; margin:2px -20px 0 0; }
    .block-reorder .product-name { margin-left:20px; }
    .block-reorder .validation-advice { margin:3px 9px 7px; }

    /* Block: Banner */
    .block-banner { border:0; }
    .block-banner .block-content { padding:0; text-align:center; }

    /* Block: Login */
    .block-login .block-title strong { background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_ma-info.gif); }
    .block-login .block-content { padding:5px 10px; }
    .block-login label { font-weight:bold; color:#666; }
    .block-login input.input-text { display:block; width:167px; margin:3px 0; }
    .block-login .actions { background:none; padding:0; margin:3px 0 0; }
    .block-login .actions button.button span { border-color:#406a83; background:#618499; }

    /* Block: Twitter */
    .block-twitter { clear: both; }
    .block-twitter .block-title { background: #333; position: relative; }
    .block-twitter .block-title .slider-icon { display: block; width: 21px; height: 21px; text-indent: -9999em; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -182px -85px no-repeat; position: absolute; top: 10px; right: 40px; }
    .block-twitter .block-title .icon-next { background-position: -203px -85px; right: 15px; }
    .block-twitter .block-title strong { color: #fff; font: 300 18px/1 'Open Sans', Arial; background-image: none; text-transform: none; padding: 10px 5px; }
    .block-twitter .block-content {
        background: #ededee url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/twitter-logo-grey.png) right bottom no-repeat;
        padding: 18px 10px;
    }
    .block-twitter .block-content ul { overflow: hidden; }
    .block-twitter .block-content li { float: left; width: 100%; }
    .block-twitter .block-content li a { text-decoration: underline; }
    .block-twitter .block-content li a:hover,
    .block-twitter .block-content li a:focus { text-decoration: none; }

    /* Slider */
    .main .slide-container { margin-bottom: 0; margin-top: -10px; }


    /* ======================================================================================= */

    /* Search by price Page ================================================================== */
    .price-with-image { float: left; width: 220px; margin-right: 130px; margin-bottom: 30px; }
    .price-with-image.last { margin-right: 0; }
    .price-with-image a { text-decoration: none; }
    .price-with-image span { display: block; padding: 3px 10px; background: #990033; color: #ffffff; font-weight: bold; }
    .price-list	{ clear: left; margin-bottom: 30px; float: right; width: 675px; }
    .price-list ul { padding-left: 0; }
    .price-list ul li { float: left; width: 33%; margin-bottom: 15px; list-style: none; }
    .price-list ul li a { text-decoration: none; color: #990033; font-weight: bold; }
    .price-list ul li a:hover { text-decoration: underline; }
    .price-form { width: 205px; border: 1px solid #990033; float: left; }
    .price-form h3 { background: #990033; color: #ffffff; padding: 5px; }
    .price-form form { display: block; padding: 20px 10px; }
    .price-form input { max-width: 50px; }
    .price-form button { margin-top: 20px; }

    /* Category Page ========================================================================= */
    .category-title { border:0; margin:0 0 7px; }
    .category-image { width:100%; overflow:hidden; margin:0 0 10px; text-align:center; }
    .category-image img {}
    .category-description { margin:0 0 14px; padding: 0 9px; }
    .toggle-link-category { color: #333; text-decoration: none; font-size: 11px; line-height: 1.5; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -284px -35px no-repeat; padding: 1px 0 1px 20px; }
    .toggle-link-category.expanded { background-position: -284px -56px; }
    .category-products { clear: both; }

    /* Category Bodegas */
    .catalog-category-view {}
    /*.catalog-category-view .note-msg { display: none; }*/
    .category-vinos .note-msg { display: block; }
    .catalog-category-view .gIndex { border: 1px solid #ccccca; border-width: 1px 0; padding: 6px 0 8px; margin: 0 0 25px; }
    .catalog-category-view .gIndex li { display: inline-block; font:normal 12px/1.5 Arial,sans-serif; }
    .catalog-category-view .gIndex .title { background: #bc1724; color: #fff; padding: 2px 6px; position: relative; margin: 0 18px 0 0; }
    .catalog-category-view .gIndex .title:after { content: ''; width: 0px; height: 0px; border-style: solid; border-width: 11px 0 11px 9px; border-color: transparent transparent transparent #bc1725; top: 0; right: -9px; position: absolute; z-index: 2; }
    .catalog-category-view .gIndex .item { border: 1px solid #ccccca; text-align: center; }
    .catalog-category-view .gIndex .item a { text-decoration: none; color: #000; display: block; padding: 0 2px; width: 15px; }
    .catalog-category-view .gIndex .item a:hover,
    .catalog-category-view .gIndex .item a:focus { background: #ccccca; }

    .catalog-category-view .gLink { line-height: 2; border-bottom: 1px solid #ccccca; font-weight: 300; font-size: 18px; clear: both; position: relative; cursor: pointer; }
    .catalog-category-view .gLink:after { content:''; width: 8px; height: 5px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -292px 0; position: absolute; right: 0; bottom: 6px; }
    .catalog-category-view .gLink.open:after { background-position: -292px -15px; }
    .catalog-category-view .subcategories-list ul { margin: 0 0 16px; }
    .catalog-category-view .gItem { float: left; width: 292px; margin-bottom: 13px; clear: left; }
    .catalog-category-view .gItem h3 { margin: 0; }
    .catalog-category-view .gItem a { font-size: 12px; font-weight: 400; color:#000; text-decoration: none; }
    .catalog-category-view .gItem a:hover,
    .catalog-category-view .gItem a:focus { text-decoration: underline; }
    .catalog-category-view .gItem:nth-child(3n),
    .catalog-category-view .gItem:nth-child(3n-1) { margin-left: 22px; clear: none; }

    .catalog-category-view .di-column { float: left; width: 30%; margin-right: 1%; }

    .catalog-category-view .oferta-destacada { float: left; width: 686px; margin: 40px 0; }
    .catalog-category-view .oferta-destacada > h2,
    .catalog-category-view .category-bodegas-title-list h2,
    .catalog-category-view .category-concurso-title-list h2,
    .catalog-category-view .category-puntuacion-title-list h2 { font-weight: 300; font-size: 24px; line-height: 1; margin: 0 0 30px; text-transform: uppercase; }
    .catalog-category-view .category-concurso-title-list h2,
    .catalog-category-view .category-puntuacion-title-list h2 { margin-bottom: 15px; }
    .catalog-category-view .oferta-destacada .product-name > h2{ font-size: 18px !important; font-weight: 300 !important; text-transform: none; margin: 0 0 5px !important; line-height: 1 !important; }
    .catalog-category-view .oferta-destacada .sdesc { color: #5e5e5d; font-weight: 300; }
    .catalog-category-view .oferta-destacada .product-view .product-shop { float: right; width: 447px; }
    .catalog-category-view .oferta-destacada .product-view .product-img-box { float: left; width: 230px; }
    .catalog-category-view .oferta-destacada .product-view .product-img-box { float: left; width: 230px; }
    .catalog-category-view .oferta-destacada .data-table thead th { border: 0; color: #fff; background: #333; font-size: 18px; font-weight: 300; line-height: 1; padding: 10px 15px; }
    .catalog-category-view .oferta-destacada .data-table tbody td,
    .catalog-category-view .oferta-destacada .data-table tbody .odd,
    .catalog-category-view .oferta-destacada .data-table tbody .even { border: 0; background: #ededee; }
    .catalog-category-view .banner-right { float: right; margin: 100px 0 0; }
    .catalog-category-view .oferta-destacada .data-table tbody td { padding: 8px; }
    .catalog-category-view .oferta-destacada .data-table tbody td.name { font-size: 15px; font-weight: 700; padding-top: 15px; color: #333; }
    .catalog-category-view .oferta-destacada .price { font-size: 24px; font-weight: 700; color: #333 !important; }
    .catalog-category-view .oferta-destacada input.input-text.qty { padding: 0; width: 45px; height: 31px; line-height: 31px; text-align: center; font-style: 15px; }
    .catalog-category-view .oferta-destacada button.button span { width: 33px; height: 33px; border: 0; padding: 0; background:  url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -35px -267px no-repeat; position: relative; text-indent: -9999px; }
    .catalog-category-view .category-bodegas-title-list { clear: both; margin: 40px 0 0; }
    .catalog-category-view .category-bodegas-title-list h2 { text-transform: uppercase; margin: 0 0 5px; }
    .catalog-category-view .table-anyadas { float: left; margin-right: 25px; width: 150px; margin-bottom: 15px; }
    .catalog-category-view .table-anyadas.last { margin-right: 0; }
    .catalog-category-view .table-anyadas a { text-decoration: none; border-bottom: 1px solid; margin-bottom: 5px; line-height: 25px; display: inline-block; height: 19px; }
    .catalog-category-view .table-anyadas a:hover { border-bottom: none; padding-bottom: 1px; }
    .catalog-category-view .table-anyadas td { text-align: left; }
    .catalog-category-view .table-vinos { width: 100%; }

    .catalog-category-view .inner-left { width: 212px; float: left; margin-right: 20px; }
    .catalog-category-view .with-filters { width: 685px; float: left; }

    .catalog-category-view .banner-colecciones { margin-top: 30px; }
    .catalog-category-view .banner-colecciones li { margin-bottom: 0; }

    .category-bodegas-page { }
    .category-bodegas-page .category-gallery { width: 211px; float: left; margin: 0 27px 0 0; }
    .category-bodegas-page .category-gallery li { float: left; width: 66px; margin: 0 6px 0 0; }
    .category-bodegas-page .category-gallery li img { width: 66px; }
    .category-bodegas-page .category-gallery li.first { width: 211px; float: none; margin: 0 0 11px; }
    .category-bodegas-page .category-gallery li.first img { width: 211px; }
    .category-bodegas-page .category-gallery li.last { margin: 0; }
    .category-bodegas-page .right-content-category-bodega .product-actions { margin: 0 0 4px; }

    .category-regiones #subcategories-list h2,
    .category-cosechas #subcategories-list h2 { margin: 30px 0 20px; font-size: 26px; text-transform: uppercase; clear: both; }
    .category-cosechas #subcategories-list ul { padding: 0; }
    .category-cosechas #subcategories-list ul li { list-style: none; }
    .category-cosechas .gItem:nth-child(3n), .category-cosechas .gItem:nth-child(3n-1) {
        margin-left: 22px;
        clear: none;
    }
    .right-content-category-bodega { float: none; width: auto; }
    .right-content-category-bodega .small-steps .home-steps { width: 684px; margin: 0 auto; margin-bottom: 10px; }
    .right-content-category-bodega .small-steps .home-steps .special { right: 0; }
    .right-content-category-bodega .medium-steps .home-steps { margin-bottom: 10px; }

    .bodega .right-content-category-bodega { float: right; width: 682px; }

    .category-image.image-enologo, .category-bodegas-page.enologo,
    .category-image.image-concurso, .category-bodegas-page.concurso,
    .category-image.image-puntuacion, .category-bodegas-page.puntuacion,
    .category-image.image-bodeguero, .category-bodegas-page.bodeguero { float: left; width: auto; }
    .category-bodegas-page.enologo, .category-bodegas-page.bodeguero,
    .category-bodegas-page.puntuacion, .category-bodegas-page.concurso { width: 684px; margin-left: 25px; margin-bottom: 40px; min-height: 290px; }

    /* Category blocks */
    .block-category { margin: 40px 35px 0 0; float: left; width: 283px; }
    .categorypath-vinos-tipos-de-vino-html .block-category.small-block:nth-child(5),
    .categorypath-vinos-tipos-de-vino .block-category.small-block:nth-child(5),
    .categorypath-enoturismo-html .block-category.small-block:nth-child(3), .block-category.last { margin-right: 0; }
    .block-category.big-block { margin-right: 60px; width: 430px; }
    .block-category.big-block:nth-child(2) { margin-right: 0; }
    .block-category .block-category-title { font-weight: 600; font-size: 18px; }
    .block-category .block-category-title a { color: #000000; }
    .block-category .category-image { margin: 0; height: 196px; }
    .block-category .block-category-content { background: #ededee; min-height: 200px; padding: 17px; }
    .block-category .block-category-content li { font-size: 12px; line-height: 1.5; margin: 0 0 10px; }
    .block-category .block-category-content a { color: #333; text-decoration: none; }
    .block-category .block-category-content a:hover,
    .block-category .block-category-content a:focus { text-decoration: underline; }


    .categorypath-vinos-concursos-html h1,
    .categorypath-vinos-puntuaciones-html h1,
    .categorypath-vinos-regiones-html h1,
    .categorypath-vinos-bodegas-html h1,
    .categorypath-vinos-tipos-de-uva-html h1,
    .categorypath-vinos-enologos-html h1,
    .categorypath-vinos-bodegueros-html h1,
    .cms-precios-html h1,
    .categorypath-vinos-tipos-de-vino-html h1 { text-transform: uppercase; border-bottom: 1px solid #cccccc; font-size: 25px; }
    .block-category-box { width: 210px; float: left; margin: 10px 10px 30px; height: 245px; text-align: center; }
    .block-category-box h2 a { font-size: 15px; font-weight: 600; color: #000000; text-decoration: none; }
    .block-category-box h2 a:hover { text-decoration: underline; }
    .block-category-box img { width: 150px; }

    /* View Type: Grid */
    .products-grid { margin: 0 0 30px; }
    .products-grid.last { border-bottom:0; }
    .products-grid li.item { float: left; width: 207px; border-right:1px solid #ccc; padding: 0 10px; position: relative; height: 250px; }
    .products-grid li.last { border:0; }
    .products-grid .product-image { position: absolute; bottom: 0; width:76px; height:184px; margin:0; }
    .products-grid .product-name { min-height: 40px; margin:0 0 7px; font-weight:600; font-size:15px; color:#000; }
    .products-grid .product-name a { color:#000; text-decoration: none; }
    .products-grid .product-name a:hover,
    .products-grid .product-name a:focus { text-decoration: underline; }
    .products-grid .desc,
    .products-grid .sdesc { font-size: 12px; line-height: 14px; margin-left: 85px; }
    .products-grid .sdesc { color: #5e5e5e; }
    .products-grid .actions-box { position: absolute; bottom: 0; right: 0; width: 135px; }
    .products-grid-otros .actions-box { right: 10px; width: 160px; }
    .products-grid .actions { background: #ededee; position: relative; float: left; padding-left: 26px; margin: 0 0 13px; }
    .products-grid .actions:last-child { margin: 0; }
    /*.products-grid .actions:before { content: ''; width: 26px; height: 26px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -102px -85px; border-right: 1px solid #fffef3; position: absolute; left:0; top: 0; } */
    .products-grid .actions .bot-icon { text-indent: -99999px; width: 26px; height: 26px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bg-botella-list.png) no-repeat center center; border-right: 1px solid #fffef3; position: absolute; left:0; top: 0; }
    .products-grid .actions .bot-icon.more { line-height: 27px; text-indent: 5px; background-position: 15px center; }
    .products-grid .actions .bot-icon.more-10 { line-height: 27px; text-indent: 2px; background-position: 18px center; }
    /* .products-grid .actions.last:before { background-position: -128px -85px; }
.products-grid .actions.three-bot:before { background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/3botellas.png) no-repeat 4px 4px; } */
    .products-grid .actions .price-box { float: left; width: 70px; margin: 0 7px 0 0; text-align: right; height: 26px; }
    .products-grid .actions .price-box .price { font-weight: 700; font-size: 16px; color: #333; line-height: 26px; }
    .products-grid .actions button.button { float: right; }
    .products-grid .actions button.button span,
    .cart .crosssell .product-details button span { width: 28px; height: 26px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -154px -85px; border:0; text-indent: -9999em; padding: 0; margin: 0; }

    .products-grid .puntos-ficha { display: none; }
    .products-grid .puntos-listado p { display: none; }
    .products-grid .puntos-listado p.active { display: block; font-weight: 600; color: #c2003c; font-size: 14px; margin-bottom: 0; }
    .products-grid .premios-ficha { display: none; }
    .products-grid .premios-listado p { display: none; }
    .products-grid .premios-listado p.active { display: block; font-weight: 600; color: #c2003c; font-size: 14px; margin-bottom: 0; }
    .puntuacion .products-grid li.item, .concurso .products-grid li.item { height: 270px; }

    .col2-left-layout .products-grid,
    .col2-right-layout .products-grid { width:685px; }

    .products-grid .non-wine-item a.product-image {
        position: relative;
        width: 207px;
        height: auto;
        margin: 0 auto;
    }
    .products-grid .non-wine-item a.product-image img {
        margin: -5px 25px 0;
    }
    .products-grid .non-wine-item .desc, .products-grid .non-wine-item .sdesc{
        font-size: 12px;
        line-height: 14px;
        margin: 0 auto;
    }
    .products-grid .non-wine-item .actions-box .actions{
        padding: 0;
        margin-left: 26px;
    }


    .products-grid-otros li.item { width: 213px; padding: 0 11px; height: 315px; }
    .products-grid-otros li.item.first { padding-left: 0; }
    .products-grid-otros li.item.last { padding-right: 0; }
    .products-grid-otros .product-image { float: none; display: block; width: 100%; height: 150px; margin: 0 0 15px; }
    .products-grid-otros .actions { padding: 0; background: #fff; text-align: right; width: 100%; }
    .products-grid-otros .actions .price-box { background: #ededee; width: auto; float: right; padding-left: 5px; margin: 0; padding-right: 5px; }
    .products-grid-otros .actions .price-box span{ display: inline-block; }
    .products-grid-otros .actions button.button { float: right; }

    .products-grid-otros .actions:before { width: 0; height: 0; content: none; }
    .products-grid-otros .desc,
    .products-grid-otros .sdesc { margin-left: 0; }
    .products-grid-otros .product-image { position: relative; bottom: auto; }

    /* View Type: List */
    /*.products-list li.item { border-bottom:1px solid #d9ddd3; padding:12px 10px; }
.products-list li.item.last { border-bottom:0; }
.products-list .product-image { float:left; width:135px; height:135px; margin:0 0 10px; }
.products-list .product-shop { margin-left:150px; }
.products-list .product-name { margin:0 0 5px; font-weight:bold; font-size:13px; color:#203548; }
.products-list .product-name a { color:#203548; }
.products-list .price-box { float:left; margin:3px 13px 5px 0; }
.products-list .availability { float:left; margin:3px 0 0; }
.products-list .desc { clear:both; padding:6px 0 0; margin:0 0 15px; line-height:1.35; }
.products-list .desc .link-learn { font-size:11px; }
.products-list .add-to-links { clear:both; }
.products-list .add-to-links li { display:inline; }
.products-list .add-to-links .separator { display:inline; margin:0 2px; }*/
    /* ======================================================================================= */


    /* Product View ========================================================================== */
    /* Rating */
    .no-rating { margin:0; }

    .ratings { font-size:11px; line-height:1.25; margin:7px 0; }
    .ratings strong { float:left; margin:1px 3px 0 0; }
    .ratings .rating-links { margin:0; }
    .ratings .rating-links .separator { margin:0 2px; }
    .ratings dt {}
    .ratings dd {}
    .rating-box { width:69px; height:13px; font-size:0; line-height:0; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_rating.gif) 0 0 repeat-x; text-indent:-999em; overflow:hidden; }
    .rating-box .rating { float:left; height:13px; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_rating.gif) 0 100% repeat-x; }
    .ratings .rating-box { float:left; margin-right:3px; }
    .ratings .amount {}

    .ratings-table th,
    .ratings-table td { font-size:11px; line-height:1.15; padding:3px 0; }
    .ratings-table th { font-weight:bold; padding-right:8px; }

    /* Availability */
    .availability { margin:0; }
    .availability span { font-weight:bold; }
    .availability.in-stock span {}
    .availability.out-of-stock span { color:#fff; background-color:#bc1724; padding:1%}

    .availability-only { margin:10px 0 7px; line-height:16px; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_availability_only.gif) 0 50% no-repeat; padding-left:15px; }
    .availability-only span,
    .availability-only a { border-bottom:1px dashed #751d02; color:#000; }
    .availability-only a { background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_availability_only_arrow.gif) 100% 0 no-repeat; cursor:pointer; padding-right:15px; text-decoration:none; }
    .availability-only .expanded { background-position:100% -15px; }
    .availability-only strong { color:#be2c00; }

    .availability-only-details { margin:0 0 7px; }
    .availability-only-details th { background:#d2d6d9; font-size:10px; padding:0 8px; }
    .availability-only-details td { background:#ebf0f3; border-bottom:1px solid #fff; font-size:11px; padding:2px 8px 1px; }
    .availability-only-details tr.odd td.last { color:#d95e00; font-weight:bold; }

    .product-view .product-shop .availability { font-size:11px; }
    .product-view .product-shop .availability span { font-weight:normal; }

    /* Email to a Friend */
    .email-friend { margin:0; }

    /* Alerts */
    .alert-price { margin:0; font-size:11px; }
    .alert-stock { margin:0; font-size:11px; }

    /********** < Product Prices */
    .price { white-space:nowrap !important; }
    .price-discount { background: #bc1724; padding: 1px 3px; color: #ffffff; position: relative; top: 5px; left: 23px; z-index: 999; float: left; height: 15px; line-height: 15px; display: block; margin-top: -10px; }
    .price-reference {
        background: #bc1724;
        padding: 1px 3px;
        color: #fff;
        position: relative;
        top: 0px;
        right: 31px;
        z-index: 2;
        float: right;
        height: 15px;
        line-height: 15px;
        display: block;
        margin-top: -10px;
        text-decoration: line-through;
    }
    .a-left .price-reference {
        right: 0px;
    }

    .price-box { margin:5px 0; }
    .price-box .price { font-weight:bold; color:#c76200; }

    /* Regular price */
    .regular-price { color:#c76200; }
    .regular-price .price { font-weight:bold; font-size:13px; color:#c76200; }
    .block .regular-price,
    .block .regular-price .price { color:#2f2f2f; }

    /* Old price */
    .old-price { margin:0; display: none; }
    .old-price .price-label { white-space:nowrap; color:#999; }
    .old-price .price { font-weight:bold; color:#c76200; text-decoration:line-through; }

    /* Special price */
    .special-price { margin:0; }
    .special-price .price-label { font-size:13px; font-weight:bold; white-space:nowrap; color:#cd5033; display: none; }
    .special-price .price { font-size:13px; font-weight:bold; color:#c76200; }

    /* Minimal price (as low as) */
    .minimal-price { margin:0; }
    .minimal-price .price-label { font-weight:bold; white-space:nowrap; }

    .minimal-price-link { display:block; }
    .minimal-price-link .label {color:#1e7ec8;}
    .minimal-price-link .price { font-weight:normal; color:#1e7ec8; }

    /* Excluding tax */
    .price-excluding-tax { display:block; color:#999; }
    .price-excluding-tax .label { white-space:nowrap; color:#999; }
    .price-excluding-tax .price { font-size:13px; font-weight:normal; color:#c76200; }

    /* Including tax */
    .price-including-tax { display:block; color:#999; }
    .price-including-tax .label { white-space:nowrap; color:#999; }
    .price-including-tax .price { font-size:13px; font-weight:bold; color:#c76200; }

    /* Configured price */
    .configured-price { margin:0; }
    .configured-price .price-label { font-weight:bold; white-space:nowrap; }
    .configured-price .price { font-weight:bold; }

    /* FPT */
    .weee { display:block; font-size:11px; color:#444; }
    .weee .price { font-size:11px; font-weight:normal; }

    /* Excl tax (for order tables) */
    .price-excl-tax  { display:block; }
    .price-excl-tax .label { display:block; white-space:nowrap; }
    .price-excl-tax .price { display:block; }

    /* Incl tax (for order tables) */
    .price-incl-tax { display:block; }
    .price-incl-tax .label { display:block; white-space:nowrap; }
    .price-incl-tax .price { display:block; font-weight:bold; }

    /* Price range */
    .price-from { margin:0; }
    .price-from .price-label { font-weight:bold; white-space:nowrap; }

    .price-to { margin:0; }
    .price-to .price-label { font-weight:bold; white-space:nowrap; }

    /* Price notice next to the options */
    .price-notice { padding-left:10px; color:#999; }
    .price-notice .price { font-weight:bold; color:#2f2f2f; }

    /* Price as configured */
    .price-as-configured { margin:0; }
    .price-as-configured .price-label { font-weight:bold; white-space:nowrap; }

    .price-box-bundle { padding:0 0 10px 0; }
    .price-box-bundle .price-box { margin:0 !important; padding:0 !important; }
    .price-box-bundle .price { color:#555; }
    /********** Product Prices > */

    /* Tier Prices */
    .product-pricing,
    .tier-prices { margin:10px 0; padding:10px; background-color:#f4f7f7; border:1px solid #dadddd; color:#424242; }
    .tier-prices li { line-height:1.4; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_tier.gif) no-repeat 0 3px; padding:2px 0 2px 10px; }
    .tier-prices .benefit { font-style:italic; font-weight:bold; color:#2f2f2f; }
    .tier-prices .price { font-weight:bold; color:#2f2f2f; }

    .tier-prices-grouped li { padding:2px 0; color:#000000; }
    .tier-prices-grouped li .price { font-weight:bold; }

    /* Add to Links */
    .add-to-links { font-size:11px; margin:5px 0 0; }
    .add-to-links .separator { display:none; }

    /* Add to Cart */
    .add-to-cart label { float:left; margin-right:5px; font-weight:bold; color:#666; }
    .add-to-cart .qty { float:left; margin-right:5px; }
    .add-to-cart button.button { float:left; }
    .add-to-cart .paypal-logo { clear:left; margin:0; text-align:right; }
    .add-to-cart .paypal-logo .paypal-or { clear:both; display:block; margin:5px 60px 5px 0; }
    .product-view .add-to-cart .paypal-logo { margin:0; }

    /* Add to Links + Add to Cart */
    .add-to-box { margin:10px 0; }
    .add-to-box .add-to-cart { float:left; }
    .add-to-box .or { float:left; font-weight:bold; margin:0 7px; color:#666; }
    .add-to-box .add-to-links { float:left; margin:0; font-size:12px !important; line-height:1.25 !important; text-align:left !important; }
    .add-to-box .add-to-links li { display:block !important; }
    .add-to-box .add-to-links li .separator { display:none !important; }


    .product-view { margin: 5px 0 0; }

    .product-essential { margin-bottom: 40px; }
    .product-essential h2 { font:bold 13px/1.35 Arial, Helvetica, sans-serif; }

    .product-collateral { float: left; width: 688px; margin: 0 20px 0 0; }
    .tabs-container li { float: left; background: #ededed; margin: 0 5px 0 0; }
    .tabs-container li.last { margin: 0; }
    .tabs-container a { float: left; height: 40px; line-height: 40px; padding: 0 17px; font-weight: 300; font-size: 18px; color: #000; text-decoration: none; }
    .tabs-container li.active,
    .tabs-container li:hover { background: #333; }
    .tabs-container li.active a,
    .tabs-container li a:hover { color: #fff; }
    .tabs .content { padding: 27px; border-top: 1px solid #ccc; }
    .tabs ul.columns li { float: left; width: 30%; }
    .tabs .columns ul li { float: left; width: 30%; }

    /* Product Images */
    .product-view .product-img-box { float:left; width:220px; }
    .product-view-otros .product-img-box { float:left; width:448px; }
    .col3-layout .product-view .product-img-box { float:none; margin:0 auto; }
    .product-view .product-img-box .product-image { margin:0 0 13px; }

    .product-view .product-img-box .more-views h4 { display: none; }
    .product-view .product-img-box .more-views h2 { font-size:11px; border-bottom:1px solid #ccc; margin:0 0 8px; text-transform:uppercase; }
    .product-view .product-img-box .more-views ul { margin-left:-9px }
    .product-view .product-img-box .more-views li { float:left; margin:0 0 8px 9px; opacity: .5; border: 1px solid #fff; }
    .product-view .product-img-box .more-views li.active { opacity: 1; border:1px solid #ccc; }
    .product-view .product-img-box .more-views li a { float:left; width:43px; height:111px; overflow:hidden; }
    .product-view-otros .product-img-box .more-views li a { width:129px !important; height:90px !important; }

    /* Product Shop */
    .product-view .product-shop { float:right; width:330px; }
    .col1-layout .product-view .product-shop { float:right; width:684px; }
    .col1-layout .product-view-otros .product-shop { float:right; width:449px; }
    .col3-layout .product-view .product-shop { float:none; width:auto; }
    .product-view .product-shop .product-name .selection-title { display: inline; padding: 1px 15px; height: 21px; line-height: 21px; text-transform: uppercase; background: #ededee; color: #333; font-weight: 300; text-align: center; margin-bottom: 10px; font-size: 14px; }
    .product-view .product-shop .product-name h1,
    .product-view-otros .product-name h1 { margin:0 0 10px; font:300 33px/1 'Open Sans', Arial, Helvetica, sans-serif; }
    .product-view .product-shop .product-name h2 { margin:0 0 15px; font:400 15px/1.2 'Open Sans', Arial, Helvetica, sans-serif; }
    .product-view .product-shop .description { margin: 0 0 40px; }
    .product-view .product-shop .add-to-cart-wrapper { background: #ededee url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bg-add-to-cart-wrapper.gif) 0 0 repeat-x; margin: 0 0 5px; }
    .product-view .product-shop .add-to-cart-wrapper table { float: left; width: 366px; padding: 0 10px; }
    .product-view .product-shop .add-to-cart-wrapper.grouped table { width: 100%; }
    .product-view-otros .product-shop .add-to-cart-wrapper table { width: 449px; }
    .product-view-otros .product-shop .add-to-cart-wrapper.grouped table { width: 100%; }
    .product-view .product-shop .add-to-cart-wrapper table,
    .product-view .product-shop .add-to-cart-wrapper table tr,
    .product-view .product-shop .add-to-cart-wrapper table td,
    .product-view .product-shop .add-to-cart-wrapper table th { background: none; border: 0; }
    .product-view .product-shop .add-to-cart-wrapper table th { font-size: 18px; font-weight: 300; color: #fff; padding: 3px 8px; }
    .product-view .product-shop .add-to-cart-wrapper.grouped table th.last { text-align: left; }
    .product-view .product-shop .add-to-cart-wrapper table td { padding: 7px; }
    .product-view .product-shop .add-to-cart-wrapper.grouped table td.last { width: 300px; }
    .product-view .product-shop .add-to-cart-wrapper.grouped table.grouped-items-table-otros td.last { width: auto; }
    .product-view .product-shop .add-to-cart-wrapper.grouped .grouped-items-form-otros .add-to-box { margin: 15px 20px 20px 0; }
    .product-view .product-shop .add-to-cart-wrapper table td.format { font-size: 15px; vertical-align: middle; }
    .product-view .product-shop .add-to-cart-wrapper table td.format .reference { font-size: 12px; margin-left: 15px; float: right; }
    .product-view .product-shop .add-to-cart-wrapper table .first td { padding-top: 14px; }
    .product-view .product-shop .add-to-cart-wrapper table .last td { padding-bottom: 14px; }
    .product-view .product-shop .add-to-cart-wrapper table .price-box .price { font-weight: 700; font-size: 22px !important; color: #4b4b4b; }
    .product-view .product-shop .add-to-cart-wrapper table input.qty { width: 45px; height: 31px; line-height: 31px; text-align: center; border: 1px solid #d9d9d9; }
    .product-view .product-shop .add-to-cart-wrapper.grouped table input.qty { float: left; margin-right: 15px; }
    .product-view .product-shop .add-to-cart-wrapper.simple { position: relative; }
    .product-view .product-shop .add-to-cart-wrapper.simple .add-to-box { float: right; margin: 48px 20px 0 0; }
    .product-view .product-shop .add-to-cart-wrapper.simple td.last .add-to-cart { position: absolute; top: 100px; right: 19px; display: block; }
    .product-view .product-shop .add-to-cart-wrapper.simple td.last .add-to-cart-simple { position: absolute; top: 50px; right: 19px; display: block; }
    .product-view-otros .product-shop .add-to-cart-wrapper.simple .add-to-box { margin: 10px 20px 20px 0; }
    .product-view .product-shop .add-to-cart-wrapper.grouped .add-to-box { float: right; margin: 75px 20px 0 0; }
    .product-view-otros .product-shop .add-to-cart-wrapper .add-to-box { margin-top: 20px; margin-bottom: 20px; }
    .product-view .add-to-cart button { }
    .product-view .add-to-cart button span { background: #333; padding: 0 10px 0 5px; color: #fff; text-transform: uppercase; font-weight: 600; border: 0; height: 33px; line-height: 33px; font-size: 18px; }
    .product-view .add-to-cart button span span { float: left; }
    .product-view .add-to-cart button .icon { float: left; width: 26px; height: 24px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bg-cart-button.png) 0 4px no-repeat; margin: 2px 5px 0 0; }
    .product-actions { clear: both; padding: 3px 0; border: 1px solid #ccc; border-width: 1px 0; margin: 0 0 10px; }
    .product-actions .product-share,
    .product-actions .add-whishlist,
    .product-actions p,
    .product-actions ul,
    .product-actions li { float: left; }

    /*.price-box.price-red .price{ color: #bc1724 !important; }*/

    .product-share,
    .product-view .product-shop .add-whishlist { padding: 6px 0; }

    .product-share li { margin: 0 3px 0 0; }
    .product-share a { float: left; width: 20px; height: 20px; text-indent: -9999em; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png); }
    .product-share p { margin: 0 15px 0 0; }
    .product-share .share-fb a { background-position: -30px 0; }
    .product-share .share-tw a { background-position: -50px 0; }
    .product-share .share-gp a { width: 21px; background-position: -225px -86px; }
    .product-share .email-friend a { width: 22px; background-position: -246px -85px; }
    .product-share .print a { padding: 2px; width: 22px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/print.png) 0 0 no-repeat; }

    .product-view .product-shop .add-whishlist { margin: 0 0 0 30px; padding-left: 4px; border-left: 1px solid #ccc; }
    .product-view .product-shop .add-whishlist a { padding: 1px 0 1px 22px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -268px -85px no-repeat; color: #5e5e5e; font-weight: 600; text-decoration: none; }

    .product-view .product-shop .general-features h2,
    .product-view-otros .general-features h2 { font-size: 18px; line-height: 1; font-weight: 300; color: #333; padding: 0 0 5px; border-bottom: 1px solid #ccc;}
    .product-view .product-shop .general-features .content,
    .product-view-otros .general-features .content { padding: 0 27px; }
    .product-view .product-shop .general-features li,
    .product-view-otros .general-features li { display: inline-block; vertical-align: top; width: 47%; margin: 0 2% 10px 0; }
    .product-view-otros .general-features li { width: 100% !important; }
    .product-view .product-shop .general-features li:nth-child(2n),
        /*.product-view-otros .general-features li:nth-child(2n) { margin: 0 0 10px 2%; }*/

    .product-view-otros .general-features { clear: both; }

    .product-view .product-shop .price-box { margin:10px 0; }
    .product-view .product-shop .add-to-links { margin:0; }
    .product-view .product-shop .add-to-links { font-size:12px; text-align:right; }
    .product-view .product-shop .add-to-links li,
    .product-view .product-shop .add-to-links li .separator { display:inline; }
    .product-view .product-shop .add-to-links a { color:#1E7EC8 !important; font-weight:normal !important; }

    .catalog-product-view .main { padding: 10px 20px 0; }
    .catalog-product-view .box-up-sell { clear: both; margin: 0 0 40px; }
    .catalog-product-view .box-up-sell > h2,
    .catalog-product-view .block-related-wrapper > h2 { font-weight: 300; font-size: 24px; text-transform: uppercase; line-height: 1; padding: 0 0 5px; border-bottom: 1px solid #ccc; margin: 0 0 30px; }

    .product-view .product-image { position: relative; }
    .product-view .product-image .pegatina-pr,
    .product-view .product-image .pegatina-se { background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/pegatinas_g.png) no-repeat 0 0; position: absolute; top: 15px; left: 0; text-indent: -9999px; width: 93px; height: 44px; }
    .product-view .product-image .pegatina-se { top: 65px; }
    .product-view .product-image .ultimos-dias { background-position: 0 -47px; }
    .product-view .product-image .primicia { background-position: 0 -94px; }
    .product-view .product-image .ultimas-botellas { background-position: 0 -141px; }
    .product-view .product-image .exclusivo { background-position: 0 -188px; }

    .products-grid .pegatina { background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/pegatinas_p.png) no-repeat 0 0; position: absolute; top: 82px; left: 5px; text-indent: -9999px; width: 70px; height: 33px; }
    .products-grid .pegatina-secundaria { top: 47px; }
    .products-grid .ultimos-dias { background-position: 0 -35px; }
    .products-grid .primicia { background-position: 0 -69px; }
    .products-grid .ultimas-botellas { background-position: 0 -103px; }
    .products-grid .exclusivo { background-position: 0 -137px; }

    .product-view .puntos-listado, .product-view .premios-listado { display: none; }

    .catalog-product-view .home-product-list { margin-bottom: 0; }

    /* Product Options */
    .product-options { margin:20px 0 0; padding:10px 15px 20px; position:relative; background-color:#f6f6f6; border:1px solid #e4e4e4; }
    .product-options dt { padding:10px 0 0; font-weight:normal; }
    .product-options dt label { font-weight:bold; color:#2f2f2f; }
    .product-options dt label.required em { color:#eb340a; margin-left:5px; }
    .product-options dd .qty-holder { display:block; padding:10px 0 0; }
    .product-options dd .qty-holder label { vertical-align:middle; }
    .product-options dt .qty-disabled { background:none; border:0; padding:3px; color:#2f2f2f; }
    .product-options dd { padding:5px 10px 15px; margin:0 0 5px; border-bottom:1px solid #e4e4e4; }
    .product-options dl.last dd.last { border-bottom:0; padding-bottom:5px; margin-bottom:0; }
    .product-options dd input.input-text { width:98%; }
    .product-options dd input.datetime-picker { width:150px; }
    .product-options dd .time-picker { display:-moz-inline-box; display:inline-block; padding:2px 0; vertical-align:middle; }
    .product-options dd textarea { width:98%; height:8em; }
    .product-options dd select { width:99%; }
    .product-options dd .multiselect option { border-bottom:1px dotted #d9e5ee; padding:2px 4px; }
    .product-options ul.options-list { margin-right:5px; }
    .product-options ul.options-list li { line-height:1.5; padding:2px 0; }
    .product-options ul.options-list input.radio { float:left; margin-top:3px; }
    .product-options ul.options-list input.checkbox { float:left; margin-top:3px; }
    .product-options ul.options-list .label { display:block; margin-left:18px; }
    .product-options ul.options-list label { font-weight:normal; }
    .product-options ul.validation-failed { padding:0 7px; }
    .product-options p.note { margin:0; font-size:11px; }
    .product-options p.required { position:absolute; right:20px; top:20px; }

    .product-options-bottom { background-color:#fffada; padding:15px 20px; border:1px solid #e4e4e4; border-top:0; }
    .product-options-bottom .product-pricing,
    .product-options-bottom .tier-prices { margin:0; padding:0 0 10px; border:0; background:0; color:#000000; }
    .product-options-bottom .tier-prices li { background:0; padding:2px 0; }
    .product-options-bottom .tier-prices .price,
    .product-options-bottom .tier-prices .benefit { color:#000000; }
    .product-options-bottom .price-box { float:left; margin:0; padding:0; }
    .product-options-bottom .add-to-links { clear:both; padding:5px 0 0; text-align:right; }
    .col3-layout .product-options-bottom .price-box { float:none; padding:0 0 5px; }
    .product-options-bottom .price-label { float:left; padding-right:5px; }
    .product-options-bottom .price-tax { float:left; }
    .product-options-bottom .add-to-cart { float:right; }
    .product-shop .product-options-bottom { margin:0 0 10px; }
    .product-shop .product-options-bottom .price-box { float:none; margin:0 0 5px; }
    .product-shop .product-options-bottom .price-label { float:none; padding-right:0; }
    .product-shop .product-options-bottom .price-tax { float:none; }
    .product-shop .product-options-bottom .add-to-cart-box { clear:both; float:left; padding-top:12px; }
    .product-shop .product-options-bottom .add-to-links { clear:both; padding:5px 0 0; text-align:right; }

    /* Grouped Product */
    .product-view .grouped-items-table .price-box { margin:0; padding:0; }

    /* Block: Description */
    .product-view .box-description {}

    /* Block: Additional */
    .product-view .box-additional .data-table th,
    .product-view .box-additional .data-table td { line-height:1.25; }

    /* Block: Upsell */
    .product-view .box-up-sell h2 { border-bottom:0; padding:0; margin:0 0 8px; }
    .product-view .box-up-sell .products-grid { width:100%; border:1px solid #e5dcc3; }
    .product-view .box-up-sell .products-grid td { width:25%; background:#f6f2e7; border-right:1px solid #e5dcc3; border-bottom:1px solid #e5dcc3; padding:15px 10px 12px; line-height:1.6em; }
    .product-view .box-up-sell .products-grid tr.last td { border-bottom:0; }
    .product-view .box-up-sell .products-grid td.last { border-right:0; }
    .product-view .box-up-sell .products-grid td img { border:1px solid #e5dcc3; }
    .product-view .box-up-sell .products-grid .product-image { text-align:center; }
    .product-view .box-up-sell .products-grid td.empty { border-right:0; background:#f1ecdb; }
    .product-view .box-up-sell .products-grid .ratings .rating-box { float:none; display:block; margin:0 0 3px; }

    /* Block: Tags */
    .product-view .box-tags { margin:0; }
    .product-view .box-tags h3 { font-size:13px; }
    .product-view .box-tags .product-tags { display:block; margin:0 0 15px; }
    .product-view .box-tags .product-tags li { display:inline; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_pipe3.gif) 100% 4px no-repeat; padding:0 7px 0 4px; }
    .product-view .box-tags .product-tags li.first { padding-left:0; }
    .product-view .box-tags .product-tags li.last { background:none; padding-right:0; }
    .product-view .box-tags .form-add label { display:block; font-size:13px; font-weight:bold; margin:0 0 5px; color:#0a263c;}
    .product-view .box-tags .form-add .input-box { float:left; width:305px; margin:0 5px 0 0; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_tag_add.gif) 0 2px no-repeat; padding:0 0 0 23px; }
    .product-view .box-tags .form-add input.input-text { width:299px; }
    .product-view .box-tags .form-add button.button span { border-color:#406a83; background:#618499; }
    .product-view .box-tags .note { margin:3px 0 0; padding:0 0 0 23px; font-size:11px; }

    /* Block: Reviews */
    .product-view .box-reviews dl { margin:15px 0; }
    .product-view .box-reviews dt a,
    .product-view .box-reviews dt span { font-weight:bold; }
    .product-view .box-reviews dd { margin:0 0 15px; }
    .product-view .box-reviews dd small { font-style:italic; }
    .product-view .box-reviews .form-add { margin:15px 0 0; }
    .product-view .box-reviews .form-add h3 { font-size:13px; font-weight:normal; }
    .product-view .box-reviews .form-add h3 span { font-weight:bold; }
    .product-view .box-reviews .form-add h4 { font-size:12px; }
    .product-view .box-reviews .form-add .data-table td { text-align:center; }
    .product-view .box-reviews .form-add .form-list { margin:15px 0 0; }
    .product-view .box-reviews .form-add .form-list .input-box { width:360px; }
    .product-view .box-reviews .form-add .form-list input.input-text,
    .product-view .box-reviews .form-add .form-list textarea { width:354px; }

    /* Send a Friend */
    .send-friend .form-list { width:615px; overflow:hidden; }
    .send-friend .form-list li { margin-right:-15px; }
    .send-friend .form-list li p { margin:0 15px 0 0; }
    .send-friend .form-list .field { width:315px; }
    .send-friend .form-list .input-box { width:300px; }
    .send-friend .form-list input.input-text,
    .send-friend .form-list textarea { width:294px; }
    .send-friend .form-list li.wide .input-box { width:612px; }
    .send-friend .form-list li.wide textarea { width:609px; }
    .send-friend .buttons-set .limit { float:right; margin:0 7px 0 0; font-size:11px; line-height:21px; }
    /* ======================================================================================= */


    /* Content Styles ================================================================= */
    .product-name { margin:0; font-size:1em; font-weight:normal; }
    .product-name a { color:#1e7ec8; }

    /* Product Tags */
    .tags-list { display:block; font-size:13px; border:1px solid #c1c4bc; background:#f8f7f5; padding:10px; }
    .tags-list li { display:inline !important; margin:0 4px 0 0; }
    .tags-list li a { color:#1b2d3b; }

    /* Advanced Search */
    .advanced-search .form-list label { width:160px; padding-right:10px; }
    .advanced-search .form-list .input-box,
    .advanced-search .form-list .input-range { float:left; clear:none; }
    .advanced-search-amount { margin:0 0 10px; }
    .advanced-search-summary { margin:10px 0; border:1px solid #e9d7c9; background:#fff6f1; padding:10px; }
    .advanced-search-summary ul { float:left; width:49%; }
    .advanced-search-summary strong { color:#E17C24; padding-left:15px; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_search_criteria.gif) 0 3px no-repeat; }
    .advanced-search-summary p { clear:both; font-weight:bold; margin:0; }

    /* CMS Home Page */
    .cms-home .subtitle {}
    .cms-index-index .subtitle {}
    .magestore-bannerslider .flexslider { border: none; box-shadow: none; border-radius: 0; margin: 0;}
    .magestore-bannerslider .flexslider.one-slide { margin-bottom: 0; }
    .magestore-bannerslider .flexslider .flex-control-nav { bottom: 0px; }
    .cms-index-index .magestore-bannerslider .flexslider { margin-top: -10px; }

    /* Nuestras selecciones */
    .category-nuestras-selecciones .page-title { border: 0; }
    .category-nuestras-selecciones .category-description { padding: 0; }
    .category-nuestras-selecciones .content-top p { margin: 0 0 .3em; }
    .category-nuestras-selecciones .content-top > p { margin: 0 0 30px; }
    .category-nuestras-selecciones .content-top ol { list-style: none; margin: 0; padding: 0; }
    .category-nuestras-selecciones .content-top ol li { float: left; width: 264px; margin: 0 20px; }
    .category-nuestras-selecciones .content-top .img { min-height: 150px; margin: 0 0 20px; }
    .category-nuestras-selecciones .right .prod-name a { color: black; text-decoration: none; }
    .category-nuestras-selecciones .right .prod-name a:hover { text-decoration: underline; }

    .category-nuestras-selecciones .selections-wrapper { clear: both; padding: 50px 0 0; }
    .category-selection { margin: 0 0 40px; }
    .category-selection h2 { font-size: 24px; margin: 0 0 15px; }
    .category-selection h2 a { color: #000; }
    .category-selection-wrapper { padding: 20px; background: #ededee; position: relative; }
    .category-selection-wrapper > .left { width: 396px; }
    .category-selection-wrapper .desc { margin: 0 0 20px; }
    .category-selection-wrapper .veces_anyo,
    .category-selection-wrapper .uds_venta,
    .category-selection-wrapper .pvp_aprox { margin: 0 0 15px; }
    .category-selection-wrapper .veces_anyo strong,
    .category-selection-wrapper .uds_venta strong,
    .category-selection-wrapper .pvp_aprox strong { display: block; }
    .category-selection-wrapper .avios { float: left; background: #bc1724 url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_avios.png) 100% 0 no-repeat; color: #fff; font-weight: 600; font-size: 14px; line-height: 31px; padding: 0 47px 0 10px; margin: 0; }
    .category-selection-wrapper .addtocart-wrapper,
    .category-selection-info .addtocart-wrapper { clear: both; padding: 65px 0 0; margin: 0; position: absolute; bottom: 0; left: 0; width: 396px; position: absolute; bottom: 20px; left: 20px; }
    .category-selection-wrapper .addtocart,
    .category-selection-info .addtocart { display: block; height: 53px; line-height: 53px; font-size: 18px; font-weight: 600; text-transform: uppercase; text-align: center; background: #333; color: #fff; text-decoration: none; }
    .category-selection-wrapper .addtocart:hover,
    .category-selection-wrapper .addtocart:focus,
    .category-selection-info .addtocart:hover,
    .category-selection-info .addtocart:focus { background: #222; }

    .category-selection-wrapper > .right { background: #fff; width: 380px; padding: 20px 20px 12px; position: relative; min-height: 376px; }
    .category-selection-wrapper > .right.otros { width: 287px; min-height: 355px; }
    .category-selection-wrapper > .right .left { width: 115px; margin: 0 10px 0 0; }
    .category-selection-wrapper > .right .right { width: 255px; }
    .category-selection-wrapper .right .products-grid .actions .bot-icon.more { line-height: 36px; text-indent: 6px; background-position: 18px center; height: 34px; width: 32px; }
    .category-selection-wrapper h2.selection-title { text-transform: capitalize; font-size: 18px; padding: 0 0 5px; border-bottom: 1px solid #ccccca; margin: 0 0 30px; }
    .category-selection-wrapper .otros h2.selection-title { margin: 0; }
    .category-selection-wrapper h3.prod-name { font-weight: 600; font-size: 15px; }
    .category-selection-wrapper p.subtitle { font-size: 12px; color: #5e5e5d; padding: 0; margin: 0 0 15px; font-weight: 400; }
    .category-selection-wrapper .img { margin: 0 0 10px; }
    .category-selection-wrapper .descripcion_seleccion ul,
    .category-selection-lastproduct .descripcion_seleccion ul { list-style: none; }
    .category-selection-wrapper .descripcion_seleccion li,
    .category-selection-lastproduct .descripcion_seleccion li { padding: 0 0 0 6px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_list_seleccion.gif) 0 8px no-repeat; }
    .category-selection-lastproduct .products-grid { margin: 0; padding: 50px 0 0; }
    .selections-wrapper .category-selection-wrapper .otros .actions-box { position: relative; top: auto; right: auto; margin-top: 20px; }
    .selections-wrapper .category-selection-wrapper .otros .actions-box .actions { width: 290px; }

    .category-selection-wrapper .otros .descripcion_seleccion { color: #5e5e5d; }
    .category-selection-wrapper .products-grid { margin: 0; position: absolute; bottom: 30px; right: 20px;}
    .category-selection-wrapper .products-grid-otros { margin: 0; position: relative; bottom: 0; left: 0;}
    .category-selection-wrapper .products-grid .actions:before,
    .category-selection-lastproduct .products-grid .actions:before, { width: 33px; height: 33px; background-position: 0 -267px; }
    .category-selection-wrapper .products-grid .actions .price-box,
    .category-selection-lastproduct .products-grid .actions .price-box { width: 106px; }
    .category-selection-wrapper .products-grid .actions .price-box .price,
    .category-selection-lastproduct .products-grid .actions .price-box .price { font-size: 23px; line-height: 33px; }
    .category-selection-wrapper .products-grid .actions button.button span,
    .category-selection-lastproduct .products-grid .actions button.button span { width: 35px; height: 33px; background-position: -33px -267px; }
    .selections-wrapper .category-selection-wrapper .otros .actions-box .actions .price-box { height: 33px; }

    .category-selection-info { margin: 0 0 30px; }
    .category-selection-info .left { padding: 22px; background: #ededee; margin: 0 40px 0 0; width: 166px; position: relative; }
    .category-selection-info .left strong { display: block; }
    .category-selection-info .left .pvp_aprox { margin: 0 0 40px; }
    .category-selection-info .left .avios { width: 130px; padding: 3px 58px 3px 22px; background: #bc1724 url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_avios.png) 100% 0 no-repeat; position: absolute; bottom: 0; left: 0; color: #fff; margin: 0; line-height: 1.05; }
    .category-selection-info .right { width: 670px; }
    .category-selection-info .desc { margin: 0; }
    .category-selection-info .addtocart-wrapper { position: relative; top: auto; bottom: auto; left: auto; right: auto; padding: 23px 0 0; width: 360px; }
    .category-selection-info .addtocart { height: 34px; line-height: 34px; margin: 15px 0; }
    .category-selection-info .addtocart span { font-size: 18px; font-weight: 600; }
    .category-selection-info .addtocart-wrapper input#qty { width: 45px; height: 31px; line-height: 31px; text-align: center; border: 1px solid #d9d9d9; margin-left: 10px; margin-right: 20px; }

    .category-selection-lastproduct { margin: 0 0 40px; }
    .category-selection-lastproduct .product { width: 686px; }
    .category-selection-lastproduct .selection-title { font-size: 24px; padding: 0 0 5px; border-bottom: 1px solid #ccccca; margin: 0 0 30px; }
    .category-selection-lastproduct .selection-title a { color: black; }
    .category-selection-lastproduct .img { width: 230px; margin: 0 10px 0 0; text-align: center; }
    .category-selection-lastproduct .img img { max-width: 230px; }
    .category-selection-lastproduct .content { width: 440px; }
    .category-selection-lastproduct .products-grid .actions .bot-icon.more { line-height: 36px; text-indent: 6px; background-position: 18px center; height: 34px; width: 32px; }
    .category-seleccion-quesos-artesanos .category-selection-lastproduct .img,
    .category-rincon-gastronomico .category-selection-lastproduct .img { width: 280px; }
    .category-seleccion-quesos-artesanos .category-selection-lastproduct .img img,
    .category-rincon-gastronomico .category-selection-lastproduct .img img { max-width: 280px; }
    .category-seleccion-quesos-artesanos .category-selection-lastproduct .content,
    .category-rincon-gastronomico .category-selection-lastproduct .content { width: 390px; }
    .category-selection-lastproduct .product-title { font-size: 18px; }
    .category-selection-lastproduct .product-title a { color: black; }
    .category-selection-lastproduct .sdesc { color: #5e5e5d; }
    .category-selection-lastproduct .banner { margin: 70px 0 0; }

    .category-selection-otherproducts { clear: both; }
    .category-selection-otherproducts > h2 { font-size: 24px; font-weight: 300; padding: 0 0 5px; border-bottom: 1px solid #ccccca; text-transform: uppercase; margin: 0 0 41px; }
    .category-selection-otherproducts .products-grid li.item { position: relative; }
    .category-selection-otherproducts .products-grid { margin-top: 26px; }
    .category-selection-otherproducts .selection-title { width: 110px; height: 19px; line-height: 19px; text-transform: uppercase; background: #ededee; color: #333; font-weight: 300; text-align: center; position: absolute; top: -26px; }
    .category-selection-otherproducts .products-grid-otros li.item { padding: 0 10px; height: 315px; }
    .category-selection-otherproducts .products-grid-otros li.item.first { padding-left: 0; }
    .category-selection-otherproducts .products-grid-otros li.item.last { padding-right: 0; }
    .category-selection-otherproducts .products-grid-otros .sdesc { margin-left: 0; }

    /* Pasos */
    .home-steps { background: #ededee; overflow: hidden; clear: both; height: 79px; margin-bottom: 25px; }
    .home-steps p { float: left; height: 70px; border-right: 1px solid #fff; padding: 9px 0 0 0; margin: 0; }
    .home-steps span { font-size: 14px; color: gray; float: left; margin-top: 8px; width: 135px; }
    .home-steps .icon{ float: left; width: 61px; height: 60px; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png); margin: 0 7px 0 15px; }
    .home-steps .step1 { width: 25%;  }
    .home-steps .step1 .icon { background-position: 0px -25px; }
    .home-steps .step1 span { width: 145px; }
    .home-steps .step2 { width: 24%; }
    .home-steps .step2 .icon { background-position: -61px -25px; }
    .home-steps .step2 span { margin-top: 0; }
    .home-steps .step3 { width: 24%; }
    .home-steps .step3 .icon { background-position: -122px -25px; }
    .home-steps .step4 { width: 26%; border: 0; position: relative; }
    .home-steps .step4 .icon { background-position: -183px -25px; }
    .home-steps .step4 span { width: 150px; }
    .home-steps .special { background: #bc1724; font-size: 12px; position: absolute; top: 0; right: -5px; padding: 1px 4px; color: #fff; width: auto !important; float: left; margin: 0; line-height: 1; }

    .small-steps { clear: both; }
    .small-steps .home-steps { margin: 0 0 4px; height: 66px; }
    .small-steps .home-steps span { font-size: 12px; }
    .small-steps .home-steps p { padding-left: 0; }
    .small-steps .home-steps .icon { width: 40px; height: 40px; margin: 5px 7px 0 5px; }
    .small-steps .home-steps .step1 { width: 170px; }
    .small-steps .home-steps .step1 .icon { background-position: 0 -209px; }
    .small-steps .home-steps .step1 span { width: 115px; }
    .small-steps .home-steps .step2 { width: 160px; }
    .small-steps .home-steps .step2 .icon { background-position: -40px -209px; }
    .small-steps .home-steps .step2 span { width: 105px; }
    .small-steps .home-steps .step3 { width: 165px; }
    .small-steps .home-steps .step3 .icon { background-position: -80px -209px; }
    .small-steps .home-steps .step3 span { width: 110px; }
    .small-steps .home-steps .step4 { width: 185px; }
    .small-steps .home-steps .step4 .icon { background-position: -120px -209px; }
    .small-steps .home-steps .step4 span { width: 128px; }

    .medium-steps { clear: both; margin-bottom: 25px;}
    .medium-steps .home-steps { margin: 0 0 4px; height: 66px; }
    .medium-steps .home-steps span { font-size: 12px; margin-top: 7px; }
    .medium-steps .home-steps span.special { margin-top: 0; }
    .medium-steps .home-steps p { padding-left: 0; width: 24.8%; }
    .medium-steps .home-steps .icon { width: 40px; height: 40px; margin-top: 4px; margin-left: 22px; }
    .medium-steps .home-steps .step1 .icon { background-position: 0 -209px; }
    .medium-steps .home-steps .step1 span { width: 120px; }
    .medium-steps .home-steps .step2 .icon { background-position: -40px -209px; }
    .medium-steps .home-steps .step2 span { width: 140px; }
    .medium-steps .home-steps .step3 .icon { background-position: -80px -209px; }
    .medium-steps .home-steps .step3 span { width: 115px; }
    .medium-steps .home-steps .step4 .icon { background-position: -120px -209px; }
    .medium-steps .home-steps .step4 span { width: 130px; }

    .product-view-otros .product-shop .home-steps { height: 123px; }
    .product-view-otros .product-shop .home-steps p { height: 46px; }
    .product-view-otros .product-shop .home-steps .icon { margin: 5px 7px 0 17px; }
    .product-view-otros .product-shop .home-steps .step1,
    .product-view-otros .product-shop .home-steps .step2,
    .product-view-otros .product-shop .home-steps .step3,
    .product-view-otros .product-shop .home-steps .step4 { width: 223px; padding-top: 5px; height: 56px; }
    .product-view-otros .product-shop .home-steps .step1,
    .product-view-otros .product-shop .home-steps .step2 { border-bottom: 1px solid #fff; }
    .product-view-otros .product-shop .home-steps .step2 { border-right: 0; }

    /* Home product-list */
    .home-product-list { margin: 0 0 40px; }
    .home-product-list h2 { color: black; font-size: 24px; border-bottom: 1px solid #ccc; margin: 0 0 33px; }
    .home-product-list h2 a{ color: #000; }
    .cms-index-index .home-product-list h2 { padding-top: 0; }

    /* Home banners */
    .home_main_banners { box-shadow: 0 0 6px rgba(0,0,0,.3); }

    /* Home Colecceiones */
    .banner-colecciones h2 { font-weight: bold; color: #000; font-size: 24px; border-bottom: 1px solid #ccc; margin: 0 0 33px; }

    /* Sitemap */
    .page-sitemap .links { text-align:right; margin:0 8px -22px 0; }
    .page-sitemap .links a { text-decoration:none; position:relative; }
    .page-sitemap .links a:hover { text-decoration:underline; }
    .page-sitemap .sitemap { margin:12px; }
    .page-sitemap .sitemap a { color:#1b2d3b; }
    .page-sitemap .sitemap li { margin:3px 0; }
    .page-sitemap .sitemap li.level-0 { margin:10px 0 0; font-weight:bold; }
    .page-sitemap .sitemap li.level-0 a { color:#1e7ec8; }

    /* RSS */
    .rss-title h1 { background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_rss-big.png) 0 4px no-repeat; padding-left:27px; }
    .rss-table .link-rss { display:block; line-height:1.55; background-position:0 4px; }
    /* ======================================================================================= */


    /* Shopping Cart ========================================================================= */
    .cart .page-title { border-bottom:0; margin: 20px 0; }
    .cart .page-title h1 { margin: 0; float: left; border: 0; text-transform: none; }

    /* Checkout Types */
    .cart .page-title .checkout-types li { margin:0 0 5px; }
    .cart .title-buttons .checkout-types { float:right; }
    .cart .title-buttons .checkout-types li { float:left; margin:0 0 5px 5px; }
    .cart .checkout-types .paypal-or { margin:0 8px; line-height:2.3; }
    .cart .totals .checkout-types .paypal-or { clear:both; display:block; padding:8px 55px 0 0; line-height:1.0; font-size:11px; }
    .cart .tfoot { margin: 11px 0 0; height: 50px; margin-bottom: 40px; }
    .cart .tfoot button span { height: 26px; line-height: 26px; padding: 0 24px; font-size: 14px; color: #fff; background: #333; border: 0; font-weight: 400; }
    .cart .tfoot button span span { padding: 0; }
    .cart .tfoot table { float: right; }
    .cart .tfoot table tbody { display: none; }
    .cart .tfoot table tfoot { font-size: 24px; color: #000; }
    .cart .tfoot table tfoot td { padding: 0 5px; }
    .cart .tfoot table tfoot strong { font-weight: 400; }
    .cart .tfoot table tfoot strong .price { font-weight: 700; }

    /* Shopping Cart Table */
    .cart-table thead th { background: #333; font-size: 18px; font-weight: 300; color: #fff; border: 0; }
    .cart-table th { padding:2px 10px; }
    .cart-table td { padding:6px 5px; color: #333; }
    .cart-table td.last { padding:6px 10px; position: relative; }
    .cart-table td.last > div { position: relative; }
    .cart-table .even,
    .cart-table .odd { background: #ededee; }
    .cart-table tbody td { border: 0; }
    .cart-table .product-name,
    .cart-table .product-name a,
    .cart-table .reference { font-weight: 600; font-size: 15px; color: #333; margin: 14px 0 0; line-height: 1; text-decoration: none; }
    .cart-table .reference small { font-size: 12px; }
    .cart-table .product-name small{
        font-size: 12px; color: #555;
    }
    .cart-table .sku { font-weight: 400; font-size: 12px; color: #333; }
    .cart-table .reference,
    .cart-table .sku { padding-top: 20px; line-height: 1; }
    .cart-table .prices { padding: 20px 0 0; }
    .cart-table .cart-price .price { font-size: 15px; line-height: 1; }
    .cart-table .final-price .cart-price .price { font-weight: 700; }
    .cart-table .item-msg { margin:5px 0; font-size:11px; font-weight:bold; color:#df280a; }
    .cart-table .qty { width: 55px; height: 31px; border: 1px solid #d9d9d8; font-size: 15px; text-align: center; line-height: 31px; margin: 5px 0 0; padding: 0; }
    .cart-table tfoot td { padding:5px 10px; }
    .cart-table .btn-continue { float:left; }
    .cart-table .btn-empty span,
    .cart-table .btn-continue span,
    .cart-table .btn-update span { border-color:#406a83; background:#618499; }
    .cart-table .btn-update,
    .cart-table .btn-empty { float:right; }
    .cart-table .btn-update { margin-left:10px; }
    .cart-table .btn-remove2 { position: absolute; width: 16px; height: 16px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_remove_cart.png); top: 14px; left: -7px; }

    /* Shopping Cart Collateral boxes */
    .cart .cart-collaterals { margin: -10px 0 0 0; width: 460px; float: left; }

    .cart .cart-crosssell { }
    .cart .crosssell { float: left; width: 450px; }
    .cart .crosssell h2 { font-size:24px; font-weight:300; text-transform: uppercase; border-bottom: 1px solid #ccccca; line-height: 1; margin: 0 0 18px; }
    .cart .crosssell .product-name { margin: 0 0 3px; }
    .cart .crosssell .product-name a { font-weight: 600; color: #000; font-size: 18px; text-decoration: none; line-height: 1; }
    .cart .crosssell .product-name a:hover,
    .cart .crosssell .product-name a:focus { text-decoration: underline; }
    .cart .crosssell .product-details { background: #ededee; height: 26px; }
    .cart .crosssell .product-details .price-box { float: left; height: 26px; margin: 0 0 0 8px; }
    .cart .crosssell .product-details .price-box .price { font-weight: 700; font-size: 18px; color: #333; line-height: 26px; }
    .cart .crosssell .product-details button { float: right; }
    .cart .crosssell li.item { width: 213px; margin: 0 23px 21px 0; float: left; }
    .cart .crosssell li.even { margin-right: 0; }

    .cart .cart-promotion { margin: 10px 0; width: 427px; float: right; }
    .cart .cart-promotion .block-container { width: 100%; }

    /* Discount Codes & Estimate Shipping and Tax Boxes */
    /*.cart .discount,
.cart .shipping { border:1px solid #d0cbc1; background:#fff url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_block-title.gif) 0 0 repeat-x; padding:12px 15px; margin:0 0 18px; }
.cart .discount h2,
.cart .shipping h2 { background-position:0 0; background-repeat:no-repeat; font:bold 13px/16px Arial, Helvetica, sans-serif; padding:0 0 0 21px; color:#000000; text-transform:uppercase; }
.cart .discount button span,
.cart .shipping button span { border-color:#406a83; background:#618499; }
.cart .discount .buttons-set,
.cart .shipping .buttons-set { margin:10px 0 0; border:0; padding:0; text-align:left; }
.cart .discount .buttons-set button.button,
.cart .shipping .buttons-set button.button { float:none; margin-left:0; }

.cart .discount h2 { background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_discount.gif); }
.cart .discount .input-box { margin:8px 0 0; width:260px; }
.cart .discount input.input-text { width:254px; }

.cart .shipping h2 { background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_shipping.gif); }
.cart .shipping .sp-methods { margin:10px 0 0; padding:5px 0 0; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_divider1.gif) 0 0 repeat-x; }*/
    .cart .discount { width: 500px; float: left; margin: 25px 0 0; }
    .cart .discount > h2 { display: none; }
    .cart .discount label { text-transform: uppercase; margin: 0 0 9px 4px; line-height: 1; display: block; }
    .cart .discount input.input-text { width: 253px; height: 21px; line-height: 21px; border: 1px solid #ccccca; text-indent: 5px; }
    .cart .discount .input-box,
    .cart .discount .buttons-set { float: left; }
    .cart .discount .buttons-set { border: 0; margin: 0 0 0 8px; clear: none; padding: 0; width: 180px; }
    .cart .discount .buttons-set button { float: left; }
    .cart .discount .buttons-set button span { height: 26px; line-height: 26px; padding: 0 24px; font-size: 14px; color: #fff; background: #333; border: 0; font-weight: 400; }
    .cart .discount .buttons-set button span span { padding: 0; }

    /* Shopping Cart Totals */
    .cart .totals { float:right; width:460px; background:#fff; border:0; margin: -10px 0 0; }
    .cart .totals table { width:100%; margin:7px 0; }
    .cart .totals td { padding:1px 15px 1px 7px; }
    .cart .totals tr.last td {}
    .cart .totals tfoot th { padding:5px 15px 5px 7px; }
    .cart .totals tfoot td { padding-top:5px; padding-bottom:5px; }
    .cart .totals tfoot th strong,
    .cart .totals tfoot td strong { font-size:15px; }
    .cart .totals .checkout-types { text-align:right; float: right;}
    .cart .totals .checkout-types li { float: left; margin: 0 0 0 10px; }
    .cart .totals button.btn-proceed-checkout { font-weight: 600; font-size: 18px; color: #fff; text-transform: uppercase; }
    .cart .totals button.btn-proceed-checkout span { background: #bc1724; height: 53px; line-height: 53px; padding: 0 29px; }
    .cart .totals button.btn-proceed-checkout span span { padding: 0; }
    .cart .totals button.btn-continue { font-weight: 600; font-size: 18px; color: #fff; text-transform: uppercase; }
    .cart .totals button.btn-continue span { background: #333; height: 53px; line-height: 53px; padding: 0 29px; }
    .cart .totals button.btn-continue span span { padding: 0; }

    /* Options Tool Tip */
    .item-options dt { font-weight:bold; font-style:italic; }
    .item-options dd { padding-left:10px; margin:0 0 6px; }
    .truncated { cursor:help; }
    .truncated a.dots { cursor:help; }
    .truncated a.details { cursor:help; }
    .truncated .truncated_full_value { position:relative; z-index:999; }
    .truncated .truncated_full_value .item-options { position:absolute; top:-99999em; left:-99999em; z-index:999; width:250px; padding:8px; border:1px solid #ddd; background-color:#f6f6f6; }
    .truncated .truncated_full_value .item-options > p { font-weight:bold; text-transform:uppercase; }
    .truncated .show .item-options { top:-20px; left:50%; }
    .col-left .truncated .show .item-options { left:15px; top:7px; }
    .col-right .truncated .show .item-options { left:-240px; top:7px; }
    /* ======================================================================================= */


    /* Checkout ============================================================================== */
    /********** < Common Checkout Styles */
    /* Shipping and Payment methods */
    .sp-methods { margin:0 0 8px; }
    .sp-methods dt { margin:13px 0 5px; font-weight:bold; }
    .sp-methods dd {}
    .sp-methods dd li { margin:5px 0; }
    .sp-methods label { font-weight:bold; color:#666; }
    .sp-methods .price { font-weight:bold; }
    .sp-methods .form-list { padding-left:20px; }
    .sp-methods .form-list li { margin:0 0 8px; }
    .sp-methods select.month { width:154px; margin-right:10px; }
    .sp-methods select.year { width:96px; }
    .sp-methods input.cvv { width:3em !important; }

    .sp-methods .checkmo-list li { margin:0 0 5px; }
    .sp-methods .checkmo-list label { width:135px; padding-right:10px; text-align:right; }
    .sp-methods .checkmo-list address { float:left; }

    .sp-methods .centinel-logos a { margin-right:3px; }
    .sp-methods .centinel-logos img { vertical-align:middle; }

    .sp-methods .release-amounts { margin:0.5em 0; }
    .sp-methods .release-amounts button { float:left; margin:5px 10px 0 0; }

    .please-wait { float:right; }
    .please-wait img { vertical-align:middle; }
    .cvv-what-is-this { font-size:11px; cursor:help; margin-left:10px; }

    /* Tooltip */
    .tool-tip { border:1px solid #7BA7C9; background:#EAF6FF; padding:15px 20px; position:absolute; z-index:9999; }
    .tool-tip .btn-close { margin:-9px -14px 0; text-align:right; }
    .tool-tip .btn-close a { display:block; margin:0 0 0 auto; width:15px; height:15px; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/btn_window_close.gif) 100% 0 no-repeat; text-align:left; text-indent:-999em; overflow:hidden; }
    .tool-tip .tool-tip-content { padding:5px; }

    /* Gift Messages */
    .gift-messages h3 { font-size:12px; font-weight:bold; color:#e87403; }
    .gift-messages p.control { color:#8e8d8b; }
    .gift-messages-form { position:relative; }
    .gift-messages-form label { float:none !important; position:static !important; }
    .gift-messages-form h4 { font-size:12px; font-weight:bold; color:#e87403; }
    .gift-messages-form .whole-order { margin:0 0 25px; }
    .gift-messages-form .item { margin:0 0 10px; }
    .gift-messages-form .item .product-img-box { float:left; width:75px; }
    .gift-messages-form .item .product-image { margin:0 0 7px; }
    .gift-messages-form .item .number { margin:0; font-weight:bold; text-align:center; color:#8a8987; }
    .gift-messages-form .item .details { margin-left:90px; }
    .gift-messages-form .item .details .product-name { font-size:13px; font-weight:bold; margin:0 0 10px; }
    .gift-messages-form .item .details .form-list .field { width:255px; }
    .gift-messages-form .item .details .form-list .input-box { width:240px; }
    .gift-messages-form .item .details .form-list input.input-text { width:234px; }
    .gift-messages-form .item .details .form-list li.wide .input-box { width:500px; }
    .gift-messages-form .item .details .form-list li.wide textarea { width:494px; }

    .gift-message-link { font-size:11px; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_collapse-gm.gif) 100% 6px no-repeat; padding-right:7px; }
    .gift-message-link.expanded { background-position:100% -40px; }
    .gift-message-row { background:#f2efe9; }
    .gift-message-row .btn-close { float:right; width:16px; height:16px; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/btn_gm-close.gif) 0 0 no-repeat; font-size:0; line-height:0; text-indent:-999em; overflow:hidden; }

    /* Checkout Agreements */
    .checkout-agreements li { margin:30px 0; }
    .checkout-agreements .agreement-content { overflow:auto; height:12em; padding:10px; background-color:#fbfaf6; border:1px solid #bbb6a5; }
    .checkout-agreements .agree { margin:0; padding:10px 0 10px 11px; }
    .checkout-agreements .agree input.checkbox { margin-right:6px; }
    .checkout-agreements .agree label { font-weight:bold; color:#666; }

    .opc .checkout-agreements { padding:5px 30px; }
    .opc .checkout-agreements li { margin:20px 0 0; }
    .opc .checkout-agreements .agreement-content { background-color:#fff; border-color:#e4e4e4; padding:5px; }
    .opc .checkout-agreements .agree { padding-left:6px; }

    /* Centinel */
    .centinel {}
    .centinel .authentication { border:1px solid #ddd; background:#fff; }
    .centinel .authentication iframe { width:99%; height:400px; background:transparent !important; margin:0 !important; padding:0 !important; border:0 !important; }

    .opc .centinel { border:1px solid #bbb6a5; border-width:0 1px 1px; padding:10px 30px; }

    /* Generic Info Set */
    .info-set { background:#fbfaf6 url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_checkout.gif) 0 0 repeat-x; border:1px solid #bbb6a5; margin:0 0 25px; padding:20px; }
    .info-set h2 { font-size:13px; font-weight:bold; margin:0 0 10px; }
    .info-set h3,
    .info-set h4 { font-size:13px; font-weight:bold; color:#000000; }
    .info-set h2 a,
    .info-set h3 a,
    .info-set h4 a { font-weight:normal; }
    .info-set h2.legend { margin:-20px -20px 15px; padding:5px 10px; background:#f9f3e3; border-bottom:1px solid #bbafa0; position:relative; }
    .info-set h3.legend { margin:0 0 10px; color:#0a263c; }
    .info-set .divider { margin:0 -20px; padding:25px 0; position:relative; }
    .info-set .box { margin:0 0 15px; }
    .info-set .box h2 { color:#000000; }
    .info-set .data-table .product-name { font-size:1em !important; font-weight:bold !important; color:#1e7ec8 !important; }
    .info-set .data-table .product-name a { font-weight:bold !important; }
    .info-set .data-table .item-options { margin:5px 0 0; }
    /********** Common Checkout Styles > */

    /* One Page Checkout */
    .checkout-onepage-index .page-title { border: 0; margin: 0 0 20px; }
    .checkout-onepage-index .page-title h1 { border: 0; text-transform: none; font-size: 33px; margin: 0; }
    .block-progress { border:0; margin:0; }
    .block-progress .block-title { background:none; border:0; padding:0; margin:0 0 5px; }
    .block-progress .block-title strong { font-size:13px; color:#0a263c; }
    .block-progress .block-content { background:none; }
    .block-progress dt { font-size:13px; font-weight:bold; line-height:1.35; background:#eee; border:1px solid #a3aeb3; margin:0 0 6px; padding:2px 8px; color:#999; }
    .block-progress dd { background:#eee; border:1px solid #a3aeb3; border-top:0; padding:8px 13px; margin:0 0 6px; }
    .block-progress dt.complete { margin:0; background:#d0dce1; color:#5e8ab4; }
    .block-progress dd.complete {}
    .block-progress p { margin:0; }
    .block-progress .cards-list dt { background:none; border:0 none; color:inherit; font-size:12px; margin:5px 0; padding:0; }
    .block-progress .cards-list dd { border:0 none; margin:0; padding:0; }
    .block-progress .cards-list .info-table th { font-weight:normal; }

    .opc .buttons-set { margin-top:0; padding-top:20px; }
    .opc .buttons-set p.required { margin:0; padding:0 0 10px; }
    .opc #payment-buttons-container.buttons-set p.required { display: none; }
    .opc .buttons-set .back-link small { display:none; }
    .opc .buttons-set .back-link a { background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_arrow-top.gif) 0 50% no-repeat; padding-left:16px; }
    .opc .buttons-set.disabled button.button { display:none; }
    .opc .buttons-set .please-wait { height:21px; line-height:21px; }
    .opc .ul { list-style:disc outside; padding-left:18px; }

    #checkoutSteps label { font-size: 12px; font-weight: 400; color: #000; }
    #checkoutSteps button.button { font-size: 14px; color: #fff; font-weight: 400; }
    #checkoutSteps button.button span { background: #333; border: 0; height: 26px; line-height: 26px; padding: 0 13px; }
    #checkoutSteps button.button span span{ padding: 0; }
    #checkoutSteps .form-list label.required em { color: #000; }
    #checkoutSteps .form-list .field { width: 355px; }
    #checkoutSteps .form-list input.input-text { border-color: #d3d3d1; width: 315px; padding: 0 5px; height: 21px; line-height: 21px; }

    .opc { position:relative; }
    .opc li.section {}

    .opc .step-title { border-bottom:1px solid #ccccca; padding: 0 0 4px; margin: 0 0 40px; }
    .opc .step-title .number { float: left; color:#000; font-size: 18px; font-weight: 700; line-height: 1; margin: 0 5px 0 0; }
    .opc .step-title h2 { color:#000; font-size: 18px; font-weight: 700; line-height: 1; margin: 0 5px 0 0; float: left; }
    .opc .step-title a { float:right; font-size:11px; line-height:16px; }
    .opc .step-title .details-summary{
        float: left;
        line-height: 1.8;
        margin: 0 0 0 20px;
        color: gray;
    }

    .opc .allow .step-title { cursor:pointer; }
    .opc .allow .step-title .number {  }
    .opc .allow .step-title h2 {  }
    /*.opc .allow .step-title a { display:block; }*/

    .opc .active .step-title { cursor:default; }
    .opc .active .step-title .number { border: 0; color:#000; }
    .opc .active .step-title h2 { background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_step_checkout_open.png) 100% 9px no-repeat; }
    /*.opc .active .step-title a { display:none; }*/

    .opc .step { position:relative; }
    .opc .step .tool-tip { right:30px; }

    /* OPC-LOGIN */
    #opc-login .step-title { display: none; }
    #opc-login .col2-set .col-1 { width: 330px; margin: 0 66px 0 0; }
    #opc-login .col2-set .col-2 { width: 354px; float: left; }
    #opc-login .buttons-set { border-top:0; }
    #opc-login h3 { font-size:18px; font-weight: 600; line-height: 1; margin: 0 0 25px; }
    #opc-login input.input-text { width: 315px; height: 21px; line-height: 21px; border: 1px solid #dddddc; padding: 0 5px; }
    #opc-login .forgot-pass { font-weight: 700; color: #bc1724; text-decoration: none; }
    #opc-login .forgot-pass:hover,
    #opc-login .forgot-pass:focus { font-weight: 700; color: #bc1724; text-decoration: underline; }
    #opc-login #nopassword-form { margin: 20px 0 0 26px; }

    .first-step-checkout #opc-billing,
    .first-step-checkout #opc-shipping,
    .first-step-checkout #opc-shipping_method,
    .first-step-checkout #opc-payment,
    .first-step-checkout #opc-review { display: none; }

    #opc-billing .form-list .name-firstname,
    #opc-shipping .form-list .name-firstname { width: 100%; margin: 0 0 8px; }
    #opc-billing .form-list .postcode,
    #opc-billing .form-list .postcode .input-box,
    #opc-shipping .form-list .postcode,
    #opc-shipping .form-list .postcode .input-box { width: 142px; }
    #opc-billing .form-list .postcode .input-box input,
    #opc-shipping .form-list .postcode .input-box input { width: 130px; }
    #opc-billing .form-list .country,
    #opc-shipping .form-list .country { margin: 0 0 0 25px; }
    #opc-billing .form-list .country,
    #opc-billing .form-list .country .input-box,
    #opc-shipping .form-list .country,
    #opc-shipping .form-list .country .input-box { width: 158px; }
    #opc-billing .form-list .country select,
    #opc-shipping .form-list .country select { width: 185px; }
    #opc-billing .buttons-set,
    #opc-shipping .buttons-set { margin: 0 0 65px; width: 680px; border: 0; }

    #opc-billing .step-title {  /* display: none; */ }
    #opc-shipping .step-title { /* display: none; */ }


    #opc-shipping_method { display: none; }
    #opc-shipping_method .buttons-set { border-top:0; }
    .opc .gift-messages-form { margin:0 -30px; background:#f6f1eb; border:1px solid #e9e4de; border-width:1px 0; padding:22px 24px 22px 30px; }
    .opc .gift-messages-form .inner-box { padding:5px; height:260px; overflow:auto; }


    #opc-payment #payment_form_ccsave li { float: left; width: 260px; }
    #opc-payment #payment_form_ccsave li input.input-text,
    #opc-payment #payment_form_ccsave li select { width: 230px; }
    #opc-payment #payment_form_ccsave li .v-fix { float: left; width: 127px; }
    #opc-payment #payment_form_ccsave li .v-fix select { width: 115px; }
    #opc-payment #payment_form_iberia .small-input { width: 15px; text-align: center; }

    #opc-review .step-title { display: none }
    #opc-review .dstep { border:0; padding:0; }
    #opc-review .product-name { font-weight:bold; color:#0a263c; }
    #opc-review .item-options { margin:5px 0 0; }
    #opc-review .buttons-set { padding:20px 30px; border:1px solid #d9dde3; border-width:0 1px 1px; }
    #opc-review .buttons-set p { margin:0; line-height:40px; }
    #opc-review .buttons-set .please-wait { height:40px; line-height:40px; }
    #opc-review .authentication { margin:0 auto; width:570px; }
    #opc-review .warning-message { color:#222; font-weight:bold; text-align:center; padding:10px 10px 0; }

    #opc-review .f-left { width: 448px; }
    #opc-review .f-right { width: 450px; }
    #opc-review .data-table { border: 0; }
    #opc-review .data-table thead th { background: #333; color: #fff; border: 0; font-weight: 300; font-size: 13px; }
    #opc-review .data-table tbody .odd td,
    #opc-review .data-table tbody .even td { background: #ededee; border: 0; border-bottom: 1px solid #ccccca; padding: 15px 5px 10px; }
    #opc-review .data-table tfoot td { background: #ededee; border: 0; padding: 5px 5px 10px}
    #opc-review .data-table tfoot .first td { border-top: 1px solid #ccccca; }
    #opc-review .data-table tfoot .last strong { font-size: 24px; color: #040000; font-weight: 300; }
    #opc-review .data-table tfoot .last .last strong { font-size: 24px; color: #000; font-weight: 700; }
    #opc-review .buttons-set { border: 0; padding: 20px 0; }
    #opc-review button.btn-checkout span { background: #bc1724; height: 53px; padding: 0 23px; line-height: 53px; text-transform: uppercase; font-weight: 600; font-size: 18px; }
    #opc-review button.btn-checkout span span { padding: 0; }


    /* Multiple Addresses Checkout */
    .checkout-progress { padding:0 90px; margin:0 0 20px; }
    .checkout-progress li { float:left; width:19%; margin:0 3px 0 0; border-top:10px solid #999; padding:2px 0 0; font-weight:bold; text-align:center; color:#abb5ba; }
    .checkout-progress li.active { border-top-color:#e96200; color:#e96200; }

    .multiple-checkout h2 { font-size:13px; font-weight:bold; margin:0 0 10px; }
    .multiple-checkout h3,
    .multiple-checkout h4 { font-size:13px; font-weight:bold; color:#000000; }
    .multiple-checkout h2 a,
    .multiple-checkout h3 a,
    .multiple-checkout h4 a { font-weight:normal; }
    .multiple-checkout .data-table .product-name { font-size:1em !important; font-weight:bold !important; color:#1e7ec8 !important; }
    .multiple-checkout .data-table .product-name a { font-weight:bold !important; }
    .multiple-checkout .data-table .item-options { margin:5px 0 0; }

    .multiple-checkout .gift-messages { margin:15px 0 0; }

    .multiple-checkout .tool-tip { top:50%; margin-top:-120px; right:20px; }

    .multiple-checkout .col2-set,
    .multiple-checkout .col3-set { background:#fbfaf6 url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_checkout.gif) 0 0 repeat-x; border:1px solid #bbb6a5; margin:0 0 25px; padding:20px; }
    .multiple-checkout .col2-set h2.legend { margin:-20px -20px 15px; padding:5px 10px; background:#f9f3e3; border-bottom:1px solid #bbafa0; position:relative; }
    .multiple-checkout .col2-set h3.legend { margin:0 0 10px; color:#0a263c; }
    .multiple-checkout .col2-set .divider { margin:0 -20px; padding:25px 0; position:relative; }
    .multiple-checkout .box { margin:0 0 15px; }
    .multiple-checkout .box h2 { color:#000000; }

    .multiple-checkout .place-order .please-wait { float:right; padding:27px 7px 0 0; }
    .multiple-checkout .place-order .grand-total { float:right; height:71px; font-size:1.5em; padding:0 0 0 21px; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_grand-total.gif) 0 0 no-repeat; overflow:hidden; }
    .multiple-checkout .place-order .grand-total .inner { float:left; height:57px; padding:14px 21px 0 0; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_grand-total.gif) 100% 0 no-repeat; }
    .multiple-checkout .place-order .grand-total .inner div { display:inline; }
    .multiple-checkout .place-order .grand-total big { display:inline; margin-right:12px; }
    .multiple-checkout .place-order .grand-total .price { color:#000000; }
    .multiple-checkout .place-order .grand-total button.button span { font-size:16px; }
    .multiple-checkout .place-order .grand-total button.button span span { padding:0 45px 0 36px; }

    /* Step 1 */
    .multiple-checkout .title-buttons button.button span { border-color:#406a83; background:#618499; }
    #multiship-addresses-table td { padding:10px; }
    #multiship-addresses-table tfoot td { padding:5px 10px; }
    #multiship-addresses-table tfoot button.button span { border-color:#406a83; background:#618499; }

    /* Step 2 */
    .multiple-checkout .gift-messages-form .item .details .form-list { width:100%; overflow:hidden; }
    .multiple-checkout .gift-messages-form .item .details .form-list li { margin-right:-15px; }
    .multiple-checkout .gift-messages-form .item .details .form-list .field { width:230px; }
    .multiple-checkout .gift-messages-form .item .details .form-list .input-box { width:215px; }
    .multiple-checkout .gift-messages-form .item .details .form-list input.input-text { width:209px; }
    .multiple-checkout .gift-messages-form .item .details .form-list li.wide .input-box { width:445px; }
    .multiple-checkout .gift-messages-form .item .details .form-list li.wide textarea { width:439px; }
    .checkout-multishipping-shipping .box-sp-methods { border:1px solid #d9d2be; background:#f9f3e3; padding:13px; position:relative; }
    .checkout-multishipping-shipping .box-sp-methods .pointer { position:absolute; top:-20px; right:-40px; width:178px; height:41px; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_sp-methods.gif) 0 0 no-repeat; overflow:hidden; }

    /* Step 3 */
    .checkout-multishipping-billing .multiple-checkout { position:relative; }
    /* ======================================================================================= */


    /* Account Login/Create Pages ============================================================ */
    .account-login .content { min-height:345px; padding:14px 21px; background:#faf7ee url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_login-box.gif) 0 0 repeat-x; border:1px solid #bbb6a5; border-bottom:0; }
    .account-login .content h2 { font-weight:bold; font-size:13px; margin:0 0 14px; padding:0 0 5px 23px; border-bottom:1px solid #ddd; background-position:0 1px; background-repeat:no-repeat; text-transform:uppercase; color:#e76200; }
    .account-login .new-users h2 { background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_page1.gif)}
    .account-login .registered-users h2 { background-image:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/i_page2.gif); }
    .account-login .buttons-set { border:none; margin-top: 20px; }

    .account-login .col2-set .col-1 { width: 330px; margin: 0 66px 0 0; }
    .account-login .col2-set .col-2 { width: 354px; float: left; }
    .account-login h3 { font-size:18px; font-weight: 600; line-height: 1; margin: 0 0 25px; }
    .account-login input.input-text {
        border-color: #d3d3d1;
        width: 315px;
        padding: 0 5px;
        height: 21px;
        line-height: 21px;
    }
    .account-login .input-box { display: block; }
    .account-login label { font-size: 12px;	font-weight: 400; color: #000; }
    .account-login .forgot-pass { font-weight: 700;	color: #bc1724;	text-decoration: none; }
    .account-login .forgot-pass:hover { text-decoration: underline; }
    .account-create {}

    /* Captcha ================================================================================ */
    .captcha-note      { clear:left; padding-top:5px; }
    .captcha-image     { float:left; display:inline;  margin:0; position:relative; width:258px; }
    .captcha-image .captcha-img { border:1px solid #b6b6b6; vertical-align:bottom; width:100%; }
    .registered-users .captcha-image { margin:0;}
    .captcha-reload { cursor:pointer; position:absolute; top:2px; right:2px;}
    .captcha-reload.refreshing  { animation:rotate 1.5s infinite linear; -webkit-animation:rotate 1.5s infinite linear; -moz-animation:rotate 1.5s infinite linear; }

    @-webkit-keyframes rotate {
        0% { -webkit-transform:rotate(0); }
        0% { -webkit-transform:rotate(-360deg); }
    }
    @-moz-keyframes rotate {
        0% { -moz-transform:rotate(0); }
        0% { -moz-transform:rotate(-360deg); }
    }
    @keyframes rotate {
        0% { transform:rotate(0); }
        0% { transform:rotate(-360deg); }
    }

    /* Remember Me Popup ===================================================================== */
    .window-overlay { background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/window_overlay.png) repeat; background:rgba(0, 0, 0, 0.35); position:absolute; top:0; left:0; height:100%; width:100%; z-index:990; }

    .remember-me label { float:none; margin:0 6px; }
    .remember-me-popup { background:#fff; border:1px solid #ccc; left:50%; top:50%; position:absolute; margin:-85px 0 0 -200px; width:400px; text-align:left; -moz-box-shadow:0 0 6px #ccc; -webkit-box-shadow:0 0 6px #ccc; -box-shadow:0 0 6px #ccc; z-index:1000; }
    .remember-me-popup h3 { background:#d9e5ee; border-bottom:1px solid #ccc; font-size:14px; padding:5px 10px; }
    .remember-me-popup .remember-me-popup-head { position:relative; }
    .remember-me-popup .remember-me-popup-head .remember-me-popup-close { background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/btn_window_close.gif) no-repeat; display:block; position:absolute; top:7px; right:7px; height:15px; width:15px; text-indent:-9999em; }
    .remember-me-popup .remember-me-popup-body { padding:10px; }
    .remember-me-popup .remember-me-popup-body a { display:inline-block; height:19px; border:1px solid #de5400; background:#f18200; padding:0 8px; font:bold 12px/19px Arial, Helvetica, sans-serif; text-align:center; text-decoration:none; white-space:nowrap; color:#fff; }
    /* Remember Me Popup ===================================================================== */


    /* My Account ============================================================================= */
    .my-account .title-buttons .link-rss { float:none; margin:0; }

    /********** < Dashboard */
    .dashboard .welcome-msg { margin:0 8em 1.5em 0; }
    .dashboard .welcome-msg p { margin:0; }
    .dashboard .col2-set { margin:0 0 15px; }

    /* General Box */
    .box-account { background:#fff; margin: 0 0 50px; }
    .box-account .box-head { margin:0 0 10px; text-align:right; }
    .box-account .box-head h2 { text-align: left; font-weight: 300; line-height: 1.5; font-size: 24px; border-bottom: 1px solid #ccccca; margin: 0 0 13px; }

    .dashboard .box .box-title { background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_divider1.gif) 0 100% repeat-x; padding:0 0 2px; margin:0 0 8px; text-align:right; }
    .dashboard .box .box-title h3,
    .dashboard .box .box-title h4 { float:left; font-size:13px; font-weight:bold; margin:0; }

    /* Block: Recent Orders */
    .dashboard .box-recent .box-head h2 { }

    /* Block: Account Information */
    .dashboard .box-info .box-head h2 { }
    .dashboard .box-info h4 { font-size:11px; font-weight:bold; text-transform:uppercase; }

    /* Block: Reviews */
    .dashboard .box-reviews .box-head h2 { }
    .dashboard .box-reviews .number { float:left; font-size:10px; font-weight:bold; line-height:1; color:#fff; margin:3px -20px 0 0; padding:2px 3px; background:#0a263c; }
    .dashboard .box-reviews .details { margin-left:20px; }
    .dashboard .box-reviews li.item { margin:0 0 7px; }
    .dashboard .box-reviews li.item.last { margin:0; }
    .dashboard .box-reviews .ratings { margin:7px 0 0; }

    /* Block: Tags */
    .dashboard .box-tags .box-head h2 { }
    .dashboard .box-tags .number { float:left; font-size:10px; font-weight:bold; line-height:1; color:#fff; margin:3px -20px 0 0; padding:2px 3px; background:#0a263c; }
    .dashboard .box-tags .details { margin-left:20px; }
    .dashboard .box-tags li.item { margin:0 0 7px; }
    .dashboard .box-tags li.item.last { margin:0; }
    .dashboard .box-tags .tags strong,
    .dashboard .box-tags .tags ul,
    .dashboard .box-tags .tags ul li { display:inline; }
    /********** Dashboard > */

    /* Address Book */
    .addresses-list h2 { font-weight:bold; font-size:13px; color:#000000; text-transform:uppercase; }
    .addresses-list h3 { font-weight:bold; font-size:13px; }
    .addresses-list address { margin:0 0 3px; }
    .addresses-list p { margin:0; }
    .addresses-list a { font-weight:bold; }
    .addresses-list .link-remove { color:#646464; }
    .addresses-list .separator { margin:0 3px; }
    .addresses-list li.item { background:#fff url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_account_box.gif) 0 0 repeat-x; border:1px solid #ccc; padding:10px 13px; margin:0 0 10px; }
    .addresses-list li.empty { background:none; border:0; padding:0; }
    .addresses-list li.empty p { font-weight:bold; }
    .addresses-list .addresses-additional li.item { background:none; border:0; padding:0; }

    /* Credit Card */
    .field-card-date .v-fix { float: left; }
    .form-list .field-card-date select { width: 80px; margin-right: 10px; }

    /* Order View */
    .order-info { background:#dee5e8; border:1px solid #d0cbc1; padding:4px 8px; margin:0 0 8px; }
    .order-info dt,
    .order-info dd,
    .order-info ul,
    .order-info li { display:inline; }
    .order-info .current { font-weight:bold; }
    .order-info li { margin:0 3px; }

    .order-date { margin:10px 0; }

    .order-info-box { background:#fff url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_block-title.gif) 0 0 repeat-x; border:1px solid #d0cbc1; padding:12px 15px; margin:0 0 15px; }
    .order-info-box h2 { font-weight:bold; font-size:13px; }
    .order-info-box .box-payment p { margin:0 0 3px; }
    .order-info-box .box-payment th { font-weight:bold; padding-right:7px; }

    .order-items { width:100%; overflow-x:auto; }
    .order-items h2,
    .order-items h3 { clear:none; font-weight:bold; font-size:13px; padding:0; margin:0 0 5px; color:#0a263c; }
    .order-items .product-name { font-size:1em !important; font-weight:bold !important; }
    .order-items .link-print { color:#1e7ec8; font-weight:normal; }
    .order-items .order-links { text-align:right; }

    .order-additional { margin:15px 0; }
    /* Order Gift Message */
    .gift-message dt strong { color:#666; }
    .gift-message dd { font-size:13px; margin:5px 0 0; }
    /* Order Comments */
    .order-about dt { font-weight:bold; }
    .order-about dd { font-size:13px; margin:0 0 7px; }

    .tracking-table { margin:0 0 15px; }
    .tracking-table th { font-weight:bold; white-space:nowrap; }

    .tracking-table-popup { width:100%; }
    .tracking-table-popup th { font-weight:bold; white-space:nowrap; }
    .tracking-table-popup th,
    .tracking-table-popup td { padding:1px 8px; }

    /* Order Print Pages */
    .page-print .print-head { margin:0 0 15px; }
    .page-print .print-head .logo { float:left; }
    .page-print .print-head address { float:left; margin-left:15px; }
    .page-print h1 { font-size:16px; font-weight:bold; }
    .page-print h2,
    .page-print h3 { font-size:13px; font-weight:bold; }
    .page-print h2.h2 { font-size:16px; font-weight:bold; }
    .page-print .order-date { background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_divider1.gif) 0 100% repeat-x; padding:0 0 10px; margin:0 0 10px; }
    .page-print .col2-set { margin:0 0 10px; }
    /* Price Rewrites */
    .page-print .gift-message-link { display:none; }
    .page-print .price-excl-tax,
    .page-print .price-incl-tax { display:block; white-space:nowrap; }
    .page-print .cart-price,
    .page-print .price-excl-tax .label,
    .page-print .price-incl-tax .label,
    .page-print .price-excl-tax .price,
    .page-print .price-incl-tax .price { display:inline; }

    /* My Wishlist */
    .my-wishlist .data-table td { padding:10px; }
    .my-wishlist .product-image { display:block; width:113px; height:113px; margin:0 0 5px; }
    .my-wishlist textarea { display:block; width:97%; height:109px; }
    .my-wishlist .buttons-set { margin-top:2em; }
    .my-wishlist .buttons-set button.button { float:none; }
    .my-wishlist .buttons-set .btn-add span,
    .my-wishlist .buttons-set .btn-share span { border-color:#406a83; background:#618499; }
    #wishlist-table .add-to-links { white-space:nowrap; }

    /* My Tags */
    .my-tag-edit { float:left; margin:0 0 10px; }
    .my-tag-edit .btn-remove { float:right; margin:4px 0 0 5px; }
    #my-tags-table { clear:both; }
    #my-tags-table td { padding:10px; }
    #my-tags-table .add-to-links { white-space:nowrap; }

    /* My Reviews */
    #my-reviews-table td { padding:10px; }

    .product-review .product-img-box { float:left; width:140px;  }
    .product-review .product-img-box .product-image { display:block; width:125px; height:125px; }
    .product-review .product-img-box .label { font-size:11px; margin:0 0 3px; }
    .product-review .product-img-box .ratings .rating-box { float:none; display:block; margin:0 0 3px; }
    .product-review .product-details { margin-left:150px; }
    .product-review .product-name { font-size:16px; font-weight:bold; margin:0 0 10px; }
    .product-review h3 { font-size:12px; margin:0 0 3px; color:#2f2f2f; }
    .product-review .ratings-table { margin:0 0 10px; }
    .product-review dt { font-weight:bold; }
    .product-review dd { font-size:13px; margin:5px 0 0; }

    /* Billing Agreements */
    .billing-agreements .info-box{ margin:15px 0; }
    .billing-agreements .form-list li select { float:left; }
    .billing-agreements .form-list li button.button { float:left; margin-left:10px; }
    .billing-agreements .table-caption { font-weight:bold; font-size:13px; }
    /* ======================================================================================= */


    /* MAP Popup============================================================================== */
    .cart-msrp-totals { color:red; font-size:12px !important; font-weight:bold; margin:10px 10px 0; padding:10px; text-align:right; text-transform:uppercase;}
    .map-cart-sidebar-total { color:red; display:block; font-size:10px; font-weight:bold; text-align:left; padding:2px 5px; text-shadow:0 1px 0 #fff; }

    .map-popup { background:#fff; border:1px solid #aaa; margin:12px 0 0; position:absolute; -moz-box-shadow:0 0 6px #ccc; -webkit-box-shadow:0 0 6px #ccc; box-shadow:0 0 6px #ccc; text-align:left; width:300px; z-index:100; }
    .map-popup-heading { background:#d9e5ee; border-bottom:1px solid #ccc; padding:5px 30px 5px 10px; width:260px; }
    .map-popup-heading h2 { font-size:16px; margin:0; text-shadow:0 1px 0 #f6f6f6; overflow:hidden; white-space:nowrap; word-wrap:break-word; text-align:left; text-overflow:ellipsis; }
    .map-popup-arrow { background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/map_popup_arrow.gif) no-repeat; position:absolute; left:50%; top:-10px; height:10px; width:19px; }
    .map-popup-close { background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/btn_window_close.gif) no-repeat; display:block; position:absolute; top:8px; right:10px; height:15px; width:15px; text-indent:-9999em; -moz-box-shadow:0 0 3px #999; -webkit-box-shadow:0 0 3px #999; box-shadow:0 0 3px #999; -moz-border-radius:2px; -webkit-border-radius:2px; border-radius:2px; }
    .map-popup-content { border-top:1px solid #eee; padding:10px; overflow:hidden; text-align:left; width:280px; }
    .map-popup-checkout { display:inline; float:right; text-align:right; }
    .map-popup-checkout span { display:block; padding-right:30px; }
    .map-popup-checkout .paypal-logo { margin:0 0 5px; }
    .map-popup-price .price-box,
    .map-popup-price .price-box .special-price { margin:0; padding:0; }
    .map-popup-price { margin:5px 0 0; }
    .map-popup-text { clear:right; margin:0 10px; padding:10px 0; text-align:left; word-wrap:break-word; }
    .map-popup-only-text { border-top:1px solid #ddd; }
    /* ======================================================================================= */

    .banner-colecciones { width: 920px; margin : 0 auto; clear: both; }
    .banner-colecciones ul { list-style: none; padding: 0;}
    .banner-colecciones li { float: left; width: 209px; margin: 0 28px 40px 0; background: #ededed; text-align: left; position: relative; }
    .banner-colecciones li.last { margin-right: 0; }
    .cms-home .banner-colecciones li { margin-bottom: 40px; }
    .banner-colecciones h3 { background: #fff; text-align: left; margin: 0; font-weight: 600; font-size: 18px; padding: 0 0 5px; }
    .banner-colecciones h3 a { color: black; }
    .banner-colecciones .price { font-weight: 700; font-size: 21px; padding: 12px 0 5px 6px; color: #333; line-height: 1; margin: 0; }
    .banner-colecciones .desc { font-size: 9px; color: #000; margin: 0; padding: 0 0 0 6px; }
    .banner-colecciones .block-link { float: left; background: #333; color: #fff; font-size: 10px; line-height: 1; padding: 5px 10px; margin: 8px 0 12px 6px; text-transform: uppercase; text-decoration: none; clear: both; }
    .banner-colecciones .dto { font-size: 17px; font-weight: 600; color: #fffef3; width: 64px; height: 54px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -146px -113px no-repeat; text-align: center; position: absolute; bottom: -23px; right: 10px; line-height: 1.1; padding: 10px 0 0; margin: 0; }

    .col2-right-layout .banner-colecciones { width: 685px; }

    /* Footer ================================================================================ */
    .footer-container { background: #333 url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_footer.png) 0 0 repeat-x; box-shadow: 0 -3px 5px rgba(0,0,0,.15); }
    .subfooter,
    .footer { width:920px; margin:0 auto; padding:30px 20px 50px; text-align: left; color: #fff; }
    .subfooter-container { background: #333; border-top: 1px dotted #c7c5c5; padding: 12px 0; margin: 0; }
    .subfooter { padding-top: 0; padding-bottom: 0; overflow: hidden; }

    .footer a,
    .subfooter a { color:#fff; text-decoration:none; }
    .footer a:hover,
    .subfooter a:hover { text-decoration:underline; }
    .footer ul { display:inline; }
    .footer ul.links,
    .footer ul.links li { display:block; }
    .footer li,
    .subfooter li { display:inline; background:url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_pipe2.gif) 100% 60% no-repeat; padding:0 7px 0 4px; }
    .footer li.last,
    .subfooter li.last { background:none !important; padding-right:0 !important; }

    .footer .left { width: 450px; }
    .footer .right { width: 411px; }

    /* Footer blocks */
    .footer .block { border: 0; }
    .footer .block-title { border: 0; background: none; padding: 0; margin: 0 0 12px; }
    .footer .block-title h2 {
        font-weight: 300;
    }
    .footer .block-title.dark h2 {
        font-size: 18px;
        display: inline-block;
        padding: 5px;
        background-color: #6c6c6c;
        background-image: -webkit-gradient(linear, left top, left bottom, from(#6b6b6b), to(#6e6e6e));
        background-image: -webkit-linear-gradient(top, #6b6b6b, #6e6e6e);
        background-image:    -moz-linear-gradient(top, #6b6b6b, #6e6e6e);
        background-image:      -o-linear-gradient(top, #6b6b6b, #6e6e6e);
        background-image:         linear-gradient(to bottom, #6b6b6b, #6e6e6e);
    }
    .footer .block-title h2 { color: #fff; }
    .footer .block-content { background: none; }

    /* contacto */
    .contact-footer { width: 210px; float: left; margin: 10px 2px 25px; }
    .contact-footer p { margin-bottom: 17px; }
    .contact-footer .icon { background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png); float: left; }
    .contact-footer .phone .icon { width: 22px; height: 17px; background-position: -127px 0; margin-right: 11px; }
    .contact-footer .fax .icon { width: 20px; height: 20px; background-position: -149px 0; margin-right: 16px; }
    .contact-footer .address .icon { width: 14px; height: 23px; background-position: -169px 0; margin-right: 20px; }
    .contact-footer .mail .icon { width: 19px; height: 19px; background-position: -183px 0; margin-right: 15px; }

    .contact-footer .phone { font-size: 20px; font-weight: 700; line-height: 1; }
    .contact-footer .fax { font-size: 12px; font-weight: 700; line-height: 1.6; }
    .contact-footer .address { font-size: 12px; font-weight: 400; line-height: 1.5; }
    .contact-footer .mail { font-size: 12px; font-weight: 400; line-height: 1.5; }
    .contact-footer .mail dd { color: #c4c3c3; }
    .contact-footer .mail .no-icon { margin-left: 34px; }

    /* newsletter */
    .footer .block-subscribe { float: right; width: 210px; box-shadow: 0 3px 15px rgba(0,0,0,.9); }
    .footer .block-subscribe .block-title { border-bottom: 2px solid #000; background: #fff; margin-bottom: 0; }
    .footer .block-subscribe .block-title strong { color: #333; }
    .footer .block-subscribe .block-content { background: #fff; }
    .footer .block-subscribe input.input-text { background: #ededee; }
    .block-subscribe .policy { font-size: 10px; margin-top: 15px; }
    .footer .block-subscribe .policy a { color: #000000; }


    /* Social */
    .social-footer { float: left; clear: left; }
    .social-footer li { background: none; margin: 0 3px; float: left; padding: 0; }
    .social-footer a { display: block; width: 35px; height: 35px; text-indent: -9999em; background-image: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/social-footer-sprite.png); background-color: transparent; }
    .social-footer .fb { background-position: 0px -35px; }
    .social-footer .gplus { background-position: -35px -35px; }
    .social-footer .rss { background-position: -70px -35px; }
    .social-footer .tw { background-position: -105px -35px; }
    .social-footer .youtube { background-position: -140px -35px; }
    .social-footer .fb:hover { background-position: 0px 0px; }
    .social-footer .gplus:hover { background-position: -35px 0px; }
    .social-footer .rss:hover { background-position: -70px 0px; }
    .social-footer .tw:hover { background-position: -105px 0px; }
    .social-footer .youtube:hover { background-position: -140px 0px; }


    /* Payment */
    .payment-footer { float: right; }

    /* Listados */
    .most-search-footer li,
    .about-us-footer li,
    .internacional-footer li { background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/list-footer-bullet.png) 0 50% no-repeat; padding: 7.5px 0 7.5px 17px; }

    .most-search-footer,
    .about-us-footer,
    .internacional-footer { float: left; width: 200px; }


    /* Microsite bodega del mes */
    .cms-microsite-bodega-del-mes.std ul,
    .cms-microsite-colecciones.std ul,
    .cms-microsite-socio.std ul { padding-left: 0; list-style-type: none; margin-bottom: 0; }
    .cms-microsite-bodega-del-mes .propuesta-bodega h3,
    .cms-microsite-colecciones .propuesta-bodega h3,
    .cms-microsite-colecciones .vinos-coleccion h3 { font-weight: 300; font-size: 18px; margin-bottom: 15px;}
    .cms-microsite-colecciones .vinos-coleccion h3 { font-size: 24px; margin-bottom: 10px; }
    .cms-microsite-colecciones .vinos-coleccion h3 a { text-decoration: none; }
    .cms-microsite-colecciones .vinos-coleccion h3 a:hover { text-decoration: underline; }
    .cms-microsite-bodega-del-mes .category-image,
    .cms-microsite-bodega-del-mes .propuesta-bodega,
    .cms-microsite-colecciones .category-image,
    .cms-microsite-colecciones .propuesta-bodega { margin-bottom: 30px; }
    .cms-microsite-bodega-del-mes .col1-layout .product-view-otros .product-shop { margin-left: 10px; }
    .cms-microsite-bodega-del-mes .banner-sacacorchos { position: relative; float: right; margin-top: -260px; top: 330px; clear: both; }
    .cms-microsite-bodega-del-mes .home-product-list h2 { width: 685px; }
    .cms-microsite-bodega-del-mes .home-product-list ul { margin-bottom: 35px; }
    .cms-microsite-bodega-del-mes .desc-bodega h2,
    .cms-microsite-colecciones .vinos-coleccion h2,
    .cms-microsite-optimum .optimum-entregas h2,
    .cms-microsite-optimum .optimum-payments h2,
    .cms-microsite-optimum .optimum-opciones h2,
    .cms-microsite-socio h2 {
        font-weight: 300;
        text-transform: uppercase;
        color: #000;
        font-size: 24px;
        border-bottom: 1px solid #ccc;
        margin: 0 0 33px;
    }
    .cms-microsite-bodega-del-mes .desc-bodega .desc-bodega-text { padding: 15px 25px; }

    .cms-microsite-colecciones .vinos-coleccion,
    .cms-microsite-colecciones .vino-coleccion { clear: both; margin-bottom: 30px; }
    .cms-microsite-colecciones .vino-coleccion p { margin-right: 250px; }
    .cms-microsite-colecciones .vino-coleccion-image-bodega { float: right; margin-left: 35px; }
    .cms-microsite-colecciones .vino-coleccion-image { float: left; margin-right: 35px; }
    .cms-microsite-colecciones .vinos-coleccion .add-to-cart { border-top: 1px solid #ccc; padding-top: 20px; float: none; text-align: center; }
    .cms-microsite-colecciones .vinos-coleccion .add-to-cart button,
    .cms-microsite-optimum .add-to-cart button { float: none; }
    .cms-microsite-colecciones .vinos-coleccion .add-to-cart button span,
    .cms-microsite-optimum .add-to-cart button span,
    .cms-microsite-socio .add-to-cart button span { background: #333; padding: 0 25px; color: #fff; text-transform: uppercase; font-weight: 600; border: 0; height: 53px; line-height: 53px; font-size: 18px; }
    .cms-microsite-colecciones .vinos-coleccion .add-to-cart button span span,
    .cms-microsite-optimum .add-to-cart button span span,
    .cms-microsite-socio .add-to-cart button span span { float: left; padding: 0; }
    .cms-microsite-socio .add-to-cart button span span { float: none; }
    .cms-microsite-colecciones .vinos-coleccion .add-to-cart button .icon,
    .cms-microsite-optimum .add-to-cart button .icon { float: left; width: 26px; height: 24px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bg-cart-button.png) 0 4px no-repeat; margin: 12px 15px 0 0; }

    .cms-microsite-optimum .optimum-content .optimum-entregas h2,
    .cms-microsite-optimum .optimum-content .optimum-payments h2,
    .cms-microsite-optimum .optimum-content .optimum-opciones h2 { font-size: 24px; margin-bottom: 30px; }
    .cms-microsite-optimum .optimum-content .banner-sacacorchos { float: right; margin-top: 10px; margin-left: 35px; }
    .cms-microsite-optimum .optimum-content h2 { font-weight: 300; font-size: 18px; margin-bottom: 15px; margin-top: 15px; }
    .cms-microsite-optimum .optimum-content .optimum-desc { margin-right: 250px; }
    .cms-microsite-optimum .optimum-features { margin-top: 40px; }
    .cms-microsite-optimum .optimum-features > div { float: left; }
    .cms-microsite-optimum .optimum-features-box { width: 450px; margin-right: 30px; background: #ededee; padding: 15px 0; }
    .cms-microsite-optimum .optimum-features-box p { padding: 0 20px; }
    .cms-microsite-optimum .optimum-features-text { width: 435px; }
    .cms-microsite-optimum .optimum-payments,
    .cms-microsite-optimum .optimum-entregas,
    .cms-microsite-optimum .optimum-opciones { clear: both; }
    .cms-microsite-optimum .optimum-content .optimum-entregas h2 { margin-bottom: 15px; }
    .cms-microsite-optimum .optimum-entregas > p { margin-bottom: 20px; }
    .cms-microsite-optimum .optimum-entrega { float: left; width: 283px; margin-right: 30px; margin-bottom: 30px; }
    .cms-microsite-optimum .optimum-entrega.last { margin-right: 0; }
    .cms-microsite-optimum .optimum-entrega .optimum-entrega-content { background: #ededee; height: 320px;  }
    .cms-microsite-optimum .optimum-entrega .optimum-entrega-content p { padding: 10px 15px; line-height: 15px; }
    .cms-microsite-optimum .optimum-payment-first,
    .cms-microsite-optimum .optimum-payment { float: left; width: 283px;  margin-right: 30px; }
    .cms-microsite-optimum .optimum-payment.last { margin-right: 0; }
    .cms-microsite-optimum .optimum-payment-first .payment-content { padding: 15px 20px; }
    .cms-microsite-optimum .optimum-payment .payment-content { padding: 0 20px; }
    .cms-microsite-optimum .optimum-payment-first { background: #ededee; width: 283px; height: 165px; }
    .cms-microsite-optimum .optimum-payment { margin-bottom: 19px; }
    .cms-microsite-optimum .optimum-payment-first h3 { font-size: 22px; margin-bottom: 0; }
    .cms-microsite-optimum .optimum-payment-first p.optimum-payment-price { font-size: 45px; font-weight: bold; margin-bottom: 0; }
    .cms-microsite-optimum .optimum-payment-first button.button span,
    .cms-microsite-optimum .optimum-opciones button.button span { height: 35px; line-height: 35px; padding: 0 5px; }
    .cms-microsite-optimum .optimum-payment-first button span span,
    .cms-microsite-optimum .optimum-opciones button span span { font-size: 18px; }
    .cms-microsite-optimum .optimum-payment-first .add-to-cart button .icon,
    .cms-microsite-optimum .optimum-opciones .add-to-cart button .icon { margin: 2px 5px 0 0; }
    .cms-microsite-optimum .optimum-payment h3 { font-size: 15px; margin-bottom: 0; font-weight: 600; }
    .cms-microsite-optimum .optimum-payment p { line-height: 12px; margin-bottom: 5px; }
    .cms-microsite-optimum .optimum-payment button.button span { height: 26px; line-height: 26px; padding: 0 10px; }
    .cms-microsite-optimum .optimum-payment button span span { font-size: 12px; }
    .cms-microsite-optimum .optimum-payment .add-to-cart button .icon { float: left; width: 18px; height: 20px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bg-cart-button-small.png) 0 3px no-repeat; margin: 2px 5px 0 0; }
    .cms-microsite-optimum .optimum-opciones .vino-coleccion { margin-bottom: 40px; clear: both; }
    .cms-microsite-optimum .optimum-opciones .vino-coleccion.last { margin-bottom: 0; }
    .cms-microsite-optimum .optimum-opciones .vino-coleccion h3 { font-weight: 300; font-size: 22px; }
    .cms-microsite-optimum .optimum-opciones .vino-coleccion h3 a { text-decoration: none; }
    .cms-microsite-optimum .optimum-opciones .vino-coleccion h3 a:hover { text-decoration: underline; }
    .cms-microsite-optimum .optimum-opciones .vino-coleccion-image { float: left; margin-right: 20px; }
    .cms-microsite-optimum .optimum-opciones .add-to-box { float: right; margin-top: 25px; }

    .cms-microsite-socio .page-title { margin-bottom: 10px; }
    .cms-microsite-socio .category-image { margin-bottom: 70px; }
    .cms-microsite-socio h2, .cms-microsite-socio h3 { margin-bottom: 20px; }
    .cms-microsite-socio #form-nuevo-socio { width: 685px; display: block; }
    .cms-microsite-socio .fieldset { margin: 28px 0 55px; }
    .cms-microsite-socio ul.form-list { padding-left: 0; }
    .cms-microsite-socio ul.form-list li.fields { margin-bottom: 20px; }
    .cms-microsite-socio ul.form-list .field { width: 330px; margin-right: 25px; }
    .cms-microsite-socio ul.form-list .field.last { margin-right: 0; }
    .cms-microsite-socio ul.form-list label { font-weight: normal; color: #000000; font-size: 12px; }
    .cms-microsite-socio ul.form-list .field input { width: 325px; background: none; border: 1px solid #ccccca; height: 25px; line-height: 25px; }
    .cms-microsite-socio ul.form-list .field-fnacnimiento input { width: 36px; }
    .cms-microsite-socio ul.form-list .field-fnacnimiento input#fnacimiento_socio_anyo { width: 60px; }
    .cms-microsite-socio .socio-captcha { float: right; margin-top: 40px; background: #ededee; width: 275px; height: 225px; margin-bottom: 25px; }
    .cms-microsite-socio .socio-captcha ul { padding: 15px 25px; }
    .cms-microsite-socio .socio-captcha li { margin-bottom: 20px; }
    .cms-microsite-socio .socio-captcha li label { margin-bottom: 25px; display: block; }
    .cms-microsite-socio .socio-captcha li.captcha { text-align: right; }
    .cms-microsite-socio .socio-captcha li input { width: 206px; float: right; background: #ffffff; border: 1px solid #ccccca; height: 25px; line-height: 25px; }
    .cms-microsite-socio .socio-captcha .captcha-image { float: none; }
    .cms-microsite-socio .socio-check,
    .cms-microsite-socio .socio-payment { margin-top: 50px; }
    .cms-microsite-socio .socio-payment { float: left; }
    .cms-microsite-socio .socio-check label input,
    .cms-microsite-socio .socio-payment div.input-box input { width: 45px; background: none; border: 1px solid #ccccca; height: 25px; line-height: 25px; }
    .cms-microsite-socio .socio-check label { position: relative; z-index: 10; }
    .cms-microsite-socio .socio-check label input { position: relative; z-index: 15; }
    .cms-microsite-socio .socio-payment > div > label { font-weight: bold; margin-bottom: 25px; float: left; display: block; clear: right; }
    .cms-microsite-socio .socio-payment div.input-box { float: left; max-width: 110px; margin-right: 10px; }
    .cms-microsite-socio .socio-payment div.socio-payment-visa,
    .cms-microsite-socio .socio-payment div.socio-payment-data { clear: both; }
    .cms-microsite-socio .socio-payment div.socio-payment-visa { margin-top: 30px; }
    .cms-microsite-socio .socio-payment div.field-visa-tar { margin-right: 30px; }
    .cms-microsite-socio .socio-payment div.input-box label { display: block; line-height: 15px; margin-bottom: 4px; }
    .cms-microsite-socio .socio-payment div.field-banco-ent,
    .cms-microsite-socio .socio-payment div.field-banco-suc { width: 70px; }
    .cms-microsite-socio .socio-payment div.field-banco-iban,
    .cms-microsite-socio .socio-payment div.field-banco-dc,
    .cms-microsite-socio .socio-payment div.field-banco-cta { padding-top: 15px; }
    .cms-microsite-socio .socio-payment div .input-box #socio_fp_banco_ent { width: 65px; }
    .cms-microsite-socio .socio-payment div .input-box #socio_fp_banco_suc { width: 65px; }
    .cms-microsite-socio .socio-payment div .input-box #socio_fp_banco_dc { width: 37px; }
    .cms-microsite-socio .socio-payment div .input-box #socio_fp_banco_cta { width: 106px; }
    .cms-microsite-socio .socio-payment div .input-box #socio_fp_visa_tar { width: 106px; }
    .cms-microsite-socio .add-to-box { clear: both; float: right; margin-bottom: 50px; }
    .cms-microsite-socio .socio-terminos { clear: both; margin-top: 40px; background: #ededee; padding: 35px 45px; }
    .cms-microsite-socio .socio-terminos-content ul { padding-bottom: 25px; margin-bottom: 25px; border-bottom: 1px solid #ccccca; }
    .cms-microsite-socio .add-to-cart button span { padding: 0 15px; height: 36px; line-height: 36px; }
    .cms-microsite-socio .news-check,
    .cms-microsite-socio .policy-check {
        width: 100%;
        float: left;
    }

    /* ======================================================================================= */
    /*	Iberia
/* ======================================================================================= */

    .nav-container.nav-iberia, .header-container .home-top-menu .iberia_sub, .header-container .home-top-menu .iberia_sub li a,
    .header-container .home-top-menu .iberia.hover, .header-container .home-top-menu .iberia:hover { background-color:#d7192d; }
    .header-container .home-top-menu .iberia.hover a, .header-container .home-top-menu .iberia:hover a { background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/logo_iberia_active.png) no-repeat center center; }
    .banners-iberia-home a { margin-right: 20px; }
    .banners-iberia-home a.last { margin-right: 0; }
    .banner-vs-iberia { margin: 80px 0 20px 0; }
    .categorypath-iberia .page-title { display: none; }
    .iberia-home-wellcome h2 { font-size: 24px; font-weight: 300; margin-bottom: 15px; }
    .iberia-home-wellcome { margin-bottom: 25px; }
    .iberia-home-ventajas { width: 315px; float: left; margin-top: 10px; margin-bottom: 20px; }
    .iberia-home-ventajas h2 { text-transform: uppercase; font-weight: 300; font-size: 24px; }
    .iberia-home-ventajas ul { padding-left: 0; margin-top: 10px; }
    .iberia-home-ventajas ul li { list-style-type: none; padding-left: 25px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bg-list-bold.png) no-repeat left 3px; font-weight: bold; }
    .iberia-home-ventajas .actions { text-align: center; }
    .iberia-home-ventajas a.button { padding: 4px 24px; margin-top: 20px; display: inline-block; text-transform: uppercase; text-decoration: none; text-align: center; font-size: 18px; color: #fff; background: #333; border: 0; font-weight: 600; }
    .banner-iberia-avios { float: right; }

    /* Home */
    .banners-iberia-home02, .banners-iberia-home03, .banners-iberia-home04{position: relative; width: 200px; height: 96px; background: url("http://www.vinoseleccion.com/skin/frontend/default/ge/images/icono-home.png") no-repeat  170px 21px  #d7192d;color: #ffffff; font-size: 27px; float: left; padding: 52px 0 0 10px; margin-bottom: 40px }
    .banners-iberia-home02 a, .banners-iberia-home03 a, .banners-iberia-home04 a { position: absolute; top: 0; left: 0; width: 200px; height: 144px; display: block; text-indent: -99999px; }
    .banners-iberia-home02 span, .banners-iberia-home03 span, .banners-iberia-home04 span{color: #fcd100;}
    .banners-iberia-home02{clear: both; margin: 0 25px 0 0;}
    .banners-iberia-home03{margin: 0 25px 0 0;}
    .proveedor{ float: left; margin: 0px 25px 34px 0;}
    .cms-iberia .std h2{font-size: 24px; font-weight: 300; }

    /* Coleccion business */
    .category-bodega-clase-business-iberia .category-image,
    .category-obtencion-avios .category-image { width: auto; }
    .category-bodega-clase-business-iberia .category-selection-lastproduct .product,
    .category-obtencion-avios .category-selection-lastproduct .product { width: 445px; }
    .category-bodega-clase-business-iberia .category-selection-lastproduct,
    .category-obtencion-avios .category-selection-lastproduct { margin-bottom: 10px; }
    .category-bodega-clase-business-iberia .category-selection-otherproducts > h2,
    .category-bodega-clase-business-iberia .cartas-iberia h2,
    .category-obtencion-avios .category-selection-otherproducts > h2,
    .category-obtencion-avios .with-filters > h2, .category-comprar-con-avios .with-filters > h2 { font-size: 24px; font-weight: 300; padding: 0 0 5px; border-bottom: 1px solid #ccccca; text-transform: uppercase; margin: 0 0 21px; }
    .category-obtencion-avios .with-filters > h2, .category-comprar-con-avios .with-filters > h2 { border-bottom: none; margin-bottom: 0; }
    .category-bodega-clase-business-iberia .cartas-iberia h2 { margin-bottom: 35px; }
    .category-bodega-clase-business-iberia .cartas-iberia { margin-top: 25px; }
    .cartas-iberia ul li { width: 220px; height: 230px; float: left; margin-right: 10px; text-align: center; }
    .cartas-iberia ul li.last { margin-right: 0; }
    .cartas-iberia ul li p { margin-top: 5px; font-weight: 600; font-size: 15px; }
    .cartas-iberia ul li p a { color: black; }

    .category-comprar-con-avios .banner-sacacorchos { position: relative; float: right; margin-top: -260px; top: 330px; }
    .category-comprar-con-avios .home-product-list h2 { margin-bottom: 20px; }
    .category-comprar-con-avios .home-steps { margin-bottom: 0; }
    .category-comprar-con-avios .products-grid .actions .price-box .price { font-size: 14px; }
    .category-comprar-con-avios .products-grid .actions .price-box .price .avios-currency { font-size: 12px; font-weight: normal; }
    .category-comprar-con-avios .products-grid .actions { padding-left: 31px; }
    .category-comprar-con-avios .products-grid .actions-box { width: 145px; }
    .category-comprar-con-avios .products-grid .actions .price-box { width: 73px; }
    .category-comprar-con-avios .products-grid .desc, .products-grid .sdesc { margin-left: 77px; }
    .category-bodega-clase-business-iberia .products-grid-otros .desc, .category-bodega-clase-business-iberia .products-grid-otros .sdesc { margin-left: 0; }
    .category-comprar-con-avios .m-slider-values { font-size: 9.5px; }

    .category-bodega-clase-business-iberia .products-grid-otros .actions-box { right: 0; }
    .category-bodega-clase-business-iberia .products-grid-otros .actions { padding-left: 26px; width: auto; text-align: left; background: #ededee; }
    .category-bodega-clase-business-iberia .products-grid-otros .actions .price-box { margin: 0 7px 0 0; padding: 0; width: 70px; float: left; }

    .add-to-cart-wrapper .avios { background: #717070; padding: 1px 3px; color: #ffffff; }
    .products-grid .actions-box .avios { background: #717070; padding: 1px 3px; color: #ffffff; position: relative; top: 0; left: 0; z-index: 999; float: left; height: 15px; line-height: 15px; display: block; margin-top: -10px; font-size: 11px; }

    .iberia-cart .home-product-list .products-grid .actions .price-box .price { font-size: 14px; }
    .iberia-cart .home-product-list .products-grid .actions .price-box .price .avios-currency { font-size: 12px; font-weight: normal; }

    .category-bodega-clase-business-iberia .add-to-cart-wrapper .avios { display: none; }

    /* ======================================================================================= */


    /* Clears ================================================================================ */
    .clearer:after,
    .header-container:after,
    .header-container .top-container:after,
    .header:after,
    .header .quick-access:after,
    #nav:after,
    .main:after,
    .footer:after,
    .footer-container .bottom-container:after,
    .col-main:after,
    .col2-set:after,
    .col3-set:after,
    .col3-layout .product-options-bottom .price-box:after,
    .col4-set:after,
    .search-autocomplete li:after,
    .block .block-content:after,
    .block .actions:after,
    .block li.item:after,
    .block-poll li:after,
    .block-layered-nav .currently li:after,
    .page-title:after,
    .products-grid:after,
    .products-list li.item:after,
    .box-account .box-head:after,
    .dashboard .box .box-title:after,
    .box-reviews li.item:after,
    .box-tags li.item:after,
    .pager:after,
    .sorter:after,
    .ratings:after,
    .add-to-box:after,
    .add-to-cart:after,
    .product-essential:after,
    .product-collateral:after,
    .product-view .product-img-box .more-views ul:after,
    .product-view .box-tags .form-add:after,
    .product-view .product-shop .short-description:after,
    .product-view .box-description:after,
    .product-options .options-list li:after,
    .product-options-bottom:after,
    .product-review:after,
    .cart:after,
    .cart-collaterals:after,
    .cart .crosssell li.item:after,
    .opc .step-title:after,
    .checkout-progress:after,
    .multiple-checkout .place-order:after,
    .group-select li:after,
    .form-list li:after,
    .form-list .field:after,
    .buttons-set:after,
    .page-print .print-head:after,
    .advanced-search-summary:after,
    .gift-messages-form .item:after,
    .send-friend .form-list li p:after,
    .toolbar:after,
    .category-bodegas .subcategories-list ul:after,
    .product-view .product-shop .add-to-cart-wrapper:after,
    .product-actions:after,
    .tabs-container:after,
    .banner-colecciones:after,
    .category-bodegas-page:after,
    .block-category-wrapper:after,
    .category-selection-wrapper:after,
    .category-selection-info:after,
    .category-selection-lastproduct:after,
    .cart .crosssell .product-details:after,
    .cms-microsite-colecciones .vino-coleccion:after,
    .cms-microsite-optimum .optimum-opciones .vino-coleccion:after,
    .cms-microsite-optimum .optimum-payments:after,
    .cms-microsite-optimum .optimum-entregas:after,
    .cms-microsite-socio .socio-payment div.socio-payment-data:after { display:block; content:"."; clear:both; font-size:0; line-height:0; height:0; overflow:hidden; }
    /* ======================================================================================= */

    .guest-select {width:305px !important;}
    /* h5bp. hide visually but available for screenreaders */
    .visuallyhidden { border: 0; clip: rect(0 0 0 0); height: 1px; margin: -1px; overflow: hidden; padding: 0; position: absolute; width: 1px; }
    .custom-radio-label { padding: 0 0 0 26px;  }
    .custom-radio-label-unchecked { padding: 0 0 0 26px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_radios.png) 0 2px no-repeat; }
    .custom-radio-label-checked { padding: 0 0 0 26px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_radios_checked.png) 0 2px no-repeat; }

    .input-box-select { position: relative; height: 23px; }
    .input-box-select select { 	background: transparent; line-height: 1; border: 0; border-radius: 0; height: 23px; outline: none; position: relative; z-index: 10; }
    .input-box-select .select { height: 21px; line-height: 21px; width: 100%; border: 1px solid #ccccca; overflow: hidden; text-indent: 10px; background: #fff url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/bkg_step_checkout_close.png) 98% 50% no-repeat; position: absolute; top: 0; float: left; left: 0; cursor: default; z-index: 1; }



    .cookienotice-container { background: #efefee !important; color: #2d2d2d !important; font-size: 12px !important; padding: 12px 0 !important; opacity: 0.9; }
    .cookienotice-bar .cookienotice-content { width: auto !important; padding: 0 15px !important; }
    .cookienotice-container h2 { font-size: 15px; font-weight: 300; margin-bottom: 10px; display: none; }
    .cookienotice-button { display: block; position: absolute; text-indent: -9999px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -222px 0; width: 16px; height: 16px; top: 9px; right: 11px; }
    .cookienotice-container a { color: #2d2d2d !important; text-decoration: underline; }

    body #overlay { z-index: 99999; }
    body #lightbox { z-index: 999999; }

    .gIndex .search{ margin-right: 10px; }
    .gIndex .search input{ padding: 2px 6px; }
    .entity-search-results{
        text-align: left;
        cursor: default;
        border: 1px solid #ccc;
        border-top: 0;
        background: #fff;
        box-shadow: -1px 1px 3px rgba(0,0,0,.1);
        position: absolute;
        display: none;
        z-index: 9999;
        max-height: 254px;
        overflow: hidden;
        overflow-y: auto;
        box-sizing: border-box;
        width: auto !important;
    }
    .entity-search-results .autocomplete-suggestion{
        position: relative;
        padding: 0 .6em;
        line-height: 23px;
        white-space: nowrap;
        overflow: hidden;
        font-size: 1.02em;
        color: #333;
    }
    .entity-search-results .autocomplete-suggestion b{
        font-weight: normal;
        color: #bc1725;
    }
    .entity-search-results .autocomplete-suggestion.selected{
        background: #f0f0f0;
    }

    .entity-header-image-landscape{}
    .entity-header-image-portrait{
        float: left;
        width: auto;
    }

    .entity-content-landscape{}
    .entity-content-portrait{
        width: 684px;
        margin-left: 25px;
        margin-bottom: 40px;
        min-height: 290px;
        float: left;
    }

    .qty-container{ position: relative; }
    .btn-qty-modifier{
        position: absolute;
        width: 16px;
        height: 16px;
        top: 20px;
        text-indent: -9999px;
    }
    .btn-qty-decrease{
        left: 5px;
        background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/btn-qty-decrease-rb.png) 0 0 no-repeat;
    }
    .btn-qty-increase{
        right: 6px;
        background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/btn-qty-increase-rb.png) 0 0 no-repeat;
    }
    button.back-to-checkout{
        width: 100%;
    }
    button.back-to-checkout span{
        background: #bc1724;
    }
    .precontent .messages {
        margin-bottom: 10px !important;
    }
    .product-view .printing-tabs{ display: none !important;}

    .product-view .product-img-box { position: relative; }

    .sticker{
        position: absolute;
        left: 5px;
        width: 70px;
        height: 35px;
        text-indent: -9999px;
    }

    .availability.out-of-stock {
        width: 200px;
    }

    /** Modify Template PC - Privacy Policy
	customer-account-create **/

    .fieldset-privacy-policy label {  color: #666;  font-weight: bold;  position: absolute;  z-index: 0;  margin-left: 5px;  }

    .fieldset-privacy-policy label em {  float: right;  font-style: normal;  color: #EB340A;  position: absolute;  top: 0;  right: -8px;  }
    label.privacy-policy em {  float: right;  font-style: normal;  color: #EB340A;  position: absolute;  top: 0;  right: -8px;  }

    .fieldset-privacy-policy {  margin-bottom: 15px; overflow: hidden; }

    .fieldset-privacy-policy .input-check-privacy-policy {  display: inline;  }

    .fieldset-privacy-policy .input-check-privacy-policy .comunicaciones {  margin-left: 60%;  }

    .form-list li.control input.comunicaciones {  margin-left: 34%;  }

    .fieldset-privacy-policy input.privacy-policy {  float: left;  }

    .fieldset-privacy-policy label.privacy-policy {  float: left;  position: relative;  }

    li input.form-privacy-policy {  float: left;	}

    .form-list li input.comunicaciones, input.form-privacy-policy { margin-right: 5px;	}

    #lightbox{	position: absolute;	left: 0; width: 100%; z-index: 999; text-align: center; line-height: 0;}
    #lightbox img{ width: auto; height: auto; top: 0px; left: 0px; }
    #lightbox a img{ border: none; }

    #outerImageContainer{ position: relative; background-color: #fff; width: 250px; height: 250px; margin: 0 auto; }
    #imageContainer{ padding: 10px; }

    #loading{ position: absolute; top: 40%; left: 0%; height: 25%; width: 100%; text-align: center; line-height: 0; }
    #hoverNav{ position: absolute; top: 0; left: 0; height: 100%; width: 100%; z-index: 10; }
    #imageContainer>#hoverNav{ left: 0;}
    #hoverNav a{ outline: none;}

    #prevLink, #nextLink{ width: 49%; height: 100%; background-image: url(http://www.vinoseleccion.com/skin/frontend/default/default/images/lightbox/blank.gif); /* Trick IE into showing hover */ display: block; }
    #prevLink { left: 0; float: left;}
    #nextLink { right: 0; float: right;}
    #prevLink:hover, #prevLink:visited:hover { background: url(http://www.vinoseleccion.com/skin/frontend/default/default/images/lightbox/prevlabel.gif) left 15% no-repeat; }
    #nextLink:hover, #nextLink:visited:hover { background: url(http://www.vinoseleccion.com/skin/frontend/default/default/images/lightbox/nextlabel.gif) right 15% no-repeat; }

    #imageDataContainer{ font: 10px Verdana, Helvetica, sans-serif; background-color: #fff; margin: 0 auto; line-height: 1.4em; overflow: auto; width: 100%	; }

    #imageData{	padding:0 10px; color: #666; }
    #imageData #imageDetails{ width: 70%; float: left; text-align: left; }
    #imageData #caption{ font-weight: bold;	}
    #imageData #numberDisplay{ display: block; clear: left; padding-bottom: 1.0em;	}
    #imageData #bottomNavClose{ width: 66px; float: right;  padding-bottom: 0.7em; outline: none;}

    #overlay{ position: absolute; top: 0; left: 0; z-index: 999; width: 100%; height: 500px; background-color: #000; }
    #magestore-bannerslider-popup{
        padding: 2px;
        position: fixed;
        z-index: 19990;
        background: #fff;
        border: 2px;
    }
    #magestore-bannerslider-popup-close{
        cursor: pointer;
        height: 22px;
        width:22px;
        position: absolute;
        right: 0px;
        top: -25px;
        z-index: 19999;
        background:url(http://www.vinoseleccion.com/skin/frontend/base/default/css/magestore/bannerslider/image/close-tiny.png) no-repeat center;
    }
    #bg_fade {
        background-color: #000000;
        height: 100%;
        left: 0;
        margin: 0;
        padding: 0;
        position: fixed;
        top: 0;
        visibility: hidden;
        width: 100%;
        z-index: 1000;
        opacity: 0.7;
    }
    /* CONTAINER */
    .cookienotice-container {font: inherit;background: #ddd;z-index: 9999;padding: 10px;}
    .cookienotice-content {margin: 0 auto;display: block;clear: both;overflow: auto;}

    /* MESSAGE */
    .cookienotice-message {float: left;}
    .cookienotice-page-link {}
    .cookienotice-page-link:hover {}

    /* BUTTON */
    .cookienotice-button-container {float: right;}
    .cookienotice-button {cursor: pointer;}
    .cookienotice-container .cookienotice-button:hover {}
    .cookienotice-container a.cookienotice-button:active {}

    /* BAR */
    .cookienotice-bar {clear: both;width: 100%;}
    .cookienotice-bar-top {position: absolute;top: 0;left: 0;}
    .cookienotice-bar-bottom {position: fixed;top: auto;bottom: 0;left: 0;}
    .cookienotice-bar .cookienotice-content {width: 960px;}

    /* BOX */
    .cookienotice-box {position: fixed;top: 0;left: 0;width: 240px;border-radius: 4px;top: auto;bottom: auto;left: auto;right: auto;}
    .cookienotice-box-top-left {left: 30px;top: 30px;}
    .cookienotice-box-top-right {right: 30px;top: 30px;}
    .cookienotice-box-bottom-right {right: 30px;bottom: 30px;}
    .cookienotice-box-bottom-left {left: 30px;bottom: 30px;}
    .cookienotice-box .cookienotice-content {}
    #custommenu {
        position:relative;
        font-size: 14px;
        margin: 0 auto;
        padding: 5px 16px 0;
        width: 918px;
        z-index: 999;
        height: 35px;
    }
    div.menu {
        float: left;
        position: relative;
    }
    div.menu .parentMenu a{
        padding: 2px 7px;
        position:relative;
        top: 1px;
    }
    div.menu.active .parentMenu a,
    div.menu .parentMenu a:hover {
        background-color: #fff;
        background-image: -webkit-gradient(linear, left top, left bottom, from(#fff), to(#fefefe)); /* Chrome, Safari 4+ */
        background-image: -webkit-linear-gradient(top, #fff, #fefefe); /* Chrome 10-25, iOS 5+, Safari 5.1+ */
        background-image:    -moz-linear-gradient(top, #fff, #fefefe); /* Firefox 3.6-15 */
        background-image:      -o-linear-gradient(top, #fff, #fefefe); /* Opera 11.10-12.00 */
        background-image:         linear-gradient(to bottom, #fff, #fefefe); /* Chrome 26, Firefox 16+, IE 10+, Opera 12.10+ */
        border-width: 1px 1px 0;
        z-index: 10001;

        box-shadow: 0 0 -4px rgba(0,0,0,.75);
    }
    div.wp-custom-menu-popup {
        position:absolute;
        z-index:3000;
        display: none;
        padding: 15px 0;
        background-color:#eae9e9;
        background-image: -webkit-gradient(linear, left top, left bottom, from(#fefefe), to(#eae9e9)); /* Chrome, Safari 4+ */
        background-image: -webkit-linear-gradient(top, #fefefe, #eae9e9); /* Chrome 10-25, iOS 5+, Safari 5.1+ */
        background-image:    -moz-linear-gradient(top, #fefefe, #eae9e9); /* Firefox 3.6-15 */
        background-image:      -o-linear-gradient(top, #fefefe, #eae9e9); /* Opera 11.10-12.00 */
        background-image:         linear-gradient(to bottom, #fefefe, #eae9e9); /* Chrome 26, Firefox 16+, IE 10+, Opera 12.10+ */
        box-shadow: 0 0 4px rgba(0,0,0,.75);
        text-align:left;
    }
    div.wp-custom-menu-popup .block1,
    div.wp-custom-menu-popup .block2 { float: left; }
    div.menu, div.wp-custom-menu-popup {

    }

    div.parentMenu a { font-size: 16px; color: #fff; font-weight: 700; position: relative; margin: 0 32px 0 0; }
    div.parentMenu:after { content: ''; width: 7px; height: 7px; background: url(http://www.vinoseleccion.com/skin/frontend/default/ge/images/sprite.png) -215px 0 no-repeat; position: absolute; right: 13px; top: 12px; }
    div.parentMenu.last:after { content: ''; width: 0; height: 0; background: none; }

    div.parentMenu a:hover,
    div.parentMenu a:focus,
    .active div.parentMenu a{ color: #bc1724; }

    div.menu a, div.wp-custom-menu-popup a {
        text-decoration: none;
        display:block;
    }
    div.wp-custom-menu-popup a.actParent {
        color: #4D4D4D;
    }
    div.wp-custom-menu-popup a.act {
        color: #A52A2A;
    }
    div.column {
        float:left;
        width:222px; /* column width */
        border-right: 1px solid #ccccca;
        padding: 10px 0;
    }
    div.column:last-child { border: 0; }

    .itemMenuName.level1 { padding: 10px 0; }
    .itemMenuName.level1:first-child { padding-top: 0; }

    div.itemMenu {
        padding:0 10px;
    }
    div.itemMenu a,
    div.itemMenu a:visited {
        font-weight: 600;
        color: #000;
    }
    div.itemMenu a:hover,
    div.itemMenu a:focus,
    div.itemSubMenu a:hover,
    div.itemSubMenu a:focus {
        text-decoration: underline;
    }
    div.itemSubMenu div.itemMenu { padding: 0; }
    div.itemSubMenu a,
    div.itemSubMenu a:visited {
        font-weight: 400;
        color: #000;
    }
    .clearBoth {
        clear:both;
    }
    #custommenu.rtl .menu {
        float: right;
    }
    #custommenu.rtl div.column {
        text-align: right;
    }


    </style>
    <link rel="stylesheet" type="text/css" href="http://www.vinoseleccion.com/media/css/51e2fa27767fd84b94d21ac02265a747.css" media="print" /> <script type="text/javascript"  style="display:none">/*  Prototype JavaScript framework, version 1.7
     *  (c) 2005-2010 Sam Stephenson
     *
     *  Prototype is freely distributable under the terms of an MIT-style license.
     *  For details, see the Prototype web site: http://www.prototypejs.org/
     *
     *--------------------------------------------------------------------------*/

    var Prototype = {

        Version: '1.7',

        Browser: (function(){
            var ua = navigator.userAgent;
            var isOpera = Object.prototype.toString.call(window.opera) == '[object Opera]';
            return {
                IE:             !!window.attachEvent && !isOpera,
                Opera:          isOpera,
                WebKit:         ua.indexOf('AppleWebKit/') > -1,
                Gecko:          ua.indexOf('Gecko') > -1 && ua.indexOf('KHTML') === -1,
                MobileSafari:   /Apple.*Mobile/.test(ua)
            }
        })(),

        BrowserFeatures: {
            XPath: !!document.evaluate,

            SelectorsAPI: !!document.querySelector,

            ElementExtensions: (function() {
                var constructor = window.Element || window.HTMLElement;
                return !!(constructor && constructor.prototype);
            })(),
            SpecificElementExtensions: (function() {
                if (typeof window.HTMLDivElement !== 'undefined')
                    return true;

                var div = document.createElement('div'),
                        form = document.createElement('form'),
                        isSupported = false;

                if (div['__proto__'] && (div['__proto__'] !== form['__proto__'])) {
                    isSupported = true;
                }

                div = form = null;

                return isSupported;
            })()
        },

        ScriptFragment: '<script[^>]*>([\\S\\s]*?)<\/script>',
        JSONFilter: /^\/\*-secure-([\s\S]*)\*\/\s*$/,

        emptyFunction: function() { },

        K: function(x) { return x }
    };

    if (Prototype.Browser.MobileSafari)
        Prototype.BrowserFeatures.SpecificElementExtensions = false;


    var Abstract = { };


    var Try = {
        these: function() {
            var returnValue;

            for (var i = 0, length = arguments.length; i < length; i++) {
                var lambda = arguments[i];
                try {
                    returnValue = lambda();
                    break;
                } catch (e) { }
            }

            return returnValue;
        }
    };

    /* Based on Alex Arnell's inheritance implementation. */

    var Class = (function() {

        var IS_DONTENUM_BUGGY = (function(){
            for (var p in { toString: 1 }) {
                if (p === 'toString') return false;
            }
            return true;
        })();

        function subclass() {};
        function create() {
            var parent = null, properties = $A(arguments);
            if (Object.isFunction(properties[0]))
                parent = properties.shift();

            function klass() {
                this.initialize.apply(this, arguments);
            }

            Object.extend(klass, Class.Methods);
            klass.superclass = parent;
            klass.subclasses = [];

            if (parent) {
                subclass.prototype = parent.prototype;
                klass.prototype = new subclass;
                parent.subclasses.push(klass);
            }

            for (var i = 0, length = properties.length; i < length; i++)
                klass.addMethods(properties[i]);

            if (!klass.prototype.initialize)
                klass.prototype.initialize = Prototype.emptyFunction;

            klass.prototype.constructor = klass;
            return klass;
        }

        function addMethods(source) {
            var ancestor   = this.superclass && this.superclass.prototype,
                    properties = Object.keys(source);

            if (IS_DONTENUM_BUGGY) {
                if (source.toString != Object.prototype.toString)
                    properties.push("toString");
                if (source.valueOf != Object.prototype.valueOf)
                    properties.push("valueOf");
            }

            for (var i = 0, length = properties.length; i < length; i++) {
                var property = properties[i], value = source[property];
                if (ancestor && Object.isFunction(value) &&
                        value.argumentNames()[0] == "$super") {
                    var method = value;
                    value = (function(m) {
                        return function() { return ancestor[m].apply(this, arguments); };
                    })(property).wrap(method);

                    value.valueOf = method.valueOf.bind(method);
                    value.toString = method.toString.bind(method);
                }
                this.prototype[property] = value;
            }

            return this;
        }

        return {
            create: create,
            Methods: {
                addMethods: addMethods
            }
        };
    })();
    (function() {

        var _toString = Object.prototype.toString,
                NULL_TYPE = 'Null',
                UNDEFINED_TYPE = 'Undefined',
                BOOLEAN_TYPE = 'Boolean',
                NUMBER_TYPE = 'Number',
                STRING_TYPE = 'String',
                OBJECT_TYPE = 'Object',
                FUNCTION_CLASS = '[object Function]',
                BOOLEAN_CLASS = '[object Boolean]',
                NUMBER_CLASS = '[object Number]',
                STRING_CLASS = '[object String]',
                ARRAY_CLASS = '[object Array]',
                DATE_CLASS = '[object Date]',
                NATIVE_JSON_STRINGIFY_SUPPORT = window.JSON &&
                        typeof JSON.stringify === 'function' &&
                        JSON.stringify(0) === '0' &&
                        typeof JSON.stringify(Prototype.K) === 'undefined';

        function Type(o) {
            switch(o) {
                case null: return NULL_TYPE;
                case (void 0): return UNDEFINED_TYPE;
            }
            var type = typeof o;
            switch(type) {
                case 'boolean': return BOOLEAN_TYPE;
                case 'number':  return NUMBER_TYPE;
                case 'string':  return STRING_TYPE;
            }
            return OBJECT_TYPE;
        }

        function extend(destination, source) {
            for (var property in source)
                destination[property] = source[property];
            return destination;
        }

        function inspect(object) {
            try {
                if (isUndefined(object)) return 'undefined';
                if (object === null) return 'null';
                return object.inspect ? object.inspect() : String(object);
            } catch (e) {
                if (e instanceof RangeError) return '...';
                throw e;
            }
        }

        function toJSON(value) {
            return Str('', { '': value }, []);
        }

        function Str(key, holder, stack) {
            var value = holder[key],
                    type = typeof value;

            if (Type(value) === OBJECT_TYPE && typeof value.toJSON === 'function') {
                value = value.toJSON(key);
            }

            var _class = _toString.call(value);

            switch (_class) {
                case NUMBER_CLASS:
                case BOOLEAN_CLASS:
                case STRING_CLASS:
                    value = value.valueOf();
            }

            switch (value) {
                case null: return 'null';
                case true: return 'true';
                case false: return 'false';
            }

            type = typeof value;
            switch (type) {
                case 'string':
                    return value.inspect(true);
                case 'number':
                    return isFinite(value) ? String(value) : 'null';
                case 'object':

                    for (var i = 0, length = stack.length; i < length; i++) {
                        if (stack[i] === value) { throw new TypeError(); }
                    }
                    stack.push(value);

                    var partial = [];
                    if (_class === ARRAY_CLASS) {
                        for (var i = 0, length = value.length; i < length; i++) {
                            var str = Str(i, value, stack);
                            partial.push(typeof str === 'undefined' ? 'null' : str);
                        }
                        partial = '[' + partial.join(',') + ']';
                    } else {
                        var keys = Object.keys(value);
                        for (var i = 0, length = keys.length; i < length; i++) {
                            var key = keys[i], str = Str(key, value, stack);
                            if (typeof str !== "undefined") {
                                partial.push(key.inspect(true)+ ':' + str);
                            }
                        }
                        partial = '{' + partial.join(',') + '}';
                    }
                    stack.pop();
                    return partial;
            }
        }

        function stringify(object) {
            return JSON.stringify(object);
        }

        function toQueryString(object) {
            return $H(object).toQueryString();
        }

        function toHTML(object) {
            return object && object.toHTML ? object.toHTML() : String.interpret(object);
        }

        function keys(object) {
            if (Type(object) !== OBJECT_TYPE) { throw new TypeError(); }
            var results = [];
            for (var property in object) {
                if (object.hasOwnProperty(property)) {
                    results.push(property);
                }
            }
            return results;
        }

        function values(object) {
            var results = [];
            for (var property in object)
                results.push(object[property]);
            return results;
        }

        function clone(object) {
            return extend({ }, object);
        }

        function isElement(object) {
            return !!(object && object.nodeType == 1);
        }

        function isArray(object) {
            return _toString.call(object) === ARRAY_CLASS;
        }

        var hasNativeIsArray = (typeof Array.isArray == 'function')
                && Array.isArray([]) && !Array.isArray({});

        if (hasNativeIsArray) {
            isArray = Array.isArray;
        }

        function isHash(object) {
            return object instanceof Hash;
        }

        function isFunction(object) {
            return _toString.call(object) === FUNCTION_CLASS;
        }

        function isString(object) {
            return _toString.call(object) === STRING_CLASS;
        }

        function isNumber(object) {
            return _toString.call(object) === NUMBER_CLASS;
        }

        function isDate(object) {
            return _toString.call(object) === DATE_CLASS;
        }

        function isUndefined(object) {
            return typeof object === "undefined";
        }

        extend(Object, {
            extend:        extend,
            inspect:       inspect,
            toJSON:        NATIVE_JSON_STRINGIFY_SUPPORT ? stringify : toJSON,
            toQueryString: toQueryString,
            toHTML:        toHTML,
            keys:          Object.keys || keys,
            values:        values,
            clone:         clone,
            isElement:     isElement,
            isArray:       isArray,
            isHash:        isHash,
            isFunction:    isFunction,
            isString:      isString,
            isNumber:      isNumber,
            isDate:        isDate,
            isUndefined:   isUndefined
        });
    })();
    Object.extend(Function.prototype, (function() {
        var slice = Array.prototype.slice;

        function update(array, args) {
            var arrayLength = array.length, length = args.length;
            while (length--) array[arrayLength + length] = args[length];
            return array;
        }

        function merge(array, args) {
            array = slice.call(array, 0);
            return update(array, args);
        }

        function argumentNames() {
            var names = this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1]
                    .replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g, '')
                    .replace(/\s+/g, '').split(',');
            return names.length == 1 && !names[0] ? [] : names;
        }

        function bind(context) {
            if (arguments.length < 2 && Object.isUndefined(arguments[0])) return this;
            var __method = this, args = slice.call(arguments, 1);
            return function() {
                var a = merge(args, arguments);
                return __method.apply(context, a);
            }
        }

        function bindAsEventListener(context) {
            var __method = this, args = slice.call(arguments, 1);
            return function(event) {
                var a = update([event || window.event], args);
                return __method.apply(context, a);
            }
        }

        function curry() {
            if (!arguments.length) return this;
            var __method = this, args = slice.call(arguments, 0);
            return function() {
                var a = merge(args, arguments);
                return __method.apply(this, a);
            }
        }

        function delay(timeout) {
            var __method = this, args = slice.call(arguments, 1);
            timeout = timeout * 1000;
            return window.setTimeout(function() {
                return __method.apply(__method, args);
            }, timeout);
        }

        function defer() {
            var args = update([0.01], arguments);
            return this.delay.apply(this, args);
        }

        function wrap(wrapper) {
            var __method = this;
            return function() {
                var a = update([__method.bind(this)], arguments);
                return wrapper.apply(this, a);
            }
        }

        function methodize() {
            if (this._methodized) return this._methodized;
            var __method = this;
            return this._methodized = function() {
                var a = update([this], arguments);
                return __method.apply(null, a);
            };
        }

        return {
            argumentNames:       argumentNames,
            bind:                bind,
            bindAsEventListener: bindAsEventListener,
            curry:               curry,
            delay:               delay,
            defer:               defer,
            wrap:                wrap,
            methodize:           methodize
        }
    })());



    (function(proto) {


        function toISOString() {
            return this.getUTCFullYear() + '-' +
                    (this.getUTCMonth() + 1).toPaddedString(2) + '-' +
                    this.getUTCDate().toPaddedString(2) + 'T' +
                    this.getUTCHours().toPaddedString(2) + ':' +
                    this.getUTCMinutes().toPaddedString(2) + ':' +
                    this.getUTCSeconds().toPaddedString(2) + 'Z';
        }


        function toJSON() {
            return this.toISOString();
        }

        if (!proto.toISOString) proto.toISOString = toISOString;
        if (!proto.toJSON) proto.toJSON = toJSON;

    })(Date.prototype);


    RegExp.prototype.match = RegExp.prototype.test;

    RegExp.escape = function(str) {
        return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g, '\\$1');
    };
    var PeriodicalExecuter = Class.create({
        initialize: function(callback, frequency) {
            this.callback = callback;
            this.frequency = frequency;
            this.currentlyExecuting = false;

            this.registerCallback();
        },

        registerCallback: function() {
            this.timer = setInterval(this.onTimerEvent.bind(this), this.frequency * 1000);
        },

        execute: function() {
            this.callback(this);
        },

        stop: function() {
            if (!this.timer) return;
            clearInterval(this.timer);
            this.timer = null;
        },

        onTimerEvent: function() {
            if (!this.currentlyExecuting) {
                try {
                    this.currentlyExecuting = true;
                    this.execute();
                    this.currentlyExecuting = false;
                } catch(e) {
                    this.currentlyExecuting = false;
                    throw e;
                }
            }
        }
    });
    Object.extend(String, {
        interpret: function(value) {
            return value == null ? '' : String(value);
        },
        specialChar: {
            '\b': '\\b',
            '\t': '\\t',
            '\n': '\\n',
            '\f': '\\f',
            '\r': '\\r',
            '\\': '\\\\'
        }
    });

    Object.extend(String.prototype, (function() {
        var NATIVE_JSON_PARSE_SUPPORT = window.JSON &&
                typeof JSON.parse === 'function' &&
                JSON.parse('{"test": true}').test;

        function prepareReplacement(replacement) {
            if (Object.isFunction(replacement)) return replacement;
            var template = new Template(replacement);
            return function(match) { return template.evaluate(match) };
        }

        function gsub(pattern, replacement) {
            var result = '', source = this, match;
            replacement = prepareReplacement(replacement);

            if (Object.isString(pattern))
                pattern = RegExp.escape(pattern);

            if (!(pattern.length || pattern.source)) {
                replacement = replacement('');
                return replacement + source.split('').join(replacement) + replacement;
            }

            while (source.length > 0) {
                if (match = source.match(pattern)) {
                    result += source.slice(0, match.index);
                    result += String.interpret(replacement(match));
                    source  = source.slice(match.index + match[0].length);
                } else {
                    result += source, source = '';
                }
            }
            return result;
        }

        function sub(pattern, replacement, count) {
            replacement = prepareReplacement(replacement);
            count = Object.isUndefined(count) ? 1 : count;

            return this.gsub(pattern, function(match) {
                if (--count < 0) return match[0];
                return replacement(match);
            });
        }

        function scan(pattern, iterator) {
            this.gsub(pattern, iterator);
            return String(this);
        }

        function truncate(length, truncation) {
            length = length || 30;
            truncation = Object.isUndefined(truncation) ? '...' : truncation;
            return this.length > length ?
            this.slice(0, length - truncation.length) + truncation : String(this);
        }

        function strip() {
            return this.replace(/^\s+/, '').replace(/\s+$/, '');
        }

        function stripTags() {
            return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi, '');
        }

        function stripScripts() {
            return this.replace(new RegExp(Prototype.ScriptFragment, 'img'), '');
        }

        function extractScripts() {
            var matchAll = new RegExp(Prototype.ScriptFragment, 'img'),
                    matchOne = new RegExp(Prototype.ScriptFragment, 'im');
            return (this.match(matchAll) || []).map(function(scriptTag) {
                return (scriptTag.match(matchOne) || ['', ''])[1];
            });
        }

        function evalScripts() {
            return this.extractScripts().map(function(script) { return eval(script) });
        }

        function escapeHTML() {
            return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
        }

        function unescapeHTML() {
            return this.stripTags().replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&amp;/g,'&');
        }


        function toQueryParams(separator) {
            var match = this.strip().match(/([^?#]*)(#.*)?$/);
            if (!match) return { };

            return match[1].split(separator || '&').inject({ }, function(hash, pair) {
                if ((pair = pair.split('='))[0]) {
                    var key = decodeURIComponent(pair.shift()),
                            value = pair.length > 1 ? pair.join('=') : pair[0];

                    if (value != undefined) value = decodeURIComponent(value);

                    if (key in hash) {
                        if (!Object.isArray(hash[key])) hash[key] = [hash[key]];
                        hash[key].push(value);
                    }
                    else hash[key] = value;
                }
                return hash;
            });
        }

        function toArray() {
            return this.split('');
        }

        function succ() {
            return this.slice(0, this.length - 1) +
                    String.fromCharCode(this.charCodeAt(this.length - 1) + 1);
        }

        function times(count) {
            return count < 1 ? '' : new Array(count + 1).join(this);
        }

        function camelize() {
            return this.replace(/-+(.)?/g, function(match, chr) {
                return chr ? chr.toUpperCase() : '';
            });
        }

        function capitalize() {
            return this.charAt(0).toUpperCase() + this.substring(1).toLowerCase();
        }

        function underscore() {
            return this.replace(/::/g, '/')
                    .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')
                    .replace(/([a-z\d])([A-Z])/g, '$1_$2')
                    .replace(/-/g, '_')
                    .toLowerCase();
        }

        function dasherize() {
            return this.replace(/_/g, '-');
        }

        function inspect(useDoubleQuotes) {
            var escapedString = this.replace(/[\x00-\x1f\\]/g, function(character) {
                if (character in String.specialChar) {
                    return String.specialChar[character];
                }
                return '\\u00' + character.charCodeAt().toPaddedString(2, 16);
            });
            if (useDoubleQuotes) return '"' + escapedString.replace(/"/g, '\\"') + '"';
            return "'" + escapedString.replace(/'/g, '\\\'') + "'";
        }

        function unfilterJSON(filter) {
            return this.replace(filter || Prototype.JSONFilter, '$1');
        }

        function isJSON() {
            var str = this;
            if (str.blank()) return false;
            str = str.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@');
            str = str.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']');
            str = str.replace(/(?:^|:|,)(?:\s*\[)+/g, '');
            return (/^[\],:{}\s]*$/).test(str);
        }

        function evalJSON(sanitize) {
            var json = this.unfilterJSON(),
                    cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
            if (cx.test(json)) {
                json = json.replace(cx, function (a) {
                    return '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
                });
            }
            try {
                if (!sanitize || json.isJSON()) return eval('(' + json + ')');
            } catch (e) { }
            throw new SyntaxError('Badly formed JSON string: ' + this.inspect());
        }

        function parseJSON() {
            var json = this.unfilterJSON();
            return JSON.parse(json);
        }

        function include(pattern) {
            return this.indexOf(pattern) > -1;
        }

        function startsWith(pattern) {
            return this.lastIndexOf(pattern, 0) === 0;
        }

        function endsWith(pattern) {
            var d = this.length - pattern.length;
            return d >= 0 && this.indexOf(pattern, d) === d;
        }

        function empty() {
            return this == '';
        }

        function blank() {
            return /^\s*$/.test(this);
        }

        function interpolate(object, pattern) {
            return new Template(this, pattern).evaluate(object);
        }

        return {
            gsub:           gsub,
            sub:            sub,
            scan:           scan,
            truncate:       truncate,
            strip:          String.prototype.trim || strip,
            stripTags:      stripTags,
            stripScripts:   stripScripts,
            extractScripts: extractScripts,
            evalScripts:    evalScripts,
            escapeHTML:     escapeHTML,
            unescapeHTML:   unescapeHTML,
            toQueryParams:  toQueryParams,
            parseQuery:     toQueryParams,
            toArray:        toArray,
            succ:           succ,
            times:          times,
            camelize:       camelize,
            capitalize:     capitalize,
            underscore:     underscore,
            dasherize:      dasherize,
            inspect:        inspect,
            unfilterJSON:   unfilterJSON,
            isJSON:         isJSON,
            evalJSON:       NATIVE_JSON_PARSE_SUPPORT ? parseJSON : evalJSON,
            include:        include,
            startsWith:     startsWith,
            endsWith:       endsWith,
            empty:          empty,
            blank:          blank,
            interpolate:    interpolate
        };
    })());

    var Template = Class.create({
        initialize: function(template, pattern) {
            this.template = template.toString();
            this.pattern = pattern || Template.Pattern;
        },

        evaluate: function(object) {
            if (object && Object.isFunction(object.toTemplateReplacements))
                object = object.toTemplateReplacements();

            return this.template.gsub(this.pattern, function(match) {
                if (object == null) return (match[1] + '');

                var before = match[1] || '';
                if (before == '\\') return match[2];

                var ctx = object, expr = match[3],
                        pattern = /^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;

                match = pattern.exec(expr);
                if (match == null) return before;

                while (match != null) {
                    var comp = match[1].startsWith('[') ? match[2].replace(/\\\\]/g, ']') : match[1];
                    ctx = ctx[comp];
                    if (null == ctx || '' == match[3]) break;
                    expr = expr.substring('[' == match[3] ? match[1].length : match[0].length);
                    match = pattern.exec(expr);
                }

                return before + String.interpret(ctx);
            });
        }
    });
    Template.Pattern = /(^|.|\r|\n)(#\{(.*?)\})/;

    var $break = { };

    var Enumerable = (function() {
        function each(iterator, context) {
            var index = 0;
            try {
                this._each(function(value) {
                    iterator.call(context, value, index++);
                });
            } catch (e) {
                if (e != $break) throw e;
            }
            return this;
        }

        function eachSlice(number, iterator, context) {
            var index = -number, slices = [], array = this.toArray();
            if (number < 1) return array;
            while ((index += number) < array.length)
                slices.push(array.slice(index, index+number));
            return slices.collect(iterator, context);
        }

        function all(iterator, context) {
            iterator = iterator || Prototype.K;
            var result = true;
            this.each(function(value, index) {
                result = result && !!iterator.call(context, value, index);
                if (!result) throw $break;
            });
            return result;
        }

        function any(iterator, context) {
            iterator = iterator || Prototype.K;
            var result = false;
            this.each(function(value, index) {
                if (result = !!iterator.call(context, value, index))
                    throw $break;
            });
            return result;
        }

        function collect(iterator, context) {
            iterator = iterator || Prototype.K;
            var results = [];
            this.each(function(value, index) {
                results.push(iterator.call(context, value, index));
            });
            return results;
        }

        function detect(iterator, context) {
            var result;
            this.each(function(value, index) {
                if (iterator.call(context, value, index)) {
                    result = value;
                    throw $break;
                }
            });
            return result;
        }

        function findAll(iterator, context) {
            var results = [];
            this.each(function(value, index) {
                if (iterator.call(context, value, index))
                    results.push(value);
            });
            return results;
        }

        function grep(filter, iterator, context) {
            iterator = iterator || Prototype.K;
            var results = [];

            if (Object.isString(filter))
                filter = new RegExp(RegExp.escape(filter));

            this.each(function(value, index) {
                if (filter.match(value))
                    results.push(iterator.call(context, value, index));
            });
            return results;
        }

        function include(object) {
            if (Object.isFunction(this.indexOf))
                if (this.indexOf(object) != -1) return true;

            var found = false;
            this.each(function(value) {
                if (value == object) {
                    found = true;
                    throw $break;
                }
            });
            return found;
        }

        function inGroupsOf(number, fillWith) {
            fillWith = Object.isUndefined(fillWith) ? null : fillWith;
            return this.eachSlice(number, function(slice) {
                while(slice.length < number) slice.push(fillWith);
                return slice;
            });
        }

        function inject(memo, iterator, context) {
            this.each(function(value, index) {
                memo = iterator.call(context, memo, value, index);
            });
            return memo;
        }

        function invoke(method) {
            var args = $A(arguments).slice(1);
            return this.map(function(value) {
                return value[method].apply(value, args);
            });
        }

        function max(iterator, context) {
            iterator = iterator || Prototype.K;
            var result;
            this.each(function(value, index) {
                value = iterator.call(context, value, index);
                if (result == null || value >= result)
                    result = value;
            });
            return result;
        }

        function min(iterator, context) {
            iterator = iterator || Prototype.K;
            var result;
            this.each(function(value, index) {
                value = iterator.call(context, value, index);
                if (result == null || value < result)
                    result = value;
            });
            return result;
        }

        function partition(iterator, context) {
            iterator = iterator || Prototype.K;
            var trues = [], falses = [];
            this.each(function(value, index) {
                (iterator.call(context, value, index) ?
                        trues : falses).push(value);
            });
            return [trues, falses];
        }

        function pluck(property) {
            var results = [];
            this.each(function(value) {
                results.push(value[property]);
            });
            return results;
        }

        function reject(iterator, context) {
            var results = [];
            this.each(function(value, index) {
                if (!iterator.call(context, value, index))
                    results.push(value);
            });
            return results;
        }

        function sortBy(iterator, context) {
            return this.map(function(value, index) {
                return {
                    value: value,
                    criteria: iterator.call(context, value, index)
                };
            }).sort(function(left, right) {
                var a = left.criteria, b = right.criteria;
                return a < b ? -1 : a > b ? 1 : 0;
            }).pluck('value');
        }

        function toArray() {
            return this.map();
        }

        function zip() {
            var iterator = Prototype.K, args = $A(arguments);
            if (Object.isFunction(args.last()))
                iterator = args.pop();

            var collections = [this].concat(args).map($A);
            return this.map(function(value, index) {
                return iterator(collections.pluck(index));
            });
        }

        function size() {
            return this.toArray().length;
        }

        function inspect() {
            return '#<Enumerable:' + this.toArray().inspect() + '>';
        }









        return {
            each:       each,
            eachSlice:  eachSlice,
            all:        all,
            every:      all,
            any:        any,
            some:       any,
            collect:    collect,
            map:        collect,
            detect:     detect,
            findAll:    findAll,
            select:     findAll,
            filter:     findAll,
            grep:       grep,
            include:    include,
            member:     include,
            inGroupsOf: inGroupsOf,
            inject:     inject,
            invoke:     invoke,
            max:        max,
            min:        min,
            partition:  partition,
            pluck:      pluck,
            reject:     reject,
            sortBy:     sortBy,
            toArray:    toArray,
            entries:    toArray,
            zip:        zip,
            size:       size,
            inspect:    inspect,
            find:       detect
        };
    })();

    function $A(iterable) {
        if (!iterable) return [];
        if ('toArray' in Object(iterable)) return iterable.toArray();
        var length = iterable.length || 0, results = new Array(length);
        while (length--) results[length] = iterable[length];
        return results;
    }


    function $w(string) {
        if (!Object.isString(string)) return [];
        string = string.strip();
        return string ? string.split(/\s+/) : [];
    }

    Array.from = $A;


    (function() {
        var arrayProto = Array.prototype,
                slice = arrayProto.slice,
                _each = arrayProto.forEach; // use native browser JS 1.6 implementation if available

        function each(iterator, context) {
            for (var i = 0, length = this.length >>> 0; i < length; i++) {
                if (i in this) iterator.call(context, this[i], i, this);
            }
        }
        if (!_each) _each = each;

        function clear() {
            this.length = 0;
            return this;
        }

        function first() {
            return this[0];
        }

        function last() {
            return this[this.length - 1];
        }

        function compact() {
            return this.select(function(value) {
                return value != null;
            });
        }

        function flatten() {
            return this.inject([], function(array, value) {
                if (Object.isArray(value))
                    return array.concat(value.flatten());
                array.push(value);
                return array;
            });
        }

        function without() {
            var values = slice.call(arguments, 0);
            return this.select(function(value) {
                return !values.include(value);
            });
        }

        function reverse(inline) {
            return (inline === false ? this.toArray() : this)._reverse();
        }

        function uniq(sorted) {
            return this.inject([], function(array, value, index) {
                if (0 == index || (sorted ? array.last() != value : !array.include(value)))
                    array.push(value);
                return array;
            });
        }

        function intersect(array) {
            return this.uniq().findAll(function(item) {
                return array.detect(function(value) { return item === value });
            });
        }


        function clone() {
            return slice.call(this, 0);
        }

        function size() {
            return this.length;
        }

        function inspect() {
            return '[' + this.map(Object.inspect).join(', ') + ']';
        }

        function indexOf(item, i) {
            i || (i = 0);
            var length = this.length;
            if (i < 0) i = length + i;
            for (; i < length; i++)
                if (this[i] === item) return i;
            return -1;
        }

        function lastIndexOf(item, i) {
            i = isNaN(i) ? this.length : (i < 0 ? this.length + i : i) + 1;
            var n = this.slice(0, i).reverse().indexOf(item);
            return (n < 0) ? n : i - n - 1;
        }

        function concat() {
            var array = slice.call(this, 0), item;
            for (var i = 0, length = arguments.length; i < length; i++) {
                item = arguments[i];
                if (Object.isArray(item) && !('callee' in item)) {
                    for (var j = 0, arrayLength = item.length; j < arrayLength; j++)
                        array.push(item[j]);
                } else {
                    array.push(item);
                }
            }
            return array;
        }

        Object.extend(arrayProto, Enumerable);

        if (!arrayProto._reverse)
            arrayProto._reverse = arrayProto.reverse;

        Object.extend(arrayProto, {
            _each:     _each,
            clear:     clear,
            first:     first,
            last:      last,
            compact:   compact,
            flatten:   flatten,
            without:   without,
            reverse:   reverse,
            uniq:      uniq,
            intersect: intersect,
            clone:     clone,
            toArray:   clone,
            size:      size,
            inspect:   inspect
        });

        var CONCAT_ARGUMENTS_BUGGY = (function() {
            return [].concat(arguments)[0][0] !== 1;
        })(1,2)

        if (CONCAT_ARGUMENTS_BUGGY) arrayProto.concat = concat;

        if (!arrayProto.indexOf) arrayProto.indexOf = indexOf;
        if (!arrayProto.lastIndexOf) arrayProto.lastIndexOf = lastIndexOf;
    })();
    function $H(object) {
        return new Hash(object);
    };

    var Hash = Class.create(Enumerable, (function() {
        function initialize(object) {
            this._object = Object.isHash(object) ? object.toObject() : Object.clone(object);
        }


        function _each(iterator) {
            for (var key in this._object) {
                var value = this._object[key], pair = [key, value];
                pair.key = key;
                pair.value = value;
                iterator(pair);
            }
        }

        function set(key, value) {
            return this._object[key] = value;
        }

        function get(key) {
            if (this._object[key] !== Object.prototype[key])
                return this._object[key];
        }

        function unset(key) {
            var value = this._object[key];
            delete this._object[key];
            return value;
        }

        function toObject() {
            return Object.clone(this._object);
        }



        function keys() {
            return this.pluck('key');
        }

        function values() {
            return this.pluck('value');
        }

        function index(value) {
            var match = this.detect(function(pair) {
                return pair.value === value;
            });
            return match && match.key;
        }

        function merge(object) {
            return this.clone().update(object);
        }

        function update(object) {
            return new Hash(object).inject(this, function(result, pair) {
                result.set(pair.key, pair.value);
                return result;
            });
        }

        function toQueryPair(key, value) {
            if (Object.isUndefined(value)) return key;
            return key + '=' + encodeURIComponent(String.interpret(value));
        }

        function toQueryString() {
            return this.inject([], function(results, pair) {
                var key = encodeURIComponent(pair.key), values = pair.value;

                if (values && typeof values == 'object') {
                    if (Object.isArray(values)) {
                        var queryValues = [];
                        for (var i = 0, len = values.length, value; i < len; i++) {
                            value = values[i];
                            queryValues.push(toQueryPair(key, value));
                        }
                        return results.concat(queryValues);
                    }
                } else results.push(toQueryPair(key, values));
                return results;
            }).join('&');
        }

        function inspect() {
            return '#<Hash:{' + this.map(function(pair) {
                        return pair.map(Object.inspect).join(': ');
                    }).join(', ') + '}>';
        }

        function clone() {
            return new Hash(this);
        }

        return {
            initialize:             initialize,
            _each:                  _each,
            set:                    set,
            get:                    get,
            unset:                  unset,
            toObject:               toObject,
            toTemplateReplacements: toObject,
            keys:                   keys,
            values:                 values,
            index:                  index,
            merge:                  merge,
            update:                 update,
            toQueryString:          toQueryString,
            inspect:                inspect,
            toJSON:                 toObject,
            clone:                  clone
        };
    })());

    Hash.from = $H;
    Object.extend(Number.prototype, (function() {
        function toColorPart() {
            return this.toPaddedString(2, 16);
        }

        function succ() {
            return this + 1;
        }

        function times(iterator, context) {
            $R(0, this, true).each(iterator, context);
            return this;
        }

        function toPaddedString(length, radix) {
            var string = this.toString(radix || 10);
            return '0'.times(length - string.length) + string;
        }

        function abs() {
            return Math.abs(this);
        }

        function round() {
            return Math.round(this);
        }

        function ceil() {
            return Math.ceil(this);
        }

        function floor() {
            return Math.floor(this);
        }

        return {
            toColorPart:    toColorPart,
            succ:           succ,
            times:          times,
            toPaddedString: toPaddedString,
            abs:            abs,
            round:          round,
            ceil:           ceil,
            floor:          floor
        };
    })());

    function $R(start, end, exclusive) {
        return new ObjectRange(start, end, exclusive);
    }

    var ObjectRange = Class.create(Enumerable, (function() {
        function initialize(start, end, exclusive) {
            this.start = start;
            this.end = end;
            this.exclusive = exclusive;
        }

        function _each(iterator) {
            var value = this.start;
            while (this.include(value)) {
                iterator(value);
                value = value.succ();
            }
        }

        function include(value) {
            if (value < this.start)
                return false;
            if (this.exclusive)
                return value < this.end;
            return value <= this.end;
        }

        return {
            initialize: initialize,
            _each:      _each,
            include:    include
        };
    })());



    var Ajax = {
        getTransport: function() {
            return Try.these(
                            function() {return new XMLHttpRequest()},
                            function() {return new ActiveXObject('Msxml2.XMLHTTP')},
                            function() {return new ActiveXObject('Microsoft.XMLHTTP')}
                    ) || false;
        },

        activeRequestCount: 0
    };

    Ajax.Responders = {
        responders: [],

        _each: function(iterator) {
            this.responders._each(iterator);
        },

        register: function(responder) {
            if (!this.include(responder))
                this.responders.push(responder);
        },

        unregister: function(responder) {
            this.responders = this.responders.without(responder);
        },

        dispatch: function(callback, request, transport, json) {
            this.each(function(responder) {
                if (Object.isFunction(responder[callback])) {
                    try {
                        responder[callback].apply(responder, [request, transport, json]);
                    } catch (e) { }
                }
            });
        }
    };

    Object.extend(Ajax.Responders, Enumerable);

    Ajax.Responders.register({
        onCreate:   function() { Ajax.activeRequestCount++ },
        onComplete: function() { Ajax.activeRequestCount-- }
    });
    Ajax.Base = Class.create({
        initialize: function(options) {
            this.options = {
                method:       'post',
                asynchronous: true,
                contentType:  'application/x-www-form-urlencoded',
                encoding:     'UTF-8',
                parameters:   '',
                evalJSON:     true,
                evalJS:       true
            };
            Object.extend(this.options, options || { });

            this.options.method = this.options.method.toLowerCase();

            if (Object.isHash(this.options.parameters))
                this.options.parameters = this.options.parameters.toObject();
        }
    });
    Ajax.Request = Class.create(Ajax.Base, {
        _complete: false,

        initialize: function($super, url, options) {
            $super(options);
            this.transport = Ajax.getTransport();
            this.request(url);
        },

        request: function(url) {
            this.url = url;
            this.method = this.options.method;
            var params = Object.isString(this.options.parameters) ?
                    this.options.parameters :
                    Object.toQueryString(this.options.parameters);

            if (!['get', 'post'].include(this.method)) {
                params += (params ? '&' : '') + "_method=" + this.method;
                this.method = 'post';
            }

            if (params && this.method === 'get') {
                this.url += (this.url.include('?') ? '&' : '?') + params;
            }

            this.parameters = params.toQueryParams();

            try {
                var response = new Ajax.Response(this);
                if (this.options.onCreate) this.options.onCreate(response);
                Ajax.Responders.dispatch('onCreate', this, response);

                this.transport.open(this.method.toUpperCase(), this.url,
                        this.options.asynchronous);

                if (this.options.asynchronous) this.respondToReadyState.bind(this).defer(1);

                this.transport.onreadystatechange = this.onStateChange.bind(this);
                this.setRequestHeaders();

                this.body = this.method == 'post' ? (this.options.postBody || params) : null;
                this.transport.send(this.body);

                /* Force Firefox to handle ready state 4 for synchronous requests */
                if (!this.options.asynchronous && this.transport.overrideMimeType)
                    this.onStateChange();

            }
            catch (e) {
                this.dispatchException(e);
            }
        },

        onStateChange: function() {
            var readyState = this.transport.readyState;
            if (readyState > 1 && !((readyState == 4) && this._complete))
                this.respondToReadyState(this.transport.readyState);
        },

        setRequestHeaders: function() {
            var headers = {
                'X-Requested-With': 'XMLHttpRequest',
                'X-Prototype-Version': Prototype.Version,
                'Accept': 'text/javascript, text/html, application/xml, text/xml, */*'
            };

            if (this.method == 'post') {
                headers['Content-type'] = this.options.contentType +
                        (this.options.encoding ? '; charset=' + this.options.encoding : '');

                /* Force "Connection: close" for older Mozilla browsers to work
                 * around a bug where XMLHttpRequest sends an incorrect
                 * Content-length header. See Mozilla Bugzilla #246651.
                 */
                if (this.transport.overrideMimeType &&
                        (navigator.userAgent.match(/Gecko\/(\d{4})/) || [0,2005])[1] < 2005)
                    headers['Connection'] = 'close';
            }

            if (typeof this.options.requestHeaders == 'object') {
                var extras = this.options.requestHeaders;

                if (Object.isFunction(extras.push))
                    for (var i = 0, length = extras.length; i < length; i += 2)
                        headers[extras[i]] = extras[i+1];
                else
                    $H(extras).each(function(pair) { headers[pair.key] = pair.value });
            }

            for (var name in headers)
                this.transport.setRequestHeader(name, headers[name]);
        },

        success: function() {
            var status = this.getStatus();
            return !status || (status >= 200 && status < 300) || status == 304;
        },

        getStatus: function() {
            try {
                if (this.transport.status === 1223) return 204;
                return this.transport.status || 0;
            } catch (e) { return 0 }
        },

        respondToReadyState: function(readyState) {
            var state = Ajax.Request.Events[readyState], response = new Ajax.Response(this);

            if (state == 'Complete') {
                try {
                    this._complete = true;
                    (this.options['on' + response.status]
                    || this.options['on' + (this.success() ? 'Success' : 'Failure')]
                    || Prototype.emptyFunction)(response, response.headerJSON);
                } catch (e) {
                    this.dispatchException(e);
                }

                var contentType = response.getHeader('Content-type');
                if (this.options.evalJS == 'force'
                        || (this.options.evalJS && this.isSameOrigin() && contentType
                        && contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i)))
                    this.evalResponse();
            }

            try {
                (this.options['on' + state] || Prototype.emptyFunction)(response, response.headerJSON);
                Ajax.Responders.dispatch('on' + state, this, response, response.headerJSON);
            } catch (e) {
                this.dispatchException(e);
            }

            if (state == 'Complete') {
                this.transport.onreadystatechange = Prototype.emptyFunction;
            }
        },

        isSameOrigin: function() {
            var m = this.url.match(/^\s*https?:\/\/[^\/]*/);
            return !m || (m[0] == '#{protocol}//#{domain}#{port}'.interpolate({
                        protocol: location.protocol,
                        domain: document.domain,
                        port: location.port ? ':' + location.port : ''
                    }));
        },

        getHeader: function(name) {
            try {
                return this.transport.getResponseHeader(name) || null;
            } catch (e) { return null; }
        },

        evalResponse: function() {
            try {
                return eval((this.transport.responseText || '').unfilterJSON());
            } catch (e) {
                this.dispatchException(e);
            }
        },

        dispatchException: function(exception) {
            (this.options.onException || Prototype.emptyFunction)(this, exception);
            Ajax.Responders.dispatch('onException', this, exception);
        }
    });

    Ajax.Request.Events =
            ['Uninitialized', 'Loading', 'Loaded', 'Interactive', 'Complete'];








    Ajax.Response = Class.create({
        initialize: function(request){
            this.request = request;
            var transport  = this.transport  = request.transport,
                    readyState = this.readyState = transport.readyState;

            if ((readyState > 2 && !Prototype.Browser.IE) || readyState == 4) {
                this.status       = this.getStatus();
                this.statusText   = this.getStatusText();
                this.responseText = String.interpret(transport.responseText);
                this.headerJSON   = this._getHeaderJSON();
            }

            if (readyState == 4) {
                var xml = transport.responseXML;
                this.responseXML  = Object.isUndefined(xml) ? null : xml;
                this.responseJSON = this._getResponseJSON();
            }
        },

        status:      0,

        statusText: '',

        getStatus: Ajax.Request.prototype.getStatus,

        getStatusText: function() {
            try {
                return this.transport.statusText || '';
            } catch (e) { return '' }
        },

        getHeader: Ajax.Request.prototype.getHeader,

        getAllHeaders: function() {
            try {
                return this.getAllResponseHeaders();
            } catch (e) { return null }
        },

        getResponseHeader: function(name) {
            return this.transport.getResponseHeader(name);
        },

        getAllResponseHeaders: function() {
            return this.transport.getAllResponseHeaders();
        },

        _getHeaderJSON: function() {
            var json = this.getHeader('X-JSON');
            if (!json) return null;
            json = decodeURIComponent(escape(json));
            try {
                return json.evalJSON(this.request.options.sanitizeJSON ||
                        !this.request.isSameOrigin());
            } catch (e) {
                this.request.dispatchException(e);
            }
        },

        _getResponseJSON: function() {
            var options = this.request.options;
            if (!options.evalJSON || (options.evalJSON != 'force' &&
                    !(this.getHeader('Content-type') || '').include('application/json')) ||
                    this.responseText.blank())
                return null;
            try {
                return this.responseText.evalJSON(options.sanitizeJSON ||
                        !this.request.isSameOrigin());
            } catch (e) {
                this.request.dispatchException(e);
            }
        }
    });

    Ajax.Updater = Class.create(Ajax.Request, {
        initialize: function($super, container, url, options) {
            this.container = {
                success: (container.success || container),
                failure: (container.failure || (container.success ? null : container))
            };

            options = Object.clone(options);
            var onComplete = options.onComplete;
            options.onComplete = (function(response, json) {
                this.updateContent(response.responseText);
                if (Object.isFunction(onComplete)) onComplete(response, json);
            }).bind(this);

            $super(url, options);
        },

        updateContent: function(responseText) {
            var receiver = this.container[this.success() ? 'success' : 'failure'],
                    options = this.options;

            if (!options.evalScripts) responseText = responseText.stripScripts();

            if (receiver = $(receiver)) {
                if (options.insertion) {
                    if (Object.isString(options.insertion)) {
                        var insertion = { }; insertion[options.insertion] = responseText;
                        receiver.insert(insertion);
                    }
                    else options.insertion(receiver, responseText);
                }
                else receiver.update(responseText);
            }
        }
    });

    Ajax.PeriodicalUpdater = Class.create(Ajax.Base, {
        initialize: function($super, container, url, options) {
            $super(options);
            this.onComplete = this.options.onComplete;

            this.frequency = (this.options.frequency || 2);
            this.decay = (this.options.decay || 1);

            this.updater = { };
            this.container = container;
            this.url = url;

            this.start();
        },

        start: function() {
            this.options.onComplete = this.updateComplete.bind(this);
            this.onTimerEvent();
        },

        stop: function() {
            this.updater.options.onComplete = undefined;
            clearTimeout(this.timer);
            (this.onComplete || Prototype.emptyFunction).apply(this, arguments);
        },

        updateComplete: function(response) {
            if (this.options.decay) {
                this.decay = (response.responseText == this.lastText ?
                this.decay * this.options.decay : 1);

                this.lastText = response.responseText;
            }
            this.timer = this.onTimerEvent.bind(this).delay(this.decay * this.frequency);
        },

        onTimerEvent: function() {
            this.updater = new Ajax.Updater(this.container, this.url, this.options);
        }
    });


    function $(element) {
        if (arguments.length > 1) {
            for (var i = 0, elements = [], length = arguments.length; i < length; i++)
                elements.push($(arguments[i]));
            return elements;
        }
        if (Object.isString(element))
            element = document.getElementById(element);
        return Element.extend(element);
    }

    if (Prototype.BrowserFeatures.XPath) {
        document._getElementsByXPath = function(expression, parentElement) {
            var results = [];
            var query = document.evaluate(expression, $(parentElement) || document,
                    null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
            for (var i = 0, length = query.snapshotLength; i < length; i++)
                results.push(Element.extend(query.snapshotItem(i)));
            return results;
        };
    }

    /*--------------------------------------------------------------------------*/

    if (!Node) var Node = { };

    if (!Node.ELEMENT_NODE) {
        Object.extend(Node, {
            ELEMENT_NODE: 1,
            ATTRIBUTE_NODE: 2,
            TEXT_NODE: 3,
            CDATA_SECTION_NODE: 4,
            ENTITY_REFERENCE_NODE: 5,
            ENTITY_NODE: 6,
            PROCESSING_INSTRUCTION_NODE: 7,
            COMMENT_NODE: 8,
            DOCUMENT_NODE: 9,
            DOCUMENT_TYPE_NODE: 10,
            DOCUMENT_FRAGMENT_NODE: 11,
            NOTATION_NODE: 12
        });
    }



    (function(global) {
        function shouldUseCache(tagName, attributes) {
            if (tagName === 'select') return false;
            if ('type' in attributes) return false;
            return true;
        }

        var HAS_EXTENDED_CREATE_ELEMENT_SYNTAX = (function(){
            try {
                var el = document.createElement('<input name="x">');
                return el.tagName.toLowerCase() === 'input' && el.name === 'x';
            }
            catch(err) {
                return false;
            }
        })();

        var element = global.Element;

        global.Element = function(tagName, attributes) {
            attributes = attributes || { };
            tagName = tagName.toLowerCase();
            var cache = Element.cache;

            if (HAS_EXTENDED_CREATE_ELEMENT_SYNTAX && attributes.name) {
                tagName = '<' + tagName + ' name="' + attributes.name + '">';
                delete attributes.name;
                return Element.writeAttribute(document.createElement(tagName), attributes);
            }

            if (!cache[tagName]) cache[tagName] = Element.extend(document.createElement(tagName));

            var node = shouldUseCache(tagName, attributes) ?
                    cache[tagName].cloneNode(false) : document.createElement(tagName);

            return Element.writeAttribute(node, attributes);
        };

        Object.extend(global.Element, element || { });
        if (element) global.Element.prototype = element.prototype;

    })(this);

    Element.idCounter = 1;
    Element.cache = { };

    Element._purgeElement = function(element) {
        var uid = element._prototypeUID;
        if (uid) {
            Element.stopObserving(element);
            element._prototypeUID = void 0;
            delete Element.Storage[uid];
        }
    }

    Element.Methods = {
        visible: function(element) {
            return $(element).style.display != 'none';
        },

        toggle: function(element) {
            element = $(element);
            Element[Element.visible(element) ? 'hide' : 'show'](element);
            return element;
        },

        hide: function(element) {
            element = $(element);
            element.style.display = 'none';
            return element;
        },

        show: function(element) {
            element = $(element);
            element.style.display = '';
            return element;
        },

        remove: function(element) {
            element = $(element);
            element.parentNode.removeChild(element);
            return element;
        },

        update: (function(){

            var SELECT_ELEMENT_INNERHTML_BUGGY = (function(){
                var el = document.createElement("select"),
                        isBuggy = true;
                el.innerHTML = "<option value=\"test\">test</option>";
                if (el.options && el.options[0]) {
                    isBuggy = el.options[0].nodeName.toUpperCase() !== "OPTION";
                }
                el = null;
                return isBuggy;
            })();

            var TABLE_ELEMENT_INNERHTML_BUGGY = (function(){
                try {
                    var el = document.createElement("table");
                    if (el && el.tBodies) {
                        el.innerHTML = "<tbody><tr><td>test</td></tr></tbody>";
                        var isBuggy = typeof el.tBodies[0] == "undefined";
                        el = null;
                        return isBuggy;
                    }
                } catch (e) {
                    return true;
                }
            })();

            var LINK_ELEMENT_INNERHTML_BUGGY = (function() {
                try {
                    var el = document.createElement('div');
                    el.innerHTML = "<link>";
                    var isBuggy = (el.childNodes.length === 0);
                    el = null;
                    return isBuggy;
                } catch(e) {
                    return true;
                }
            })();

            var ANY_INNERHTML_BUGGY = SELECT_ELEMENT_INNERHTML_BUGGY ||
                    TABLE_ELEMENT_INNERHTML_BUGGY || LINK_ELEMENT_INNERHTML_BUGGY;

            var SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING = (function () {
                var s = document.createElement("script"),
                        isBuggy = false;
                try {
                    s.appendChild(document.createTextNode(""));
                    isBuggy = !s.firstChild ||
                            s.firstChild && s.firstChild.nodeType !== 3;
                } catch (e) {
                    isBuggy = true;
                }
                s = null;
                return isBuggy;
            })();


            function update(element, content) {
                element = $(element);
                var purgeElement = Element._purgeElement;

                var descendants = element.getElementsByTagName('*'),
                        i = descendants.length;
                while (i--) purgeElement(descendants[i]);

                if (content && content.toElement)
                    content = content.toElement();

                if (Object.isElement(content))
                    return element.update().insert(content);

                content = Object.toHTML(content);

                var tagName = element.tagName.toUpperCase();

                if (tagName === 'SCRIPT' && SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING) {
                    element.text = content;
                    return element;
                }

                if (ANY_INNERHTML_BUGGY) {
                    if (tagName in Element._insertionTranslations.tags) {
                        while (element.firstChild) {
                            element.removeChild(element.firstChild);
                        }
                        Element._getContentFromAnonymousElement(tagName, content.stripScripts())
                                .each(function(node) {
                                    element.appendChild(node)
                                });
                    } else if (LINK_ELEMENT_INNERHTML_BUGGY && Object.isString(content) && content.indexOf('<link') > -1) {
                        while (element.firstChild) {
                            element.removeChild(element.firstChild);
                        }
                        var nodes = Element._getContentFromAnonymousElement(tagName, content.stripScripts(), true);
                        nodes.each(function(node) { element.appendChild(node) });
                    }
                    else {
                        element.innerHTML = content.stripScripts();
                    }
                }
                else {
                    element.innerHTML = content.stripScripts();
                }

                content.evalScripts.bind(content).defer();
                return element;
            }

            return update;
        })(),

        replace: function(element, content) {
            element = $(element);
            if (content && content.toElement) content = content.toElement();
            else if (!Object.isElement(content)) {
                content = Object.toHTML(content);
                var range = element.ownerDocument.createRange();
                range.selectNode(element);
                content.evalScripts.bind(content).defer();
                content = range.createContextualFragment(content.stripScripts());
            }
            element.parentNode.replaceChild(content, element);
            return element;
        },

        insert: function(element, insertions) {
            element = $(element);

            if (Object.isString(insertions) || Object.isNumber(insertions) ||
                    Object.isElement(insertions) || (insertions && (insertions.toElement || insertions.toHTML)))
                insertions = {bottom:insertions};

            var content, insert, tagName, childNodes;

            for (var position in insertions) {
                content  = insertions[position];
                position = position.toLowerCase();
                insert = Element._insertionTranslations[position];

                if (content && content.toElement) content = content.toElement();
                if (Object.isElement(content)) {
                    insert(element, content);
                    continue;
                }

                content = Object.toHTML(content);

                tagName = ((position == 'before' || position == 'after')
                        ? element.parentNode : element).tagName.toUpperCase();

                childNodes = Element._getContentFromAnonymousElement(tagName, content.stripScripts());

                if (position == 'top' || position == 'after') childNodes.reverse();
                childNodes.each(insert.curry(element));

                content.evalScripts.bind(content).defer();
            }

            return element;
        },

        wrap: function(element, wrapper, attributes) {
            element = $(element);
            if (Object.isElement(wrapper))
                $(wrapper).writeAttribute(attributes || { });
            else if (Object.isString(wrapper)) wrapper = new Element(wrapper, attributes);
            else wrapper = new Element('div', wrapper);
            if (element.parentNode)
                element.parentNode.replaceChild(wrapper, element);
            wrapper.appendChild(element);
            return wrapper;
        },

        inspect: function(element) {
            element = $(element);
            var result = '<' + element.tagName.toLowerCase();
            $H({'id': 'id', 'className': 'class'}).each(function(pair) {
                var property = pair.first(),
                        attribute = pair.last(),
                        value = (element[property] || '').toString();
                if (value) result += ' ' + attribute + '=' + value.inspect(true);
            });
            return result + '>';
        },

        recursivelyCollect: function(element, property, maximumLength) {
            element = $(element);
            maximumLength = maximumLength || -1;
            var elements = [];

            while (element = element[property]) {
                if (element.nodeType == 1)
                    elements.push(Element.extend(element));
                if (elements.length == maximumLength)
                    break;
            }

            return elements;
        },

        ancestors: function(element) {
            return Element.recursivelyCollect(element, 'parentNode');
        },

        descendants: function(element) {
            return Element.select(element, "*");
        },

        firstDescendant: function(element) {
            element = $(element).firstChild;
            while (element && element.nodeType != 1) element = element.nextSibling;
            return $(element);
        },

        immediateDescendants: function(element) {
            var results = [], child = $(element).firstChild;
            while (child) {
                if (child.nodeType === 1) {
                    results.push(Element.extend(child));
                }
                child = child.nextSibling;
            }
            return results;
        },

        previousSiblings: function(element, maximumLength) {
            return Element.recursivelyCollect(element, 'previousSibling');
        },

        nextSiblings: function(element) {
            return Element.recursivelyCollect(element, 'nextSibling');
        },

        siblings: function(element) {
            element = $(element);
            return Element.previousSiblings(element).reverse()
                    .concat(Element.nextSiblings(element));
        },

        match: function(element, selector) {
            element = $(element);
            if (Object.isString(selector))
                return Prototype.Selector.match(element, selector);
            return selector.match(element);
        },

        up: function(element, expression, index) {
            element = $(element);
            if (arguments.length == 1) return $(element.parentNode);
            var ancestors = Element.ancestors(element);
            return Object.isNumber(expression) ? ancestors[expression] :
                    Prototype.Selector.find(ancestors, expression, index);
        },

        down: function(element, expression, index) {
            element = $(element);
            if (arguments.length == 1) return Element.firstDescendant(element);
            return Object.isNumber(expression) ? Element.descendants(element)[expression] :
                    Element.select(element, expression)[index || 0];
        },

        previous: function(element, expression, index) {
            element = $(element);
            if (Object.isNumber(expression)) index = expression, expression = false;
            if (!Object.isNumber(index)) index = 0;

            if (expression) {
                return Prototype.Selector.find(element.previousSiblings(), expression, index);
            } else {
                return element.recursivelyCollect("previousSibling", index + 1)[index];
            }
        },

        next: function(element, expression, index) {
            element = $(element);
            if (Object.isNumber(expression)) index = expression, expression = false;
            if (!Object.isNumber(index)) index = 0;

            if (expression) {
                return Prototype.Selector.find(element.nextSiblings(), expression, index);
            } else {
                var maximumLength = Object.isNumber(index) ? index + 1 : 1;
                return element.recursivelyCollect("nextSibling", index + 1)[index];
            }
        },


        select: function(element) {
            element = $(element);
            var expressions = Array.prototype.slice.call(arguments, 1).join(', ');
            return Prototype.Selector.select(expressions, element);
        },

        adjacent: function(element) {
            element = $(element);
            var expressions = Array.prototype.slice.call(arguments, 1).join(', ');
            return Prototype.Selector.select(expressions, element.parentNode).without(element);
        },

        identify: function(element) {
            element = $(element);
            var id = Element.readAttribute(element, 'id');
            if (id) return id;
            do { id = 'anonymous_element_' + Element.idCounter++ } while ($(id));
            Element.writeAttribute(element, 'id', id);
            return id;
        },

        readAttribute: function(element, name) {
            element = $(element);
            if (Prototype.Browser.IE) {
                var t = Element._attributeTranslations.read;
                if (t.values[name]) return t.values[name](element, name);
                if (t.names[name]) name = t.names[name];
                if (name.include(':')) {
                    return (!element.attributes || !element.attributes[name]) ? null :
                            element.attributes[name].value;
                }
            }
            return element.getAttribute(name);
        },

        writeAttribute: function(element, name, value) {
            element = $(element);
            var attributes = { }, t = Element._attributeTranslations.write;

            if (typeof name == 'object') attributes = name;
            else attributes[name] = Object.isUndefined(value) ? true : value;

            for (var attr in attributes) {
                name = t.names[attr] || attr;
                value = attributes[attr];
                if (t.values[attr]) name = t.values[attr](element, value);
                if (value === false || value === null)
                    element.removeAttribute(name);
                else if (value === true)
                    element.setAttribute(name, name);
                else element.setAttribute(name, value);
            }
            return element;
        },

        getHeight: function(element) {
            return Element.getDimensions(element).height;
        },

        getWidth: function(element) {
            return Element.getDimensions(element).width;
        },

        classNames: function(element) {
            return new Element.ClassNames(element);
        },

        hasClassName: function(element, className) {
            if (!(element = $(element))) return;
            var elementClassName = element.className;
            return (elementClassName.length > 0 && (elementClassName == className ||
            new RegExp("(^|\\s)" + className + "(\\s|$)").test(elementClassName)));
        },

        addClassName: function(element, className) {
            if (!(element = $(element))) return;
            if (!Element.hasClassName(element, className))
                element.className += (element.className ? ' ' : '') + className;
            return element;
        },

        removeClassName: function(element, className) {
            if (!(element = $(element))) return;
            element.className = element.className.replace(
                    new RegExp("(^|\\s+)" + className + "(\\s+|$)"), ' ').strip();
            return element;
        },

        toggleClassName: function(element, className) {
            if (!(element = $(element))) return;
            return Element[Element.hasClassName(element, className) ?
                    'removeClassName' : 'addClassName'](element, className);
        },

        cleanWhitespace: function(element) {
            element = $(element);
            var node = element.firstChild;
            while (node) {
                var nextNode = node.nextSibling;
                if (node.nodeType == 3 && !/\S/.test(node.nodeValue))
                    element.removeChild(node);
                node = nextNode;
            }
            return element;
        },

        empty: function(element) {
            return $(element).innerHTML.blank();
        },

        descendantOf: function(element, ancestor) {
            element = $(element), ancestor = $(ancestor);

            if (element.compareDocumentPosition)
                return (element.compareDocumentPosition(ancestor) & 8) === 8;

            if (ancestor.contains)
                return ancestor.contains(element) && ancestor !== element;

            while (element = element.parentNode)
                if (element == ancestor) return true;

            return false;
        },

        scrollTo: function(element) {
            element = $(element);
            var pos = Element.cumulativeOffset(element);
            window.scrollTo(pos[0], pos[1]);
            return element;
        },

        getStyle: function(element, style) {
            element = $(element);
            style = style == 'float' ? 'cssFloat' : style.camelize();
            var value = element.style[style];
            if (!value || value == 'auto') {
                var css = document.defaultView.getComputedStyle(element, null);
                value = css ? css[style] : null;
            }
            if (style == 'opacity') return value ? parseFloat(value) : 1.0;
            return value == 'auto' ? null : value;
        },

        getOpacity: function(element) {
            return $(element).getStyle('opacity');
        },

        setStyle: function(element, styles) {
            element = $(element);
            var elementStyle = element.style, match;
            if (Object.isString(styles)) {
                element.style.cssText += ';' + styles;
                return styles.include('opacity') ?
                        element.setOpacity(styles.match(/opacity:\s*(\d?\.?\d*)/)[1]) : element;
            }
            for (var property in styles)
                if (property == 'opacity') element.setOpacity(styles[property]);
                else
                    elementStyle[(property == 'float' || property == 'cssFloat') ?
                            (Object.isUndefined(elementStyle.styleFloat) ? 'cssFloat' : 'styleFloat') :
                            property] = styles[property];

            return element;
        },

        setOpacity: function(element, value) {
            element = $(element);
            element.style.opacity = (value == 1 || value === '') ? '' :
                    (value < 0.00001) ? 0 : value;
            return element;
        },

        makePositioned: function(element) {
            element = $(element);
            var pos = Element.getStyle(element, 'position');
            if (pos == 'static' || !pos) {
                element._madePositioned = true;
                element.style.position = 'relative';
                if (Prototype.Browser.Opera) {
                    element.style.top = 0;
                    element.style.left = 0;
                }
            }
            return element;
        },

        undoPositioned: function(element) {
            element = $(element);
            if (element._madePositioned) {
                element._madePositioned = undefined;
                element.style.position =
                        element.style.top =
                                element.style.left =
                                        element.style.bottom =
                                                element.style.right = '';
            }
            return element;
        },

        makeClipping: function(element) {
            element = $(element);
            if (element._overflow) return element;
            element._overflow = Element.getStyle(element, 'overflow') || 'auto';
            if (element._overflow !== 'hidden')
                element.style.overflow = 'hidden';
            return element;
        },

        undoClipping: function(element) {
            element = $(element);
            if (!element._overflow) return element;
            element.style.overflow = element._overflow == 'auto' ? '' : element._overflow;
            element._overflow = null;
            return element;
        },

        clonePosition: function(element, source) {
            var options = Object.extend({
                setLeft:    true,
                setTop:     true,
                setWidth:   true,
                setHeight:  true,
                offsetTop:  0,
                offsetLeft: 0
            }, arguments[2] || { });

            source = $(source);
            var p = Element.viewportOffset(source), delta = [0, 0], parent = null;

            element = $(element);

            if (Element.getStyle(element, 'position') == 'absolute') {
                parent = Element.getOffsetParent(element);
                delta = Element.viewportOffset(parent);
            }

            if (parent == document.body) {
                delta[0] -= document.body.offsetLeft;
                delta[1] -= document.body.offsetTop;
            }

            if (options.setLeft)   element.style.left  = (p[0] - delta[0] + options.offsetLeft) + 'px';
            if (options.setTop)    element.style.top   = (p[1] - delta[1] + options.offsetTop) + 'px';
            if (options.setWidth)  element.style.width = source.offsetWidth + 'px';
            if (options.setHeight) element.style.height = source.offsetHeight + 'px';
            return element;
        }
    };

    Object.extend(Element.Methods, {
        getElementsBySelector: Element.Methods.select,

        childElements: Element.Methods.immediateDescendants
    });

    Element._attributeTranslations = {
        write: {
            names: {
                className: 'class',
                htmlFor:   'for'
            },
            values: { }
        }
    };

    if (Prototype.Browser.Opera) {
        Element.Methods.getStyle = Element.Methods.getStyle.wrap(
                function(proceed, element, style) {
                    switch (style) {
                        case 'height': case 'width':
                        if (!Element.visible(element)) return null;

                        var dim = parseInt(proceed(element, style), 10);

                        if (dim !== element['offset' + style.capitalize()])
                            return dim + 'px';

                        var properties;
                        if (style === 'height') {
                            properties = ['border-top-width', 'padding-top',
                                'padding-bottom', 'border-bottom-width'];
                        }
                        else {
                            properties = ['border-left-width', 'padding-left',
                                'padding-right', 'border-right-width'];
                        }
                        return properties.inject(dim, function(memo, property) {
                                    var val = proceed(element, property);
                                    return val === null ? memo : memo - parseInt(val, 10);
                                }) + 'px';
                        default: return proceed(element, style);
                    }
                }
        );

        Element.Methods.readAttribute = Element.Methods.readAttribute.wrap(
                function(proceed, element, attribute) {
                    if (attribute === 'title') return element.title;
                    return proceed(element, attribute);
                }
        );
    }

    else if (Prototype.Browser.IE) {
        Element.Methods.getStyle = function(element, style) {
            element = $(element);
            style = (style == 'float' || style == 'cssFloat') ? 'styleFloat' : style.camelize();
            var value = element.style[style];
            if (!value && element.currentStyle) value = element.currentStyle[style];

            if (style == 'opacity') {
                if (value = (element.getStyle('filter') || '').match(/alpha\(opacity=(.*)\)/))
                    if (value[1]) return parseFloat(value[1]) / 100;
                return 1.0;
            }

            if (value == 'auto') {
                if ((style == 'width' || style == 'height') && (element.getStyle('display') != 'none'))
                    return element['offset' + style.capitalize()] + 'px';
                return null;
            }
            return value;
        };

        Element.Methods.setOpacity = function(element, value) {
            function stripAlpha(filter){
                return filter.replace(/alpha\([^\)]*\)/gi,'');
            }
            element = $(element);
            var currentStyle = element.currentStyle;
            if ((currentStyle && !currentStyle.hasLayout) ||
                    (!currentStyle && element.style.zoom == 'normal'))
                element.style.zoom = 1;

            var filter = element.getStyle('filter'), style = element.style;
            if (value == 1 || value === '') {
                (filter = stripAlpha(filter)) ?
                        style.filter = filter : style.removeAttribute('filter');
                return element;
            } else if (value < 0.00001) value = 0;
            style.filter = stripAlpha(filter) +
                    'alpha(opacity=' + (value * 100) + ')';
            return element;
        };

        Element._attributeTranslations = (function(){

            var classProp = 'className',
                    forProp = 'for',
                    el = document.createElement('div');

            el.setAttribute(classProp, 'x');

            if (el.className !== 'x') {
                el.setAttribute('class', 'x');
                if (el.className === 'x') {
                    classProp = 'class';
                }
            }
            el = null;

            el = document.createElement('label');
            el.setAttribute(forProp, 'x');
            if (el.htmlFor !== 'x') {
                el.setAttribute('htmlFor', 'x');
                if (el.htmlFor === 'x') {
                    forProp = 'htmlFor';
                }
            }
            el = null;

            return {
                read: {
                    names: {
                        'class':      classProp,
                        'className':  classProp,
                        'for':        forProp,
                        'htmlFor':    forProp
                    },
                    values: {
                        _getAttr: function(element, attribute) {
                            return element.getAttribute(attribute);
                        },
                        _getAttr2: function(element, attribute) {
                            return element.getAttribute(attribute, 2);
                        },
                        _getAttrNode: function(element, attribute) {
                            var node = element.getAttributeNode(attribute);
                            return node ? node.value : "";
                        },
                        _getEv: (function(){

                            var el = document.createElement('div'), f;
                            el.onclick = Prototype.emptyFunction;
                            var value = el.getAttribute('onclick');

                            if (String(value).indexOf('{') > -1) {
                                f = function(element, attribute) {
                                    attribute = element.getAttribute(attribute);
                                    if (!attribute) return null;
                                    attribute = attribute.toString();
                                    attribute = attribute.split('{')[1];
                                    attribute = attribute.split('}')[0];
                                    return attribute.strip();
                                };
                            }
                            else if (value === '') {
                                f = function(element, attribute) {
                                    attribute = element.getAttribute(attribute);
                                    if (!attribute) return null;
                                    return attribute.strip();
                                };
                            }
                            el = null;
                            return f;
                        })(),
                        _flag: function(element, attribute) {
                            return $(element).hasAttribute(attribute) ? attribute : null;
                        },
                        style: function(element) {
                            return element.style.cssText.toLowerCase();
                        },
                        title: function(element) {
                            return element.title;
                        }
                    }
                }
            }
        })();

        Element._attributeTranslations.write = {
            names: Object.extend({
                cellpadding: 'cellPadding',
                cellspacing: 'cellSpacing'
            }, Element._attributeTranslations.read.names),
            values: {
                checked: function(element, value) {
                    element.checked = !!value;
                },

                style: function(element, value) {
                    element.style.cssText = value ? value : '';
                }
            }
        };

        Element._attributeTranslations.has = {};

        $w('colSpan rowSpan vAlign dateTime accessKey tabIndex ' +
                'encType maxLength readOnly longDesc frameBorder').each(function(attr) {
            Element._attributeTranslations.write.names[attr.toLowerCase()] = attr;
            Element._attributeTranslations.has[attr.toLowerCase()] = attr;
        });

        (function(v) {
            Object.extend(v, {
                href:        v._getAttr2,
                src:         v._getAttr2,
                type:        v._getAttr,
                action:      v._getAttrNode,
                disabled:    v._flag,
                checked:     v._flag,
                readonly:    v._flag,
                multiple:    v._flag,
                onload:      v._getEv,
                onunload:    v._getEv,
                onclick:     v._getEv,
                ondblclick:  v._getEv,
                onmousedown: v._getEv,
                onmouseup:   v._getEv,
                onmouseover: v._getEv,
                onmousemove: v._getEv,
                onmouseout:  v._getEv,
                onfocus:     v._getEv,
                onblur:      v._getEv,
                onkeypress:  v._getEv,
                onkeydown:   v._getEv,
                onkeyup:     v._getEv,
                onsubmit:    v._getEv,
                onreset:     v._getEv,
                onselect:    v._getEv,
                onchange:    v._getEv
            });
        })(Element._attributeTranslations.read.values);

        if (Prototype.BrowserFeatures.ElementExtensions) {
            (function() {
                function _descendants(element) {
                    var nodes = element.getElementsByTagName('*'), results = [];
                    for (var i = 0, node; node = nodes[i]; i++)
                        if (node.tagName !== "!") // Filter out comment nodes.
                            results.push(node);
                    return results;
                }

                Element.Methods.down = function(element, expression, index) {
                    element = $(element);
                    if (arguments.length == 1) return element.firstDescendant();
                    return Object.isNumber(expression) ? _descendants(element)[expression] :
                            Element.select(element, expression)[index || 0];
                }
            })();
        }

    }

    else if (Prototype.Browser.Gecko && /rv:1\.8\.0/.test(navigator.userAgent)) {
        Element.Methods.setOpacity = function(element, value) {
            element = $(element);
            element.style.opacity = (value == 1) ? 0.999999 :
                    (value === '') ? '' : (value < 0.00001) ? 0 : value;
            return element;
        };
    }

    else if (Prototype.Browser.WebKit) {
        Element.Methods.setOpacity = function(element, value) {
            element = $(element);
            element.style.opacity = (value == 1 || value === '') ? '' :
                    (value < 0.00001) ? 0 : value;

            if (value == 1)
                if (element.tagName.toUpperCase() == 'IMG' && element.width) {
                    element.width++; element.width--;
                } else try {
                    var n = document.createTextNode(' ');
                    element.appendChild(n);
                    element.removeChild(n);
                } catch (e) { }

            return element;
        };
    }

    if ('outerHTML' in document.documentElement) {
        Element.Methods.replace = function(element, content) {
            element = $(element);

            if (content && content.toElement) content = content.toElement();
            if (Object.isElement(content)) {
                element.parentNode.replaceChild(content, element);
                return element;
            }

            content = Object.toHTML(content);
            var parent = element.parentNode, tagName = parent.tagName.toUpperCase();

            if (Element._insertionTranslations.tags[tagName]) {
                var nextSibling = element.next(),
                        fragments = Element._getContentFromAnonymousElement(tagName, content.stripScripts());
                parent.removeChild(element);
                if (nextSibling)
                    fragments.each(function(node) { parent.insertBefore(node, nextSibling) });
                else
                    fragments.each(function(node) { parent.appendChild(node) });
            }
            else element.outerHTML = content.stripScripts();

            content.evalScripts.bind(content).defer();
            return element;
        };
    }

    Element._returnOffset = function(l, t) {
        var result = [l, t];
        result.left = l;
        result.top = t;
        return result;
    };

    Element._getContentFromAnonymousElement = function(tagName, html, force) {
        var div = new Element('div'),
                t = Element._insertionTranslations.tags[tagName];

        var workaround = false;
        if (t) workaround = true;
        else if (force) {
            workaround = true;
            t = ['', '', 0];
        }

        if (workaround) {
            div.innerHTML = '&nbsp;' + t[0] + html + t[1];
            div.removeChild(div.firstChild);
            for (var i = t[2]; i--; ) {
                div = div.firstChild;
            }
        }
        else {
            div.innerHTML = html;
        }
        return $A(div.childNodes);
    };

    Element._insertionTranslations = {
        before: function(element, node) {
            element.parentNode.insertBefore(node, element);
        },
        top: function(element, node) {
            element.insertBefore(node, element.firstChild);
        },
        bottom: function(element, node) {
            element.appendChild(node);
        },
        after: function(element, node) {
            element.parentNode.insertBefore(node, element.nextSibling);
        },
        tags: {
            TABLE:  ['<table>',                '</table>',                   1],
            TBODY:  ['<table><tbody>',         '</tbody></table>',           2],
            TR:     ['<table><tbody><tr>',     '</tr></tbody></table>',      3],
            TD:     ['<table><tbody><tr><td>', '</td></tr></tbody></table>', 4],
            SELECT: ['<select>',               '</select>',                  1]
        }
    };

    (function() {
        var tags = Element._insertionTranslations.tags;
        Object.extend(tags, {
            THEAD: tags.TBODY,
            TFOOT: tags.TBODY,
            TH:    tags.TD
        });
    })();

    Element.Methods.Simulated = {
        hasAttribute: function(element, attribute) {
            attribute = Element._attributeTranslations.has[attribute] || attribute;
            var node = $(element).getAttributeNode(attribute);
            return !!(node && node.specified);
        }
    };

    Element.Methods.ByTag = { };

    Object.extend(Element, Element.Methods);

    (function(div) {

        if (!Prototype.BrowserFeatures.ElementExtensions && div['__proto__']) {
            window.HTMLElement = { };
            window.HTMLElement.prototype = div['__proto__'];
            Prototype.BrowserFeatures.ElementExtensions = true;
        }

        div = null;

    })(document.createElement('div'));

    Element.extend = (function() {

        function checkDeficiency(tagName) {
            if (typeof window.Element != 'undefined') {
                var proto = window.Element.prototype;
                if (proto) {
                    var id = '_' + (Math.random()+'').slice(2),
                            el = document.createElement(tagName);
                    proto[id] = 'x';
                    var isBuggy = (el[id] !== 'x');
                    delete proto[id];
                    el = null;
                    return isBuggy;
                }
            }
            return false;
        }

        function extendElementWith(element, methods) {
            for (var property in methods) {
                var value = methods[property];
                if (Object.isFunction(value) && !(property in element))
                    element[property] = value.methodize();
            }
        }

        var HTMLOBJECTELEMENT_PROTOTYPE_BUGGY = checkDeficiency('object');

        if (Prototype.BrowserFeatures.SpecificElementExtensions) {
            if (HTMLOBJECTELEMENT_PROTOTYPE_BUGGY) {
                return function(element) {
                    if (element && typeof element._extendedByPrototype == 'undefined') {
                        var t = element.tagName;
                        if (t && (/^(?:object|applet|embed)$/i.test(t))) {
                            extendElementWith(element, Element.Methods);
                            extendElementWith(element, Element.Methods.Simulated);
                            extendElementWith(element, Element.Methods.ByTag[t.toUpperCase()]);
                        }
                    }
                    return element;
                }
            }
            return Prototype.K;
        }

        var Methods = { }, ByTag = Element.Methods.ByTag;

        var extend = Object.extend(function(element) {
            if (!element || typeof element._extendedByPrototype != 'undefined' ||
                    element.nodeType != 1 || element == window) return element;

            var methods = Object.clone(Methods),
                    tagName = element.tagName.toUpperCase();

            if (ByTag[tagName]) Object.extend(methods, ByTag[tagName]);

            extendElementWith(element, methods);

            element._extendedByPrototype = Prototype.emptyFunction;
            return element;

        }, {
            refresh: function() {
                if (!Prototype.BrowserFeatures.ElementExtensions) {
                    Object.extend(Methods, Element.Methods);
                    Object.extend(Methods, Element.Methods.Simulated);
                }
            }
        });

        extend.refresh();
        return extend;
    })();

    if (document.documentElement.hasAttribute) {
        Element.hasAttribute = function(element, attribute) {
            return element.hasAttribute(attribute);
        };
    }
    else {
        Element.hasAttribute = Element.Methods.Simulated.hasAttribute;
    }

    Element.addMethods = function(methods) {
        var F = Prototype.BrowserFeatures, T = Element.Methods.ByTag;

        if (!methods) {
            Object.extend(Form, Form.Methods);
            Object.extend(Form.Element, Form.Element.Methods);
            Object.extend(Element.Methods.ByTag, {
                "FORM":     Object.clone(Form.Methods),
                "INPUT":    Object.clone(Form.Element.Methods),
                "SELECT":   Object.clone(Form.Element.Methods),
                "TEXTAREA": Object.clone(Form.Element.Methods),
                "BUTTON":   Object.clone(Form.Element.Methods)
            });
        }

        if (arguments.length == 2) {
            var tagName = methods;
            methods = arguments[1];
        }

        if (!tagName) Object.extend(Element.Methods, methods || { });
        else {
            if (Object.isArray(tagName)) tagName.each(extend);
            else extend(tagName);
        }

        function extend(tagName) {
            tagName = tagName.toUpperCase();
            if (!Element.Methods.ByTag[tagName])
                Element.Methods.ByTag[tagName] = { };
            Object.extend(Element.Methods.ByTag[tagName], methods);
        }

        function copy(methods, destination, onlyIfAbsent) {
            onlyIfAbsent = onlyIfAbsent || false;
            for (var property in methods) {
                var value = methods[property];
                if (!Object.isFunction(value)) continue;
                if (!onlyIfAbsent || !(property in destination))
                    destination[property] = value.methodize();
            }
        }

        function findDOMClass(tagName) {
            var klass;
            var trans = {
                "OPTGROUP": "OptGroup", "TEXTAREA": "TextArea", "P": "Paragraph",
                "FIELDSET": "FieldSet", "UL": "UList", "OL": "OList", "DL": "DList",
                "DIR": "Directory", "H1": "Heading", "H2": "Heading", "H3": "Heading",
                "H4": "Heading", "H5": "Heading", "H6": "Heading", "Q": "Quote",
                "INS": "Mod", "DEL": "Mod", "A": "Anchor", "IMG": "Image", "CAPTION":
                        "TableCaption", "COL": "TableCol", "COLGROUP": "TableCol", "THEAD":
                        "TableSection", "TFOOT": "TableSection", "TBODY": "TableSection", "TR":
                        "TableRow", "TH": "TableCell", "TD": "TableCell", "FRAMESET":
                        "FrameSet", "IFRAME": "IFrame"
            };
            if (trans[tagName]) klass = 'HTML' + trans[tagName] + 'Element';
            if (window[klass]) return window[klass];
            klass = 'HTML' + tagName + 'Element';
            if (window[klass]) return window[klass];
            klass = 'HTML' + tagName.capitalize() + 'Element';
            if (window[klass]) return window[klass];

            var element = document.createElement(tagName),
                    proto = element['__proto__'] || element.constructor.prototype;

            element = null;
            return proto;
        }

        var elementPrototype = window.HTMLElement ? HTMLElement.prototype :
                Element.prototype;

        if (F.ElementExtensions) {
            copy(Element.Methods, elementPrototype);
            copy(Element.Methods.Simulated, elementPrototype, true);
        }

        if (F.SpecificElementExtensions) {
            for (var tag in Element.Methods.ByTag) {
                var klass = findDOMClass(tag);
                if (Object.isUndefined(klass)) continue;
                copy(T[tag], klass.prototype);
            }
        }

        Object.extend(Element, Element.Methods);
        delete Element.ByTag;

        if (Element.extend.refresh) Element.extend.refresh();
        Element.cache = { };
    };


    document.viewport = {

        getDimensions: function() {
            return { width: this.getWidth(), height: this.getHeight() };
        },

        getScrollOffsets: function() {
            return Element._returnOffset(
                    window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft,
                    window.pageYOffset || document.documentElement.scrollTop  || document.body.scrollTop);
        }
    };

    (function(viewport) {
        var B = Prototype.Browser, doc = document, element, property = {};

        function getRootElement() {
            if (B.WebKit && !doc.evaluate)
                return document;

            if (B.Opera && window.parseFloat(window.opera.version()) < 9.5)
                return document.body;

            return document.documentElement;
        }

        function define(D) {
            if (!element) element = getRootElement();

            property[D] = 'client' + D;

            viewport['get' + D] = function() { return element[property[D]] };
            return viewport['get' + D]();
        }

        viewport.getWidth  = define.curry('Width');

        viewport.getHeight = define.curry('Height');
    })(document.viewport);


    Element.Storage = {
        UID: 1
    };

    Element.addMethods({
        getStorage: function(element) {
            if (!(element = $(element))) return;

            var uid;
            if (element === window) {
                uid = 0;
            } else {
                if (typeof element._prototypeUID === "undefined")
                    element._prototypeUID = Element.Storage.UID++;
                uid = element._prototypeUID;
            }

            if (!Element.Storage[uid])
                Element.Storage[uid] = $H();

            return Element.Storage[uid];
        },

        store: function(element, key, value) {
            if (!(element = $(element))) return;

            if (arguments.length === 2) {
                Element.getStorage(element).update(key);
            } else {
                Element.getStorage(element).set(key, value);
            }

            return element;
        },

        retrieve: function(element, key, defaultValue) {
            if (!(element = $(element))) return;
            var hash = Element.getStorage(element), value = hash.get(key);

            if (Object.isUndefined(value)) {
                hash.set(key, defaultValue);
                value = defaultValue;
            }

            return value;
        },

        clone: function(element, deep) {
            if (!(element = $(element))) return;
            var clone = element.cloneNode(deep);
            clone._prototypeUID = void 0;
            if (deep) {
                var descendants = Element.select(clone, '*'),
                        i = descendants.length;
                while (i--) {
                    descendants[i]._prototypeUID = void 0;
                }
            }
            return Element.extend(clone);
        },

        purge: function(element) {
            if (!(element = $(element))) return;
            var purgeElement = Element._purgeElement;

            purgeElement(element);

            var descendants = element.getElementsByTagName('*'),
                    i = descendants.length;

            while (i--) purgeElement(descendants[i]);

            return null;
        }
    });

    (function() {

        function toDecimal(pctString) {
            var match = pctString.match(/^(\d+)%?$/i);
            if (!match) return null;
            return (Number(match[1]) / 100);
        }

        function getPixelValue(value, property, context) {
            var element = null;
            if (Object.isElement(value)) {
                element = value;
                value = element.getStyle(property);
            }

            if (value === null) {
                return null;
            }

            if ((/^(?:-)?\d+(\.\d+)?(px)?$/i).test(value)) {
                return window.parseFloat(value);
            }

            var isPercentage = value.include('%'), isViewport = (context === document.viewport);

            if (/\d/.test(value) && element && element.runtimeStyle && !(isPercentage && isViewport)) {
                var style = element.style.left, rStyle = element.runtimeStyle.left;
                element.runtimeStyle.left = element.currentStyle.left;
                element.style.left = value || 0;
                value = element.style.pixelLeft;
                element.style.left = style;
                element.runtimeStyle.left = rStyle;

                return value;
            }

            if (element && isPercentage) {
                context = context || element.parentNode;
                var decimal = toDecimal(value);
                var whole = null;
                var position = element.getStyle('position');

                var isHorizontal = property.include('left') || property.include('right') ||
                        property.include('width');

                var isVertical =  property.include('top') || property.include('bottom') ||
                        property.include('height');

                if (context === document.viewport) {
                    if (isHorizontal) {
                        whole = document.viewport.getWidth();
                    } else if (isVertical) {
                        whole = document.viewport.getHeight();
                    }
                } else {
                    if (isHorizontal) {
                        whole = $(context).measure('width');
                    } else if (isVertical) {
                        whole = $(context).measure('height');
                    }
                }

                return (whole === null) ? 0 : whole * decimal;
            }

            return 0;
        }

        function toCSSPixels(number) {
            if (Object.isString(number) && number.endsWith('px')) {
                return number;
            }
            return number + 'px';
        }

        function isDisplayed(element) {
            var originalElement = element;
            while (element && element.parentNode) {
                var display = element.getStyle('display');
                if (display === 'none') {
                    return false;
                }
                element = $(element.parentNode);
            }
            return true;
        }

        var hasLayout = Prototype.K;
        if ('currentStyle' in document.documentElement) {
            hasLayout = function(element) {
                if (!element.currentStyle.hasLayout) {
                    element.style.zoom = 1;
                }
                return element;
            };
        }

        function cssNameFor(key) {
            if (key.include('border')) key = key + '-width';
            return key.camelize();
        }

        Element.Layout = Class.create(Hash, {
            initialize: function($super, element, preCompute) {
                $super();
                this.element = $(element);

                Element.Layout.PROPERTIES.each( function(property) {
                    this._set(property, null);
                }, this);

                if (preCompute) {
                    this._preComputing = true;
                    this._begin();
                    Element.Layout.PROPERTIES.each( this._compute, this );
                    this._end();
                    this._preComputing = false;
                }
            },

            _set: function(property, value) {
                return Hash.prototype.set.call(this, property, value);
            },

            set: function(property, value) {
                throw "Properties of Element.Layout are read-only.";
            },

            get: function($super, property) {
                var value = $super(property);
                return value === null ? this._compute(property) : value;
            },

            _begin: function() {
                if (this._prepared) return;

                var element = this.element;
                if (isDisplayed(element)) {
                    this._prepared = true;
                    return;
                }

                var originalStyles = {
                    position:   element.style.position   || '',
                    width:      element.style.width      || '',
                    visibility: element.style.visibility || '',
                    display:    element.style.display    || ''
                };

                element.store('prototype_original_styles', originalStyles);

                var position = element.getStyle('position'),
                        width = element.getStyle('width');

                if (width === "0px" || width === null) {
                    element.style.display = 'block';
                    width = element.getStyle('width');
                }

                var context = (position === 'fixed') ? document.viewport :
                        element.parentNode;

                element.setStyle({
                    position:   'absolute',
                    visibility: 'hidden',
                    display:    'block'
                });

                var positionedWidth = element.getStyle('width');

                var newWidth;
                if (width && (positionedWidth === width)) {
                    newWidth = getPixelValue(element, 'width', context);
                } else if (position === 'absolute' || position === 'fixed') {
                    newWidth = getPixelValue(element, 'width', context);
                } else {
                    var parent = element.parentNode, pLayout = $(parent).getLayout();

                    newWidth = pLayout.get('width') -
                            this.get('margin-left') -
                            this.get('border-left') -
                            this.get('padding-left') -
                            this.get('padding-right') -
                            this.get('border-right') -
                            this.get('margin-right');
                }

                element.setStyle({ width: newWidth + 'px' });

                this._prepared = true;
            },

            _end: function() {
                var element = this.element;
                var originalStyles = element.retrieve('prototype_original_styles');
                element.store('prototype_original_styles', null);
                element.setStyle(originalStyles);
                this._prepared = false;
            },

            _compute: function(property) {
                var COMPUTATIONS = Element.Layout.COMPUTATIONS;
                if (!(property in COMPUTATIONS)) {
                    throw "Property not found.";
                }

                return this._set(property, COMPUTATIONS[property].call(this, this.element));
            },

            toObject: function() {
                var args = $A(arguments);
                var keys = (args.length === 0) ? Element.Layout.PROPERTIES :
                        args.join(' ').split(' ');
                var obj = {};
                keys.each( function(key) {
                    if (!Element.Layout.PROPERTIES.include(key)) return;
                    var value = this.get(key);
                    if (value != null) obj[key] = value;
                }, this);
                return obj;
            },

            toHash: function() {
                var obj = this.toObject.apply(this, arguments);
                return new Hash(obj);
            },

            toCSS: function() {
                var args = $A(arguments);
                var keys = (args.length === 0) ? Element.Layout.PROPERTIES :
                        args.join(' ').split(' ');
                var css = {};

                keys.each( function(key) {
                    if (!Element.Layout.PROPERTIES.include(key)) return;
                    if (Element.Layout.COMPOSITE_PROPERTIES.include(key)) return;

                    var value = this.get(key);
                    if (value != null) css[cssNameFor(key)] = value + 'px';
                }, this);
                return css;
            },

            inspect: function() {
                return "#<Element.Layout>";
            }
        });

        Object.extend(Element.Layout, {
            PROPERTIES: $w('height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height'),

            COMPOSITE_PROPERTIES: $w('padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height'),

            COMPUTATIONS: {
                'height': function(element) {
                    if (!this._preComputing) this._begin();

                    var bHeight = this.get('border-box-height');
                    if (bHeight <= 0) {
                        if (!this._preComputing) this._end();
                        return 0;
                    }

                    var bTop = this.get('border-top'),
                            bBottom = this.get('border-bottom');

                    var pTop = this.get('padding-top'),
                            pBottom = this.get('padding-bottom');

                    if (!this._preComputing) this._end();

                    return bHeight - bTop - bBottom - pTop - pBottom;
                },

                'width': function(element) {
                    if (!this._preComputing) this._begin();

                    var bWidth = this.get('border-box-width');
                    if (bWidth <= 0) {
                        if (!this._preComputing) this._end();
                        return 0;
                    }

                    var bLeft = this.get('border-left'),
                            bRight = this.get('border-right');

                    var pLeft = this.get('padding-left'),
                            pRight = this.get('padding-right');

                    if (!this._preComputing) this._end();

                    return bWidth - bLeft - bRight - pLeft - pRight;
                },

                'padding-box-height': function(element) {
                    var height = this.get('height'),
                            pTop = this.get('padding-top'),
                            pBottom = this.get('padding-bottom');

                    return height + pTop + pBottom;
                },

                'padding-box-width': function(element) {
                    var width = this.get('width'),
                            pLeft = this.get('padding-left'),
                            pRight = this.get('padding-right');

                    return width + pLeft + pRight;
                },

                'border-box-height': function(element) {
                    if (!this._preComputing) this._begin();
                    var height = element.offsetHeight;
                    if (!this._preComputing) this._end();
                    return height;
                },

                'border-box-width': function(element) {
                    if (!this._preComputing) this._begin();
                    var width = element.offsetWidth;
                    if (!this._preComputing) this._end();
                    return width;
                },

                'margin-box-height': function(element) {
                    var bHeight = this.get('border-box-height'),
                            mTop = this.get('margin-top'),
                            mBottom = this.get('margin-bottom');

                    if (bHeight <= 0) return 0;

                    return bHeight + mTop + mBottom;
                },

                'margin-box-width': function(element) {
                    var bWidth = this.get('border-box-width'),
                            mLeft = this.get('margin-left'),
                            mRight = this.get('margin-right');

                    if (bWidth <= 0) return 0;

                    return bWidth + mLeft + mRight;
                },

                'top': function(element) {
                    var offset = element.positionedOffset();
                    return offset.top;
                },

                'bottom': function(element) {
                    var offset = element.positionedOffset(),
                            parent = element.getOffsetParent(),
                            pHeight = parent.measure('height');

                    var mHeight = this.get('border-box-height');

                    return pHeight - mHeight - offset.top;
                },

                'left': function(element) {
                    var offset = element.positionedOffset();
                    return offset.left;
                },

                'right': function(element) {
                    var offset = element.positionedOffset(),
                            parent = element.getOffsetParent(),
                            pWidth = parent.measure('width');

                    var mWidth = this.get('border-box-width');

                    return pWidth - mWidth - offset.left;
                },

                'padding-top': function(element) {
                    return getPixelValue(element, 'paddingTop');
                },

                'padding-bottom': function(element) {
                    return getPixelValue(element, 'paddingBottom');
                },

                'padding-left': function(element) {
                    return getPixelValue(element, 'paddingLeft');
                },

                'padding-right': function(element) {
                    return getPixelValue(element, 'paddingRight');
                },

                'border-top': function(element) {
                    return getPixelValue(element, 'borderTopWidth');
                },

                'border-bottom': function(element) {
                    return getPixelValue(element, 'borderBottomWidth');
                },

                'border-left': function(element) {
                    return getPixelValue(element, 'borderLeftWidth');
                },

                'border-right': function(element) {
                    return getPixelValue(element, 'borderRightWidth');
                },

                'margin-top': function(element) {
                    return getPixelValue(element, 'marginTop');
                },

                'margin-bottom': function(element) {
                    return getPixelValue(element, 'marginBottom');
                },

                'margin-left': function(element) {
                    return getPixelValue(element, 'marginLeft');
                },

                'margin-right': function(element) {
                    return getPixelValue(element, 'marginRight');
                }
            }
        });

        if ('getBoundingClientRect' in document.documentElement) {
            Object.extend(Element.Layout.COMPUTATIONS, {
                'right': function(element) {
                    var parent = hasLayout(element.getOffsetParent());
                    var rect = element.getBoundingClientRect(),
                            pRect = parent.getBoundingClientRect();

                    return (pRect.right - rect.right).round();
                },

                'bottom': function(element) {
                    var parent = hasLayout(element.getOffsetParent());
                    var rect = element.getBoundingClientRect(),
                            pRect = parent.getBoundingClientRect();

                    return (pRect.bottom - rect.bottom).round();
                }
            });
        }

        Element.Offset = Class.create({
            initialize: function(left, top) {
                this.left = left.round();
                this.top  = top.round();

                this[0] = this.left;
                this[1] = this.top;
            },

            relativeTo: function(offset) {
                return new Element.Offset(
                        this.left - offset.left,
                        this.top  - offset.top
                );
            },

            inspect: function() {
                return "#<Element.Offset left: #{left} top: #{top}>".interpolate(this);
            },

            toString: function() {
                return "[#{left}, #{top}]".interpolate(this);
            },

            toArray: function() {
                return [this.left, this.top];
            }
        });

        function getLayout(element, preCompute) {
            return new Element.Layout(element, preCompute);
        }

        function measure(element, property) {
            return $(element).getLayout().get(property);
        }

        function getDimensions(element) {
            element = $(element);
            var display = Element.getStyle(element, 'display');

            if (display && display !== 'none') {
                return { width: element.offsetWidth, height: element.offsetHeight };
            }

            var style = element.style;
            var originalStyles = {
                visibility: style.visibility,
                position:   style.position,
                display:    style.display
            };

            var newStyles = {
                visibility: 'hidden',
                display:    'block'
            };

            if (originalStyles.position !== 'fixed')
                newStyles.position = 'absolute';

            Element.setStyle(element, newStyles);

            var dimensions = {
                width:  element.offsetWidth,
                height: element.offsetHeight
            };

            Element.setStyle(element, originalStyles);

            return dimensions;
        }

        function getOffsetParent(element) {
            element = $(element);

            if (isDocument(element) || isDetached(element) || isBody(element) || isHtml(element))
                return $(document.body);

            var isInline = (Element.getStyle(element, 'display') === 'inline');
            if (!isInline && element.offsetParent) return $(element.offsetParent);

            while ((element = element.parentNode) && element !== document.body) {
                if (Element.getStyle(element, 'position') !== 'static') {
                    return isHtml(element) ? $(document.body) : $(element);
                }
            }

            return $(document.body);
        }


        function cumulativeOffset(element) {
            element = $(element);
            var valueT = 0, valueL = 0;
            if (element.parentNode) {
                do {
                    valueT += element.offsetTop  || 0;
                    valueL += element.offsetLeft || 0;
                    element = element.offsetParent;
                } while (element);
            }
            return new Element.Offset(valueL, valueT);
        }

        function positionedOffset(element) {
            element = $(element);

            var layout = element.getLayout();

            var valueT = 0, valueL = 0;
            do {
                valueT += element.offsetTop  || 0;
                valueL += element.offsetLeft || 0;
                element = element.offsetParent;
                if (element) {
                    if (isBody(element)) break;
                    var p = Element.getStyle(element, 'position');
                    if (p !== 'static') break;
                }
            } while (element);

            valueL -= layout.get('margin-top');
            valueT -= layout.get('margin-left');

            return new Element.Offset(valueL, valueT);
        }

        function cumulativeScrollOffset(element) {
            var valueT = 0, valueL = 0;
            do {
                valueT += element.scrollTop  || 0;
                valueL += element.scrollLeft || 0;
                element = element.parentNode;
            } while (element);
            return new Element.Offset(valueL, valueT);
        }

        function viewportOffset(forElement) {
            element = $(element);
            var valueT = 0, valueL = 0, docBody = document.body;

            var element = forElement;
            do {
                valueT += element.offsetTop  || 0;
                valueL += element.offsetLeft || 0;
                if (element.offsetParent == docBody &&
                        Element.getStyle(element, 'position') == 'absolute') break;
            } while (element = element.offsetParent);

            element = forElement;
            do {
                if (element != docBody) {
                    valueT -= element.scrollTop  || 0;
                    valueL -= element.scrollLeft || 0;
                }
            } while (element = element.parentNode);
            return new Element.Offset(valueL, valueT);
        }

        function absolutize(element) {
            element = $(element);

            if (Element.getStyle(element, 'position') === 'absolute') {
                return element;
            }

            var offsetParent = getOffsetParent(element);
            var eOffset = element.viewportOffset(),
                    pOffset = offsetParent.viewportOffset();

            var offset = eOffset.relativeTo(pOffset);
            var layout = element.getLayout();

            element.store('prototype_absolutize_original_styles', {
                left:   element.getStyle('left'),
                top:    element.getStyle('top'),
                width:  element.getStyle('width'),
                height: element.getStyle('height')
            });

            element.setStyle({
                position: 'absolute',
                top:    offset.top + 'px',
                left:   offset.left + 'px',
                width:  layout.get('width') + 'px',
                height: layout.get('height') + 'px'
            });

            return element;
        }

        function relativize(element) {
            element = $(element);
            if (Element.getStyle(element, 'position') === 'relative') {
                return element;
            }

            var originalStyles =
                    element.retrieve('prototype_absolutize_original_styles');

            if (originalStyles) element.setStyle(originalStyles);
            return element;
        }

        if (Prototype.Browser.IE) {
            getOffsetParent = getOffsetParent.wrap(
                    function(proceed, element) {
                        element = $(element);

                        if (isDocument(element) || isDetached(element) || isBody(element) || isHtml(element))
                            return $(document.body);

                        var position = element.getStyle('position');
                        if (position !== 'static') return proceed(element);

                        element.setStyle({ position: 'relative' });
                        var value = proceed(element);
                        element.setStyle({ position: position });
                        return value;
                    }
            );

            positionedOffset = positionedOffset.wrap(function(proceed, element) {
                element = $(element);
                if (!element.parentNode) return new Element.Offset(0, 0);
                var position = element.getStyle('position');
                if (position !== 'static') return proceed(element);

                var offsetParent = element.getOffsetParent();
                if (offsetParent && offsetParent.getStyle('position') === 'fixed')
                    hasLayout(offsetParent);

                element.setStyle({ position: 'relative' });
                var value = proceed(element);
                element.setStyle({ position: position });
                return value;
            });
        } else if (Prototype.Browser.Webkit) {
            cumulativeOffset = function(element) {
                element = $(element);
                var valueT = 0, valueL = 0;
                do {
                    valueT += element.offsetTop  || 0;
                    valueL += element.offsetLeft || 0;
                    if (element.offsetParent == document.body)
                        if (Element.getStyle(element, 'position') == 'absolute') break;

                    element = element.offsetParent;
                } while (element);

                return new Element.Offset(valueL, valueT);
            };
        }


        Element.addMethods({
            getLayout:              getLayout,
            measure:                measure,
            getDimensions:          getDimensions,
            getOffsetParent:        getOffsetParent,
            cumulativeOffset:       cumulativeOffset,
            positionedOffset:       positionedOffset,
            cumulativeScrollOffset: cumulativeScrollOffset,
            viewportOffset:         viewportOffset,
            absolutize:             absolutize,
            relativize:             relativize
        });

        function isBody(element) {
            return element.nodeName.toUpperCase() === 'BODY';
        }

        function isHtml(element) {
            return element.nodeName.toUpperCase() === 'HTML';
        }

        function isDocument(element) {
            return element.nodeType === Node.DOCUMENT_NODE;
        }

        function isDetached(element) {
            return element !== document.body &&
                    !Element.descendantOf(element, document.body);
        }

        if ('getBoundingClientRect' in document.documentElement) {
            Element.addMethods({
                viewportOffset: function(element) {
                    element = $(element);
                    if (isDetached(element)) return new Element.Offset(0, 0);

                    var rect = element.getBoundingClientRect(),
                            docEl = document.documentElement;
                    return new Element.Offset(rect.left - docEl.clientLeft,
                            rect.top - docEl.clientTop);
                }
            });
        }
    })();
    window.$$ = function() {
        var expression = $A(arguments).join(', ');
        return Prototype.Selector.select(expression, document);
    };

    Prototype.Selector = (function() {

        function select() {
            throw new Error('Method "Prototype.Selector.select" must be defined.');
        }

        function match() {
            throw new Error('Method "Prototype.Selector.match" must be defined.');
        }

        function find(elements, expression, index) {
            index = index || 0;
            var match = Prototype.Selector.match, length = elements.length, matchIndex = 0, i;

            for (i = 0; i < length; i++) {
                if (match(elements[i], expression) && index == matchIndex++) {
                    return Element.extend(elements[i]);
                }
            }
        }

        function extendElements(elements) {
            for (var i = 0, length = elements.length; i < length; i++) {
                Element.extend(elements[i]);
            }
            return elements;
        }


        var K = Prototype.K;

        return {
            select: select,
            match: match,
            find: find,
            extendElements: (Element.extend === K) ? K : extendElements,
            extendElement: Element.extend
        };
    })();
    Prototype._original_property = window.Sizzle;
    /*!
     * Sizzle CSS Selector Engine - v1.0
     *  Copyright 2009, The Dojo Foundation
     *  Released under the MIT, BSD, and GPL Licenses.
     *  More information: http://sizzlejs.com/
     */
    (function(){

        var chunker = /((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,
                done = 0,
                toString = Object.prototype.toString,
                hasDuplicate = false,
                baseHasDuplicate = true;

        [0, 0].sort(function(){
            baseHasDuplicate = false;
            return 0;
        });

        var Sizzle = function(selector, context, results, seed) {
            results = results || [];
            var origContext = context = context || document;

            if ( context.nodeType !== 1 && context.nodeType !== 9 ) {
                return [];
            }

            if ( !selector || typeof selector !== "string" ) {
                return results;
            }

            var parts = [], m, set, checkSet, check, mode, extra, prune = true, contextXML = isXML(context),
                    soFar = selector;

            while ( (chunker.exec(""), m = chunker.exec(soFar)) !== null ) {
                soFar = m[3];

                parts.push( m[1] );

                if ( m[2] ) {
                    extra = m[3];
                    break;
                }
            }

            if ( parts.length > 1 && origPOS.exec( selector ) ) {
                if ( parts.length === 2 && Expr.relative[ parts[0] ] ) {
                    set = posProcess( parts[0] + parts[1], context );
                } else {
                    set = Expr.relative[ parts[0] ] ?
                            [ context ] :
                            Sizzle( parts.shift(), context );

                    while ( parts.length ) {
                        selector = parts.shift();

                        if ( Expr.relative[ selector ] )
                            selector += parts.shift();

                        set = posProcess( selector, set );
                    }
                }
            } else {
                if ( !seed && parts.length > 1 && context.nodeType === 9 && !contextXML &&
                        Expr.match.ID.test(parts[0]) && !Expr.match.ID.test(parts[parts.length - 1]) ) {
                    var ret = Sizzle.find( parts.shift(), context, contextXML );
                    context = ret.expr ? Sizzle.filter( ret.expr, ret.set )[0] : ret.set[0];
                }

                if ( context ) {
                    var ret = seed ?
                    { expr: parts.pop(), set: makeArray(seed) } :
                            Sizzle.find( parts.pop(), parts.length === 1 && (parts[0] === "~" || parts[0] === "+") && context.parentNode ? context.parentNode : context, contextXML );
                    set = ret.expr ? Sizzle.filter( ret.expr, ret.set ) : ret.set;

                    if ( parts.length > 0 ) {
                        checkSet = makeArray(set);
                    } else {
                        prune = false;
                    }

                    while ( parts.length ) {
                        var cur = parts.pop(), pop = cur;

                        if ( !Expr.relative[ cur ] ) {
                            cur = "";
                        } else {
                            pop = parts.pop();
                        }

                        if ( pop == null ) {
                            pop = context;
                        }

                        Expr.relative[ cur ]( checkSet, pop, contextXML );
                    }
                } else {
                    checkSet = parts = [];
                }
            }

            if ( !checkSet ) {
                checkSet = set;
            }

            if ( !checkSet ) {
                throw "Syntax error, unrecognized expression: " + (cur || selector);
            }

            if ( toString.call(checkSet) === "[object Array]" ) {
                if ( !prune ) {
                    results.push.apply( results, checkSet );
                } else if ( context && context.nodeType === 1 ) {
                    for ( var i = 0; checkSet[i] != null; i++ ) {
                        if ( checkSet[i] && (checkSet[i] === true || checkSet[i].nodeType === 1 && contains(context, checkSet[i])) ) {
                            results.push( set[i] );
                        }
                    }
                } else {
                    for ( var i = 0; checkSet[i] != null; i++ ) {
                        if ( checkSet[i] && checkSet[i].nodeType === 1 ) {
                            results.push( set[i] );
                        }
                    }
                }
            } else {
                makeArray( checkSet, results );
            }

            if ( extra ) {
                Sizzle( extra, origContext, results, seed );
                Sizzle.uniqueSort( results );
            }

            return results;
        };

        Sizzle.uniqueSort = function(results){
            if ( sortOrder ) {
                hasDuplicate = baseHasDuplicate;
                results.sort(sortOrder);

                if ( hasDuplicate ) {
                    for ( var i = 1; i < results.length; i++ ) {
                        if ( results[i] === results[i-1] ) {
                            results.splice(i--, 1);
                        }
                    }
                }
            }

            return results;
        };

        Sizzle.matches = function(expr, set){
            return Sizzle(expr, null, null, set);
        };

        Sizzle.find = function(expr, context, isXML){
            var set, match;

            if ( !expr ) {
                return [];
            }

            for ( var i = 0, l = Expr.order.length; i < l; i++ ) {
                var type = Expr.order[i], match;

                if ( (match = Expr.leftMatch[ type ].exec( expr )) ) {
                    var left = match[1];
                    match.splice(1,1);

                    if ( left.substr( left.length - 1 ) !== "\\" ) {
                        match[1] = (match[1] || "").replace(/\\/g, "");
                        set = Expr.find[ type ]( match, context, isXML );
                        if ( set != null ) {
                            expr = expr.replace( Expr.match[ type ], "" );
                            break;
                        }
                    }
                }
            }

            if ( !set ) {
                set = context.getElementsByTagName("*");
            }

            return {set: set, expr: expr};
        };

        Sizzle.filter = function(expr, set, inplace, not){
            var old = expr, result = [], curLoop = set, match, anyFound,
                    isXMLFilter = set && set[0] && isXML(set[0]);

            while ( expr && set.length ) {
                for ( var type in Expr.filter ) {
                    if ( (match = Expr.match[ type ].exec( expr )) != null ) {
                        var filter = Expr.filter[ type ], found, item;
                        anyFound = false;

                        if ( curLoop == result ) {
                            result = [];
                        }

                        if ( Expr.preFilter[ type ] ) {
                            match = Expr.preFilter[ type ]( match, curLoop, inplace, result, not, isXMLFilter );

                            if ( !match ) {
                                anyFound = found = true;
                            } else if ( match === true ) {
                                continue;
                            }
                        }

                        if ( match ) {
                            for ( var i = 0; (item = curLoop[i]) != null; i++ ) {
                                if ( item ) {
                                    found = filter( item, match, i, curLoop );
                                    var pass = not ^ !!found;

                                    if ( inplace && found != null ) {
                                        if ( pass ) {
                                            anyFound = true;
                                        } else {
                                            curLoop[i] = false;
                                        }
                                    } else if ( pass ) {
                                        result.push( item );
                                        anyFound = true;
                                    }
                                }
                            }
                        }

                        if ( found !== undefined ) {
                            if ( !inplace ) {
                                curLoop = result;
                            }

                            expr = expr.replace( Expr.match[ type ], "" );

                            if ( !anyFound ) {
                                return [];
                            }

                            break;
                        }
                    }
                }

                if ( expr == old ) {
                    if ( anyFound == null ) {
                        throw "Syntax error, unrecognized expression: " + expr;
                    } else {
                        break;
                    }
                }

                old = expr;
            }

            return curLoop;
        };

        var Expr = Sizzle.selectors = {
            order: [ "ID", "NAME", "TAG" ],
            match: {
                ID: /#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,
                CLASS: /\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,
                NAME: /\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,
                ATTR: /\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,
                TAG: /^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,
                CHILD: /:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,
                POS: /:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,
                PSEUDO: /:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/
            },
            leftMatch: {},
            attrMap: {
                "class": "className",
                "for": "htmlFor"
            },
            attrHandle: {
                href: function(elem){
                    return elem.getAttribute("href");
                }
            },
            relative: {
                "+": function(checkSet, part, isXML){
                    var isPartStr = typeof part === "string",
                            isTag = isPartStr && !/\W/.test(part),
                            isPartStrNotTag = isPartStr && !isTag;

                    if ( isTag && !isXML ) {
                        part = part.toUpperCase();
                    }

                    for ( var i = 0, l = checkSet.length, elem; i < l; i++ ) {
                        if ( (elem = checkSet[i]) ) {
                            while ( (elem = elem.previousSibling) && elem.nodeType !== 1 ) {}

                            checkSet[i] = isPartStrNotTag || elem && elem.nodeName === part ?
                            elem || false :
                            elem === part;
                        }
                    }

                    if ( isPartStrNotTag ) {
                        Sizzle.filter( part, checkSet, true );
                    }
                },
                ">": function(checkSet, part, isXML){
                    var isPartStr = typeof part === "string";

                    if ( isPartStr && !/\W/.test(part) ) {
                        part = isXML ? part : part.toUpperCase();

                        for ( var i = 0, l = checkSet.length; i < l; i++ ) {
                            var elem = checkSet[i];
                            if ( elem ) {
                                var parent = elem.parentNode;
                                checkSet[i] = parent.nodeName === part ? parent : false;
                            }
                        }
                    } else {
                        for ( var i = 0, l = checkSet.length; i < l; i++ ) {
                            var elem = checkSet[i];
                            if ( elem ) {
                                checkSet[i] = isPartStr ?
                                        elem.parentNode :
                                elem.parentNode === part;
                            }
                        }

                        if ( isPartStr ) {
                            Sizzle.filter( part, checkSet, true );
                        }
                    }
                },
                "": function(checkSet, part, isXML){
                    var doneName = done++, checkFn = dirCheck;

                    if ( !/\W/.test(part) ) {
                        var nodeCheck = part = isXML ? part : part.toUpperCase();
                        checkFn = dirNodeCheck;
                    }

                    checkFn("parentNode", part, doneName, checkSet, nodeCheck, isXML);
                },
                "~": function(checkSet, part, isXML){
                    var doneName = done++, checkFn = dirCheck;

                    if ( typeof part === "string" && !/\W/.test(part) ) {
                        var nodeCheck = part = isXML ? part : part.toUpperCase();
                        checkFn = dirNodeCheck;
                    }

                    checkFn("previousSibling", part, doneName, checkSet, nodeCheck, isXML);
                }
            },
            find: {
                ID: function(match, context, isXML){
                    if ( typeof context.getElementById !== "undefined" && !isXML ) {
                        var m = context.getElementById(match[1]);
                        return m ? [m] : [];
                    }
                },
                NAME: function(match, context, isXML){
                    if ( typeof context.getElementsByName !== "undefined" ) {
                        var ret = [], results = context.getElementsByName(match[1]);

                        for ( var i = 0, l = results.length; i < l; i++ ) {
                            if ( results[i].getAttribute("name") === match[1] ) {
                                ret.push( results[i] );
                            }
                        }

                        return ret.length === 0 ? null : ret;
                    }
                },
                TAG: function(match, context){
                    return context.getElementsByTagName(match[1]);
                }
            },
            preFilter: {
                CLASS: function(match, curLoop, inplace, result, not, isXML){
                    match = " " + match[1].replace(/\\/g, "") + " ";

                    if ( isXML ) {
                        return match;
                    }

                    for ( var i = 0, elem; (elem = curLoop[i]) != null; i++ ) {
                        if ( elem ) {
                            if ( not ^ (elem.className && (" " + elem.className + " ").indexOf(match) >= 0) ) {
                                if ( !inplace )
                                    result.push( elem );
                            } else if ( inplace ) {
                                curLoop[i] = false;
                            }
                        }
                    }

                    return false;
                },
                ID: function(match){
                    return match[1].replace(/\\/g, "");
                },
                TAG: function(match, curLoop){
                    for ( var i = 0; curLoop[i] === false; i++ ){}
                    return curLoop[i] && isXML(curLoop[i]) ? match[1] : match[1].toUpperCase();
                },
                CHILD: function(match){
                    if ( match[1] == "nth" ) {
                        var test = /(-?)(\d*)n((?:\+|-)?\d*)/.exec(
                                match[2] == "even" && "2n" || match[2] == "odd" && "2n+1" ||
                                !/\D/.test( match[2] ) && "0n+" + match[2] || match[2]);

                        match[2] = (test[1] + (test[2] || 1)) - 0;
                        match[3] = test[3] - 0;
                    }

                    match[0] = done++;

                    return match;
                },
                ATTR: function(match, curLoop, inplace, result, not, isXML){
                    var name = match[1].replace(/\\/g, "");

                    if ( !isXML && Expr.attrMap[name] ) {
                        match[1] = Expr.attrMap[name];
                    }

                    if ( match[2] === "~=" ) {
                        match[4] = " " + match[4] + " ";
                    }

                    return match;
                },
                PSEUDO: function(match, curLoop, inplace, result, not){
                    if ( match[1] === "not" ) {
                        if ( ( chunker.exec(match[3]) || "" ).length > 1 || /^\w/.test(match[3]) ) {
                            match[3] = Sizzle(match[3], null, null, curLoop);
                        } else {
                            var ret = Sizzle.filter(match[3], curLoop, inplace, true ^ not);
                            if ( !inplace ) {
                                result.push.apply( result, ret );
                            }
                            return false;
                        }
                    } else if ( Expr.match.POS.test( match[0] ) || Expr.match.CHILD.test( match[0] ) ) {
                        return true;
                    }

                    return match;
                },
                POS: function(match){
                    match.unshift( true );
                    return match;
                }
            },
            filters: {
                enabled: function(elem){
                    return elem.disabled === false && elem.type !== "hidden";
                },
                disabled: function(elem){
                    return elem.disabled === true;
                },
                checked: function(elem){
                    return elem.checked === true;
                },
                selected: function(elem){
                    elem.parentNode.selectedIndex;
                    return elem.selected === true;
                },
                parent: function(elem){
                    return !!elem.firstChild;
                },
                empty: function(elem){
                    return !elem.firstChild;
                },
                has: function(elem, i, match){
                    return !!Sizzle( match[3], elem ).length;
                },
                header: function(elem){
                    return /h\d/i.test( elem.nodeName );
                },
                text: function(elem){
                    return "text" === elem.type;
                },
                radio: function(elem){
                    return "radio" === elem.type;
                },
                checkbox: function(elem){
                    return "checkbox" === elem.type;
                },
                file: function(elem){
                    return "file" === elem.type;
                },
                password: function(elem){
                    return "password" === elem.type;
                },
                submit: function(elem){
                    return "submit" === elem.type;
                },
                image: function(elem){
                    return "image" === elem.type;
                },
                reset: function(elem){
                    return "reset" === elem.type;
                },
                button: function(elem){
                    return "button" === elem.type || elem.nodeName.toUpperCase() === "BUTTON";
                },
                input: function(elem){
                    return /input|select|textarea|button/i.test(elem.nodeName);
                }
            },
            setFilters: {
                first: function(elem, i){
                    return i === 0;
                },
                last: function(elem, i, match, array){
                    return i === array.length - 1;
                },
                even: function(elem, i){
                    return i % 2 === 0;
                },
                odd: function(elem, i){
                    return i % 2 === 1;
                },
                lt: function(elem, i, match){
                    return i < match[3] - 0;
                },
                gt: function(elem, i, match){
                    return i > match[3] - 0;
                },
                nth: function(elem, i, match){
                    return match[3] - 0 == i;
                },
                eq: function(elem, i, match){
                    return match[3] - 0 == i;
                }
            },
            filter: {
                PSEUDO: function(elem, match, i, array){
                    var name = match[1], filter = Expr.filters[ name ];

                    if ( filter ) {
                        return filter( elem, i, match, array );
                    } else if ( name === "contains" ) {
                        return (elem.textContent || elem.innerText || "").indexOf(match[3]) >= 0;
                    } else if ( name === "not" ) {
                        var not = match[3];

                        for ( var i = 0, l = not.length; i < l; i++ ) {
                            if ( not[i] === elem ) {
                                return false;
                            }
                        }

                        return true;
                    }
                },
                CHILD: function(elem, match){
                    var type = match[1], node = elem;
                    switch (type) {
                        case 'only':
                        case 'first':
                            while ( (node = node.previousSibling) )  {
                                if ( node.nodeType === 1 ) return false;
                            }
                            if ( type == 'first') return true;
                            node = elem;
                        case 'last':
                            while ( (node = node.nextSibling) )  {
                                if ( node.nodeType === 1 ) return false;
                            }
                            return true;
                        case 'nth':
                            var first = match[2], last = match[3];

                            if ( first == 1 && last == 0 ) {
                                return true;
                            }

                            var doneName = match[0],
                                    parent = elem.parentNode;

                            if ( parent && (parent.sizcache !== doneName || !elem.nodeIndex) ) {
                                var count = 0;
                                for ( node = parent.firstChild; node; node = node.nextSibling ) {
                                    if ( node.nodeType === 1 ) {
                                        node.nodeIndex = ++count;
                                    }
                                }
                                parent.sizcache = doneName;
                            }

                            var diff = elem.nodeIndex - last;
                            if ( first == 0 ) {
                                return diff == 0;
                            } else {
                                return ( diff % first == 0 && diff / first >= 0 );
                            }
                    }
                },
                ID: function(elem, match){
                    return elem.nodeType === 1 && elem.getAttribute("id") === match;
                },
                TAG: function(elem, match){
                    return (match === "*" && elem.nodeType === 1) || elem.nodeName === match;
                },
                CLASS: function(elem, match){
                    return (" " + (elem.className || elem.getAttribute("class")) + " ")
                                    .indexOf( match ) > -1;
                },
                ATTR: function(elem, match){
                    var name = match[1],
                            result = Expr.attrHandle[ name ] ?
                                    Expr.attrHandle[ name ]( elem ) :
                                    elem[ name ] != null ?
                                            elem[ name ] :
                                            elem.getAttribute( name ),
                            value = result + "",
                            type = match[2],
                            check = match[4];

                    return result == null ?
                    type === "!=" :
                            type === "=" ?
                            value === check :
                                    type === "*=" ?
                                    value.indexOf(check) >= 0 :
                                            type === "~=" ?
                                            (" " + value + " ").indexOf(check) >= 0 :
                                                    !check ?
                                                    value && result !== false :
                                                            type === "!=" ?
                                                            value != check :
                                                                    type === "^=" ?
                                                                    value.indexOf(check) === 0 :
                                                                            type === "$=" ?
                                                                            value.substr(value.length - check.length) === check :
                                                                                    type === "|=" ?
                                                                                    value === check || value.substr(0, check.length + 1) === check + "-" :
                                                                                            false;
                },
                POS: function(elem, match, i, array){
                    var name = match[2], filter = Expr.setFilters[ name ];

                    if ( filter ) {
                        return filter( elem, i, match, array );
                    }
                }
            }
        };

        var origPOS = Expr.match.POS;

        for ( var type in Expr.match ) {
            Expr.match[ type ] = new RegExp( Expr.match[ type ].source + /(?![^\[]*\])(?![^\(]*\))/.source );
            Expr.leftMatch[ type ] = new RegExp( /(^(?:.|\r|\n)*?)/.source + Expr.match[ type ].source );
        }

        var makeArray = function(array, results) {
            array = Array.prototype.slice.call( array, 0 );

            if ( results ) {
                results.push.apply( results, array );
                return results;
            }

            return array;
        };

        try {
            Array.prototype.slice.call( document.documentElement.childNodes, 0 );

        } catch(e){
            makeArray = function(array, results) {
                var ret = results || [];

                if ( toString.call(array) === "[object Array]" ) {
                    Array.prototype.push.apply( ret, array );
                } else {
                    if ( typeof array.length === "number" ) {
                        for ( var i = 0, l = array.length; i < l; i++ ) {
                            ret.push( array[i] );
                        }
                    } else {
                        for ( var i = 0; array[i]; i++ ) {
                            ret.push( array[i] );
                        }
                    }
                }

                return ret;
            };
        }

        var sortOrder;

        if ( document.documentElement.compareDocumentPosition ) {
            sortOrder = function( a, b ) {
                if ( !a.compareDocumentPosition || !b.compareDocumentPosition ) {
                    if ( a == b ) {
                        hasDuplicate = true;
                    }
                    return 0;
                }

                var ret = a.compareDocumentPosition(b) & 4 ? -1 : a === b ? 0 : 1;
                if ( ret === 0 ) {
                    hasDuplicate = true;
                }
                return ret;
            };
        } else if ( "sourceIndex" in document.documentElement ) {
            sortOrder = function( a, b ) {
                if ( !a.sourceIndex || !b.sourceIndex ) {
                    if ( a == b ) {
                        hasDuplicate = true;
                    }
                    return 0;
                }

                var ret = a.sourceIndex - b.sourceIndex;
                if ( ret === 0 ) {
                    hasDuplicate = true;
                }
                return ret;
            };
        } else if ( document.createRange ) {
            sortOrder = function( a, b ) {
                if ( !a.ownerDocument || !b.ownerDocument ) {
                    if ( a == b ) {
                        hasDuplicate = true;
                    }
                    return 0;
                }

                var aRange = a.ownerDocument.createRange(), bRange = b.ownerDocument.createRange();
                aRange.setStart(a, 0);
                aRange.setEnd(a, 0);
                bRange.setStart(b, 0);
                bRange.setEnd(b, 0);
                var ret = aRange.compareBoundaryPoints(Range.START_TO_END, bRange);
                if ( ret === 0 ) {
                    hasDuplicate = true;
                }
                return ret;
            };
        }

        (function(){
            var form = document.createElement("div"),
                    id = "script" + (new Date).getTime();
            form.innerHTML = "<a name='" + id + "'/>";

            var root = document.documentElement;
            root.insertBefore( form, root.firstChild );

            if ( !!document.getElementById( id ) ) {
                Expr.find.ID = function(match, context, isXML){
                    if ( typeof context.getElementById !== "undefined" && !isXML ) {
                        var m = context.getElementById(match[1]);
                        return m ? m.id === match[1] || typeof m.getAttributeNode !== "undefined" && m.getAttributeNode("id").nodeValue === match[1] ? [m] : undefined : [];
                    }
                };

                Expr.filter.ID = function(elem, match){
                    var node = typeof elem.getAttributeNode !== "undefined" && elem.getAttributeNode("id");
                    return elem.nodeType === 1 && node && node.nodeValue === match;
                };
            }

            root.removeChild( form );
            root = form = null; // release memory in IE
        })();

        (function(){

            var div = document.createElement("div");
            div.appendChild( document.createComment("") );

            if ( div.getElementsByTagName("*").length > 0 ) {
                Expr.find.TAG = function(match, context){
                    var results = context.getElementsByTagName(match[1]);

                    if ( match[1] === "*" ) {
                        var tmp = [];

                        for ( var i = 0; results[i]; i++ ) {
                            if ( results[i].nodeType === 1 ) {
                                tmp.push( results[i] );
                            }
                        }

                        results = tmp;
                    }

                    return results;
                };
            }

            div.innerHTML = "<a href='#'></a>";
            if ( div.firstChild && typeof div.firstChild.getAttribute !== "undefined" &&
                    div.firstChild.getAttribute("href") !== "#" ) {
                Expr.attrHandle.href = function(elem){
                    return elem.getAttribute("href", 2);
                };
            }

            div = null; // release memory in IE
        })();

        if ( document.querySelectorAll ) (function(){
            var oldSizzle = Sizzle, div = document.createElement("div");
            div.innerHTML = "<p class='TEST'></p>";

            if ( div.querySelectorAll && div.querySelectorAll(".TEST").length === 0 ) {
                return;
            }

            Sizzle = function(query, context, extra, seed){
                context = context || document;

                if ( !seed && context.nodeType === 9 && !isXML(context) ) {
                    try {
                        return makeArray( context.querySelectorAll(query), extra );
                    } catch(e){}
                }

                return oldSizzle(query, context, extra, seed);
            };

            for ( var prop in oldSizzle ) {
                Sizzle[ prop ] = oldSizzle[ prop ];
            }

            div = null; // release memory in IE
        })();

        if ( document.getElementsByClassName && document.documentElement.getElementsByClassName ) (function(){
            var div = document.createElement("div");
            div.innerHTML = "<div class='test e'></div><div class='test'></div>";

            if ( div.getElementsByClassName("e").length === 0 )
                return;

            div.lastChild.className = "e";

            if ( div.getElementsByClassName("e").length === 1 )
                return;

            Expr.order.splice(1, 0, "CLASS");
            Expr.find.CLASS = function(match, context, isXML) {
                if ( typeof context.getElementsByClassName !== "undefined" && !isXML ) {
                    return context.getElementsByClassName(match[1]);
                }
            };

            div = null; // release memory in IE
        })();

        function dirNodeCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {
            var sibDir = dir == "previousSibling" && !isXML;
            for ( var i = 0, l = checkSet.length; i < l; i++ ) {
                var elem = checkSet[i];
                if ( elem ) {
                    if ( sibDir && elem.nodeType === 1 ){
                        elem.sizcache = doneName;
                        elem.sizset = i;
                    }
                    elem = elem[dir];
                    var match = false;

                    while ( elem ) {
                        if ( elem.sizcache === doneName ) {
                            match = checkSet[elem.sizset];
                            break;
                        }

                        if ( elem.nodeType === 1 && !isXML ){
                            elem.sizcache = doneName;
                            elem.sizset = i;
                        }

                        if ( elem.nodeName === cur ) {
                            match = elem;
                            break;
                        }

                        elem = elem[dir];
                    }

                    checkSet[i] = match;
                }
            }
        }

        function dirCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {
            var sibDir = dir == "previousSibling" && !isXML;
            for ( var i = 0, l = checkSet.length; i < l; i++ ) {
                var elem = checkSet[i];
                if ( elem ) {
                    if ( sibDir && elem.nodeType === 1 ) {
                        elem.sizcache = doneName;
                        elem.sizset = i;
                    }
                    elem = elem[dir];
                    var match = false;

                    while ( elem ) {
                        if ( elem.sizcache === doneName ) {
                            match = checkSet[elem.sizset];
                            break;
                        }

                        if ( elem.nodeType === 1 ) {
                            if ( !isXML ) {
                                elem.sizcache = doneName;
                                elem.sizset = i;
                            }
                            if ( typeof cur !== "string" ) {
                                if ( elem === cur ) {
                                    match = true;
                                    break;
                                }

                            } else if ( Sizzle.filter( cur, [elem] ).length > 0 ) {
                                match = elem;
                                break;
                            }
                        }

                        elem = elem[dir];
                    }

                    checkSet[i] = match;
                }
            }
        }

        var contains = document.compareDocumentPosition ?  function(a, b){
            return a.compareDocumentPosition(b) & 16;
        } : function(a, b){
            return a !== b && (a.contains ? a.contains(b) : true);
        };

        var isXML = function(elem){
            return elem.nodeType === 9 && elem.documentElement.nodeName !== "HTML" ||
                    !!elem.ownerDocument && elem.ownerDocument.documentElement.nodeName !== "HTML";
        };

        var posProcess = function(selector, context){
            var tmpSet = [], later = "", match,
                    root = context.nodeType ? [context] : context;

            while ( (match = Expr.match.PSEUDO.exec( selector )) ) {
                later += match[0];
                selector = selector.replace( Expr.match.PSEUDO, "" );
            }

            selector = Expr.relative[selector] ? selector + "*" : selector;

            for ( var i = 0, l = root.length; i < l; i++ ) {
                Sizzle( selector, root[i], tmpSet );
            }

            return Sizzle.filter( later, tmpSet );
        };


        window.Sizzle = Sizzle;

    })();

    ;(function(engine) {
        var extendElements = Prototype.Selector.extendElements;

        function select(selector, scope) {
            return extendElements(engine(selector, scope || document));
        }

        function match(element, selector) {
            return engine.matches(selector, [element]).length == 1;
        }

        Prototype.Selector.engine = engine;
        Prototype.Selector.select = select;
        Prototype.Selector.match = match;
    })(Sizzle);

    window.Sizzle = Prototype._original_property;
    delete Prototype._original_property;

    var Form = {
        reset: function(form) {
            form = $(form);
            form.reset();
            return form;
        },

        serializeElements: function(elements, options) {
            if (typeof options != 'object') options = { hash: !!options };
            else if (Object.isUndefined(options.hash)) options.hash = true;
            var key, value, submitted = false, submit = options.submit, accumulator, initial;

            if (options.hash) {
                initial = {};
                accumulator = function(result, key, value) {
                    if (key in result) {
                        if (!Object.isArray(result[key])) result[key] = [result[key]];
                        result[key].push(value);
                    } else result[key] = value;
                    return result;
                };
            } else {
                initial = '';
                accumulator = function(result, key, value) {
                    return result + (result ? '&' : '') + encodeURIComponent(key) + '=' + encodeURIComponent(value);
                }
            }

            return elements.inject(initial, function(result, element) {
                if (!element.disabled && element.name) {
                    key = element.name; value = $(element).getValue();
                    if (value != null && element.type != 'file' && (element.type != 'submit' || (!submitted &&
                            submit !== false && (!submit || key == submit) && (submitted = true)))) {
                        result = accumulator(result, key, value);
                    }
                }
                return result;
            });
        }
    };

    Form.Methods = {
        serialize: function(form, options) {
            return Form.serializeElements(Form.getElements(form), options);
        },

        getElements: function(form) {
            var elements = $(form).getElementsByTagName('*'),
                    element,
                    arr = [ ],
                    serializers = Form.Element.Serializers;
            for (var i = 0; element = elements[i]; i++) {
                arr.push(element);
            }
            return arr.inject([], function(elements, child) {
                if (serializers[child.tagName.toLowerCase()])
                    elements.push(Element.extend(child));
                return elements;
            })
        },

        getInputs: function(form, typeName, name) {
            form = $(form);
            var inputs = form.getElementsByTagName('input');

            if (!typeName && !name) return $A(inputs).map(Element.extend);

            for (var i = 0, matchingInputs = [], length = inputs.length; i < length; i++) {
                var input = inputs[i];
                if ((typeName && input.type != typeName) || (name && input.name != name))
                    continue;
                matchingInputs.push(Element.extend(input));
            }

            return matchingInputs;
        },

        disable: function(form) {
            form = $(form);
            Form.getElements(form).invoke('disable');
            return form;
        },

        enable: function(form) {
            form = $(form);
            Form.getElements(form).invoke('enable');
            return form;
        },

        findFirstElement: function(form) {
            var elements = $(form).getElements().findAll(function(element) {
                return 'hidden' != element.type && !element.disabled;
            });
            var firstByIndex = elements.findAll(function(element) {
                return element.hasAttribute('tabIndex') && element.tabIndex >= 0;
            }).sortBy(function(element) { return element.tabIndex }).first();

            return firstByIndex ? firstByIndex : elements.find(function(element) {
                return /^(?:input|select|textarea)$/i.test(element.tagName);
            });
        },

        focusFirstElement: function(form) {
            form = $(form);
            var element = form.findFirstElement();
            if (element) element.activate();
            return form;
        },

        request: function(form, options) {
            form = $(form), options = Object.clone(options || { });

            var params = options.parameters, action = form.readAttribute('action') || '';
            if (action.blank()) action = window.location.href;
            options.parameters = form.serialize(true);

            if (params) {
                if (Object.isString(params)) params = params.toQueryParams();
                Object.extend(options.parameters, params);
            }

            if (form.hasAttribute('method') && !options.method)
                options.method = form.method;

            return new Ajax.Request(action, options);
        }
    };

    /*--------------------------------------------------------------------------*/


    Form.Element = {
        focus: function(element) {
            $(element).focus();
            return element;
        },

        select: function(element) {
            $(element).select();
            return element;
        }
    };

    Form.Element.Methods = {

        serialize: function(element) {
            element = $(element);
            if (!element.disabled && element.name) {
                var value = element.getValue();
                if (value != undefined) {
                    var pair = { };
                    pair[element.name] = value;
                    return Object.toQueryString(pair);
                }
            }
            return '';
        },

        getValue: function(element) {
            element = $(element);
            var method = element.tagName.toLowerCase();
            return Form.Element.Serializers[method](element);
        },

        setValue: function(element, value) {
            element = $(element);
            var method = element.tagName.toLowerCase();
            Form.Element.Serializers[method](element, value);
            return element;
        },

        clear: function(element) {
            $(element).value = '';
            return element;
        },

        present: function(element) {
            return $(element).value != '';
        },

        activate: function(element) {
            element = $(element);
            try {
                element.focus();
                if (element.select && (element.tagName.toLowerCase() != 'input' ||
                        !(/^(?:button|reset|submit)$/i.test(element.type))))
                    element.select();
            } catch (e) { }
            return element;
        },

        disable: function(element) {
            element = $(element);
            element.disabled = true;
            return element;
        },

        enable: function(element) {
            element = $(element);
            element.disabled = false;
            return element;
        }
    };

    /*--------------------------------------------------------------------------*/

    var Field = Form.Element;

    var $F = Form.Element.Methods.getValue;

    /*--------------------------------------------------------------------------*/

    Form.Element.Serializers = (function() {
        function input(element, value) {
            switch (element.type.toLowerCase()) {
                case 'checkbox':
                case 'radio':
                    return inputSelector(element, value);
                default:
                    return valueSelector(element, value);
            }
        }

        function inputSelector(element, value) {
            if (Object.isUndefined(value))
                return element.checked ? element.value : null;
            else element.checked = !!value;
        }

        function valueSelector(element, value) {
            if (Object.isUndefined(value)) return element.value;
            else element.value = value;
        }

        function select(element, value) {
            if (Object.isUndefined(value))
                return (element.type === 'select-one' ? selectOne : selectMany)(element);

            var opt, currentValue, single = !Object.isArray(value);
            for (var i = 0, length = element.length; i < length; i++) {
                opt = element.options[i];
                currentValue = this.optionValue(opt);
                if (single) {
                    if (currentValue == value) {
                        opt.selected = true;
                        return;
                    }
                }
                else opt.selected = value.include(currentValue);
            }
        }

        function selectOne(element) {
            var index = element.selectedIndex;
            return index >= 0 ? optionValue(element.options[index]) : null;
        }

        function selectMany(element) {
            var values, length = element.length;
            if (!length) return null;

            for (var i = 0, values = []; i < length; i++) {
                var opt = element.options[i];
                if (opt.selected) values.push(optionValue(opt));
            }
            return values;
        }

        function optionValue(opt) {
            return Element.hasAttribute(opt, 'value') ? opt.value : opt.text;
        }

        return {
            input:         input,
            inputSelector: inputSelector,
            textarea:      valueSelector,
            select:        select,
            selectOne:     selectOne,
            selectMany:    selectMany,
            optionValue:   optionValue,
            button:        valueSelector
        };
    })();

    /*--------------------------------------------------------------------------*/


    Abstract.TimedObserver = Class.create(PeriodicalExecuter, {
        initialize: function($super, element, frequency, callback) {
            $super(callback, frequency);
            this.element   = $(element);
            this.lastValue = this.getValue();
        },

        execute: function() {
            var value = this.getValue();
            if (Object.isString(this.lastValue) && Object.isString(value) ?
                    this.lastValue != value : String(this.lastValue) != String(value)) {
                this.callback(this.element, value);
                this.lastValue = value;
            }
        }
    });

    Form.Element.Observer = Class.create(Abstract.TimedObserver, {
        getValue: function() {
            return Form.Element.getValue(this.element);
        }
    });

    Form.Observer = Class.create(Abstract.TimedObserver, {
        getValue: function() {
            return Form.serialize(this.element);
        }
    });

    /*--------------------------------------------------------------------------*/

    Abstract.EventObserver = Class.create({
        initialize: function(element, callback) {
            this.element  = $(element);
            this.callback = callback;

            this.lastValue = this.getValue();
            if (this.element.tagName.toLowerCase() == 'form')
                this.registerFormCallbacks();
            else
                this.registerCallback(this.element);
        },

        onElementEvent: function() {
            var value = this.getValue();
            if (this.lastValue != value) {
                this.callback(this.element, value);
                this.lastValue = value;
            }
        },

        registerFormCallbacks: function() {
            Form.getElements(this.element).each(this.registerCallback, this);
        },

        registerCallback: function(element) {
            if (element.type) {
                switch (element.type.toLowerCase()) {
                    case 'checkbox':
                    case 'radio':
                        Event.observe(element, 'click', this.onElementEvent.bind(this));
                        break;
                    default:
                        Event.observe(element, 'change', this.onElementEvent.bind(this));
                        break;
                }
            }
        }
    });

    Form.Element.EventObserver = Class.create(Abstract.EventObserver, {
        getValue: function() {
            return Form.Element.getValue(this.element);
        }
    });

    Form.EventObserver = Class.create(Abstract.EventObserver, {
        getValue: function() {
            return Form.serialize(this.element);
        }
    });
    (function() {

        var Event = {
            KEY_BACKSPACE: 8,
            KEY_TAB:       9,
            KEY_RETURN:   13,
            KEY_ESC:      27,
            KEY_LEFT:     37,
            KEY_UP:       38,
            KEY_RIGHT:    39,
            KEY_DOWN:     40,
            KEY_DELETE:   46,
            KEY_HOME:     36,
            KEY_END:      35,
            KEY_PAGEUP:   33,
            KEY_PAGEDOWN: 34,
            KEY_INSERT:   45,

            cache: {}
        };

        var docEl = document.documentElement;
        var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED = 'onmouseenter' in docEl
                && 'onmouseleave' in docEl;



        var isIELegacyEvent = function(event) { return false; };

        if (window.attachEvent) {
            if (window.addEventListener) {
                isIELegacyEvent = function(event) {
                    return !(event instanceof window.Event);
                };
            } else {
                isIELegacyEvent = function(event) { return true; };
            }
        }

        var _isButton;

        function _isButtonForDOMEvents(event, code) {
            return event.which ? (event.which === code + 1) : (event.button === code);
        }

        var legacyButtonMap = { 0: 1, 1: 4, 2: 2 };
        function _isButtonForLegacyEvents(event, code) {
            return event.button === legacyButtonMap[code];
        }

        function _isButtonForWebKit(event, code) {
            switch (code) {
                case 0: return event.which == 1 && !event.metaKey;
                case 1: return event.which == 2 || (event.which == 1 && event.metaKey);
                case 2: return event.which == 3;
                default: return false;
            }
        }

        if (window.attachEvent) {
            if (!window.addEventListener) {
                _isButton = _isButtonForLegacyEvents;
            } else {
                _isButton = function(event, code) {
                    return isIELegacyEvent(event) ? _isButtonForLegacyEvents(event, code) :
                            _isButtonForDOMEvents(event, code);
                }
            }
        } else if (Prototype.Browser.WebKit) {
            _isButton = _isButtonForWebKit;
        } else {
            _isButton = _isButtonForDOMEvents;
        }

        function isLeftClick(event)   { return _isButton(event, 0) }

        function isMiddleClick(event) { return _isButton(event, 1) }

        function isRightClick(event)  { return _isButton(event, 2) }

        function element(event) {
            event = Event.extend(event);

            var node = event.target, type = event.type,
                    currentTarget = event.currentTarget;

            if (currentTarget && currentTarget.tagName) {
                if (type === 'load' || type === 'error' ||
                        (type === 'click' && currentTarget.tagName.toLowerCase() === 'input'
                        && currentTarget.type === 'radio'))
                    node = currentTarget;
            }

            if (node.nodeType == Node.TEXT_NODE)
                node = node.parentNode;

            return Element.extend(node);
        }

        function findElement(event, expression) {
            var element = Event.element(event);

            if (!expression) return element;
            while (element) {
                if (Object.isElement(element) && Prototype.Selector.match(element, expression)) {
                    return Element.extend(element);
                }
                element = element.parentNode;
            }
        }

        function pointer(event) {
            return { x: pointerX(event), y: pointerY(event) };
        }

        function pointerX(event) {
            var docElement = document.documentElement,
                    body = document.body || { scrollLeft: 0 };

            return event.pageX || (event.clientX +
                    (docElement.scrollLeft || body.scrollLeft) -
                    (docElement.clientLeft || 0));
        }

        function pointerY(event) {
            var docElement = document.documentElement,
                    body = document.body || { scrollTop: 0 };

            return  event.pageY || (event.clientY +
                    (docElement.scrollTop || body.scrollTop) -
                    (docElement.clientTop || 0));
        }


        function stop(event) {
            Event.extend(event);
            event.preventDefault();
            event.stopPropagation();

            event.stopped = true;
        }


        Event.Methods = {
            isLeftClick:   isLeftClick,
            isMiddleClick: isMiddleClick,
            isRightClick:  isRightClick,

            element:     element,
            findElement: findElement,

            pointer:  pointer,
            pointerX: pointerX,
            pointerY: pointerY,

            stop: stop
        };

        var methods = Object.keys(Event.Methods).inject({ }, function(m, name) {
            m[name] = Event.Methods[name].methodize();
            return m;
        });

        if (window.attachEvent) {
            function _relatedTarget(event) {
                var element;
                switch (event.type) {
                    case 'mouseover':
                    case 'mouseenter':
                        element = event.fromElement;
                        break;
                    case 'mouseout':
                    case 'mouseleave':
                        element = event.toElement;
                        break;
                    default:
                        return null;
                }
                return Element.extend(element);
            }

            var additionalMethods = {
                stopPropagation: function() { this.cancelBubble = true },
                preventDefault:  function() { this.returnValue = false },
                inspect: function() { return '[object Event]' }
            };

            Event.extend = function(event, element) {
                if (!event) return false;

                if (!isIELegacyEvent(event)) return event;

                if (event._extendedByPrototype) return event;
                event._extendedByPrototype = Prototype.emptyFunction;

                var pointer = Event.pointer(event);

                Object.extend(event, {
                    target: event.srcElement || element,
                    relatedTarget: _relatedTarget(event),
                    pageX:  pointer.x,
                    pageY:  pointer.y
                });

                Object.extend(event, methods);
                Object.extend(event, additionalMethods);

                return event;
            };
        } else {
            Event.extend = Prototype.K;
        }

        if (window.addEventListener) {
            Event.prototype = window.Event.prototype || document.createEvent('HTMLEvents').__proto__;
            Object.extend(Event.prototype, methods);
        }

        function _createResponder(element, eventName, handler) {
            var registry = Element.retrieve(element, 'prototype_event_registry');

            if (Object.isUndefined(registry)) {
                CACHE.push(element);
                registry = Element.retrieve(element, 'prototype_event_registry', $H());
            }

            var respondersForEvent = registry.get(eventName);
            if (Object.isUndefined(respondersForEvent)) {
                respondersForEvent = [];
                registry.set(eventName, respondersForEvent);
            }

            if (respondersForEvent.pluck('handler').include(handler)) return false;

            var responder;
            if (eventName.include(":")) {
                responder = function(event) {
                    if (Object.isUndefined(event.eventName))
                        return false;

                    if (event.eventName !== eventName)
                        return false;

                    Event.extend(event, element);
                    handler.call(element, event);
                };
            } else {
                if (!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED &&
                        (eventName === "mouseenter" || eventName === "mouseleave")) {
                    if (eventName === "mouseenter" || eventName === "mouseleave") {
                        responder = function(event) {
                            Event.extend(event, element);

                            var parent = event.relatedTarget;
                            while (parent && parent !== element) {
                                try { parent = parent.parentNode; }
                                catch(e) { parent = element; }
                            }

                            if (parent === element) return;

                            handler.call(element, event);
                        };
                    }
                } else {
                    responder = function(event) {
                        Event.extend(event, element);
                        handler.call(element, event);
                    };
                }
            }

            responder.handler = handler;
            respondersForEvent.push(responder);
            return responder;
        }

        function _destroyCache() {
            for (var i = 0, length = CACHE.length; i < length; i++) {
                Event.stopObserving(CACHE[i]);
                CACHE[i] = null;
            }
        }

        var CACHE = [];

        if (Prototype.Browser.IE)
            window.attachEvent('onunload', _destroyCache);

        if (Prototype.Browser.WebKit)
            window.addEventListener('unload', Prototype.emptyFunction, false);


        var _getDOMEventName = Prototype.K,
                translations = { mouseenter: "mouseover", mouseleave: "mouseout" };

        if (!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED) {
            _getDOMEventName = function(eventName) {
                return (translations[eventName] || eventName);
            };
        }

        function observe(element, eventName, handler) {
            element = $(element);

            var responder = _createResponder(element, eventName, handler);

            if (!responder) return element;

            if (eventName.include(':')) {
                if (element.addEventListener)
                    element.addEventListener("dataavailable", responder, false);
                else {
                    element.attachEvent("ondataavailable", responder);
                    element.attachEvent("onlosecapture", responder);
                }
            } else {
                var actualEventName = _getDOMEventName(eventName);

                if (element.addEventListener)
                    element.addEventListener(actualEventName, responder, false);
                else
                    element.attachEvent("on" + actualEventName, responder);
            }

            return element;
        }

        function stopObserving(element, eventName, handler) {
            element = $(element);

            var registry = Element.retrieve(element, 'prototype_event_registry');
            if (!registry) return element;

            if (!eventName) {
                registry.each( function(pair) {
                    var eventName = pair.key;
                    stopObserving(element, eventName);
                });
                return element;
            }

            var responders = registry.get(eventName);
            if (!responders) return element;

            if (!handler) {
                responders.each(function(r) {
                    stopObserving(element, eventName, r.handler);
                });
                return element;
            }

            var i = responders.length, responder;
            while (i--) {
                if (responders[i].handler === handler) {
                    responder = responders[i];
                    break;
                }
            }
            if (!responder) return element;

            if (eventName.include(':')) {
                if (element.removeEventListener)
                    element.removeEventListener("dataavailable", responder, false);
                else {
                    element.detachEvent("ondataavailable", responder);
                    element.detachEvent("onlosecapture", responder);
                }
            } else {
                var actualEventName = _getDOMEventName(eventName);
                if (element.removeEventListener)
                    element.removeEventListener(actualEventName, responder, false);
                else
                    element.detachEvent('on' + actualEventName, responder);
            }

            registry.set(eventName, responders.without(responder));

            return element;
        }

        function fire(element, eventName, memo, bubble) {
            element = $(element);

            if (Object.isUndefined(bubble))
                bubble = true;

            if (element == document && document.createEvent && !element.dispatchEvent)
                element = document.documentElement;

            var event;
            if (document.createEvent) {
                event = document.createEvent('HTMLEvents');
                event.initEvent('dataavailable', bubble, true);
            } else {
                event = document.createEventObject();
                event.eventType = bubble ? 'ondataavailable' : 'onlosecapture';
            }

            event.eventName = eventName;
            event.memo = memo || { };

            if (document.createEvent)
                element.dispatchEvent(event);
            else
                element.fireEvent(event.eventType, event);

            return Event.extend(event);
        }

        Event.Handler = Class.create({
            initialize: function(element, eventName, selector, callback) {
                this.element   = $(element);
                this.eventName = eventName;
                this.selector  = selector;
                this.callback  = callback;
                this.handler   = this.handleEvent.bind(this);
            },

            start: function() {
                Event.observe(this.element, this.eventName, this.handler);
                return this;
            },

            stop: function() {
                Event.stopObserving(this.element, this.eventName, this.handler);
                return this;
            },

            handleEvent: function(event) {
                var element = Event.findElement(event, this.selector);
                if (element) this.callback.call(this.element, event, element);
            }
        });

        function on(element, eventName, selector, callback) {
            element = $(element);
            if (Object.isFunction(selector) && Object.isUndefined(callback)) {
                callback = selector, selector = null;
            }

            return new Event.Handler(element, eventName, selector, callback).start();
        }

        Object.extend(Event, Event.Methods);

        Object.extend(Event, {
            fire:          fire,
            observe:       observe,
            stopObserving: stopObserving,
            on:            on
        });

        Element.addMethods({
            fire:          fire,

            observe:       observe,

            stopObserving: stopObserving,

            on:            on
        });

        Object.extend(document, {
            fire:          fire.methodize(),

            observe:       observe.methodize(),

            stopObserving: stopObserving.methodize(),

            on:            on.methodize(),

            loaded:        false
        });

        if (window.Event) Object.extend(window.Event, Event);
        else window.Event = Event;
    })();

    (function() {
        /* Support for the DOMContentLoaded event is based on work by Dan Webb,
         Matthias Miller, Dean Edwards, John Resig, and Diego Perini. */

        var timer;

        function fireContentLoadedEvent() {
            if (document.loaded) return;
            if (timer) window.clearTimeout(timer);
            document.loaded = true;
            document.fire('dom:loaded');
        }

        function checkReadyState() {
            if (document.readyState === 'complete') {
                document.stopObserving('readystatechange', checkReadyState);
                fireContentLoadedEvent();
            }
        }

        function pollDoScroll() {
            try { document.documentElement.doScroll('left'); }
            catch(e) {
                timer = pollDoScroll.defer();
                return;
            }
            fireContentLoadedEvent();
        }

        if (document.addEventListener) {
            document.addEventListener('DOMContentLoaded', fireContentLoadedEvent, false);
        } else {
            document.observe('readystatechange', checkReadyState);
            if (window == top)
                timer = pollDoScroll.defer();
        }

        Event.observe(window, 'load', fireContentLoadedEvent);
    })();

    Element.addMethods();

    /*------------------------------- DEPRECATED -------------------------------*/

    Hash.toQueryString = Object.toQueryString;

    var Toggle = { display: Element.toggle };

    Element.Methods.childOf = Element.Methods.descendantOf;

    var Insertion = {
        Before: function(element, content) {
            return Element.insert(element, {before:content});
        },

        Top: function(element, content) {
            return Element.insert(element, {top:content});
        },

        Bottom: function(element, content) {
            return Element.insert(element, {bottom:content});
        },

        After: function(element, content) {
            return Element.insert(element, {after:content});
        }
    };

    var $continue = new Error('"throw $continue" is deprecated, use "return" instead');

    var Position = {
        includeScrollOffsets: false,

        prepare: function() {
            this.deltaX =  window.pageXOffset
                    || document.documentElement.scrollLeft
                    || document.body.scrollLeft
                    || 0;
            this.deltaY =  window.pageYOffset
                    || document.documentElement.scrollTop
                    || document.body.scrollTop
                    || 0;
        },

        within: function(element, x, y) {
            if (this.includeScrollOffsets)
                return this.withinIncludingScrolloffsets(element, x, y);
            this.xcomp = x;
            this.ycomp = y;
            this.offset = Element.cumulativeOffset(element);

            return (y >= this.offset[1] &&
            y <  this.offset[1] + element.offsetHeight &&
            x >= this.offset[0] &&
            x <  this.offset[0] + element.offsetWidth);
        },

        withinIncludingScrolloffsets: function(element, x, y) {
            var offsetcache = Element.cumulativeScrollOffset(element);

            this.xcomp = x + offsetcache[0] - this.deltaX;
            this.ycomp = y + offsetcache[1] - this.deltaY;
            this.offset = Element.cumulativeOffset(element);

            return (this.ycomp >= this.offset[1] &&
            this.ycomp <  this.offset[1] + element.offsetHeight &&
            this.xcomp >= this.offset[0] &&
            this.xcomp <  this.offset[0] + element.offsetWidth);
        },

        overlap: function(mode, element) {
            if (!mode) return 0;
            if (mode == 'vertical')
                return ((this.offset[1] + element.offsetHeight) - this.ycomp) /
                        element.offsetHeight;
            if (mode == 'horizontal')
                return ((this.offset[0] + element.offsetWidth) - this.xcomp) /
                        element.offsetWidth;
        },


        cumulativeOffset: Element.Methods.cumulativeOffset,

        positionedOffset: Element.Methods.positionedOffset,

        absolutize: function(element) {
            Position.prepare();
            return Element.absolutize(element);
        },

        relativize: function(element) {
            Position.prepare();
            return Element.relativize(element);
        },

        realOffset: Element.Methods.cumulativeScrollOffset,

        offsetParent: Element.Methods.getOffsetParent,

        page: Element.Methods.viewportOffset,

        clone: function(source, target, options) {
            options = options || { };
            return Element.clonePosition(target, source, options);
        }
    };

    /*--------------------------------------------------------------------------*/

    if (!document.getElementsByClassName) document.getElementsByClassName = function(instanceMethods){
        function iter(name) {
            return name.blank() ? null : "[contains(concat(' ', @class, ' '), ' " + name + " ')]";
        }

        instanceMethods.getElementsByClassName = Prototype.BrowserFeatures.XPath ?
                function(element, className) {
                    className = className.toString().strip();
                    var cond = /\s/.test(className) ? $w(className).map(iter).join('') : iter(className);
                    return cond ? document._getElementsByXPath('.//*' + cond, element) : [];
                } : function(element, className) {
            className = className.toString().strip();
            var elements = [], classNames = (/\s/.test(className) ? $w(className) : null);
            if (!classNames && !className) return elements;

            var nodes = $(element).getElementsByTagName('*');
            className = ' ' + className + ' ';

            for (var i = 0, child, cn; child = nodes[i]; i++) {
                if (child.className && (cn = ' ' + child.className + ' ') && (cn.include(className) ||
                        (classNames && classNames.all(function(name) {
                            return !name.toString().blank() && cn.include(' ' + name + ' ');
                        }))))
                    elements.push(Element.extend(child));
            }
            return elements;
        };

        return function(className, parentElement) {
            return $(parentElement || document.body).getElementsByClassName(className);
        };
    }(Element.Methods);

    /*--------------------------------------------------------------------------*/

    Element.ClassNames = Class.create();
    Element.ClassNames.prototype = {
        initialize: function(element) {
            this.element = $(element);
        },

        _each: function(iterator) {
            this.element.className.split(/\s+/).select(function(name) {
                return name.length > 0;
            })._each(iterator);
        },

        set: function(className) {
            this.element.className = className;
        },

        add: function(classNameToAdd) {
            if (this.include(classNameToAdd)) return;
            this.set($A(this).concat(classNameToAdd).join(' '));
        },

        remove: function(classNameToRemove) {
            if (!this.include(classNameToRemove)) return;
            this.set($A(this).without(classNameToRemove).join(' '));
        },

        toString: function() {
            return $A(this).join(' ');
        }
    };

    Object.extend(Element.ClassNames.prototype, Enumerable);

    /*--------------------------------------------------------------------------*/

    (function() {
        window.Selector = Class.create({
            initialize: function(expression) {
                this.expression = expression.strip();
            },

            findElements: function(rootElement) {
                return Prototype.Selector.select(this.expression, rootElement);
            },

            match: function(element) {
                return Prototype.Selector.match(element, this.expression);
            },

            toString: function() {
                return this.expression;
            },

            inspect: function() {
                return "#<Selector: " + this.expression + ">";
            }
        });

        Object.extend(Selector, {
            matchElements: function(elements, expression) {
                var match = Prototype.Selector.match,
                        results = [];

                for (var i = 0, length = elements.length; i < length; i++) {
                    var element = elements[i];
                    if (match(element, expression)) {
                        results.push(Element.extend(element));
                    }
                }
                return results;
            },

            findElement: function(elements, expression, index) {
                index = index || 0;
                var matchIndex = 0, element;
                for (var i = 0, length = elements.length; i < length; i++) {
                    element = elements[i];
                    if (Prototype.Selector.match(element, expression) && index === matchIndex++) {
                        return Element.extend(element);
                    }
                }
            },

            findChildElements: function(element, expressions) {
                var selector = expressions.toArray().join(', ');
                return Prototype.Selector.select(selector, element || document);
            }
        });
    })();
    </script> <script type="text/javascript"  style="display:none">// Credit Card Validation Javascript
    // copyright 12th May 2003, by Stephen Chapman, Felgall Pty Ltd

    // You have permission to copy and use this javascript provided that
    // the content of the script is not changed in any way.

    function validateCreditCard(s) {
        // remove non-numerics
        var v = "0123456789";
        var w = "";
        for (i=0; i < s.length; i++) {
            x = s.charAt(i);
            if (v.indexOf(x,0) != -1)
                w += x;
        }
        // validate number
        j = w.length / 2;
        k = Math.floor(j);
        m = Math.ceil(j) - k;
        c = 0;
        for (i=0; i<k; i++) {
            a = w.charAt(i*2+m) * 2;
            c += a > 9 ? Math.floor(a/10 + a%10) : a;
        }
        for (i=0; i<k+m; i++) c += w.charAt(i*2+1-m) * 1;
        return (c%10 == 0);
    }

    </script> <script type="text/javascript"  style="display:none">/*
     * Really easy field validation with Prototype
     * http://tetlaw.id.au/view/javascript/really-easy-field-validation
     * Andrew Tetlaw
     * Version 1.5.4.1 (2007-01-05)
     *
     * Copyright (c) 2007 Andrew Tetlaw
     * Permission is hereby granted, free of charge, to any person
     * obtaining a copy of this software and associated documentation
     * files (the "Software"), to deal in the Software without
     * restriction, including without limitation the rights to use, copy,
     * modify, merge, publish, distribute, sublicense, and/or sell copies
     * of the Software, and to permit persons to whom the Software is
     * furnished to do so, subject to the following conditions:
     *
     * The above copyright notice and this permission notice shall be
     * included in all copies or substantial portions of the Software.
     *
     * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
     * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
     * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
     * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
     * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
     * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
     * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
     * SOFTWARE.
     *
     */
    var Validator = Class.create();

    Validator.prototype = {
        initialize : function(className, error, test, options) {
            if(typeof test == 'function'){
                this.options = $H(options);
                this._test = test;
            } else {
                this.options = $H(test);
                this._test = function(){return true};
            }
            this.error = error || 'Validation failed.';
            this.className = className;
        },
        test : function(v, elm) {
            return (this._test(v,elm) && this.options.all(function(p){
                return Validator.methods[p.key] ? Validator.methods[p.key](v,elm,p.value) : true;
            }));
        }
    }
    Validator.methods = {
        pattern : function(v,elm,opt) {return Validation.get('IsEmpty').test(v) || opt.test(v)},
        minLength : function(v,elm,opt) {return v.length >= opt},
        maxLength : function(v,elm,opt) {return v.length <= opt},
        min : function(v,elm,opt) {return v >= parseFloat(opt)},
        max : function(v,elm,opt) {return v <= parseFloat(opt)},
        notOneOf : function(v,elm,opt) {return $A(opt).all(function(value) {
            return v != value;
        })},
        oneOf : function(v,elm,opt) {return $A(opt).any(function(value) {
            return v == value;
        })},
        is : function(v,elm,opt) {return v == opt},
        isNot : function(v,elm,opt) {return v != opt},
        equalToField : function(v,elm,opt) {return v == $F(opt)},
        notEqualToField : function(v,elm,opt) {return v != $F(opt)},
        include : function(v,elm,opt) {return $A(opt).all(function(value) {
            return Validation.get(value).test(v,elm);
        })}
    }

    var Validation = Class.create();
    Validation.defaultOptions = {
        onSubmit : true,
        stopOnFirst : false,
        immediate : false,
        focusOnError : true,
        useTitles : false,
        addClassNameToContainer: false,
        containerClassName: '.input-box',
        onFormValidate : function(result, form) {},
        onElementValidate : function(result, elm) {}
    };

    Validation.prototype = {
        initialize : function(form, options){
            this.form = $(form);
            if (!this.form) {
                return;
            }
            this.options = Object.extend({
                onSubmit : Validation.defaultOptions.onSubmit,
                stopOnFirst : Validation.defaultOptions.stopOnFirst,
                immediate : Validation.defaultOptions.immediate,
                focusOnError : Validation.defaultOptions.focusOnError,
                useTitles : Validation.defaultOptions.useTitles,
                onFormValidate : Validation.defaultOptions.onFormValidate,
                onElementValidate : Validation.defaultOptions.onElementValidate
            }, options || {});
            if(this.options.onSubmit) Event.observe(this.form,'submit',this.onSubmit.bind(this),false);
            if(this.options.immediate) {
                Form.getElements(this.form).each(function(input) { // Thanks Mike!
                    if (input.tagName.toLowerCase() == 'select') {
                        Event.observe(input, 'blur', this.onChange.bindAsEventListener(this));
                    }
                    if (input.type.toLowerCase() == 'radio' || input.type.toLowerCase() == 'checkbox') {
                        Event.observe(input, 'click', this.onChange.bindAsEventListener(this));
                    } else {
                        Event.observe(input, 'change', this.onChange.bindAsEventListener(this));
                    }
                }, this);
            }
        },
        onChange : function (ev) {
            Validation.isOnChange = true;
            Validation.validate(Event.element(ev),{
                useTitle : this.options.useTitles,
                onElementValidate : this.options.onElementValidate
            });
            Validation.isOnChange = false;
        },
        onSubmit :  function(ev){
            if(!this.validate()) Event.stop(ev);
        },
        validate : function() {
            var result = false;
            var useTitles = this.options.useTitles;
            var callback = this.options.onElementValidate;
            try {
                if(this.options.stopOnFirst) {
                    result = Form.getElements(this.form).all(function(elm) {
                        if (elm.hasClassName('local-validation') && !this.isElementInForm(elm, this.form)) {
                            return true;
                        }
                        return Validation.validate(elm,{useTitle : useTitles, onElementValidate : callback});
                    }, this);
                } else {
                    result = Form.getElements(this.form).collect(function(elm) {
                        if (elm.hasClassName('local-validation') && !this.isElementInForm(elm, this.form)) {
                            return true;
                        }
                        return Validation.validate(elm,{useTitle : useTitles, onElementValidate : callback});
                    }, this).all();
                }
            } catch (e) {
            }
            if(!result && this.options.focusOnError) {
                try{
                    Form.getElements(this.form).findAll(function(elm){return $(elm).hasClassName('validation-failed')}).first().focus()
                }
                catch(e){
                }
            }
            this.options.onFormValidate(result, this.form);
            return result;
        },
        reset : function() {
            Form.getElements(this.form).each(Validation.reset);
        },
        isElementInForm : function(elm, form) {
            var domForm = elm.up('form');
            if (domForm == form) {
                return true;
            }
            return false;
        }
    }

    Object.extend(Validation, {
        validate : function(elm, options){
            options = Object.extend({
                useTitle : false,
                onElementValidate : function(result, elm) {}
            }, options || {});
            elm = $(elm);

            var cn = $w(elm.className);
            return result = cn.all(function(value) {
                var test = Validation.test(value,elm,options.useTitle);
                options.onElementValidate(test, elm);
                return test;
            });
        },
        insertAdvice : function(elm, advice){
            var container = $(elm).up('.field-row');
            if(container){
                Element.insert(container, {after: advice});
            } else if (elm.up('td.value')) {
                elm.up('td.value').insert({bottom: advice});
            } else if (elm.advaiceContainer && $(elm.advaiceContainer)) {
                $(elm.advaiceContainer).update(advice);
            }
            else {
                switch (elm.type.toLowerCase()) {
                    case 'checkbox':
                    case 'radio':
                        var p = elm.parentNode;
                        if(p) {
                            Element.insert(p, {'bottom': advice});
                        } else {
                            Element.insert(elm, {'after': advice});
                        }
                        break;
                    default:
                        Element.insert(elm, {'after': advice});
                }
            }
        },
        showAdvice : function(elm, advice, adviceName){
            if(!elm.advices){
                elm.advices = new Hash();
            }
            else{
                elm.advices.each(function(pair){
                    if (!advice || pair.value.id != advice.id) {
                        // hide non-current advice after delay
                        this.hideAdvice(elm, pair.value);
                    }
                }.bind(this));
            }
            elm.advices.set(adviceName, advice);
            if(typeof Effect == 'undefined') {
                advice.style.display = 'block';
            } else {
                if(!advice._adviceAbsolutize) {
                    new Effect.Appear(advice, {duration : 1 });
                } else {
                    Position.absolutize(advice);
                    advice.show();
                    advice.setStyle({
                        'top':advice._adviceTop,
                        'left': advice._adviceLeft,
                        'width': advice._adviceWidth,
                        'z-index': 1000
                    });
                    advice.addClassName('advice-absolute');
                }
            }
        },
        hideAdvice : function(elm, advice){
            if (advice != null) {
                new Effect.Fade(advice, {duration : 1, afterFinishInternal : function() {advice.hide();}});
            }
        },
        updateCallback : function(elm, status) {
            if (typeof elm.callbackFunction != 'undefined') {
                eval(elm.callbackFunction+'(\''+elm.id+'\',\''+status+'\')');
            }
        },
        ajaxError : function(elm, errorMsg) {
            var name = 'validate-ajax';
            var advice = Validation.getAdvice(name, elm);
            if (advice == null) {
                advice = this.createAdvice(name, elm, false, errorMsg);
            }
            this.showAdvice(elm, advice, 'validate-ajax');
            this.updateCallback(elm, 'failed');

            elm.addClassName('validation-failed');
            elm.addClassName('validate-ajax');
            if (Validation.defaultOptions.addClassNameToContainer && Validation.defaultOptions.containerClassName != '') {
                var container = elm.up(Validation.defaultOptions.containerClassName);
                if (container && this.allowContainerClassName(elm)) {
                    container.removeClassName('validation-passed');
                    container.addClassName('validation-error');
                }
            }
        },
        allowContainerClassName: function (elm) {
            if (elm.type == 'radio' || elm.type == 'checkbox') {
                return elm.hasClassName('change-container-classname');
            }

            return true;
        },
        test : function(name, elm, useTitle) {
            var v = Validation.get(name);
            var prop = '__advice'+name.camelize();
            try {
                if(Validation.isVisible(elm) && !v.test($F(elm), elm)) {
                    //if(!elm[prop]) {
                    var advice = Validation.getAdvice(name, elm);
                    if (advice == null) {
                        advice = this.createAdvice(name, elm, useTitle);
                    }
                    this.showAdvice(elm, advice, name);
                    this.updateCallback(elm, 'failed');
                    //}
                    elm[prop] = 1;
                    if (!elm.advaiceContainer) {
                        elm.removeClassName('validation-passed');
                        elm.addClassName('validation-failed');
                    }

                    if (Validation.defaultOptions.addClassNameToContainer && Validation.defaultOptions.containerClassName != '') {
                        var container = elm.up(Validation.defaultOptions.containerClassName);
                        if (container && this.allowContainerClassName(elm)) {
                            container.removeClassName('validation-passed');
                            container.addClassName('validation-error');
                        }
                    }
                    return false;
                } else {
                    var advice = Validation.getAdvice(name, elm);
                    this.hideAdvice(elm, advice);
                    this.updateCallback(elm, 'passed');
                    elm[prop] = '';
                    elm.removeClassName('validation-failed');
                    elm.addClassName('validation-passed');
                    if (Validation.defaultOptions.addClassNameToContainer && Validation.defaultOptions.containerClassName != '') {
                        var container = elm.up(Validation.defaultOptions.containerClassName);
                        if (container && !container.down('.validation-failed') && this.allowContainerClassName(elm)) {
                            if (!Validation.get('IsEmpty').test(elm.value) || !this.isVisible(elm)) {
                                container.addClassName('validation-passed');
                            } else {
                                container.removeClassName('validation-passed');
                            }
                            container.removeClassName('validation-error');
                        }
                    }
                    return true;
                }
            } catch(e) {
                throw(e)
            }
        },
        isVisible : function(elm) {
            while(elm.tagName != 'BODY') {
                if(!$(elm).visible()) return false;
                elm = elm.parentNode;
            }
            return true;
        },
        getAdvice : function(name, elm) {
            return $('advice-' + name + '-' + Validation.getElmID(elm)) || $('advice-' + Validation.getElmID(elm));
        },
        createAdvice : function(name, elm, useTitle, customError) {
            var v = Validation.get(name);
            var errorMsg = useTitle ? ((elm && elm.title) ? elm.title : v.error) : v.error;
            if (customError) {
                errorMsg = customError;
            }
            try {
                if (Translator){
                    errorMsg = Translator.translate(errorMsg);
                }
            }
            catch(e){}

            advice = '<div class="validation-advice" id="advice-' + name + '-' + Validation.getElmID(elm) +'" style="display:none">' + errorMsg + '</div>'


            Validation.insertAdvice(elm, advice);
            advice = Validation.getAdvice(name, elm);
            if($(elm).hasClassName('absolute-advice')) {
                var dimensions = $(elm).getDimensions();
                var originalPosition = Position.cumulativeOffset(elm);

                advice._adviceTop = (originalPosition[1] + dimensions.height) + 'px';
                advice._adviceLeft = (originalPosition[0])  + 'px';
                advice._adviceWidth = (dimensions.width)  + 'px';
                advice._adviceAbsolutize = true;
            }
            return advice;
        },
        getElmID : function(elm) {
            return elm.id ? elm.id : elm.name;
        },
        reset : function(elm) {
            elm = $(elm);
            var cn = $w(elm.className);
            cn.each(function(value) {
                var prop = '__advice'+value.camelize();
                if(elm[prop]) {
                    var advice = Validation.getAdvice(value, elm);
                    if (advice) {
                        advice.hide();
                    }
                    elm[prop] = '';
                }
                elm.removeClassName('validation-failed');
                elm.removeClassName('validation-passed');
                if (Validation.defaultOptions.addClassNameToContainer && Validation.defaultOptions.containerClassName != '') {
                    var container = elm.up(Validation.defaultOptions.containerClassName);
                    if (container) {
                        container.removeClassName('validation-passed');
                        container.removeClassName('validation-error');
                    }
                }
            });
        },
        add : function(className, error, test, options) {
            var nv = {};
            nv[className] = new Validator(className, error, test, options);
            Object.extend(Validation.methods, nv);
        },
        addAllThese : function(validators) {
            var nv = {};
            $A(validators).each(function(value) {
                nv[value[0]] = new Validator(value[0], value[1], value[2], (value.length > 3 ? value[3] : {}));
            });
            Object.extend(Validation.methods, nv);
        },
        get : function(name) {
            return  Validation.methods[name] ? Validation.methods[name] : Validation.methods['_LikeNoIDIEverSaw_'];
        },
        methods : {
            '_LikeNoIDIEverSaw_' : new Validator('_LikeNoIDIEverSaw_','',{})
        }
    });

    Validation.add('IsEmpty', '', function(v) {
        return  (v == '' || (v == null) || (v.length == 0) || /^\s+$/.test(v));
    });

    Validation.addAllThese([
        ['validate-no-html-tags', 'HTML tags are not allowed', function(v) {
            return !/<(\/)?\w+/.test(v);
        }],
        ['validate-select', 'Please select an option.', function(v) {
            return ((v != "none") && (v != null) && (v.length != 0));
        }],
        ['required-entry', 'This is a required field.', function(v) {
            return !Validation.get('IsEmpty').test(v);
        }],
        ['validate-number', 'Please enter a valid number in this field.', function(v) {
            return Validation.get('IsEmpty').test(v)
                    || (!isNaN(parseNumber(v)) && /^\s*-?\d*(\.\d*)?\s*$/.test(v));
        }],
        ['validate-number-range', 'The value is not within the specified range.', function(v, elm) {
            if (Validation.get('IsEmpty').test(v)) {
                return true;
            }

            var numValue = parseNumber(v);
            if (isNaN(numValue)) {
                return false;
            }

            var reRange = /^number-range-(-?[\d.,]+)?-(-?[\d.,]+)?$/,
                    result = true;

            $w(elm.className).each(function(name) {
                var m = reRange.exec(name);
                if (m) {
                    result = result
                            && (m[1] == null || m[1] == '' || numValue >= parseNumber(m[1]))
                            && (m[2] == null || m[2] == '' || numValue <= parseNumber(m[2]));
                }
            });

            return result;
        }],
        ['validate-digits', 'Please use numbers only in this field. Please avoid spaces or other characters such as dots or commas.', function(v) {
            return Validation.get('IsEmpty').test(v) ||  !/[^\d]/.test(v);
        }],
        ['validate-digits-range', 'The value is not within the specified range.', function(v, elm) {
            if (Validation.get('IsEmpty').test(v)) {
                return true;
            }

            var numValue = parseNumber(v);
            if (isNaN(numValue)) {
                return false;
            }

            var reRange = /^digits-range-(-?\d+)?-(-?\d+)?$/,
                    result = true;

            $w(elm.className).each(function(name) {
                var m = reRange.exec(name);
                if (m) {
                    result = result
                            && (m[1] == null || m[1] == '' || numValue >= parseNumber(m[1]))
                            && (m[2] == null || m[2] == '' || numValue <= parseNumber(m[2]));
                }
            });

            return result;
        }],
        ['validate-alpha', 'Please use letters only (a-z or A-Z) in this field.', function (v) {
            return Validation.get('IsEmpty').test(v) ||  /^[a-zA-Z]+$/.test(v)
        }],
        ['validate-code', 'Please use only letters (a-z), numbers (0-9) or underscore(_) in this field, first character should be a letter.', function (v) {
            return Validation.get('IsEmpty').test(v) ||  /^[a-z]+[a-z0-9_]+$/.test(v)
        }],
        ['validate-alphanum', 'Please use only letters (a-z or A-Z) or numbers (0-9) only in this field. No spaces or other characters are allowed.', function(v) {
            return Validation.get('IsEmpty').test(v) || /^[a-zA-Z0-9]+$/.test(v)
        }],
        ['validate-alphanum-with-spaces', 'Please use only letters (a-z or A-Z), numbers (0-9) or spaces only in this field.', function(v) {
            return Validation.get('IsEmpty').test(v) || /^[a-zA-Z0-9 ]+$/.test(v)
        }],
        ['validate-street', 'Please use only letters (a-z or A-Z) or numbers (0-9) or spaces and # only in this field.', function(v) {
            return Validation.get('IsEmpty').test(v) ||  /^[ \w]{3,}([A-Za-z]\.)?([ \w]*\#\d+)?(\r\n| )[ \w]{3,}/.test(v)
        }],
        ['validate-phoneStrict', 'Please enter a valid phone number. For example (123) 456-7890 or 123-456-7890.', function(v) {
            return Validation.get('IsEmpty').test(v) || /^(\()?\d{3}(\))?(-|\s)?\d{3}(-|\s)\d{4}$/.test(v);
        }],
        ['validate-phoneLax', 'Please enter a valid phone number. For example (123) 456-7890 or 123-456-7890.', function(v) {
            return Validation.get('IsEmpty').test(v) || /^((\d[-. ]?)?((\(\d{3}\))|\d{3}))?[-. ]?\d{3}[-. ]?\d{4}$/.test(v);
        }],
        ['validate-fax', 'Please enter a valid fax number. For example (123) 456-7890 or 123-456-7890.', function(v) {
            return Validation.get('IsEmpty').test(v) || /^(\()?\d{3}(\))?(-|\s)?\d{3}(-|\s)\d{4}$/.test(v);
        }],
        ['validate-date', 'Please enter a valid date.', function(v) {
            var test = new Date(v);
            return Validation.get('IsEmpty').test(v) || !isNaN(test);
        }],
        ['validate-email', 'Please enter a valid email address. For example johndoe@domain.com.', function (v) {
            //return Validation.get('IsEmpty').test(v) || /\w{1,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/.test(v)
            //return Validation.get('IsEmpty').test(v) || /^[\!\#$%\*/?|\^\{\}`~&\'\+\-=_a-z0-9][\!\#$%\*/?|\^\{\}`~&\'\+\-=_a-z0-9\.]{1,30}[\!\#$%\*/?|\^\{\}`~&\'\+\-=_a-z0-9]@([a-z0-9_-]{1,30}\.){1,5}[a-z]{2,4}$/i.test(v)
            return Validation.get('IsEmpty').test(v) || /^([a-z0-9,!\#\$%&'\*\+\/=\?\^_`\{\|\}~-]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z0-9,!\#\$%&'\*\+\/=\?\^_`\{\|\}~-]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*@([a-z0-9-]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z0-9-]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*\.(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]){2,})$/i.test(v)
        }],
        ['validate-emailSender', 'Please use only visible characters and spaces.', function (v) {
            return Validation.get('IsEmpty').test(v) ||  /^[\S ]+$/.test(v)
        }],
        ['validate-password', 'Please enter 6 or more characters. Leading or trailing spaces will be ignored.', function(v) {
            var pass=v.strip(); /*strip leading and trailing spaces*/
            return !(pass.length>0 && pass.length < 6);
        }],
        ['validate-admin-password', 'Please enter 7 or more characters. Password should contain both numeric and alphabetic characters.', function(v) {
            var pass=v.strip();
            if (0 == pass.length) {
                return true;
            }
            if (!(/[a-z]/i.test(v)) || !(/[0-9]/.test(v))) {
                return false;
            }
            return !(pass.length < 7);
        }],
        ['validate-cpassword', 'Please make sure your passwords match.', function(v) {
            var conf = $('confirmation') ? $('confirmation') : $$('.validate-cpassword')[0];
            var pass = false;
            if ($('password')) {
                pass = $('password');
            }
            var passwordElements = $$('.validate-password');
            for (var i = 0; i < passwordElements.size(); i++) {
                var passwordElement = passwordElements[i];
                if (passwordElement.up('form').id == conf.up('form').id) {
                    pass = passwordElement;
                }
            }
            if ($$('.validate-admin-password').size()) {
                pass = $$('.validate-admin-password')[0];
            }
            return (pass.value == conf.value);
        }],
        ['validate-url', 'Please enter a valid URL. Protocol is required (http://, https:// or ftp://)', function (v) {
            v = (v || '').replace(/^\s+/, '').replace(/\s+$/, '');
            return Validation.get('IsEmpty').test(v) || /^(http|https|ftp):\/\/(([A-Z0-9]([A-Z0-9_-]*[A-Z0-9]|))(\.[A-Z0-9]([A-Z0-9_-]*[A-Z0-9]|))*)(:(\d+))?(\/[A-Z0-9~](([A-Z0-9_~-]|\.)*[A-Z0-9~]|))*\/?(.*)?$/i.test(v)
        }],
        ['validate-clean-url', 'Please enter a valid URL. For example http://www.example.com or www.example.com', function (v) {
            return Validation.get('IsEmpty').test(v) || /^(http|https|ftp):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+.(com|org|net|dk|at|us|tv|info|uk|co.uk|biz|se)$)(:(\d+))?\/?/i.test(v) || /^(www)((\.[A-Z0-9][A-Z0-9_-]*)+.(com|org|net|dk|at|us|tv|info|uk|co.uk|biz|se)$)(:(\d+))?\/?/i.test(v)
        }],
        ['validate-identifier', 'Please enter a valid URL Key. For example "example-page", "example-page.html" or "anotherlevel/example-page".', function (v) {
            return Validation.get('IsEmpty').test(v) || /^[a-z0-9][a-z0-9_\/-]+(\.[a-z0-9_-]+)?$/.test(v)
        }],
        ['validate-xml-identifier', 'Please enter a valid XML-identifier. For example something_1, block5, id-4.', function (v) {
            return Validation.get('IsEmpty').test(v) || /^[A-Z][A-Z0-9_\/-]*$/i.test(v)
        }],
        ['validate-ssn', 'Please enter a valid social security number. For example 123-45-6789.', function(v) {
            return Validation.get('IsEmpty').test(v) || /^\d{3}-?\d{2}-?\d{4}$/.test(v);
        }],
        ['validate-zip', 'Please enter a valid zip code. For example 90602 or 90602-1234.', function(v) {
            return Validation.get('IsEmpty').test(v) || /(^\d{5}$)|(^\d{5}-\d{4}$)/.test(v);
        }],
        ['validate-zip-spain', 'Please enter a valid zip code.', function(v) {
            return Validation.get('IsEmpty').test(v) || /(^\d{5}$)/.test(v);
        }],
        ['validate-zip-international', 'Please enter a valid zip code.', function(v) {
            //return Validation.get('IsEmpty').test(v) || /(^[A-z0-9]{2,10}([\s]{0,1}|[\-]{0,1})[A-z0-9]{2,10}$)/.test(v);
            return true;
        }],
        ['validate-date-au', 'Please use this date format: dd/mm/yyyy. For example 17/03/2006 for the 17th of March, 2006.', function(v) {
            if(Validation.get('IsEmpty').test(v)) return true;
            var regex = /^(\d{2})\/(\d{2})\/(\d{4})$/;
            if(!regex.test(v)) return false;
            var d = new Date(v.replace(regex, '$2/$1/$3'));
            return ( parseInt(RegExp.$2, 10) == (1+d.getMonth()) ) &&
                    (parseInt(RegExp.$1, 10) == d.getDate()) &&
                    (parseInt(RegExp.$3, 10) == d.getFullYear() );
        }],
        ['validate-currency-dollar', 'Please enter a valid $ amount. For example $100.00.', function(v) {
            // [$]1[##][,###]+[.##]
            // [$]1###+[.##]
            // [$]0.##
            // [$].##
            return Validation.get('IsEmpty').test(v) ||  /^\$?\-?([1-9]{1}[0-9]{0,2}(\,[0-9]{3})*(\.[0-9]{0,2})?|[1-9]{1}\d*(\.[0-9]{0,2})?|0(\.[0-9]{0,2})?|(\.[0-9]{1,2})?)$/.test(v)
        }],
        ['validate-one-required', 'Please select one of the above options.', function (v,elm) {
            var p = elm.parentNode;
            var options = p.getElementsByTagName('INPUT');
            return $A(options).any(function(elm) {
                return $F(elm);
            });
        }],
        ['validate-one-required-by-name', 'Please select one of the options.', function (v,elm) {
            var inputs = $$('input[name="' + elm.name.replace(/([\\"])/g, '\\$1') + '"]');

            var error = 1;
            for(var i=0;i<inputs.length;i++) {
                if((inputs[i].type == 'checkbox' || inputs[i].type == 'radio') && inputs[i].checked == true) {
                    error = 0;
                }

                if(Validation.isOnChange && (inputs[i].type == 'checkbox' || inputs[i].type == 'radio')) {
                    Validation.reset(inputs[i]);
                }
            }

            if( error == 0 ) {
                return true;
            } else {
                return false;
            }
        }],
        ['validate-not-negative-number', 'Please enter a number 0 or greater in this field.', function(v) {
            if (Validation.get('IsEmpty').test(v)) {
                return true;
            }
            v = parseNumber(v);
            return !isNaN(v) && v >= 0;
        }],
        ['validate-zero-or-greater', 'Please enter a number 0 or greater in this field.', function(v) {
            return Validation.get('validate-not-negative-number').test(v);
        }],
        ['validate-greater-than-zero', 'Please enter a number greater than 0 in this field.', function(v) {
            if (Validation.get('IsEmpty').test(v)) {
                return true;
            }
            v = parseNumber(v);
            return !isNaN(v) && v > 0;
        }],
        ['validate-state', 'Please select State/Province.', function(v) {
            return (v!=0 || v == '');
        }],
        ['validate-new-password', 'Please enter 6 or more characters. Leading or trailing spaces will be ignored.', function(v) {
            if (!Validation.get('validate-password').test(v)) return false;
            if (Validation.get('IsEmpty').test(v) && v != '') return false;
            return true;
        }],
        ['validate-cc-number', 'Please enter a valid credit card number.', function(v, elm) {
            // remove non-numerics
            var ccTypeContainer = $(elm.id.substr(0,elm.id.indexOf('_cc_number')) + '_cc_type');
            if (ccTypeContainer && typeof Validation.creditCartTypes.get(ccTypeContainer.value) != 'undefined'
                    && Validation.creditCartTypes.get(ccTypeContainer.value)[2] == false) {
                if (!Validation.get('IsEmpty').test(v) && Validation.get('validate-digits').test(v)) {
                    return true;
                } else {
                    return false;
                }
            }
            return validateCreditCard(v);
        }],
        ['validate-cc-type', 'Credit card number does not match credit card type.', function(v, elm) {
            // remove credit card number delimiters such as "-" and space
            elm.value = removeDelimiters(elm.value);
            v         = removeDelimiters(v);

            var ccTypeContainer = $(elm.id.substr(0,elm.id.indexOf('_cc_number')) + '_cc_type');
            if (!ccTypeContainer) {
                return true;
            }
            var ccType = ccTypeContainer.value;

            if (typeof Validation.creditCartTypes.get(ccType) == 'undefined') {
                return false;
            }

            // Other card type or switch or solo card
            if (Validation.creditCartTypes.get(ccType)[0]==false) {
                return true;
            }

            // Matched credit card type
            var ccMatchedType = '';

            Validation.creditCartTypes.each(function (pair) {
                if (pair.value[0] && v.match(pair.value[0])) {
                    ccMatchedType = pair.key;
                    throw $break;
                }
            });

            if(ccMatchedType != ccType) {
                return false;
            }

            if (ccTypeContainer.hasClassName('validation-failed') && Validation.isOnChange) {
                Validation.validate(ccTypeContainer);
            }

            return true;
        }],
        ['validate-cc-type-select', 'Card type does not match credit card number.', function(v, elm) {
            var ccNumberContainer = $(elm.id.substr(0,elm.id.indexOf('_cc_type')) + '_cc_number');
            if (Validation.isOnChange && Validation.get('IsEmpty').test(ccNumberContainer.value)) {
                return true;
            }
            if (Validation.get('validate-cc-type').test(ccNumberContainer.value, ccNumberContainer)) {
                Validation.validate(ccNumberContainer);
            }
            return Validation.get('validate-cc-type').test(ccNumberContainer.value, ccNumberContainer);
        }],
        ['validate-cc-exp', 'Incorrect credit card expiration date.', function(v, elm) {
            var ccExpMonth   = v;
            var ccExpYear    = $(elm.id.substr(0,elm.id.indexOf('_expiration')) + '_expiration_yr').value;
            var currentTime  = new Date();
            var currentMonth = currentTime.getMonth() + 1;
            var currentYear  = currentTime.getFullYear();
            if (ccExpMonth < currentMonth && ccExpYear == currentYear) {
                return false;
            }
            if (ccExpYear < currentYear) {
                return false;
            }
            return true;
        }],
        ['validate-cc-cvn', 'Please enter a valid credit card verification number.', function(v, elm) {
            var ccTypeContainer = $(elm.id.substr(0,elm.id.indexOf('_cc_cid')) + '_cc_type');
            if (!ccTypeContainer) {
                return true;
            }
            var ccType = ccTypeContainer.value;

            if (typeof Validation.creditCartTypes.get(ccType) == 'undefined') {
                return false;
            }

            var re = Validation.creditCartTypes.get(ccType)[1];

            if (v.match(re)) {
                return true;
            }

            return false;
        }],
        ['validate-ajax', '', function(v, elm) { return true; }],
        ['validate-data', 'Please use only letters (a-z or A-Z), numbers (0-9) or underscore(_) in this field, first character should be a letter.', function (v) {
            if(v != '' && v) {
                return /^[A-Za-z]+[A-Za-z0-9_]+$/.test(v);
            }
            return true;
        }],
        ['validate-css-length', 'Please input a valid CSS-length. For example 100px or 77pt or 20em or .5ex or 50%.', function (v) {
            if (v != '' && v) {
                return /^[0-9\.]+(px|pt|em|ex|%)?$/.test(v) && (!(/\..*\./.test(v))) && !(/\.$/.test(v));
            }
            return true;
        }],
        ['validate-length', 'Text length does not satisfy specified text range.', function (v, elm) {
            var reMax = new RegExp(/^maximum-length-[0-9]+$/);
            var reMin = new RegExp(/^minimum-length-[0-9]+$/);
            var result = true;
            $w(elm.className).each(function(name, index) {
                if (name.match(reMax) && result) {
                    var length = name.split('-')[2];
                    result = (v.length <= length);
                }
                if (name.match(reMin) && result && !Validation.get('IsEmpty').test(v)) {
                    var length = name.split('-')[2];
                    result = (v.length >= length);
                }
            });
            return result;
        }],
        ['validate-percents', 'Please enter a number lower than 100.', {max:100}],
        ['required-file', 'Please select a file', function(v, elm) {
            var result = !Validation.get('IsEmpty').test(v);
            if (result === false) {
                ovId = elm.id + '_value';
                if ($(ovId)) {
                    result = !Validation.get('IsEmpty').test($(ovId).value);
                }
            }
            return result;
        }],
        ['validate-cc-ukss', 'Please enter issue number or start date for switch/solo card type.', function(v,elm) {
            var endposition;

            if (elm.id.match(/(.)+_cc_issue$/)) {
                endposition = elm.id.indexOf('_cc_issue');
            } else if (elm.id.match(/(.)+_start_month$/)) {
                endposition = elm.id.indexOf('_start_month');
            } else {
                endposition = elm.id.indexOf('_start_year');
            }

            var prefix = elm.id.substr(0,endposition);

            var ccTypeContainer = $(prefix + '_cc_type');

            if (!ccTypeContainer) {
                return true;
            }
            var ccType = ccTypeContainer.value;

            if(['SS','SM','SO'].indexOf(ccType) == -1){
                return true;
            }

            $(prefix + '_cc_issue').advaiceContainer
                    = $(prefix + '_start_month').advaiceContainer
                    = $(prefix + '_start_year').advaiceContainer
                    = $(prefix + '_cc_type_ss_div').down('ul li.adv-container');

            var ccIssue   =  $(prefix + '_cc_issue').value;
            var ccSMonth  =  $(prefix + '_start_month').value;
            var ccSYear   =  $(prefix + '_start_year').value;

            var ccStartDatePresent = (ccSMonth && ccSYear) ? true : false;

            if (!ccStartDatePresent && !ccIssue){
                return false;
            }
            return true;
        }],

        //darroyo - Se añade validación para numeros de cuenta
        ['validate-bank-account', 'Por favor, introduzca un número de cuenta IBAN válido.', function(v) {
            return Validation.get('IsEmpty').test(v) || (validIBAN(v));
        }],

        //xsanz - Se añade validación para Tarjeta iberia
        ['validate-iberia-card', 'Por favor introduzca un número de tarjeta Iberia válido', function(v) {
            return Validation.get('IsEmpty').test(v) || (validIberia(v));
        }]

    ]);

    var validIberia = (function (arr) {
        return function (ccNum) {
            var
                    len = ccNum.length,
                    bit = 1,
                    sum = 0,
                    val;
            if(len == 8 ) {
                while (len) {
                    val = parseInt(ccNum.charAt(--len), 10);
                    sum += (bit ^= 1) ? arr[val] : val;
                }
            }
            return sum && sum % 10 === 0;
        };
    }([0, 2, 4, 6, 8, 1, 3, 5, 7, 9]));

    var validIBAN = (function () { // use an IIFE
                                   // A "constant" lookup table of IBAN lengths per country
                                   // (the funky formatting is just to make it fit better in the answer here on CR)
        var CODE_LENGTHS = {
            AD: 24, AE: 23, AT: 20, AZ: 28, BA: 20, BE: 16, BG: 22, BH: 22, BR: 29,
            CH: 21, CR: 21, CY: 28, CZ: 24, DE: 22, DK: 18, DO: 28, EE: 20, ES: 24,
            FI: 18, FO: 18, FR: 27, GB: 22, GI: 23, GL: 18, GR: 27, GT: 28, HR: 21,
            HU: 28, IE: 22, IL: 23, IS: 26, IT: 27, JO: 30, KW: 30, KZ: 20, LB: 28,
            LI: 21, LT: 20, LU: 20, LV: 21, MC: 27, MD: 24, ME: 22, MK: 19, MR: 27,
            MT: 31, MU: 30, NL: 18, NO: 15, PK: 24, PL: 28, PS: 29, PT: 25, QA: 29,
            RO: 24, RS: 22, SA: 24, SE: 24, SI: 19, SK: 24, SM: 27, TN: 24, TR: 26
        };

        // piece-wise mod97 using 9 digit "chunks", as per Wikipedia's example:
        // http://en.wikipedia.org/wiki/International_Bank_Account_Number#Modulo_operation_on_IBAN
        function mod97(string) {
            var checksum = string.slice(0, 2),
                    fragment;

            for(var offset = 2 ; offset < string.length ; offset += 7) {
                fragment = String(checksum) + string.substring(offset, offset + 7);
                checksum = parseInt(fragment, 10) % 97;
            }

            return checksum;
        }

        // return a function that does the actual work
        return function (input) {
            var iban = input,
            /*var iban = String(input).toUpperCase().replace(/[^A-Z0-9]/g, '');,*/
            //iban = iban.replace(/[^A-Za-z0-9]/g, ''),// keep only alphanumeric characters
                    code = iban.match(/^([A-Z]{2})(\d{2})([A-Z\d]+)$/),           // match and capture (1) the country code, (2) the check digits, and (3) the rest
                    digits;

            // check syntax and length
            if(!code || iban.length !== CODE_LENGTHS[code[1]]) {
                return false;
            }

            // rearrange country code and check digits, and convert chars to ints
            digits = (code[3] + code[1] + code[2]).replace(/[A-Z]/g, function (letter) {
                return letter.charCodeAt(0) - 55;
            });

            // final check
            return mod97(digits) === 1;
        };
    }());

    function removeDelimiters (v) {
        v = v.replace(/\s/g, '');
        v = v.replace(/\-/g, '');
        return v;
    }

    function parseNumber(v)
    {
        if (typeof v != 'string') {
            return parseFloat(v);
        }

        var isDot  = v.indexOf('.');
        var isComa = v.indexOf(',');

        if (isDot != -1 && isComa != -1) {
            if (isComa > isDot) {
                v = v.replace('.', '').replace(',', '.');
            }
            else {
                v = v.replace(',', '');
            }
        }
        else if (isComa != -1) {
            v = v.replace(',', '.');
        }

        return parseFloat(v);
    }

    /**
     * Hash with credit card types which can be simply extended in payment modules
     * 0 - regexp for card number
     * 1 - regexp for cvn
     * 2 - check or not credit card number trough Luhn algorithm by
     *     function validateCreditCard which you can find above in this file
     */
    Validation.creditCartTypes = $H({
//    'SS': [new RegExp('^((6759[0-9]{12})|(5018|5020|5038|6304|6759|6761|6763[0-9]{12,19})|(49[013][1356][0-9]{12})|(6333[0-9]{12})|(6334[0-4]\d{11})|(633110[0-9]{10})|(564182[0-9]{10}))([0-9]{2,3})?$'), new RegExp('^([0-9]{3}|[0-9]{4})?$'), true],
        'SO': [new RegExp('^(6334[5-9]([0-9]{11}|[0-9]{13,14}))|(6767([0-9]{12}|[0-9]{14,15}))$'), new RegExp('^([0-9]{3}|[0-9]{4})?$'), true],
        'SM': [new RegExp('(^(5[0678])[0-9]{11,18}$)|(^(6[^05])[0-9]{11,18}$)|(^(601)[^1][0-9]{9,16}$)|(^(6011)[0-9]{9,11}$)|(^(6011)[0-9]{13,16}$)|(^(65)[0-9]{11,13}$)|(^(65)[0-9]{15,18}$)|(^(49030)[2-9]([0-9]{10}$|[0-9]{12,13}$))|(^(49033)[5-9]([0-9]{10}$|[0-9]{12,13}$))|(^(49110)[1-2]([0-9]{10}$|[0-9]{12,13}$))|(^(49117)[4-9]([0-9]{10}$|[0-9]{12,13}$))|(^(49118)[0-2]([0-9]{10}$|[0-9]{12,13}$))|(^(4936)([0-9]{12}$|[0-9]{14,15}$))'), new RegExp('^([0-9]{3}|[0-9]{4})?$'), true],
        'VI': [new RegExp('^4[0-9]{12}([0-9]{3})?$'), new RegExp('^[0-9]{3}$'), true],
        'MC': [new RegExp('^5[1-5][0-9]{14}$'), new RegExp('^[0-9]{3}$'), true],
        'AE': [new RegExp('^3[47][0-9]{13}$'), new RegExp('^[0-9]{4}$'), true],
        'DI': [new RegExp('^6011[0-9]{12}$'), new RegExp('^[0-9]{3}$'), true],
        'JCB': [new RegExp('^(3[0-9]{15}|(2131|1800)[0-9]{11})$'), new RegExp('^[0-9]{3,4}$'), true],
        'OT': [false, new RegExp('^([0-9]{3}|[0-9]{4})?$'), false]
    });
    </script> <script type="text/javascript"  style="display:none">// script.aculo.us builder.js v1.8.2, Tue Nov 18 18:30:58 +0100 2008

    // Copyright (c) 2005-2008 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)
    //
    // script.aculo.us is freely distributable under the terms of an MIT-style license.
    // For details, see the script.aculo.us web site: http://script.aculo.us/

    var Builder = {
        NODEMAP: {
            AREA: 'map',
            CAPTION: 'table',
            COL: 'table',
            COLGROUP: 'table',
            LEGEND: 'fieldset',
            OPTGROUP: 'select',
            OPTION: 'select',
            PARAM: 'object',
            TBODY: 'table',
            TD: 'table',
            TFOOT: 'table',
            TH: 'table',
            THEAD: 'table',
            TR: 'table'
        },
        // note: For Firefox < 1.5, OPTION and OPTGROUP tags are currently broken,
        //       due to a Firefox bug
        node: function(elementName) {
            elementName = elementName.toUpperCase();

            // try innerHTML approach
            var parentTag = this.NODEMAP[elementName] || 'div';
            var parentElement = document.createElement(parentTag);
            try { // prevent IE "feature": http://dev.rubyonrails.org/ticket/2707
                parentElement.innerHTML = "<" + elementName + "></" + elementName + ">";
            } catch(e) {}
            var element = parentElement.firstChild || null;

            // see if browser added wrapping tags
            if(element && (element.tagName.toUpperCase() != elementName))
                element = element.getElementsByTagName(elementName)[0];

            // fallback to createElement approach
            if(!element) element = document.createElement(elementName);

            // abort if nothing could be created
            if(!element) return;

            // attributes (or text)
            if(arguments[1])
                if(this._isStringOrNumber(arguments[1]) ||
                        (arguments[1] instanceof Array) ||
                        arguments[1].tagName) {
                    this._children(element, arguments[1]);
                } else {
                    var attrs = this._attributes(arguments[1]);
                    if(attrs.length) {
                        try { // prevent IE "feature": http://dev.rubyonrails.org/ticket/2707
                            parentElement.innerHTML = "<" +elementName + " " +
                                    attrs + "></" + elementName + ">";
                        } catch(e) {}
                        element = parentElement.firstChild || null;
                        // workaround firefox 1.0.X bug
                        if(!element) {
                            element = document.createElement(elementName);
                            for(attr in arguments[1])
                                element[attr == 'class' ? 'className' : attr] = arguments[1][attr];
                        }
                        if(element.tagName.toUpperCase() != elementName)
                            element = parentElement.getElementsByTagName(elementName)[0];
                    }
                }

            // text, or array of children
            if(arguments[2])
                this._children(element, arguments[2]);

            return $(element);
        },
        _text: function(text) {
            return document.createTextNode(text);
        },

        ATTR_MAP: {
            'className': 'class',
            'htmlFor': 'for'
        },

        _attributes: function(attributes) {
            var attrs = [];
            for(attribute in attributes)
                attrs.push((attribute in this.ATTR_MAP ? this.ATTR_MAP[attribute] : attribute) +
                        '="' + attributes[attribute].toString().escapeHTML().gsub(/"/,'&quot;') + '"');
            return attrs.join(" ");
        },
        _children: function(element, children) {
            if(children.tagName) {
                element.appendChild(children);
                return;
            }
            if(typeof children=='object') { // array can hold nodes and text
                children.flatten().each( function(e) {
                    if(typeof e=='object')
                        element.appendChild(e);
                    else
                    if(Builder._isStringOrNumber(e))
                        element.appendChild(Builder._text(e));
                });
            } else
            if(Builder._isStringOrNumber(children))
                element.appendChild(Builder._text(children));
        },
        _isStringOrNumber: function(param) {
            return(typeof param=='string' || typeof param=='number');
        },
        build: function(html) {
            var element = this.node('div');
            $(element).update(html.strip());
            return element.down();
        },
        dump: function(scope) {
            if(typeof scope != 'object' && typeof scope != 'function') scope = window; //global scope

            var tags = ("A ABBR ACRONYM ADDRESS APPLET AREA B BASE BASEFONT BDO BIG BLOCKQUOTE BODY " +
            "BR BUTTON CAPTION CENTER CITE CODE COL COLGROUP DD DEL DFN DIR DIV DL DT EM FIELDSET " +
            "FONT FORM FRAME FRAMESET H1 H2 H3 H4 H5 H6 HEAD HR HTML I IFRAME IMG INPUT INS ISINDEX "+
            "KBD LABEL LEGEND LI LINK MAP MENU META NOFRAMES NOSCRIPT OBJECT OL OPTGROUP OPTION P "+
            "PARAM PRE Q S SAMP SCRIPT SELECT SMALL SPAN STRIKE STRONG STYLE SUB SUP TABLE TBODY TD "+
            "TEXTAREA TFOOT TH THEAD TITLE TR TT U UL VAR").split(/\s+/);

            tags.each( function(tag){
                scope[tag] = function() {
                    return Builder.node.apply(Builder, [tag].concat($A(arguments)));
                };
            });
        }
    };</script> <script type="text/javascript"  style="display:none">// script.aculo.us effects.js v1.8.2, Tue Nov 18 18:30:58 +0100 2008

    // Copyright (c) 2005-2008 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)
    // Contributors:
    //  Justin Palmer (http://encytemedia.com/)
    //  Mark Pilgrim (http://diveintomark.org/)
    //  Martin Bialasinki
    //
    // script.aculo.us is freely distributable under the terms of an MIT-style license.
    // For details, see the script.aculo.us web site: http://script.aculo.us/

    // converts rgb() and #xxx to #xxxxxx format,
    // returns self (or first argument) if not convertable
    String.prototype.parseColor = function() {
        var color = '#';
        if (this.slice(0,4) == 'rgb(') {
            var cols = this.slice(4,this.length-1).split(',');
            var i=0; do { color += parseInt(cols[i]).toColorPart() } while (++i<3);
        } else {
            if (this.slice(0,1) == '#') {
                if (this.length==4) for(var i=1;i<4;i++) color += (this.charAt(i) + this.charAt(i)).toLowerCase();
                if (this.length==7) color = this.toLowerCase();
            }
        }
        return (color.length==7 ? color : (arguments[0] || this));
    };

    /*--------------------------------------------------------------------------*/

    Element.collectTextNodes = function(element) {
        return $A($(element).childNodes).collect( function(node) {
            return (node.nodeType==3 ? node.nodeValue :
                    (node.hasChildNodes() ? Element.collectTextNodes(node) : ''));
        }).flatten().join('');
    };

    Element.collectTextNodesIgnoreClass = function(element, className) {
        return $A($(element).childNodes).collect( function(node) {
            return (node.nodeType==3 ? node.nodeValue :
                    ((node.hasChildNodes() && !Element.hasClassName(node,className)) ?
                            Element.collectTextNodesIgnoreClass(node, className) : ''));
        }).flatten().join('');
    };

    Element.setContentZoom = function(element, percent) {
        element = $(element);
        element.setStyle({fontSize: (percent/100) + 'em'});
        if (Prototype.Browser.WebKit) window.scrollBy(0,0);
        return element;
    };

    Element.getInlineOpacity = function(element){
        return $(element).style.opacity || '';
    };

    Element.forceRerendering = function(element) {
        try {
            element = $(element);
            var n = document.createTextNode(' ');
            element.appendChild(n);
            element.removeChild(n);
        } catch(e) { }
    };

    /*--------------------------------------------------------------------------*/

    var Effect = {
        _elementDoesNotExistError: {
            name: 'ElementDoesNotExistError',
            message: 'The specified DOM element does not exist, but is required for this effect to operate'
        },
        Transitions: {
            linear: Prototype.K,
            sinoidal: function(pos) {
                return (-Math.cos(pos*Math.PI)/2) + .5;
            },
            reverse: function(pos) {
                return 1-pos;
            },
            flicker: function(pos) {
                var pos = ((-Math.cos(pos*Math.PI)/4) + .75) + Math.random()/4;
                return pos > 1 ? 1 : pos;
            },
            wobble: function(pos) {
                return (-Math.cos(pos*Math.PI*(9*pos))/2) + .5;
            },
            pulse: function(pos, pulses) {
                return (-Math.cos((pos*((pulses||5)-.5)*2)*Math.PI)/2) + .5;
            },
            spring: function(pos) {
                return 1 - (Math.cos(pos * 4.5 * Math.PI) * Math.exp(-pos * 6));
            },
            none: function(pos) {
                return 0;
            },
            full: function(pos) {
                return 1;
            }
        },
        DefaultOptions: {
            duration:   1.0,   // seconds
            fps:        100,   // 100= assume 66fps max.
            sync:       false, // true for combining
            from:       0.0,
            to:         1.0,
            delay:      0.0,
            queue:      'parallel'
        },
        tagifyText: function(element) {
            var tagifyStyle = 'position:relative';
            if (Prototype.Browser.IE) tagifyStyle += ';zoom:1';

            element = $(element);
            $A(element.childNodes).each( function(child) {
                if (child.nodeType==3) {
                    child.nodeValue.toArray().each( function(character) {
                        element.insertBefore(
                                new Element('span', {style: tagifyStyle}).update(
                                        character == ' ' ? String.fromCharCode(160) : character),
                                child);
                    });
                    Element.remove(child);
                }
            });
        },
        multiple: function(element, effect) {
            var elements;
            if (((typeof element == 'object') ||
                    Object.isFunction(element)) &&
                    (element.length))
                elements = element;
            else
                elements = $(element).childNodes;

            var options = Object.extend({
                speed: 0.1,
                delay: 0.0
            }, arguments[2] || { });
            var masterDelay = options.delay;

            $A(elements).each( function(element, index) {
                new effect(element, Object.extend(options, { delay: index * options.speed + masterDelay }));
            });
        },
        PAIRS: {
            'slide':  ['SlideDown','SlideUp'],
            'blind':  ['BlindDown','BlindUp'],
            'appear': ['Appear','Fade']
        },
        toggle: function(element, effect) {
            element = $(element);
            effect = (effect || 'appear').toLowerCase();
            var options = Object.extend({
                queue: { position:'end', scope:(element.id || 'global'), limit: 1 }
            }, arguments[2] || { });
            Effect[element.visible() ?
                    Effect.PAIRS[effect][1] : Effect.PAIRS[effect][0]](element, options);
        }
    };

    Effect.DefaultOptions.transition = Effect.Transitions.sinoidal;

    /* ------------- core effects ------------- */

    Effect.ScopedQueue = Class.create(Enumerable, {
        initialize: function() {
            this.effects  = [];
            this.interval = null;
        },
        _each: function(iterator) {
            this.effects._each(iterator);
        },
        add: function(effect) {
            var timestamp = new Date().getTime();

            var position = Object.isString(effect.options.queue) ?
                    effect.options.queue : effect.options.queue.position;

            switch(position) {
                case 'front':
                    // move unstarted effects after this effect
                    this.effects.findAll(function(e){ return e.state=='idle' }).each( function(e) {
                        e.startOn  += effect.finishOn;
                        e.finishOn += effect.finishOn;
                    });
                    break;
                case 'with-last':
                    timestamp = this.effects.pluck('startOn').max() || timestamp;
                    break;
                case 'end':
                    // start effect after last queued effect has finished
                    timestamp = this.effects.pluck('finishOn').max() || timestamp;
                    break;
            }

            effect.startOn  += timestamp;
            effect.finishOn += timestamp;

            if (!effect.options.queue.limit || (this.effects.length < effect.options.queue.limit))
                this.effects.push(effect);

            if (!this.interval)
                this.interval = setInterval(this.loop.bind(this), 15);
        },
        remove: function(effect) {
            this.effects = this.effects.reject(function(e) { return e==effect });
            if (this.effects.length == 0) {
                clearInterval(this.interval);
                this.interval = null;
            }
        },
        loop: function() {
            var timePos = new Date().getTime();
            for(var i=0, len=this.effects.length;i<len;i++)
                this.effects[i] && this.effects[i].loop(timePos);
        }
    });

    Effect.Queues = {
        instances: $H(),
        get: function(queueName) {
            if (!Object.isString(queueName)) return queueName;

            return this.instances.get(queueName) ||
                    this.instances.set(queueName, new Effect.ScopedQueue());
        }
    };
    Effect.Queue = Effect.Queues.get('global');

    Effect.Base = Class.create({
        position: null,
        start: function(options) {
            function codeForEvent(options,eventName){
                return (
                        (options[eventName+'Internal'] ? 'this.options.'+eventName+'Internal(this);' : '') +
                        (options[eventName] ? 'this.options.'+eventName+'(this);' : '')
                );
            }
            if (options && options.transition === false) options.transition = Effect.Transitions.linear;
            this.options      = Object.extend(Object.extend({ },Effect.DefaultOptions), options || { });
            this.currentFrame = 0;
            this.state        = 'idle';
            this.startOn      = this.options.delay*1000;
            this.finishOn     = this.startOn+(this.options.duration*1000);
            this.fromToDelta  = this.options.to-this.options.from;
            this.totalTime    = this.finishOn-this.startOn;
            this.totalFrames  = this.options.fps*this.options.duration;

            this.render = (function() {
                function dispatch(effect, eventName) {
                    if (effect.options[eventName + 'Internal'])
                        effect.options[eventName + 'Internal'](effect);
                    if (effect.options[eventName])
                        effect.options[eventName](effect);
                }

                return function(pos) {
                    if (this.state === "idle") {
                        this.state = "running";
                        dispatch(this, 'beforeSetup');
                        if (this.setup) this.setup();
                        dispatch(this, 'afterSetup');
                    }
                    if (this.state === "running") {
                        pos = (this.options.transition(pos) * this.fromToDelta) + this.options.from;
                        this.position = pos;
                        dispatch(this, 'beforeUpdate');
                        if (this.update) this.update(pos);
                        dispatch(this, 'afterUpdate');
                    }
                };
            })();

            this.event('beforeStart');
            if (!this.options.sync)
                Effect.Queues.get(Object.isString(this.options.queue) ?
                        'global' : this.options.queue.scope).add(this);
        },
        loop: function(timePos) {
            if (timePos >= this.startOn) {
                if (timePos >= this.finishOn) {
                    this.render(1.0);
                    this.cancel();
                    this.event('beforeFinish');
                    if (this.finish) this.finish();
                    this.event('afterFinish');
                    return;
                }
                var pos   = (timePos - this.startOn) / this.totalTime,
                        frame = (pos * this.totalFrames).round();
                if (frame > this.currentFrame) {
                    this.render(pos);
                    this.currentFrame = frame;
                }
            }
        },
        cancel: function() {
            if (!this.options.sync)
                Effect.Queues.get(Object.isString(this.options.queue) ?
                        'global' : this.options.queue.scope).remove(this);
            this.state = 'finished';
        },
        event: function(eventName) {
            if (this.options[eventName + 'Internal']) this.options[eventName + 'Internal'](this);
            if (this.options[eventName]) this.options[eventName](this);
        },
        inspect: function() {
            var data = $H();
            for(property in this)
                if (!Object.isFunction(this[property])) data.set(property, this[property]);
            return '#<Effect:' + data.inspect() + ',options:' + $H(this.options).inspect() + '>';
        }
    });

    Effect.Parallel = Class.create(Effect.Base, {
        initialize: function(effects) {
            this.effects = effects || [];
            this.start(arguments[1]);
        },
        update: function(position) {
            this.effects.invoke('render', position);
        },
        finish: function(position) {
            this.effects.each( function(effect) {
                effect.render(1.0);
                effect.cancel();
                effect.event('beforeFinish');
                if (effect.finish) effect.finish(position);
                effect.event('afterFinish');
            });
        }
    });

    Effect.Tween = Class.create(Effect.Base, {
        initialize: function(object, from, to) {
            object = Object.isString(object) ? $(object) : object;
            var args = $A(arguments), method = args.last(),
                    options = args.length == 5 ? args[3] : null;
            this.method = Object.isFunction(method) ? method.bind(object) :
                    Object.isFunction(object[method]) ? object[method].bind(object) :
                            function(value) { object[method] = value };
            this.start(Object.extend({ from: from, to: to }, options || { }));
        },
        update: function(position) {
            this.method(position);
        }
    });

    Effect.Event = Class.create(Effect.Base, {
        initialize: function() {
            this.start(Object.extend({ duration: 0 }, arguments[0] || { }));
        },
        update: Prototype.emptyFunction
    });

    Effect.Opacity = Class.create(Effect.Base, {
        initialize: function(element) {
            this.element = $(element);
            if (!this.element) throw(Effect._elementDoesNotExistError);
            // make this work on IE on elements without 'layout'
            if (Prototype.Browser.IE && (!this.element.currentStyle.hasLayout))
                this.element.setStyle({zoom: 1});
            var options = Object.extend({
                from: this.element.getOpacity() || 0.0,
                to:   1.0
            }, arguments[1] || { });
            this.start(options);
        },
        update: function(position) {
            this.element.setOpacity(position);
        }
    });

    Effect.Move = Class.create(Effect.Base, {
        initialize: function(element) {
            this.element = $(element);
            if (!this.element) throw(Effect._elementDoesNotExistError);
            var options = Object.extend({
                x:    0,
                y:    0,
                mode: 'relative'
            }, arguments[1] || { });
            this.start(options);
        },
        setup: function() {
            this.element.makePositioned();
            this.originalLeft = parseFloat(this.element.getStyle('left') || '0');
            this.originalTop  = parseFloat(this.element.getStyle('top')  || '0');
            if (this.options.mode == 'absolute') {
                this.options.x = this.options.x - this.originalLeft;
                this.options.y = this.options.y - this.originalTop;
            }
        },
        update: function(position) {
            this.element.setStyle({
                left: (this.options.x  * position + this.originalLeft).round() + 'px',
                top:  (this.options.y  * position + this.originalTop).round()  + 'px'
            });
        }
    });

    // for backwards compatibility
    Effect.MoveBy = function(element, toTop, toLeft) {
        return new Effect.Move(element,
                Object.extend({ x: toLeft, y: toTop }, arguments[3] || { }));
    };

    Effect.Scale = Class.create(Effect.Base, {
        initialize: function(element, percent) {
            this.element = $(element);
            if (!this.element) throw(Effect._elementDoesNotExistError);
            var options = Object.extend({
                scaleX: true,
                scaleY: true,
                scaleContent: true,
                scaleFromCenter: false,
                scaleMode: 'box',        // 'box' or 'contents' or { } with provided values
                scaleFrom: 100.0,
                scaleTo:   percent
            }, arguments[2] || { });
            this.start(options);
        },
        setup: function() {
            this.restoreAfterFinish = this.options.restoreAfterFinish || false;
            this.elementPositioning = this.element.getStyle('position');

            this.originalStyle = { };
            ['top','left','width','height','fontSize'].each( function(k) {
                this.originalStyle[k] = this.element.style[k];
            }.bind(this));

            this.originalTop  = this.element.offsetTop;
            this.originalLeft = this.element.offsetLeft;

            var fontSize = this.element.getStyle('font-size') || '100%';
            ['em','px','%','pt'].each( function(fontSizeType) {
                if (fontSize.indexOf(fontSizeType)>0) {
                    this.fontSize     = parseFloat(fontSize);
                    this.fontSizeType = fontSizeType;
                }
            }.bind(this));

            this.factor = (this.options.scaleTo - this.options.scaleFrom)/100;

            this.dims = null;
            if (this.options.scaleMode=='box')
                this.dims = [this.element.offsetHeight, this.element.offsetWidth];
            if (/^content/.test(this.options.scaleMode))
                this.dims = [this.element.scrollHeight, this.element.scrollWidth];
            if (!this.dims)
                this.dims = [this.options.scaleMode.originalHeight,
                    this.options.scaleMode.originalWidth];
        },
        update: function(position) {
            var currentScale = (this.options.scaleFrom/100.0) + (this.factor * position);
            if (this.options.scaleContent && this.fontSize)
                this.element.setStyle({fontSize: this.fontSize * currentScale + this.fontSizeType });
            this.setDimensions(this.dims[0] * currentScale, this.dims[1] * currentScale);
        },
        finish: function(position) {
            if (this.restoreAfterFinish) this.element.setStyle(this.originalStyle);
        },
        setDimensions: function(height, width) {
            var d = { };
            if (this.options.scaleX) d.width = width.round() + 'px';
            if (this.options.scaleY) d.height = height.round() + 'px';
            if (this.options.scaleFromCenter) {
                var topd  = (height - this.dims[0])/2;
                var leftd = (width  - this.dims[1])/2;
                if (this.elementPositioning == 'absolute') {
                    if (this.options.scaleY) d.top = this.originalTop-topd + 'px';
                    if (this.options.scaleX) d.left = this.originalLeft-leftd + 'px';
                } else {
                    if (this.options.scaleY) d.top = -topd + 'px';
                    if (this.options.scaleX) d.left = -leftd + 'px';
                }
            }
            this.element.setStyle(d);
        }
    });

    Effect.Highlight = Class.create(Effect.Base, {
        initialize: function(element) {
            this.element = $(element);
            if (!this.element) throw(Effect._elementDoesNotExistError);
            var options = Object.extend({ startcolor: '#ffff99' }, arguments[1] || { });
            this.start(options);
        },
        setup: function() {
            // Prevent executing on elements not in the layout flow
            if (this.element.getStyle('display')=='none') { this.cancel(); return; }
            // Disable background image during the effect
            this.oldStyle = { };
            if (!this.options.keepBackgroundImage) {
                this.oldStyle.backgroundImage = this.element.getStyle('background-image');
                this.element.setStyle({backgroundImage: 'none'});
            }
            if (!this.options.endcolor)
                this.options.endcolor = this.element.getStyle('background-color').parseColor('#ffffff');
            if (!this.options.restorecolor)
                this.options.restorecolor = this.element.getStyle('background-color');
            // init color calculations
            this._base  = $R(0,2).map(function(i){ return parseInt(this.options.startcolor.slice(i*2+1,i*2+3),16) }.bind(this));
            this._delta = $R(0,2).map(function(i){ return parseInt(this.options.endcolor.slice(i*2+1,i*2+3),16)-this._base[i] }.bind(this));
        },
        update: function(position) {
            this.element.setStyle({backgroundColor: $R(0,2).inject('#',function(m,v,i){
                return m+((this._base[i]+(this._delta[i]*position)).round().toColorPart()); }.bind(this)) });
        },
        finish: function() {
            this.element.setStyle(Object.extend(this.oldStyle, {
                backgroundColor: this.options.restorecolor
            }));
        }
    });

    Effect.ScrollTo = function(element) {
        var options = arguments[1] || { },
                scrollOffsets = document.viewport.getScrollOffsets(),
                elementOffsets = $(element).cumulativeOffset();

        if (options.offset) elementOffsets[1] += options.offset;

        return new Effect.Tween(null,
                scrollOffsets.top,
                elementOffsets[1],
                options,
                function(p){ scrollTo(scrollOffsets.left, p.round()); }
        );
    };

    /* ------------- combination effects ------------- */

    Effect.Fade = function(element) {
        element = $(element);
        var oldOpacity = element.getInlineOpacity();
        var options = Object.extend({
            from: element.getOpacity() || 1.0,
            to:   0.0,
            afterFinishInternal: function(effect) {
                if (effect.options.to!=0) return;
                effect.element.hide().setStyle({opacity: oldOpacity});
            }
        }, arguments[1] || { });
        return new Effect.Opacity(element,options);
    };

    Effect.Appear = function(element) {
        element = $(element);
        var options = Object.extend({
            from: (element.getStyle('display') == 'none' ? 0.0 : element.getOpacity() || 0.0),
            to:   1.0,
            // force Safari to render floated elements properly
            afterFinishInternal: function(effect) {
                effect.element.forceRerendering();
            },
            beforeSetup: function(effect) {
                effect.element.setOpacity(effect.options.from).show();
            }}, arguments[1] || { });
        return new Effect.Opacity(element,options);
    };

    Effect.Puff = function(element) {
        element = $(element);
        var oldStyle = {
            opacity: element.getInlineOpacity(),
            position: element.getStyle('position'),
            top:  element.style.top,
            left: element.style.left,
            width: element.style.width,
            height: element.style.height
        };
        return new Effect.Parallel(
                [ new Effect.Scale(element, 200,
                        { sync: true, scaleFromCenter: true, scaleContent: true, restoreAfterFinish: true }),
                    new Effect.Opacity(element, { sync: true, to: 0.0 } ) ],
                Object.extend({ duration: 1.0,
                    beforeSetupInternal: function(effect) {
                        Position.absolutize(effect.effects[0].element);
                    },
                    afterFinishInternal: function(effect) {
                        effect.effects[0].element.hide().setStyle(oldStyle); }
                }, arguments[1] || { })
        );
    };

    Effect.BlindUp = function(element) {
        element = $(element);
        element.makeClipping();
        return new Effect.Scale(element, 0,
                Object.extend({ scaleContent: false,
                    scaleX: false,
                    restoreAfterFinish: true,
                    afterFinishInternal: function(effect) {
                        effect.element.hide().undoClipping();
                    }
                }, arguments[1] || { })
        );
    };

    Effect.BlindDown = function(element) {
        element = $(element);
        var elementDimensions = element.getDimensions();
        return new Effect.Scale(element, 100, Object.extend({
            scaleContent: false,
            scaleX: false,
            scaleFrom: 0,
            scaleMode: {originalHeight: elementDimensions.height, originalWidth: elementDimensions.width},
            restoreAfterFinish: true,
            afterSetup: function(effect) {
                effect.element.makeClipping().setStyle({height: '0px'}).show();
            },
            afterFinishInternal: function(effect) {
                effect.element.undoClipping();
            }
        }, arguments[1] || { }));
    };

    Effect.SwitchOff = function(element) {
        element = $(element);
        var oldOpacity = element.getInlineOpacity();
        return new Effect.Appear(element, Object.extend({
            duration: 0.4,
            from: 0,
            transition: Effect.Transitions.flicker,
            afterFinishInternal: function(effect) {
                new Effect.Scale(effect.element, 1, {
                    duration: 0.3, scaleFromCenter: true,
                    scaleX: false, scaleContent: false, restoreAfterFinish: true,
                    beforeSetup: function(effect) {
                        effect.element.makePositioned().makeClipping();
                    },
                    afterFinishInternal: function(effect) {
                        effect.element.hide().undoClipping().undoPositioned().setStyle({opacity: oldOpacity});
                    }
                });
            }
        }, arguments[1] || { }));
    };

    Effect.DropOut = function(element) {
        element = $(element);
        var oldStyle = {
            top: element.getStyle('top'),
            left: element.getStyle('left'),
            opacity: element.getInlineOpacity() };
        return new Effect.Parallel(
                [ new Effect.Move(element, {x: 0, y: 100, sync: true }),
                    new Effect.Opacity(element, { sync: true, to: 0.0 }) ],
                Object.extend(
                        { duration: 0.5,
                            beforeSetup: function(effect) {
                                effect.effects[0].element.makePositioned();
                            },
                            afterFinishInternal: function(effect) {
                                effect.effects[0].element.hide().undoPositioned().setStyle(oldStyle);
                            }
                        }, arguments[1] || { }));
    };

    Effect.Shake = function(element) {
        element = $(element);
        var options = Object.extend({
            distance: 20,
            duration: 0.5
        }, arguments[1] || {});
        var distance = parseFloat(options.distance);
        var split = parseFloat(options.duration) / 10.0;
        var oldStyle = {
            top: element.getStyle('top'),
            left: element.getStyle('left') };
        return new Effect.Move(element,
                { x:  distance, y: 0, duration: split, afterFinishInternal: function(effect) {
                    new Effect.Move(effect.element,
                            { x: -distance*2, y: 0, duration: split*2,  afterFinishInternal: function(effect) {
                                new Effect.Move(effect.element,
                                        { x:  distance*2, y: 0, duration: split*2,  afterFinishInternal: function(effect) {
                                            new Effect.Move(effect.element,
                                                    { x: -distance*2, y: 0, duration: split*2,  afterFinishInternal: function(effect) {
                                                        new Effect.Move(effect.element,
                                                                { x:  distance*2, y: 0, duration: split*2,  afterFinishInternal: function(effect) {
                                                                    new Effect.Move(effect.element,
                                                                            { x: -distance, y: 0, duration: split, afterFinishInternal: function(effect) {
                                                                                effect.element.undoPositioned().setStyle(oldStyle);
                                                                            }}); }}); }}); }}); }}); }});
    };

    Effect.SlideDown = function(element) {
        element = $(element).cleanWhitespace();
        // SlideDown need to have the content of the element wrapped in a container element with fixed height!
        var oldInnerBottom = element.down().getStyle('bottom');
        var elementDimensions = element.getDimensions();
        return new Effect.Scale(element, 100, Object.extend({
                    scaleContent: false,
                    scaleX: false,
                    scaleFrom: window.opera ? 0 : 1,
                    scaleMode: {originalHeight: elementDimensions.height, originalWidth: elementDimensions.width},
                    restoreAfterFinish: true,
                    afterSetup: function(effect) {
                        effect.element.makePositioned();
                        effect.element.down().makePositioned();
                        if (window.opera) effect.element.setStyle({top: ''});
                        effect.element.makeClipping().setStyle({height: '0px'}).show();
                    },
                    afterUpdateInternal: function(effect) {
                        effect.element.down().setStyle({bottom:
                        (effect.dims[0] - effect.element.clientHeight) + 'px' });
                    },
                    afterFinishInternal: function(effect) {
                        effect.element.undoClipping().undoPositioned();
                        effect.element.down().undoPositioned().setStyle({bottom: oldInnerBottom}); }
                }, arguments[1] || { })
        );
    };

    Effect.SlideUp = function(element) {
        element = $(element).cleanWhitespace();
        var oldInnerBottom = element.down().getStyle('bottom');
        var elementDimensions = element.getDimensions();
        return new Effect.Scale(element, window.opera ? 0 : 1,
                Object.extend({ scaleContent: false,
                    scaleX: false,
                    scaleMode: 'box',
                    scaleFrom: 100,
                    scaleMode: {originalHeight: elementDimensions.height, originalWidth: elementDimensions.width},
                    restoreAfterFinish: true,
                    afterSetup: function(effect) {
                        effect.element.makePositioned();
                        effect.element.down().makePositioned();
                        if (window.opera) effect.element.setStyle({top: ''});
                        effect.element.makeClipping().show();
                    },
                    afterUpdateInternal: function(effect) {
                        effect.element.down().setStyle({bottom:
                        (effect.dims[0] - effect.element.clientHeight) + 'px' });
                    },
                    afterFinishInternal: function(effect) {
                        effect.element.hide().undoClipping().undoPositioned();
                        effect.element.down().undoPositioned().setStyle({bottom: oldInnerBottom});
                    }
                }, arguments[1] || { })
        );
    };

    // Bug in opera makes the TD containing this element expand for a instance after finish
    Effect.Squish = function(element) {
        return new Effect.Scale(element, window.opera ? 1 : 0, {
            restoreAfterFinish: true,
            beforeSetup: function(effect) {
                effect.element.makeClipping();
            },
            afterFinishInternal: function(effect) {
                effect.element.hide().undoClipping();
            }
        });
    };

    Effect.Grow = function(element) {
        element = $(element);
        var options = Object.extend({
            direction: 'center',
            moveTransition: Effect.Transitions.sinoidal,
            scaleTransition: Effect.Transitions.sinoidal,
            opacityTransition: Effect.Transitions.full
        }, arguments[1] || { });
        var oldStyle = {
            top: element.style.top,
            left: element.style.left,
            height: element.style.height,
            width: element.style.width,
            opacity: element.getInlineOpacity() };

        var dims = element.getDimensions();
        var initialMoveX, initialMoveY;
        var moveX, moveY;

        switch (options.direction) {
            case 'top-left':
                initialMoveX = initialMoveY = moveX = moveY = 0;
                break;
            case 'top-right':
                initialMoveX = dims.width;
                initialMoveY = moveY = 0;
                moveX = -dims.width;
                break;
            case 'bottom-left':
                initialMoveX = moveX = 0;
                initialMoveY = dims.height;
                moveY = -dims.height;
                break;
            case 'bottom-right':
                initialMoveX = dims.width;
                initialMoveY = dims.height;
                moveX = -dims.width;
                moveY = -dims.height;
                break;
            case 'center':
                initialMoveX = dims.width / 2;
                initialMoveY = dims.height / 2;
                moveX = -dims.width / 2;
                moveY = -dims.height / 2;
                break;
        }

        return new Effect.Move(element, {
            x: initialMoveX,
            y: initialMoveY,
            duration: 0.01,
            beforeSetup: function(effect) {
                effect.element.hide().makeClipping().makePositioned();
            },
            afterFinishInternal: function(effect) {
                new Effect.Parallel(
                        [ new Effect.Opacity(effect.element, { sync: true, to: 1.0, from: 0.0, transition: options.opacityTransition }),
                            new Effect.Move(effect.element, { x: moveX, y: moveY, sync: true, transition: options.moveTransition }),
                            new Effect.Scale(effect.element, 100, {
                                scaleMode: { originalHeight: dims.height, originalWidth: dims.width },
                                sync: true, scaleFrom: window.opera ? 1 : 0, transition: options.scaleTransition, restoreAfterFinish: true})
                        ], Object.extend({
                            beforeSetup: function(effect) {
                                effect.effects[0].element.setStyle({height: '0px'}).show();
                            },
                            afterFinishInternal: function(effect) {
                                effect.effects[0].element.undoClipping().undoPositioned().setStyle(oldStyle);
                            }
                        }, options)
                );
            }
        });
    };

    Effect.Shrink = function(element) {
        element = $(element);
        var options = Object.extend({
            direction: 'center',
            moveTransition: Effect.Transitions.sinoidal,
            scaleTransition: Effect.Transitions.sinoidal,
            opacityTransition: Effect.Transitions.none
        }, arguments[1] || { });
        var oldStyle = {
            top: element.style.top,
            left: element.style.left,
            height: element.style.height,
            width: element.style.width,
            opacity: element.getInlineOpacity() };

        var dims = element.getDimensions();
        var moveX, moveY;

        switch (options.direction) {
            case 'top-left':
                moveX = moveY = 0;
                break;
            case 'top-right':
                moveX = dims.width;
                moveY = 0;
                break;
            case 'bottom-left':
                moveX = 0;
                moveY = dims.height;
                break;
            case 'bottom-right':
                moveX = dims.width;
                moveY = dims.height;
                break;
            case 'center':
                moveX = dims.width / 2;
                moveY = dims.height / 2;
                break;
        }

        return new Effect.Parallel(
                [ new Effect.Opacity(element, { sync: true, to: 0.0, from: 1.0, transition: options.opacityTransition }),
                    new Effect.Scale(element, window.opera ? 1 : 0, { sync: true, transition: options.scaleTransition, restoreAfterFinish: true}),
                    new Effect.Move(element, { x: moveX, y: moveY, sync: true, transition: options.moveTransition })
                ], Object.extend({
                    beforeStartInternal: function(effect) {
                        effect.effects[0].element.makePositioned().makeClipping();
                    },
                    afterFinishInternal: function(effect) {
                        effect.effects[0].element.hide().undoClipping().undoPositioned().setStyle(oldStyle); }
                }, options)
        );
    };

    Effect.Pulsate = function(element) {
        element = $(element);
        var options    = arguments[1] || { },
                oldOpacity = element.getInlineOpacity(),
                transition = options.transition || Effect.Transitions.linear,
                reverser   = function(pos){
                    return 1 - transition((-Math.cos((pos*(options.pulses||5)*2)*Math.PI)/2) + .5);
                };

        return new Effect.Opacity(element,
                Object.extend(Object.extend({  duration: 2.0, from: 0,
                    afterFinishInternal: function(effect) { effect.element.setStyle({opacity: oldOpacity}); }
                }, options), {transition: reverser}));
    };

    Effect.Fold = function(element) {
        element = $(element);
        var oldStyle = {
            top: element.style.top,
            left: element.style.left,
            width: element.style.width,
            height: element.style.height };
        element.makeClipping();
        return new Effect.Scale(element, 5, Object.extend({
            scaleContent: false,
            scaleX: false,
            afterFinishInternal: function(effect) {
                new Effect.Scale(element, 1, {
                    scaleContent: false,
                    scaleY: false,
                    afterFinishInternal: function(effect) {
                        effect.element.hide().undoClipping().setStyle(oldStyle);
                    } });
            }}, arguments[1] || { }));
    };

    Effect.Morph = Class.create(Effect.Base, {
        initialize: function(element) {
            this.element = $(element);
            if (!this.element) throw(Effect._elementDoesNotExistError);
            var options = Object.extend({
                style: { }
            }, arguments[1] || { });

            if (!Object.isString(options.style)) this.style = $H(options.style);
            else {
                if (options.style.include(':'))
                    this.style = options.style.parseStyle();
                else {
                    this.element.addClassName(options.style);
                    this.style = $H(this.element.getStyles());
                    this.element.removeClassName(options.style);
                    var css = this.element.getStyles();
                    this.style = this.style.reject(function(style) {
                        return style.value == css[style.key];
                    });
                    options.afterFinishInternal = function(effect) {
                        effect.element.addClassName(effect.options.style);
                        effect.transforms.each(function(transform) {
                            effect.element.style[transform.style] = '';
                        });
                    };
                }
            }
            this.start(options);
        },

        setup: function(){
            function parseColor(color){
                if (!color || ['rgba(0, 0, 0, 0)','transparent'].include(color)) color = '#ffffff';
                color = color.parseColor();
                return $R(0,2).map(function(i){
                    return parseInt( color.slice(i*2+1,i*2+3), 16 );
                });
            }
            this.transforms = this.style.map(function(pair){
                var property = pair[0], value = pair[1], unit = null;

                if (value.parseColor('#zzzzzz') != '#zzzzzz') {
                    value = value.parseColor();
                    unit  = 'color';
                } else if (property == 'opacity') {
                    value = parseFloat(value);
                    if (Prototype.Browser.IE && (!this.element.currentStyle.hasLayout))
                        this.element.setStyle({zoom: 1});
                } else if (Element.CSS_LENGTH.test(value)) {
                    var components = value.match(/^([\+\-]?[0-9\.]+)(.*)$/);
                    value = parseFloat(components[1]);
                    unit = (components.length == 3) ? components[2] : null;
                }

                var originalValue = this.element.getStyle(property);
                return {
                    style: property.camelize(),
                    originalValue: unit=='color' ? parseColor(originalValue) : parseFloat(originalValue || 0),
                    targetValue: unit=='color' ? parseColor(value) : value,
                    unit: unit
                };
            }.bind(this)).reject(function(transform){
                return (
                        (transform.originalValue == transform.targetValue) ||
                        (
                                transform.unit != 'color' &&
                                (isNaN(transform.originalValue) || isNaN(transform.targetValue))
                        )
                );
            });
        },
        update: function(position) {
            var style = { }, transform, i = this.transforms.length;
            while(i--)
                style[(transform = this.transforms[i]).style] =
                        transform.unit=='color' ? '#'+
                        (Math.round(transform.originalValue[0]+
                                (transform.targetValue[0]-transform.originalValue[0])*position)).toColorPart() +
                        (Math.round(transform.originalValue[1]+
                                (transform.targetValue[1]-transform.originalValue[1])*position)).toColorPart() +
                        (Math.round(transform.originalValue[2]+
                                (transform.targetValue[2]-transform.originalValue[2])*position)).toColorPart() :
                        (transform.originalValue +
                        (transform.targetValue - transform.originalValue) * position).toFixed(3) +
                        (transform.unit === null ? '' : transform.unit);
            this.element.setStyle(style, true);
        }
    });

    Effect.Transform = Class.create({
        initialize: function(tracks){
            this.tracks  = [];
            this.options = arguments[1] || { };
            this.addTracks(tracks);
        },
        addTracks: function(tracks){
            tracks.each(function(track){
                track = $H(track);
                var data = track.values().first();
                this.tracks.push($H({
                    ids:     track.keys().first(),
                    effect:  Effect.Morph,
                    options: { style: data }
                }));
            }.bind(this));
            return this;
        },
        play: function(){
            return new Effect.Parallel(
                    this.tracks.map(function(track){
                        var ids = track.get('ids'), effect = track.get('effect'), options = track.get('options');
                        var elements = [$(ids) || $$(ids)].flatten();
                        return elements.map(function(e){ return new effect(e, Object.extend({ sync:true }, options)) });
                    }).flatten(),
                    this.options
            );
        }
    });

    Element.CSS_PROPERTIES = $w(
            'backgroundColor backgroundPosition borderBottomColor borderBottomStyle ' +
            'borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth ' +
            'borderRightColor borderRightStyle borderRightWidth borderSpacing ' +
            'borderTopColor borderTopStyle borderTopWidth bottom clip color ' +
            'fontSize fontWeight height left letterSpacing lineHeight ' +
            'marginBottom marginLeft marginRight marginTop markerOffset maxHeight '+
            'maxWidth minHeight minWidth opacity outlineColor outlineOffset ' +
            'outlineWidth paddingBottom paddingLeft paddingRight paddingTop ' +
            'right textIndent top width wordSpacing zIndex');

    Element.CSS_LENGTH = /^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;

    String.__parseStyleElement = document.createElement('div');
    String.prototype.parseStyle = function(){
        var style, styleRules = $H();
        if (Prototype.Browser.WebKit)
            style = new Element('div',{style:this}).style;
        else {
            String.__parseStyleElement.innerHTML = '<div style="' + this + '"></div>';
            style = String.__parseStyleElement.childNodes[0].style;
        }

        Element.CSS_PROPERTIES.each(function(property){
            if (style[property]) styleRules.set(property, style[property]);
        });

        if (Prototype.Browser.IE && this.include('opacity'))
            styleRules.set('opacity', this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);

        return styleRules;
    };

    if (document.defaultView && document.defaultView.getComputedStyle) {
        Element.getStyles = function(element) {
            var css = document.defaultView.getComputedStyle($(element), null);
            return Element.CSS_PROPERTIES.inject({ }, function(styles, property) {
                styles[property] = css[property];
                return styles;
            });
        };
    } else {
        Element.getStyles = function(element) {
            element = $(element);
            var css = element.currentStyle, styles;
            styles = Element.CSS_PROPERTIES.inject({ }, function(results, property) {
                results[property] = css[property];
                return results;
            });
            if (!styles.opacity) styles.opacity = element.getOpacity();
            return styles;
        };
    }

    Effect.Methods = {
        morph: function(element, style) {
            element = $(element);
            new Effect.Morph(element, Object.extend({ style: style }, arguments[2] || { }));
            return element;
        },
        visualEffect: function(element, effect, options) {
            element = $(element);
            var s = effect.dasherize().camelize(), klass = s.charAt(0).toUpperCase() + s.substring(1);
            new Effect[klass](element, options);
            return element;
        },
        highlight: function(element, options) {
            element = $(element);
            new Effect.Highlight(element, options);
            return element;
        }
    };

    $w('fade appear grow shrink fold blindUp blindDown slideUp slideDown '+
            'pulsate shake puff squish switchOff dropOut').each(
            function(effect) {
                Effect.Methods[effect] = function(element, options){
                    element = $(element);
                    Effect[effect.charAt(0).toUpperCase() + effect.substring(1)](element, options);
                    return element;
                };
            }
    );

    $w('getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles').each(
            function(f) { Effect.Methods[f] = Element[f]; }
    );

    Element.addMethods(Effect.Methods);</script> <script type="text/javascript"  style="display:none">// script.aculo.us dragdrop.js v1.9.0, Thu Dec 23 16:54:48 -0500 2010

    // Copyright (c) 2005-2010 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)
    //
    // script.aculo.us is freely distributable under the terms of an MIT-style license.
    // For details, see the script.aculo.us web site: http://script.aculo.us/

    if(Object.isUndefined(Effect))
        throw("dragdrop.js requires including script.aculo.us' effects.js library");

    var Droppables = {
        drops: [],

        remove: function(element) {
            this.drops = this.drops.reject(function(d) { return d.element==$(element) });
        },

        add: function(element) {
            element = $(element);
            var options = Object.extend({
                greedy:     true,
                hoverclass: null,
                tree:       false
            }, arguments[1] || { });

            // cache containers
            if(options.containment) {
                options._containers = [];
                var containment = options.containment;
                if(Object.isArray(containment)) {
                    containment.each( function(c) { options._containers.push($(c)) });
                } else {
                    options._containers.push($(containment));
                }
            }

            if(options.accept) options.accept = [options.accept].flatten();

            Element.makePositioned(element); // fix IE
            options.element = element;

            this.drops.push(options);
        },

        findDeepestChild: function(drops) {
            deepest = drops[0];

            for (i = 1; i < drops.length; ++i)
                if (Element.isParent(drops[i].element, deepest.element))
                    deepest = drops[i];

            return deepest;
        },

        isContained: function(element, drop) {
            var containmentNode;
            if(drop.tree) {
                containmentNode = element.treeNode;
            } else {
                containmentNode = element.parentNode;
            }
            return drop._containers.detect(function(c) { return containmentNode == c });
        },

        isAffected: function(point, element, drop) {
            return (
            (drop.element!=element) &&
            ((!drop._containers) ||
            this.isContained(element, drop)) &&
            ((!drop.accept) ||
            (Element.classNames(element).detect(
                    function(v) { return drop.accept.include(v) } ) )) &&
            Position.within(drop.element, point[0], point[1]) );
        },

        deactivate: function(drop) {
            if(drop.hoverclass)
                Element.removeClassName(drop.element, drop.hoverclass);
            this.last_active = null;
        },

        activate: function(drop) {
            if(drop.hoverclass)
                Element.addClassName(drop.element, drop.hoverclass);
            this.last_active = drop;
        },

        show: function(point, element) {
            if(!this.drops.length) return;
            var drop, affected = [];

            this.drops.each( function(drop) {
                if(Droppables.isAffected(point, element, drop))
                    affected.push(drop);
            });

            if(affected.length>0)
                drop = Droppables.findDeepestChild(affected);

            if(this.last_active && this.last_active != drop) this.deactivate(this.last_active);
            if (drop) {
                Position.within(drop.element, point[0], point[1]);
                if(drop.onHover)
                    drop.onHover(element, drop.element, Position.overlap(drop.overlap, drop.element));

                if (drop != this.last_active) Droppables.activate(drop);
            }
        },

        fire: function(event, element) {
            if(!this.last_active) return;
            Position.prepare();

            if (this.isAffected([Event.pointerX(event), Event.pointerY(event)], element, this.last_active))
                if (this.last_active.onDrop) {
                    this.last_active.onDrop(element, this.last_active.element, event);
                    return true;
                }
        },

        reset: function() {
            if(this.last_active)
                this.deactivate(this.last_active);
        }
    };

    var Draggables = {
        drags: [],
        observers: [],

        register: function(draggable) {
            if(this.drags.length == 0) {
                this.eventMouseUp   = this.endDrag.bindAsEventListener(this);
                this.eventMouseMove = this.updateDrag.bindAsEventListener(this);
                this.eventKeypress  = this.keyPress.bindAsEventListener(this);

                Event.observe(document, "mouseup", this.eventMouseUp);
                Event.observe(document, "mousemove", this.eventMouseMove);
                Event.observe(document, "keypress", this.eventKeypress);
            }
            this.drags.push(draggable);
        },

        unregister: function(draggable) {
            this.drags = this.drags.reject(function(d) { return d==draggable });
            if(this.drags.length == 0) {
                Event.stopObserving(document, "mouseup", this.eventMouseUp);
                Event.stopObserving(document, "mousemove", this.eventMouseMove);
                Event.stopObserving(document, "keypress", this.eventKeypress);
            }
        },

        activate: function(draggable) {
            if(draggable.options.delay) {
                this._timeout = setTimeout(function() {
                    Draggables._timeout = null;
                    window.focus();
                    Draggables.activeDraggable = draggable;
                }.bind(this), draggable.options.delay);
            } else {
                window.focus(); // allows keypress events if window isn't currently focused, fails for Safari
                this.activeDraggable = draggable;
            }
        },

        deactivate: function() {
            this.activeDraggable = null;
        },

        updateDrag: function(event) {
            if(!this.activeDraggable) return;
            var pointer = [Event.pointerX(event), Event.pointerY(event)];
            // Mozilla-based browsers fire successive mousemove events with
            // the same coordinates, prevent needless redrawing (moz bug?)
            if(this._lastPointer && (this._lastPointer.inspect() == pointer.inspect())) return;
            this._lastPointer = pointer;

            this.activeDraggable.updateDrag(event, pointer);
        },

        endDrag: function(event) {
            if(this._timeout) {
                clearTimeout(this._timeout);
                this._timeout = null;
            }
            if(!this.activeDraggable) return;
            this._lastPointer = null;
            this.activeDraggable.endDrag(event);
            this.activeDraggable = null;
        },

        keyPress: function(event) {
            if(this.activeDraggable)
                this.activeDraggable.keyPress(event);
        },

        addObserver: function(observer) {
            this.observers.push(observer);
            this._cacheObserverCallbacks();
        },

        removeObserver: function(element) {  // element instead of observer fixes mem leaks
            this.observers = this.observers.reject( function(o) { return o.element==element });
            this._cacheObserverCallbacks();
        },

        notify: function(eventName, draggable, event) {  // 'onStart', 'onEnd', 'onDrag'
            if(this[eventName+'Count'] > 0)
                this.observers.each( function(o) {
                    if(o[eventName]) o[eventName](eventName, draggable, event);
                });
            if(draggable.options[eventName]) draggable.options[eventName](draggable, event);
        },

        _cacheObserverCallbacks: function() {
            ['onStart','onEnd','onDrag'].each( function(eventName) {
                Draggables[eventName+'Count'] = Draggables.observers.select(
                        function(o) { return o[eventName]; }
                ).length;
            });
        }
    };

    /*--------------------------------------------------------------------------*/

    var Draggable = Class.create({
        initialize: function(element) {
            var defaults = {
                handle: false,
                reverteffect: function(element, top_offset, left_offset) {
                    var dur = Math.sqrt(Math.abs(top_offset^2)+Math.abs(left_offset^2))*0.02;
                    new Effect.Move(element, { x: -left_offset, y: -top_offset, duration: dur,
                        queue: {scope:'_draggable', position:'end'}
                    });
                },
                endeffect: function(element) {
                    var toOpacity = Object.isNumber(element._opacity) ? element._opacity : 1.0;
                    new Effect.Opacity(element, {duration:0.2, from:0.7, to:toOpacity,
                        queue: {scope:'_draggable', position:'end'},
                        afterFinish: function(){
                            Draggable._dragging[element] = false
                        }
                    });
                },
                zindex: 1000,
                revert: false,
                quiet: false,
                scroll: false,
                scrollSensitivity: 20,
                scrollSpeed: 15,
                snap: false,  // false, or xy or [x,y] or function(x,y){ return [x,y] }
                delay: 0
            };

            if(!arguments[1] || Object.isUndefined(arguments[1].endeffect))
                Object.extend(defaults, {
                    starteffect: function(element) {
                        element._opacity = Element.getOpacity(element);
                        Draggable._dragging[element] = true;
                        new Effect.Opacity(element, {duration:0.2, from:element._opacity, to:0.7});
                    }
                });

            var options = Object.extend(defaults, arguments[1] || { });

            this.element = $(element);

            if(options.handle && Object.isString(options.handle))
                this.handle = this.element.down('.'+options.handle, 0);

            if(!this.handle) this.handle = $(options.handle);
            if(!this.handle) this.handle = this.element;

            if(options.scroll && !options.scroll.scrollTo && !options.scroll.outerHTML) {
                options.scroll = $(options.scroll);
                this._isScrollChild = Element.childOf(this.element, options.scroll);
            }

            Element.makePositioned(this.element); // fix IE

            this.options  = options;
            this.dragging = false;

            this.eventMouseDown = this.initDrag.bindAsEventListener(this);
            Event.observe(this.handle, "mousedown", this.eventMouseDown);

            Draggables.register(this);
        },

        destroy: function() {
            Event.stopObserving(this.handle, "mousedown", this.eventMouseDown);
            Draggables.unregister(this);
        },

        currentDelta: function() {
            return([
                parseInt(Element.getStyle(this.element,'left') || '0'),
                parseInt(Element.getStyle(this.element,'top') || '0')]);
        },

        initDrag: function(event) {
            if(!Object.isUndefined(Draggable._dragging[this.element]) &&
                    Draggable._dragging[this.element]) return;
            if(Event.isLeftClick(event)) {
                // abort on form elements, fixes a Firefox issue
                var src = Event.element(event);
                if((tag_name = src.tagName.toUpperCase()) && (
                        tag_name=='INPUT' ||
                        tag_name=='SELECT' ||
                        tag_name=='OPTION' ||
                        tag_name=='BUTTON' ||
                        tag_name=='TEXTAREA')) return;

                var pointer = [Event.pointerX(event), Event.pointerY(event)];
                var pos     = this.element.cumulativeOffset();
                this.offset = [0,1].map( function(i) { return (pointer[i] - pos[i]) });

                Draggables.activate(this);
                Event.stop(event);
            }
        },

        startDrag: function(event) {
            this.dragging = true;
            if(!this.delta)
                this.delta = this.currentDelta();

            if(this.options.zindex) {
                this.originalZ = parseInt(Element.getStyle(this.element,'z-index') || 0);
                this.element.style.zIndex = this.options.zindex;
            }

            if(this.options.ghosting) {
                this._clone = this.element.cloneNode(true);
                this._originallyAbsolute = (this.element.getStyle('position') == 'absolute');
                if (!this._originallyAbsolute)
                    Position.absolutize(this.element);
                this.element.parentNode.insertBefore(this._clone, this.element);
            }

            if(this.options.scroll) {
                if (this.options.scroll == window) {
                    var where = this._getWindowScroll(this.options.scroll);
                    this.originalScrollLeft = where.left;
                    this.originalScrollTop = where.top;
                } else {
                    this.originalScrollLeft = this.options.scroll.scrollLeft;
                    this.originalScrollTop = this.options.scroll.scrollTop;
                }
            }

            Draggables.notify('onStart', this, event);

            if(this.options.starteffect) this.options.starteffect(this.element);
        },

        updateDrag: function(event, pointer) {
            if(!this.dragging) this.startDrag(event);

            if(!this.options.quiet){
                Position.prepare();
                Droppables.show(pointer, this.element);
            }

            Draggables.notify('onDrag', this, event);

            this.draw(pointer);
            if(this.options.change) this.options.change(this);

            if(this.options.scroll) {
                this.stopScrolling();

                var p;
                if (this.options.scroll == window) {
                    with(this._getWindowScroll(this.options.scroll)) { p = [ left, top, left+width, top+height ]; }
                } else {
                    p = Position.page(this.options.scroll).toArray();
                    p[0] += this.options.scroll.scrollLeft + Position.deltaX;
                    p[1] += this.options.scroll.scrollTop + Position.deltaY;
                    p.push(p[0]+this.options.scroll.offsetWidth);
                    p.push(p[1]+this.options.scroll.offsetHeight);
                }
                var speed = [0,0];
                if(pointer[0] < (p[0]+this.options.scrollSensitivity)) speed[0] = pointer[0]-(p[0]+this.options.scrollSensitivity);
                if(pointer[1] < (p[1]+this.options.scrollSensitivity)) speed[1] = pointer[1]-(p[1]+this.options.scrollSensitivity);
                if(pointer[0] > (p[2]-this.options.scrollSensitivity)) speed[0] = pointer[0]-(p[2]-this.options.scrollSensitivity);
                if(pointer[1] > (p[3]-this.options.scrollSensitivity)) speed[1] = pointer[1]-(p[3]-this.options.scrollSensitivity);
                this.startScrolling(speed);
            }

            // fix AppleWebKit rendering
            if(Prototype.Browser.WebKit) window.scrollBy(0,0);

            Event.stop(event);
        },

        finishDrag: function(event, success) {
            this.dragging = false;

            if(this.options.quiet){
                Position.prepare();
                var pointer = [Event.pointerX(event), Event.pointerY(event)];
                Droppables.show(pointer, this.element);
            }

            if(this.options.ghosting) {
                if (!this._originallyAbsolute)
                    Position.relativize(this.element);
                delete this._originallyAbsolute;
                Element.remove(this._clone);
                this._clone = null;
            }

            var dropped = false;
            if(success) {
                dropped = Droppables.fire(event, this.element);
                if (!dropped) dropped = false;
            }
            if(dropped && this.options.onDropped) this.options.onDropped(this.element);
            Draggables.notify('onEnd', this, event);

            var revert = this.options.revert;
            if(revert && Object.isFunction(revert)) revert = revert(this.element);

            var d = this.currentDelta();
            if(revert && this.options.reverteffect) {
                if (dropped == 0 || revert != 'failure')
                    this.options.reverteffect(this.element,
                            d[1]-this.delta[1], d[0]-this.delta[0]);
            } else {
                this.delta = d;
            }

            if(this.options.zindex)
                this.element.style.zIndex = this.originalZ;

            if(this.options.endeffect)
                this.options.endeffect(this.element);

            Draggables.deactivate(this);
            Droppables.reset();
        },

        keyPress: function(event) {
            if(event.keyCode!=Event.KEY_ESC) return;
            this.finishDrag(event, false);
            Event.stop(event);
        },

        endDrag: function(event) {
            if(!this.dragging) return;
            this.stopScrolling();
            this.finishDrag(event, true);
            Event.stop(event);
        },

        draw: function(point) {
            var pos = this.element.cumulativeOffset();
            if(this.options.ghosting) {
                var r   = Position.realOffset(this.element);
                pos[0] += r[0] - Position.deltaX; pos[1] += r[1] - Position.deltaY;
            }

            var d = this.currentDelta();
            pos[0] -= d[0]; pos[1] -= d[1];

            if(this.options.scroll && (this.options.scroll != window && this._isScrollChild)) {
                pos[0] -= this.options.scroll.scrollLeft-this.originalScrollLeft;
                pos[1] -= this.options.scroll.scrollTop-this.originalScrollTop;
            }

            var p = [0,1].map(function(i){
                return (point[i]-pos[i]-this.offset[i])
            }.bind(this));

            if(this.options.snap) {
                if(Object.isFunction(this.options.snap)) {
                    p = this.options.snap(p[0],p[1],this);
                } else {
                    if(Object.isArray(this.options.snap)) {
                        p = p.map( function(v, i) {
                            return (v/this.options.snap[i]).round()*this.options.snap[i] }.bind(this));
                    } else {
                        p = p.map( function(v) {
                            return (v/this.options.snap).round()*this.options.snap }.bind(this));
                    }
                }}

            var style = this.element.style;
            if((!this.options.constraint) || (this.options.constraint=='horizontal'))
                style.left = p[0] + "px";
            if((!this.options.constraint) || (this.options.constraint=='vertical'))
                style.top  = p[1] + "px";

            if(style.visibility=="hidden") style.visibility = ""; // fix gecko rendering
        },

        stopScrolling: function() {
            if(this.scrollInterval) {
                clearInterval(this.scrollInterval);
                this.scrollInterval = null;
                Draggables._lastScrollPointer = null;
            }
        },

        startScrolling: function(speed) {
            if(!(speed[0] || speed[1])) return;
            this.scrollSpeed = [speed[0]*this.options.scrollSpeed,speed[1]*this.options.scrollSpeed];
            this.lastScrolled = new Date();
            this.scrollInterval = setInterval(this.scroll.bind(this), 10);
        },

        scroll: function() {
            var current = new Date();
            var delta = current - this.lastScrolled;
            this.lastScrolled = current;
            if(this.options.scroll == window) {
                with (this._getWindowScroll(this.options.scroll)) {
                    if (this.scrollSpeed[0] || this.scrollSpeed[1]) {
                        var d = delta / 1000;
                        this.options.scroll.scrollTo( left + d*this.scrollSpeed[0], top + d*this.scrollSpeed[1] );
                    }
                }
            } else {
                this.options.scroll.scrollLeft += this.scrollSpeed[0] * delta / 1000;
                this.options.scroll.scrollTop  += this.scrollSpeed[1] * delta / 1000;
            }

            Position.prepare();
            Droppables.show(Draggables._lastPointer, this.element);
            Draggables.notify('onDrag', this);
            if (this._isScrollChild) {
                Draggables._lastScrollPointer = Draggables._lastScrollPointer || $A(Draggables._lastPointer);
                Draggables._lastScrollPointer[0] += this.scrollSpeed[0] * delta / 1000;
                Draggables._lastScrollPointer[1] += this.scrollSpeed[1] * delta / 1000;
                if (Draggables._lastScrollPointer[0] < 0)
                    Draggables._lastScrollPointer[0] = 0;
                if (Draggables._lastScrollPointer[1] < 0)
                    Draggables._lastScrollPointer[1] = 0;
                this.draw(Draggables._lastScrollPointer);
            }

            if(this.options.change) this.options.change(this);
        },

        _getWindowScroll: function(w) {
            var T, L, W, H;
            with (w.document) {
                if (w.document.documentElement && documentElement.scrollTop) {
                    T = documentElement.scrollTop;
                    L = documentElement.scrollLeft;
                } else if (w.document.body) {
                    T = body.scrollTop;
                    L = body.scrollLeft;
                }
                if (w.innerWidth) {
                    W = w.innerWidth;
                    H = w.innerHeight;
                } else if (w.document.documentElement && documentElement.clientWidth) {
                    W = documentElement.clientWidth;
                    H = documentElement.clientHeight;
                } else {
                    W = body.offsetWidth;
                    H = body.offsetHeight;
                }
            }
            return { top: T, left: L, width: W, height: H };
        }
    });

    Draggable._dragging = { };

    /*--------------------------------------------------------------------------*/

    var SortableObserver = Class.create({
        initialize: function(element, observer) {
            this.element   = $(element);
            this.observer  = observer;
            this.lastValue = Sortable.serialize(this.element);
        },

        onStart: function() {
            this.lastValue = Sortable.serialize(this.element);
        },

        onEnd: function() {
            Sortable.unmark();
            if(this.lastValue != Sortable.serialize(this.element))
                this.observer(this.element)
        }
    });

    var Sortable = {
        SERIALIZE_RULE: /^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,

        sortables: { },

        _findRootElement: function(element) {
            while (element.tagName.toUpperCase() != "BODY") {
                if(element.id && Sortable.sortables[element.id]) return element;
                element = element.parentNode;
            }
        },

        options: function(element) {
            element = Sortable._findRootElement($(element));
            if(!element) return;
            return Sortable.sortables[element.id];
        },

        destroy: function(element){
            element = $(element);
            var s = Sortable.sortables[element.id];

            if(s) {
                Draggables.removeObserver(s.element);
                s.droppables.each(function(d){ Droppables.remove(d) });
                s.draggables.invoke('destroy');

                delete Sortable.sortables[s.element.id];
            }
        },

        create: function(element) {
            element = $(element);
            var options = Object.extend({
                element:     element,
                tag:         'li',       // assumes li children, override with tag: 'tagname'
                dropOnEmpty: false,
                tree:        false,
                treeTag:     'ul',
                overlap:     'vertical', // one of 'vertical', 'horizontal'
                constraint:  'vertical', // one of 'vertical', 'horizontal', false
                containment: element,    // also takes array of elements (or id's); or false
                handle:      false,      // or a CSS class
                only:        false,
                delay:       0,
                hoverclass:  null,
                ghosting:    false,
                quiet:       false,
                scroll:      false,
                scrollSensitivity: 20,
                scrollSpeed: 15,
                format:      this.SERIALIZE_RULE,

                // these take arrays of elements or ids and can be
                // used for better initialization performance
                elements:    false,
                handles:     false,

                onChange:    Prototype.emptyFunction,
                onUpdate:    Prototype.emptyFunction
            }, arguments[1] || { });

            // clear any old sortable with same element
            this.destroy(element);

            // build options for the draggables
            var options_for_draggable = {
                revert:      true,
                quiet:       options.quiet,
                scroll:      options.scroll,
                scrollSpeed: options.scrollSpeed,
                scrollSensitivity: options.scrollSensitivity,
                delay:       options.delay,
                ghosting:    options.ghosting,
                constraint:  options.constraint,
                handle:      options.handle };

            if(options.starteffect)
                options_for_draggable.starteffect = options.starteffect;

            if(options.reverteffect)
                options_for_draggable.reverteffect = options.reverteffect;
            else
            if(options.ghosting) options_for_draggable.reverteffect = function(element) {
                element.style.top  = 0;
                element.style.left = 0;
            };

            if(options.endeffect)
                options_for_draggable.endeffect = options.endeffect;

            if(options.zindex)
                options_for_draggable.zindex = options.zindex;

            // build options for the droppables
            var options_for_droppable = {
                overlap:     options.overlap,
                containment: options.containment,
                tree:        options.tree,
                hoverclass:  options.hoverclass,
                onHover:     Sortable.onHover
            };

            var options_for_tree = {
                onHover:      Sortable.onEmptyHover,
                overlap:      options.overlap,
                containment:  options.containment,
                hoverclass:   options.hoverclass
            };

            // fix for gecko engine
            Element.cleanWhitespace(element);

            options.draggables = [];
            options.droppables = [];

            // drop on empty handling
            if(options.dropOnEmpty || options.tree) {
                Droppables.add(element, options_for_tree);
                options.droppables.push(element);
            }

            (options.elements || this.findElements(element, options) || []).each( function(e,i) {
                var handle = options.handles ? $(options.handles[i]) :
                        (options.handle ? $(e).select('.' + options.handle)[0] : e);
                options.draggables.push(
                        new Draggable(e, Object.extend(options_for_draggable, { handle: handle })));
                Droppables.add(e, options_for_droppable);
                if(options.tree) e.treeNode = element;
                options.droppables.push(e);
            });

            if(options.tree) {
                (Sortable.findTreeElements(element, options) || []).each( function(e) {
                    Droppables.add(e, options_for_tree);
                    e.treeNode = element;
                    options.droppables.push(e);
                });
            }

            // keep reference
            this.sortables[element.identify()] = options;

            // for onupdate
            Draggables.addObserver(new SortableObserver(element, options.onUpdate));

        },

        // return all suitable-for-sortable elements in a guaranteed order
        findElements: function(element, options) {
            return Element.findChildren(
                    element, options.only, options.tree ? true : false, options.tag);
        },

        findTreeElements: function(element, options) {
            return Element.findChildren(
                    element, options.only, options.tree ? true : false, options.treeTag);
        },

        onHover: function(element, dropon, overlap) {
            if(Element.isParent(dropon, element)) return;

            if(overlap > .33 && overlap < .66 && Sortable.options(dropon).tree) {
                return;
            } else if(overlap>0.5) {
                Sortable.mark(dropon, 'before');
                if(dropon.previousSibling != element) {
                    var oldParentNode = element.parentNode;
                    element.style.visibility = "hidden"; // fix gecko rendering
                    dropon.parentNode.insertBefore(element, dropon);
                    if(dropon.parentNode!=oldParentNode)
                        Sortable.options(oldParentNode).onChange(element);
                    Sortable.options(dropon.parentNode).onChange(element);
                }
            } else {
                Sortable.mark(dropon, 'after');
                var nextElement = dropon.nextSibling || null;
                if(nextElement != element) {
                    var oldParentNode = element.parentNode;
                    element.style.visibility = "hidden"; // fix gecko rendering
                    dropon.parentNode.insertBefore(element, nextElement);
                    if(dropon.parentNode!=oldParentNode)
                        Sortable.options(oldParentNode).onChange(element);
                    Sortable.options(dropon.parentNode).onChange(element);
                }
            }
        },

        onEmptyHover: function(element, dropon, overlap) {
            var oldParentNode = element.parentNode;
            var droponOptions = Sortable.options(dropon);

            if(!Element.isParent(dropon, element)) {
                var index;

                var children = Sortable.findElements(dropon, {tag: droponOptions.tag, only: droponOptions.only});
                var child = null;

                if(children) {
                    var offset = Element.offsetSize(dropon, droponOptions.overlap) * (1.0 - overlap);

                    for (index = 0; index < children.length; index += 1) {
                        if (offset - Element.offsetSize (children[index], droponOptions.overlap) >= 0) {
                            offset -= Element.offsetSize (children[index], droponOptions.overlap);
                        } else if (offset - (Element.offsetSize (children[index], droponOptions.overlap) / 2) >= 0) {
                            child = index + 1 < children.length ? children[index + 1] : null;
                            break;
                        } else {
                            child = children[index];
                            break;
                        }
                    }
                }

                dropon.insertBefore(element, child);

                Sortable.options(oldParentNode).onChange(element);
                droponOptions.onChange(element);
            }
        },

        unmark: function() {
            if(Sortable._marker) Sortable._marker.hide();
        },

        mark: function(dropon, position) {
            // mark on ghosting only
            var sortable = Sortable.options(dropon.parentNode);
            if(sortable && !sortable.ghosting) return;

            if(!Sortable._marker) {
                Sortable._marker =
                        ($('dropmarker') || Element.extend(document.createElement('DIV'))).
                        hide().addClassName('dropmarker').setStyle({position:'absolute'});
                document.getElementsByTagName("body").item(0).appendChild(Sortable._marker);
            }
            var offsets = dropon.cumulativeOffset();
            Sortable._marker.setStyle({left: offsets[0]+'px', top: offsets[1] + 'px'});

            if(position=='after')
                if(sortable.overlap == 'horizontal')
                    Sortable._marker.setStyle({left: (offsets[0]+dropon.clientWidth) + 'px'});
                else
                    Sortable._marker.setStyle({top: (offsets[1]+dropon.clientHeight) + 'px'});

            Sortable._marker.show();
        },

        _tree: function(element, options, parent) {
            var children = Sortable.findElements(element, options) || [];

            for (var i = 0; i < children.length; ++i) {
                var match = children[i].id.match(options.format);

                if (!match) continue;

                var child = {
                    id: encodeURIComponent(match ? match[1] : null),
                    element: element,
                    parent: parent,
                    children: [],
                    position: parent.children.length,
                    container: $(children[i]).down(options.treeTag)
                };

                /* Get the element containing the children and recurse over it */
                if (child.container)
                    this._tree(child.container, options, child);

                parent.children.push (child);
            }

            return parent;
        },

        tree: function(element) {
            element = $(element);
            var sortableOptions = this.options(element);
            var options = Object.extend({
                tag: sortableOptions.tag,
                treeTag: sortableOptions.treeTag,
                only: sortableOptions.only,
                name: element.id,
                format: sortableOptions.format
            }, arguments[1] || { });

            var root = {
                id: null,
                parent: null,
                children: [],
                container: element,
                position: 0
            };

            return Sortable._tree(element, options, root);
        },

        /* Construct a [i] index for a particular node */
        _constructIndex: function(node) {
            var index = '';
            do {
                if (node.id) index = '[' + node.position + ']' + index;
            } while ((node = node.parent) != null);
            return index;
        },

        sequence: function(element) {
            element = $(element);
            var options = Object.extend(this.options(element), arguments[1] || { });

            return $(this.findElements(element, options) || []).map( function(item) {
                return item.id.match(options.format) ? item.id.match(options.format)[1] : '';
            });
        },

        setSequence: function(element, new_sequence) {
            element = $(element);
            var options = Object.extend(this.options(element), arguments[2] || { });

            var nodeMap = { };
            this.findElements(element, options).each( function(n) {
                if (n.id.match(options.format))
                    nodeMap[n.id.match(options.format)[1]] = [n, n.parentNode];
                n.parentNode.removeChild(n);
            });

            new_sequence.each(function(ident) {
                var n = nodeMap[ident];
                if (n) {
                    n[1].appendChild(n[0]);
                    delete nodeMap[ident];
                }
            });
        },

        serialize: function(element) {
            element = $(element);
            var options = Object.extend(Sortable.options(element), arguments[1] || { });
            var name = encodeURIComponent(
                    (arguments[1] && arguments[1].name) ? arguments[1].name : element.id);

            if (options.tree) {
                return Sortable.tree(element, arguments[1]).children.map( function (item) {
                    return [name + Sortable._constructIndex(item) + "[id]=" +
                    encodeURIComponent(item.id)].concat(item.children.map(arguments.callee));
                }).flatten().join('&');
            } else {
                return Sortable.sequence(element, arguments[1]).map( function(item) {
                    return name + "[]=" + encodeURIComponent(item);
                }).join('&');
            }
        }
    };

    // Returns true if child is contained within element
    Element.isParent = function(child, element) {
        if (!child.parentNode || child == element) return false;
        if (child.parentNode == element) return true;
        return Element.isParent(child.parentNode, element);
    };

    Element.findChildren = function(element, only, recursive, tagName) {
        if(!element.hasChildNodes()) return null;
        tagName = tagName.toUpperCase();
        if(only) only = [only].flatten();
        var elements = [];
        $A(element.childNodes).each( function(e) {
            if(e.tagName && e.tagName.toUpperCase()==tagName &&
                    (!only || (Element.classNames(e).detect(function(v) { return only.include(v) }))))
                elements.push(e);
            if(recursive) {
                var grandchildren = Element.findChildren(e, only, recursive, tagName);
                if(grandchildren) elements.push(grandchildren);
            }
        });

        return (elements.length>0 ? elements.flatten() : []);
    };

    Element.offsetSize = function (element, type) {
        return element['offset' + ((type=='vertical' || type=='height') ? 'Height' : 'Width')];
    };</script> <script type="text/javascript"  style="display:none">// script.aculo.us controls.js v1.8.2, Tue Nov 18 18:30:58 +0100 2008

    // Copyright (c) 2005-2008 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)
    //           (c) 2005-2008 Ivan Krstic (http://blogs.law.harvard.edu/ivan)
    //           (c) 2005-2008 Jon Tirsen (http://www.tirsen.com)
    // Contributors:
    //  Richard Livsey
    //  Rahul Bhargava
    //  Rob Wills
    //
    // script.aculo.us is freely distributable under the terms of an MIT-style license.
    // For details, see the script.aculo.us web site: http://script.aculo.us/

    // Autocompleter.Base handles all the autocompletion functionality
    // that's independent of the data source for autocompletion. This
    // includes drawing the autocompletion menu, observing keyboard
    // and mouse events, and similar.
    //
    // Specific autocompleters need to provide, at the very least,
    // a getUpdatedChoices function that will be invoked every time
    // the text inside the monitored textbox changes. This method
    // should get the text for which to provide autocompletion by
    // invoking this.getToken(), NOT by directly accessing
    // this.element.value. This is to allow incremental tokenized
    // autocompletion. Specific auto-completion logic (AJAX, etc)
    // belongs in getUpdatedChoices.
    //
    // Tokenized incremental autocompletion is enabled automatically
    // when an autocompleter is instantiated with the 'tokens' option
    // in the options parameter, e.g.:
    // new Ajax.Autocompleter('id','upd', '/url/', { tokens: ',' });
    // will incrementally autocomplete with a comma as the token.
    // Additionally, ',' in the above example can be replaced with
    // a token array, e.g. { tokens: [',', '\n'] } which
    // enables autocompletion on multiple tokens. This is most
    // useful when one of the tokens is \n (a newline), as it
    // allows smart autocompletion after linebreaks.

    if(typeof Effect == 'undefined')
        throw("controls.js requires including script.aculo.us' effects.js library");

    var Autocompleter = { };
    Autocompleter.Base = Class.create({
        baseInitialize: function(element, update, options) {
            element          = $(element);
            this.element     = element;
            this.update      = $(update);
            this.hasFocus    = false;
            this.changed     = false;
            this.active      = false;
            this.index       = 0;
            this.entryCount  = 0;
            this.oldElementValue = this.element.value;

            if(this.setOptions)
                this.setOptions(options);
            else
                this.options = options || { };

            this.options.paramName    = this.options.paramName || this.element.name;
            this.options.tokens       = this.options.tokens || [];
            this.options.frequency    = this.options.frequency || 0.4;
            this.options.minChars     = this.options.minChars || 1;
            this.options.onShow       = this.options.onShow ||
                    function(element, update){
                        if(!update.style.position || update.style.position=='absolute') {
                            update.style.position = 'absolute';
                            Position.clone(element, update, {
                                setHeight: false,
                                offsetTop: element.offsetHeight
                            });
                        }
                        Effect.Appear(update,{duration:0.15});
                    };
            this.options.onHide = this.options.onHide ||
                    function(element, update){ new Effect.Fade(update,{duration:0.15}) };

            if(typeof(this.options.tokens) == 'string')
                this.options.tokens = new Array(this.options.tokens);
            // Force carriage returns as token delimiters anyway
            if (!this.options.tokens.include('\n'))
                this.options.tokens.push('\n');

            this.observer = null;

            this.element.setAttribute('autocomplete','off');

            Element.hide(this.update);

            Event.observe(this.element, 'blur', this.onBlur.bindAsEventListener(this));
            Event.observe(this.element, 'keydown', this.onKeyPress.bindAsEventListener(this));
        },

        show: function() {
            if(Element.getStyle(this.update, 'display')=='none') this.options.onShow(this.element, this.update);
            if(!this.iefix &&
                    (Prototype.Browser.IE) &&
                    (Element.getStyle(this.update, 'position')=='absolute')) {
                new Insertion.After(this.update,
                        '<iframe id="' + this.update.id + '_iefix" '+
                        'style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" ' +
                        'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');
                this.iefix = $(this.update.id+'_iefix');
            }
            if(this.iefix) setTimeout(this.fixIEOverlapping.bind(this), 50);
        },

        fixIEOverlapping: function() {
            Position.clone(this.update, this.iefix, {setTop:(!this.update.style.height)});
            this.iefix.style.zIndex = 1;
            this.update.style.zIndex = 2;
            Element.show(this.iefix);
        },

        hide: function() {
            this.stopIndicator();
            if(Element.getStyle(this.update, 'display')!='none') this.options.onHide(this.element, this.update);
            if(this.iefix) Element.hide(this.iefix);
        },

        startIndicator: function() {
            if(this.options.indicator) Element.show(this.options.indicator);
        },

        stopIndicator: function() {
            if(this.options.indicator) Element.hide(this.options.indicator);
        },

        onKeyPress: function(event) {
            if(this.active)
                switch(event.keyCode) {
                    case Event.KEY_TAB:
                    case Event.KEY_RETURN:
                        this.selectEntry();
                        Event.stop(event);
                    case Event.KEY_ESC:
                        this.hide();
                        this.active = false;
                        Event.stop(event);
                        return;
                    case Event.KEY_LEFT:
                    case Event.KEY_RIGHT:
                        return;
                    case Event.KEY_UP:
                        this.markPrevious();
                        this.render();
                        Event.stop(event);
                        return;
                    case Event.KEY_DOWN:
                        this.markNext();
                        this.render();
                        Event.stop(event);
                        return;
                }
            else
            if(event.keyCode==Event.KEY_TAB || event.keyCode==Event.KEY_RETURN ||
                    (Prototype.Browser.WebKit > 0 && event.keyCode == 0)) return;

            this.changed = true;
            this.hasFocus = true;

            if(this.observer) clearTimeout(this.observer);
            this.observer =
                    setTimeout(this.onObserverEvent.bind(this), this.options.frequency*1000);
        },

        activate: function() {
            this.changed = false;
            this.hasFocus = true;
            this.getUpdatedChoices();
        },

        onHover: function(event) {
            var element = Event.findElement(event, 'LI');
            if(this.index != element.autocompleteIndex)
            {
                this.index = element.autocompleteIndex;
                this.render();
            }
            Event.stop(event);
        },

        onClick: function(event) {
            var element = Event.findElement(event, 'LI');
            this.index = element.autocompleteIndex;
            this.selectEntry();
            this.hide();
        },

        onBlur: function(event) {
            // needed to make click events working
            setTimeout(this.hide.bind(this), 250);
            this.hasFocus = false;
            this.active = false;
        },

        render: function() {
            if(this.entryCount > 0) {
                for (var i = 0; i < this.entryCount; i++)
                    this.index==i ?
                            Element.addClassName(this.getEntry(i),"selected") :
                            Element.removeClassName(this.getEntry(i),"selected");
                if(this.hasFocus) {
                    this.show();
                    this.active = true;
                }
            } else {
                this.active = false;
                this.hide();
            }
        },

        markPrevious: function() {
            if(this.index > 0) this.index--;
            else this.index = this.entryCount-1;
            //this.getEntry(this.index).scrollIntoView(true); useless
        },

        markNext: function() {
            if(this.index < this.entryCount-1) this.index++;
            else this.index = 0;
            this.getEntry(this.index).scrollIntoView(false);
        },

        getEntry: function(index) {
            return this.update.firstChild.childNodes[index];
        },

        getCurrentEntry: function() {
            return this.getEntry(this.index);
        },

        selectEntry: function() {
            this.active = false;
            this.updateElement(this.getCurrentEntry());
        },

        updateElement: function(selectedElement) {
            if (this.options.updateElement) {
                this.options.updateElement(selectedElement);
                return;
            }
            var value = '';
            if (this.options.select) {
                var nodes = $(selectedElement).select('.' + this.options.select) || [];
                if(nodes.length>0) value = Element.collectTextNodes(nodes[0], this.options.select);
            } else
                value = Element.collectTextNodesIgnoreClass(selectedElement, 'informal');

            var bounds = this.getTokenBounds();
            if (bounds[0] != -1) {
                var newValue = this.element.value.substr(0, bounds[0]);
                var whitespace = this.element.value.substr(bounds[0]).match(/^\s+/);
                if (whitespace)
                    newValue += whitespace[0];
                this.element.value = newValue + value + this.element.value.substr(bounds[1]);
            } else {
                this.element.value = value;
            }
            this.oldElementValue = this.element.value;
            this.element.focus();

            if (this.options.afterUpdateElement)
                this.options.afterUpdateElement(this.element, selectedElement);
        },

        updateChoices: function(choices) {
            if(!this.changed && this.hasFocus) {
                this.update.innerHTML = choices;
                Element.cleanWhitespace(this.update);
                Element.cleanWhitespace(this.update.down());

                if(this.update.firstChild && this.update.down().childNodes) {
                    this.entryCount =
                            this.update.down().childNodes.length;
                    for (var i = 0; i < this.entryCount; i++) {
                        var entry = this.getEntry(i);
                        entry.autocompleteIndex = i;
                        this.addObservers(entry);
                    }
                } else {
                    this.entryCount = 0;
                }

                this.stopIndicator();
                this.index = 0;

                if(this.entryCount==1 && this.options.autoSelect) {
                    this.selectEntry();
                    this.hide();
                } else {
                    this.render();
                }
            }
        },

        addObservers: function(element) {
            Event.observe(element, "mouseover", this.onHover.bindAsEventListener(this));
            Event.observe(element, "click", this.onClick.bindAsEventListener(this));
        },

        onObserverEvent: function() {
            this.changed = false;
            this.tokenBounds = null;
            if(this.getToken().length>=this.options.minChars) {
                this.getUpdatedChoices();
            } else {
                this.active = false;
                this.hide();
            }
            this.oldElementValue = this.element.value;
        },

        getToken: function() {
            var bounds = this.getTokenBounds();
            return this.element.value.substring(bounds[0], bounds[1]).strip();
        },

        getTokenBounds: function() {
            if (null != this.tokenBounds) return this.tokenBounds;
            var value = this.element.value;
            if (value.strip().empty()) return [-1, 0];
            var diff = arguments.callee.getFirstDifferencePos(value, this.oldElementValue);
            var offset = (diff == this.oldElementValue.length ? 1 : 0);
            var prevTokenPos = -1, nextTokenPos = value.length;
            var tp;
            for (var index = 0, l = this.options.tokens.length; index < l; ++index) {
                tp = value.lastIndexOf(this.options.tokens[index], diff + offset - 1);
                if (tp > prevTokenPos) prevTokenPos = tp;
                tp = value.indexOf(this.options.tokens[index], diff + offset);
                if (-1 != tp && tp < nextTokenPos) nextTokenPos = tp;
            }
            return (this.tokenBounds = [prevTokenPos + 1, nextTokenPos]);
        }
    });

    Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos = function(newS, oldS) {
        var boundary = Math.min(newS.length, oldS.length);
        for (var index = 0; index < boundary; ++index)
            if (newS[index] != oldS[index])
                return index;
        return boundary;
    };

    Ajax.Autocompleter = Class.create(Autocompleter.Base, {
        initialize: function(element, update, url, options) {
            this.baseInitialize(element, update, options);
            this.options.asynchronous  = true;
            this.options.onComplete    = this.onComplete.bind(this);
            this.options.defaultParams = this.options.parameters || null;
            this.url                   = url;
        },

        getUpdatedChoices: function() {
            this.startIndicator();

            var entry = encodeURIComponent(this.options.paramName) + '=' +
                    encodeURIComponent(this.getToken());

            this.options.parameters = this.options.callback ?
                    this.options.callback(this.element, entry) : entry;

            if(this.options.defaultParams)
                this.options.parameters += '&' + this.options.defaultParams;

            new Ajax.Request(this.url, this.options);
        },

        onComplete: function(request) {
            this.updateChoices(request.responseText);
        }
    });

    // The local array autocompleter. Used when you'd prefer to
    // inject an array of autocompletion options into the page, rather
    // than sending out Ajax queries, which can be quite slow sometimes.
    //
    // The constructor takes four parameters. The first two are, as usual,
    // the id of the monitored textbox, and id of the autocompletion menu.
    // The third is the array you want to autocomplete from, and the fourth
    // is the options block.
    //
    // Extra local autocompletion options:
    // - choices - How many autocompletion choices to offer
    //
    // - partialSearch - If false, the autocompleter will match entered
    //                    text only at the beginning of strings in the
    //                    autocomplete array. Defaults to true, which will
    //                    match text at the beginning of any *word* in the
    //                    strings in the autocomplete array. If you want to
    //                    search anywhere in the string, additionally set
    //                    the option fullSearch to true (default: off).
    //
    // - fullSsearch - Search anywhere in autocomplete array strings.
    //
    // - partialChars - How many characters to enter before triggering
    //                   a partial match (unlike minChars, which defines
    //                   how many characters are required to do any match
    //                   at all). Defaults to 2.
    //
    // - ignoreCase - Whether to ignore case when autocompleting.
    //                 Defaults to true.
    //
    // It's possible to pass in a custom function as the 'selector'
    // option, if you prefer to write your own autocompletion logic.
    // In that case, the other options above will not apply unless
    // you support them.

    Autocompleter.Local = Class.create(Autocompleter.Base, {
        initialize: function(element, update, array, options) {
            this.baseInitialize(element, update, options);
            this.options.array = array;
        },

        getUpdatedChoices: function() {
            this.updateChoices(this.options.selector(this));
        },

        setOptions: function(options) {
            this.options = Object.extend({
                choices: 10,
                partialSearch: true,
                partialChars: 2,
                ignoreCase: true,
                fullSearch: false,
                selector: function(instance) {
                    var ret       = []; // Beginning matches
                    var partial   = []; // Inside matches
                    var entry     = instance.getToken();
                    var count     = 0;

                    for (var i = 0; i < instance.options.array.length &&
                    ret.length < instance.options.choices ; i++) {

                        var elem = instance.options.array[i];
                        var foundPos = instance.options.ignoreCase ?
                                elem.toLowerCase().indexOf(entry.toLowerCase()) :
                                elem.indexOf(entry);

                        while (foundPos != -1) {
                            if (foundPos == 0 && elem.length != entry.length) {
                                ret.push("<li><strong>" + elem.substr(0, entry.length) + "</strong>" +
                                        elem.substr(entry.length) + "</li>");
                                break;
                            } else if (entry.length >= instance.options.partialChars &&
                                    instance.options.partialSearch && foundPos != -1) {
                                if (instance.options.fullSearch || /\s/.test(elem.substr(foundPos-1,1))) {
                                    partial.push("<li>" + elem.substr(0, foundPos) + "<strong>" +
                                            elem.substr(foundPos, entry.length) + "</strong>" + elem.substr(
                                                    foundPos + entry.length) + "</li>");
                                    break;
                                }
                            }

                            foundPos = instance.options.ignoreCase ?
                                    elem.toLowerCase().indexOf(entry.toLowerCase(), foundPos + 1) :
                                    elem.indexOf(entry, foundPos + 1);

                        }
                    }
                    if (partial.length)
                        ret = ret.concat(partial.slice(0, instance.options.choices - ret.length));
                    return "<ul>" + ret.join('') + "</ul>";
                }
            }, options || { });
        }
    });

    // AJAX in-place editor and collection editor
    // Full rewrite by Christophe Porteneuve <tdd@tddsworld.com> (April 2007).

    // Use this if you notice weird scrolling problems on some browsers,
    // the DOM might be a bit confused when this gets called so do this
    // waits 1 ms (with setTimeout) until it does the activation
    Field.scrollFreeActivate = function(field) {
        setTimeout(function() {
            Field.activate(field);
        }, 1);
    };

    Ajax.InPlaceEditor = Class.create({
        initialize: function(element, url, options) {
            this.url = url;
            this.element = element = $(element);
            this.prepareOptions();
            this._controls = { };
            arguments.callee.dealWithDeprecatedOptions(options); // DEPRECATION LAYER!!!
            Object.extend(this.options, options || { });
            if (!this.options.formId && this.element.id) {
                this.options.formId = this.element.id + '-inplaceeditor';
                if ($(this.options.formId))
                    this.options.formId = '';
            }
            if (this.options.externalControl)
                this.options.externalControl = $(this.options.externalControl);
            if (!this.options.externalControl)
                this.options.externalControlOnly = false;
            this._originalBackground = this.element.getStyle('background-color') || 'transparent';
            this.element.title = this.options.clickToEditText;
            this._boundCancelHandler = this.handleFormCancellation.bind(this);
            this._boundComplete = (this.options.onComplete || Prototype.emptyFunction).bind(this);
            this._boundFailureHandler = this.handleAJAXFailure.bind(this);
            this._boundSubmitHandler = this.handleFormSubmission.bind(this);
            this._boundWrapperHandler = this.wrapUp.bind(this);
            this.registerListeners();
        },
        checkForEscapeOrReturn: function(e) {
            if (!this._editing || e.ctrlKey || e.altKey || e.shiftKey) return;
            if (Event.KEY_ESC == e.keyCode)
                this.handleFormCancellation(e);
            else if (Event.KEY_RETURN == e.keyCode)
                this.handleFormSubmission(e);
        },
        createControl: function(mode, handler, extraClasses) {
            var control = this.options[mode + 'Control'];
            var text = this.options[mode + 'Text'];
            if ('button' == control) {
                var btn = document.createElement('input');
                btn.type = 'submit';
                btn.value = text;
                btn.className = 'editor_' + mode + '_button';
                if ('cancel' == mode)
                    btn.onclick = this._boundCancelHandler;
                this._form.appendChild(btn);
                this._controls[mode] = btn;
            } else if ('link' == control) {
                var link = document.createElement('a');
                link.href = '#';
                link.appendChild(document.createTextNode(text));
                link.onclick = 'cancel' == mode ? this._boundCancelHandler : this._boundSubmitHandler;
                link.className = 'editor_' + mode + '_link';
                if (extraClasses)
                    link.className += ' ' + extraClasses;
                this._form.appendChild(link);
                this._controls[mode] = link;
            }
        },
        createEditField: function() {
            var text = (this.options.loadTextURL ? this.options.loadingText : this.getText());
            var fld;
            if (1 >= this.options.rows && !/\r|\n/.test(this.getText())) {
                fld = document.createElement('input');
                fld.type = 'text';
                var size = this.options.size || this.options.cols || 0;
                if (0 < size) fld.size = size;
            } else {
                fld = document.createElement('textarea');
                fld.rows = (1 >= this.options.rows ? this.options.autoRows : this.options.rows);
                fld.cols = this.options.cols || 40;
            }
            fld.name = this.options.paramName;
            fld.value = text; // No HTML breaks conversion anymore
            fld.className = 'editor_field';
            if (this.options.submitOnBlur)
                fld.onblur = this._boundSubmitHandler;
            this._controls.editor = fld;
            if (this.options.loadTextURL)
                this.loadExternalText();
            this._form.appendChild(this._controls.editor);
        },
        createForm: function() {
            var ipe = this;
            function addText(mode, condition) {
                var text = ipe.options['text' + mode + 'Controls'];
                if (!text || condition === false) return;
                ipe._form.appendChild(document.createTextNode(text));
            };
            this._form = $(document.createElement('form'));
            this._form.id = this.options.formId;
            this._form.addClassName(this.options.formClassName);
            this._form.onsubmit = this._boundSubmitHandler;
            this.createEditField();
            if ('textarea' == this._controls.editor.tagName.toLowerCase())
                this._form.appendChild(document.createElement('br'));
            if (this.options.onFormCustomization)
                this.options.onFormCustomization(this, this._form);
            addText('Before', this.options.okControl || this.options.cancelControl);
            this.createControl('ok', this._boundSubmitHandler);
            addText('Between', this.options.okControl && this.options.cancelControl);
            this.createControl('cancel', this._boundCancelHandler, 'editor_cancel');
            addText('After', this.options.okControl || this.options.cancelControl);
        },
        destroy: function() {
            if (this._oldInnerHTML)
                this.element.innerHTML = this._oldInnerHTML;
            this.leaveEditMode();
            this.unregisterListeners();
        },
        enterEditMode: function(e) {
            if (this._saving || this._editing) return;
            this._editing = true;
            this.triggerCallback('onEnterEditMode');
            if (this.options.externalControl)
                this.options.externalControl.hide();
            this.element.hide();
            this.createForm();
            this.element.parentNode.insertBefore(this._form, this.element);
            if (!this.options.loadTextURL)
                this.postProcessEditField();
            if (e) Event.stop(e);
        },
        enterHover: function(e) {
            if (this.options.hoverClassName)
                this.element.addClassName(this.options.hoverClassName);
            if (this._saving) return;
            this.triggerCallback('onEnterHover');
        },
        getText: function() {
            return this.element.innerHTML.unescapeHTML();
        },
        handleAJAXFailure: function(transport) {
            this.triggerCallback('onFailure', transport);
            if (this._oldInnerHTML) {
                this.element.innerHTML = this._oldInnerHTML;
                this._oldInnerHTML = null;
            }
        },
        handleFormCancellation: function(e) {
            this.wrapUp();
            if (e) Event.stop(e);
        },
        handleFormSubmission: function(e) {
            var form = this._form;
            var value = $F(this._controls.editor);
            this.prepareSubmission();
            var params = this.options.callback(form, value) || '';
            if (Object.isString(params))
                params = params.toQueryParams();
            params.editorId = this.element.id;
            if (this.options.htmlResponse) {
                var options = Object.extend({ evalScripts: true }, this.options.ajaxOptions);
                Object.extend(options, {
                    parameters: params,
                    onComplete: this._boundWrapperHandler,
                    onFailure: this._boundFailureHandler
                });
                new Ajax.Updater({ success: this.element }, this.url, options);
            } else {
                var options = Object.extend({ method: 'get' }, this.options.ajaxOptions);
                Object.extend(options, {
                    parameters: params,
                    onComplete: this._boundWrapperHandler,
                    onFailure: this._boundFailureHandler
                });
                new Ajax.Request(this.url, options);
            }
            if (e) Event.stop(e);
        },
        leaveEditMode: function() {
            this.element.removeClassName(this.options.savingClassName);
            this.removeForm();
            this.leaveHover();
            this.element.style.backgroundColor = this._originalBackground;
            this.element.show();
            if (this.options.externalControl)
                this.options.externalControl.show();
            this._saving = false;
            this._editing = false;
            this._oldInnerHTML = null;
            this.triggerCallback('onLeaveEditMode');
        },
        leaveHover: function(e) {
            if (this.options.hoverClassName)
                this.element.removeClassName(this.options.hoverClassName);
            if (this._saving) return;
            this.triggerCallback('onLeaveHover');
        },
        loadExternalText: function() {
            this._form.addClassName(this.options.loadingClassName);
            this._controls.editor.disabled = true;
            var options = Object.extend({ method: 'get' }, this.options.ajaxOptions);
            Object.extend(options, {
                parameters: 'editorId=' + encodeURIComponent(this.element.id),
                onComplete: Prototype.emptyFunction,
                onSuccess: function(transport) {
                    this._form.removeClassName(this.options.loadingClassName);
                    var text = transport.responseText;
                    if (this.options.stripLoadedTextTags)
                        text = text.stripTags();
                    this._controls.editor.value = text;
                    this._controls.editor.disabled = false;
                    this.postProcessEditField();
                }.bind(this),
                onFailure: this._boundFailureHandler
            });
            new Ajax.Request(this.options.loadTextURL, options);
        },
        postProcessEditField: function() {
            var fpc = this.options.fieldPostCreation;
            if (fpc)
                $(this._controls.editor)['focus' == fpc ? 'focus' : 'activate']();
        },
        prepareOptions: function() {
            this.options = Object.clone(Ajax.InPlaceEditor.DefaultOptions);
            Object.extend(this.options, Ajax.InPlaceEditor.DefaultCallbacks);
            [this._extraDefaultOptions].flatten().compact().each(function(defs) {
                Object.extend(this.options, defs);
            }.bind(this));
        },
        prepareSubmission: function() {
            this._saving = true;
            this.removeForm();
            this.leaveHover();
            this.showSaving();
        },
        registerListeners: function() {
            this._listeners = { };
            var listener;
            $H(Ajax.InPlaceEditor.Listeners).each(function(pair) {
                listener = this[pair.value].bind(this);
                this._listeners[pair.key] = listener;
                if (!this.options.externalControlOnly)
                    this.element.observe(pair.key, listener);
                if (this.options.externalControl)
                    this.options.externalControl.observe(pair.key, listener);
            }.bind(this));
        },
        removeForm: function() {
            if (!this._form) return;
            this._form.remove();
            this._form = null;
            this._controls = { };
        },
        showSaving: function() {
            this._oldInnerHTML = this.element.innerHTML;
            this.element.innerHTML = this.options.savingText;
            this.element.addClassName(this.options.savingClassName);
            this.element.style.backgroundColor = this._originalBackground;
            this.element.show();
        },
        triggerCallback: function(cbName, arg) {
            if ('function' == typeof this.options[cbName]) {
                this.options[cbName](this, arg);
            }
        },
        unregisterListeners: function() {
            $H(this._listeners).each(function(pair) {
                if (!this.options.externalControlOnly)
                    this.element.stopObserving(pair.key, pair.value);
                if (this.options.externalControl)
                    this.options.externalControl.stopObserving(pair.key, pair.value);
            }.bind(this));
        },
        wrapUp: function(transport) {
            this.leaveEditMode();
            // Can't use triggerCallback due to backward compatibility: requires
            // binding + direct element
            this._boundComplete(transport, this.element);
        }
    });

    Object.extend(Ajax.InPlaceEditor.prototype, {
        dispose: Ajax.InPlaceEditor.prototype.destroy
    });

    Ajax.InPlaceCollectionEditor = Class.create(Ajax.InPlaceEditor, {
        initialize: function($super, element, url, options) {
            this._extraDefaultOptions = Ajax.InPlaceCollectionEditor.DefaultOptions;
            $super(element, url, options);
        },

        createEditField: function() {
            var list = document.createElement('select');
            list.name = this.options.paramName;
            list.size = 1;
            this._controls.editor = list;
            this._collection = this.options.collection || [];
            if (this.options.loadCollectionURL)
                this.loadCollection();
            else
                this.checkForExternalText();
            this._form.appendChild(this._controls.editor);
        },

        loadCollection: function() {
            this._form.addClassName(this.options.loadingClassName);
            this.showLoadingText(this.options.loadingCollectionText);
            var options = Object.extend({ method: 'get' }, this.options.ajaxOptions);
            Object.extend(options, {
                parameters: 'editorId=' + encodeURIComponent(this.element.id),
                onComplete: Prototype.emptyFunction,
                onSuccess: function(transport) {
                    var js = transport.responseText.strip();
                    if (!/^\[.*\]$/.test(js)) // TODO: improve sanity check
                        throw('Server returned an invalid collection representation.');
                    this._collection = eval(js);
                    this.checkForExternalText();
                }.bind(this),
                onFailure: this.onFailure
            });
            new Ajax.Request(this.options.loadCollectionURL, options);
        },

        showLoadingText: function(text) {
            this._controls.editor.disabled = true;
            var tempOption = this._controls.editor.firstChild;
            if (!tempOption) {
                tempOption = document.createElement('option');
                tempOption.value = '';
                this._controls.editor.appendChild(tempOption);
                tempOption.selected = true;
            }
            tempOption.update((text || '').stripScripts().stripTags());
        },

        checkForExternalText: function() {
            this._text = this.getText();
            if (this.options.loadTextURL)
                this.loadExternalText();
            else
                this.buildOptionList();
        },

        loadExternalText: function() {
            this.showLoadingText(this.options.loadingText);
            var options = Object.extend({ method: 'get' }, this.options.ajaxOptions);
            Object.extend(options, {
                parameters: 'editorId=' + encodeURIComponent(this.element.id),
                onComplete: Prototype.emptyFunction,
                onSuccess: function(transport) {
                    this._text = transport.responseText.strip();
                    this.buildOptionList();
                }.bind(this),
                onFailure: this.onFailure
            });
            new Ajax.Request(this.options.loadTextURL, options);
        },

        buildOptionList: function() {
            this._form.removeClassName(this.options.loadingClassName);
            this._collection = this._collection.map(function(entry) {
                return 2 === entry.length ? entry : [entry, entry].flatten();
            });
            var marker = ('value' in this.options) ? this.options.value : this._text;
            var textFound = this._collection.any(function(entry) {
                return entry[0] == marker;
            }.bind(this));
            this._controls.editor.update('');
            var option;
            this._collection.each(function(entry, index) {
                option = document.createElement('option');
                option.value = entry[0];
                option.selected = textFound ? entry[0] == marker : 0 == index;
                option.appendChild(document.createTextNode(entry[1]));
                this._controls.editor.appendChild(option);
            }.bind(this));
            this._controls.editor.disabled = false;
            Field.scrollFreeActivate(this._controls.editor);
        }
    });

    //**** DEPRECATION LAYER FOR InPlace[Collection]Editor! ****
    //**** This only  exists for a while,  in order to  let ****
    //**** users adapt to  the new API.  Read up on the new ****
    //**** API and convert your code to it ASAP!            ****

    Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions = function(options) {
        if (!options) return;
        function fallback(name, expr) {
            if (name in options || expr === undefined) return;
            options[name] = expr;
        };
        fallback('cancelControl', (options.cancelLink ? 'link' : (options.cancelButton ? 'button' :
                options.cancelLink == options.cancelButton == false ? false : undefined)));
        fallback('okControl', (options.okLink ? 'link' : (options.okButton ? 'button' :
                options.okLink == options.okButton == false ? false : undefined)));
        fallback('highlightColor', options.highlightcolor);
        fallback('highlightEndColor', options.highlightendcolor);
    };

    Object.extend(Ajax.InPlaceEditor, {
        DefaultOptions: {
            ajaxOptions: { },
            autoRows: 3,                                // Use when multi-line w/ rows == 1
            cancelControl: 'link',                      // 'link'|'button'|false
            cancelText: 'cancel',
            clickToEditText: 'Click to edit',
            externalControl: null,                      // id|elt
            externalControlOnly: false,
            fieldPostCreation: 'activate',              // 'activate'|'focus'|false
            formClassName: 'inplaceeditor-form',
            formId: null,                               // id|elt
            highlightColor: '#ffff99',
            highlightEndColor: '#ffffff',
            hoverClassName: '',
            htmlResponse: true,
            loadingClassName: 'inplaceeditor-loading',
            loadingText: 'Loading...',
            okControl: 'button',                        // 'link'|'button'|false
            okText: 'ok',
            paramName: 'value',
            rows: 1,                                    // If 1 and multi-line, uses autoRows
            savingClassName: 'inplaceeditor-saving',
            savingText: 'Saving...',
            size: 0,
            stripLoadedTextTags: false,
            submitOnBlur: false,
            textAfterControls: '',
            textBeforeControls: '',
            textBetweenControls: ''
        },
        DefaultCallbacks: {
            callback: function(form) {
                return Form.serialize(form);
            },
            onComplete: function(transport, element) {
                // For backward compatibility, this one is bound to the IPE, and passes
                // the element directly.  It was too often customized, so we don't break it.
                new Effect.Highlight(element, {
                    startcolor: this.options.highlightColor, keepBackgroundImage: true });
            },
            onEnterEditMode: null,
            onEnterHover: function(ipe) {
                ipe.element.style.backgroundColor = ipe.options.highlightColor;
                if (ipe._effect)
                    ipe._effect.cancel();
            },
            onFailure: function(transport, ipe) {
                alert('Error communication with the server: ' + transport.responseText.stripTags());
            },
            onFormCustomization: null, // Takes the IPE and its generated form, after editor, before controls.
            onLeaveEditMode: null,
            onLeaveHover: function(ipe) {
                ipe._effect = new Effect.Highlight(ipe.element, {
                    startcolor: ipe.options.highlightColor, endcolor: ipe.options.highlightEndColor,
                    restorecolor: ipe._originalBackground, keepBackgroundImage: true
                });
            }
        },
        Listeners: {
            click: 'enterEditMode',
            keydown: 'checkForEscapeOrReturn',
            mouseover: 'enterHover',
            mouseout: 'leaveHover'
        }
    });

    Ajax.InPlaceCollectionEditor.DefaultOptions = {
        loadingCollectionText: 'Loading options...'
    };

    // Delayed observer, like Form.Element.Observer,
    // but waits for delay after last key input
    // Ideal for live-search fields

    Form.Element.DelayedObserver = Class.create({
        initialize: function(element, delay, callback) {
            this.delay     = delay || 0.5;
            this.element   = $(element);
            this.callback  = callback;
            this.timer     = null;
            this.lastValue = $F(this.element);
            Event.observe(this.element,'keyup',this.delayedListener.bindAsEventListener(this));
        },
        delayedListener: function(event) {
            if(this.lastValue == $F(this.element)) return;
            if(this.timer) clearTimeout(this.timer);
            this.timer = setTimeout(this.onTimerEvent.bind(this), this.delay * 1000);
            this.lastValue = $F(this.element);
        },
        onTimerEvent: function() {
            this.timer = null;
            this.callback(this.element, $F(this.element));
        }
    });</script> <script type="text/javascript"  style="display:none">// script.aculo.us slider.js v1.8.2, Tue Nov 18 18:30:58 +0100 2008

    // Copyright (c) 2005-2008 Marty Haught, Thomas Fuchs
    //
    // script.aculo.us is freely distributable under the terms of an MIT-style license.
    // For details, see the script.aculo.us web site: http://script.aculo.us/

    if (!Control) var Control = { };

    // options:
    //  axis: 'vertical', or 'horizontal' (default)
    //
    // callbacks:
    //  onChange(value)
    //  onSlide(value)
    Control.Slider = Class.create({
        initialize: function(handle, track, options) {
            var slider = this;

            if (Object.isArray(handle)) {
                this.handles = handle.collect( function(e) { return $(e) });
            } else {
                this.handles = [$(handle)];
            }

            this.track   = $(track);
            this.options = options || { };

            this.axis      = this.options.axis || 'horizontal';
            this.increment = this.options.increment || 1;
            this.step      = parseInt(this.options.step || '1');
            this.range     = this.options.range || $R(0,1);

            this.value     = 0; // assure backwards compat
            this.values    = this.handles.map( function() { return 0 });
            this.spans     = this.options.spans ? this.options.spans.map(function(s){ return $(s) }) : false;
            this.options.startSpan = $(this.options.startSpan || null);
            this.options.endSpan   = $(this.options.endSpan || null);

            this.restricted = this.options.restricted || false;

            this.maximum   = this.options.maximum || this.range.end;
            this.minimum   = this.options.minimum || this.range.start;

            // Will be used to align the handle onto the track, if necessary
            this.alignX = parseInt(this.options.alignX || '0');
            this.alignY = parseInt(this.options.alignY || '0');

            this.trackLength = this.maximumOffset() - this.minimumOffset();

            this.handleLength = this.isVertical() ?
                    (this.handles[0].offsetHeight != 0 ?
                            this.handles[0].offsetHeight : this.handles[0].style.height.replace(/px$/,"")) :
                    (this.handles[0].offsetWidth != 0 ? this.handles[0].offsetWidth :
                            this.handles[0].style.width.replace(/px$/,""));

            this.active   = false;
            this.dragging = false;
            this.disabled = false;

            if (this.options.disabled) this.setDisabled();

            // Allowed values array
            this.allowedValues = this.options.values ? this.options.values.sortBy(Prototype.K) : false;
            if (this.allowedValues) {
                this.minimum = this.allowedValues.min();
                this.maximum = this.allowedValues.max();
            }

            this.eventMouseDown = this.startDrag.bindAsEventListener(this);
            this.eventMouseUp   = this.endDrag.bindAsEventListener(this);
            this.eventMouseMove = this.update.bindAsEventListener(this);

            // Initialize handles in reverse (make sure first handle is active)
            this.handles.each( function(h,i) {
                i = slider.handles.length-1-i;
                slider.setValue(parseFloat(
                        (Object.isArray(slider.options.sliderValue) ?
                                slider.options.sliderValue[i] : slider.options.sliderValue) ||
                        slider.range.start), i);
                h.makePositioned().observe("mousedown", slider.eventMouseDown);
            });

            this.track.observe("mousedown", this.eventMouseDown);
            document.observe("mouseup", this.eventMouseUp);
            $(this.track.parentNode.parentNode).observe("mousemove", this.eventMouseMove);


            this.initialized = true;
        },
        dispose: function() {
            var slider = this;
            Event.stopObserving(this.track, "mousedown", this.eventMouseDown);
            Event.stopObserving(document, "mouseup", this.eventMouseUp);
            Event.stopObserving(this.track.parentNode.parentNode, "mousemove", this.eventMouseMove);
            this.handles.each( function(h) {
                Event.stopObserving(h, "mousedown", slider.eventMouseDown);
            });
        },
        setDisabled: function(){
            this.disabled = true;
            this.track.parentNode.className = this.track.parentNode.className + ' disabled';
        },
        setEnabled: function(){
            this.disabled = false;
        },
        getNearestValue: function(value){
            if (this.allowedValues){
                if (value >= this.allowedValues.max()) return(this.allowedValues.max());
                if (value <= this.allowedValues.min()) return(this.allowedValues.min());

                var offset = Math.abs(this.allowedValues[0] - value);
                var newValue = this.allowedValues[0];
                this.allowedValues.each( function(v) {
                    var currentOffset = Math.abs(v - value);
                    if (currentOffset <= offset){
                        newValue = v;
                        offset = currentOffset;
                    }
                });
                return newValue;
            }
            if (value > this.range.end) return this.range.end;
            if (value < this.range.start) return this.range.start;
            return value;
        },
        setValue: function(sliderValue, handleIdx){
            if (!this.active) {
                this.activeHandleIdx = handleIdx || 0;
                this.activeHandle    = this.handles[this.activeHandleIdx];
                this.updateStyles();
            }
            handleIdx = handleIdx || this.activeHandleIdx || 0;
            if (this.initialized && this.restricted) {
                if ((handleIdx>0) && (sliderValue<this.values[handleIdx-1]))
                    sliderValue = this.values[handleIdx-1];
                if ((handleIdx < (this.handles.length-1)) && (sliderValue>this.values[handleIdx+1]))
                    sliderValue = this.values[handleIdx+1];
            }
            sliderValue = this.getNearestValue(sliderValue);
            this.values[handleIdx] = sliderValue;
            this.value = this.values[0]; // assure backwards compat

            this.handles[handleIdx].style[this.isVertical() ? 'top' : 'left'] =
                    this.translateToPx(sliderValue);

            this.drawSpans();
            if (!this.dragging || !this.event) this.updateFinished();
        },
        setValueBy: function(delta, handleIdx) {
            this.setValue(this.values[handleIdx || this.activeHandleIdx || 0] + delta,
                    handleIdx || this.activeHandleIdx || 0);
        },
        translateToPx: function(value) {
            return Math.round(
                            ((this.trackLength-this.handleLength)/(this.range.end-this.range.start)) *
                            (value - this.range.start)) + "px";
        },
        translateToValue: function(offset) {
            return ((offset/(this.trackLength-this.handleLength) *
            (this.range.end-this.range.start)) + this.range.start);
        },
        getRange: function(range) {
            var v = this.values.sortBy(Prototype.K);
            range = range || 0;
            return $R(v[range],v[range+1]);
        },
        minimumOffset: function(){
            return(this.isVertical() ? this.alignY : this.alignX);
        },
        maximumOffset: function(){
            return(this.isVertical() ?
            (this.track.offsetHeight != 0 ? this.track.offsetHeight :
                    this.track.style.height.replace(/px$/,"")) - this.alignY :
            (this.track.offsetWidth != 0 ? this.track.offsetWidth :
                    this.track.style.width.replace(/px$/,"")) - this.alignX);
        },
        isVertical:  function(){
            return (this.axis == 'vertical');
        },
        drawSpans: function() {
            var slider = this;
            if (this.spans)
                $R(0, this.spans.length-1).each(function(r) { slider.setSpan(slider.spans[r], slider.getRange(r)) });
            if (this.options.startSpan)
                this.setSpan(this.options.startSpan,
                        $R(0, this.values.length>1 ? this.getRange(0).min() : this.value ));
            if (this.options.endSpan)
                this.setSpan(this.options.endSpan,
                        $R(this.values.length>1 ? this.getRange(this.spans.length-1).max() : this.value, this.maximum));
        },
        setSpan: function(span, range) {
            if (this.isVertical()) {
                span.style.top = this.translateToPx(range.start);
                span.style.height = this.translateToPx(range.end - range.start + this.range.start);
            } else {
                span.style.left = this.translateToPx(range.start);
                span.style.width = this.translateToPx(range.end - range.start + this.range.start);
            }
        },
        updateStyles: function() {
            this.handles.each( function(h){ Element.removeClassName(h, 'selected') });
            Element.addClassName(this.activeHandle, 'selected');
        },
        startDrag: function(event) {
            if (Event.isLeftClick(event)) {
                if (!this.disabled){
                    this.active = true;

                    var handle = Event.element(event);
                    var pointer  = [Event.pointerX(event), Event.pointerY(event)];
                    var track = handle;
                    if (track==this.track) {
                        var offsets  = Position.cumulativeOffset(this.track);
                        this.event = event;
                        this.setValue(this.translateToValue(
                                (this.isVertical() ? pointer[1]-offsets[1] : pointer[0]-offsets[0])-(this.handleLength/2)
                        ));
                        var offsets  = Position.cumulativeOffset(this.activeHandle);
                        this.offsetX = (pointer[0] - offsets[0]);
                        this.offsetY = (pointer[1] - offsets[1]);
                    } else {
                        // find the handle (prevents issues with Safari)
                        while((this.handles.indexOf(handle) == -1) && handle.parentNode)
                            handle = handle.parentNode;

                        if (this.handles.indexOf(handle)!=-1) {
                            this.activeHandle    = handle;
                            this.activeHandleIdx = this.handles.indexOf(this.activeHandle);
                            this.updateStyles();

                            var offsets  = Position.cumulativeOffset(this.activeHandle);
                            this.offsetX = (pointer[0] - offsets[0]);
                            this.offsetY = (pointer[1] - offsets[1]);
                        }
                    }
                }
                Event.stop(event);
            }
        },
        update: function(event) {
            if (this.active) {
                if (!this.dragging) this.dragging = true;
                this.draw(event);
                if (Prototype.Browser.WebKit) window.scrollBy(0,0);
                Event.stop(event);
            }
        },
        draw: function(event) {
            var pointer = [Event.pointerX(event), Event.pointerY(event)];
            var offsets = Position.cumulativeOffset(this.track);
            pointer[0] -= this.offsetX + offsets[0];
            pointer[1] -= this.offsetY + offsets[1];
            this.event = event;
            this.setValue(this.translateToValue( this.isVertical() ? pointer[1] : pointer[0] ));
            if (this.initialized && this.options.onSlide)
                this.options.onSlide(this.values.length>1 ? this.values : this.value, this);
        },
        endDrag: function(event) {
            if (this.active && this.dragging) {
                this.finishDrag(event, true);
                Event.stop(event);
            }
            this.active = false;
            this.dragging = false;
        },
        finishDrag: function(event, success) {
            this.active = false;
            this.dragging = false;
            this.updateFinished();
        },
        updateFinished: function() {
            if (this.initialized && this.options.onChange)
                this.options.onChange(this.values.length>1 ? this.values : this.value, this);
            this.event = null;
        }
    });</script> <script type="text/javascript"  style="display:none">/**
     * Magento
     *
     * NOTICE OF LICENSE
     *
     * This source file is subject to the Academic Free License (AFL 3.0)
     * that is bundled with this package in the file LICENSE_AFL.txt.
     * It is also available through the world-wide-web at this URL:
     * http://opensource.org/licenses/afl-3.0.php
     * If you did not receive a copy of the license and are unable to
     * obtain it through the world-wide-web, please send an email
     * to license@magentocommerce.com so we can send you a copy immediately.
     *
     * DISCLAIMER
     *
     * Do not edit or add to this file if you wish to upgrade Magento to newer
     * versions in the future. If you wish to customize Magento for your
     * needs please refer to http://www.magentocommerce.com for more information.
     *
     * @category    Varien
     * @package     js
     * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
     * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
     */
    function popWin(url,win,para) {
        var win = window.open(url,win,para);
        win.focus();
    }

    function setLocation(url){
        window.location.href = url;
    }

    function setPLocation(url, setFocus){
        if( setFocus ) {
            window.opener.focus();
        }
        window.opener.location.href = url;
    }

    function setLanguageCode(code, fromCode){
        //TODO: javascript cookies have different domain and path than php cookies
        var href = window.location.href;
        var after = '', dash;
        if (dash = href.match(/\#(.*)$/)) {
            href = href.replace(/\#(.*)$/, '');
            after = dash[0];
        }

        if (href.match(/[?]/)) {
            var re = /([?&]store=)[a-z0-9_]*/;
            if (href.match(re)) {
                href = href.replace(re, '$1'+code);
            } else {
                href += '&store='+code;
            }

            var re = /([?&]from_store=)[a-z0-9_]*/;
            if (href.match(re)) {
                href = href.replace(re, '');
            }
        } else {
            href += '?store='+code;
        }
        if (typeof(fromCode) != 'undefined') {
            href += '&from_store='+fromCode;
        }
        href += after;

        setLocation(href);
    }

    /**
     * Add classes to specified elements.
     * Supported classes are: 'odd', 'even', 'first', 'last'
     *
     * @param elements - array of elements to be decorated
     * [@param decorateParams] - array of classes to be set. If omitted, all available will be used
     */
    function decorateGeneric(elements, decorateParams)
    {
        var allSupportedParams = ['odd', 'even', 'first', 'last'];
        var _decorateParams = {};
        var total = elements.length;

        if (total) {
            // determine params called
            if (typeof(decorateParams) == 'undefined') {
                decorateParams = allSupportedParams;
            }
            if (!decorateParams.length) {
                return;
            }
            for (var k in allSupportedParams) {
                _decorateParams[allSupportedParams[k]] = false;
            }
            for (var k in decorateParams) {
                _decorateParams[decorateParams[k]] = true;
            }

            // decorate elements
            // elements[0].addClassName('first'); // will cause bug in IE (#5587)
            if (_decorateParams.first) {
                Element.addClassName(elements[0], 'first');
            }
            if (_decorateParams.last) {
                Element.addClassName(elements[total-1], 'last');
            }
            for (var i = 0; i < total; i++) {
                if ((i + 1) % 2 == 0) {
                    if (_decorateParams.even) {
                        Element.addClassName(elements[i], 'even');
                    }
                }
                else {
                    if (_decorateParams.odd) {
                        Element.addClassName(elements[i], 'odd');
                    }
                }
            }
        }
    }

    /**
     * Decorate table rows and cells, tbody etc
     * @see decorateGeneric()
     */
    function decorateTable(table, options) {
        var table = $(table);
        if (table) {
            // set default options
            var _options = {
                'tbody'    : false,
                'tbody tr' : ['odd', 'even', 'first', 'last'],
                'thead tr' : ['first', 'last'],
                'tfoot tr' : ['first', 'last'],
                'tr td'    : ['last']
            };
            // overload options
            if (typeof(options) != 'undefined') {
                for (var k in options) {
                    _options[k] = options[k];
                }
            }
            // decorate
            if (_options['tbody']) {
                decorateGeneric(table.select('tbody'), _options['tbody']);
            }
            if (_options['tbody tr']) {
                decorateGeneric(table.select('tbody tr'), _options['tbody tr']);
            }
            if (_options['thead tr']) {
                decorateGeneric(table.select('thead tr'), _options['thead tr']);
            }
            if (_options['tfoot tr']) {
                decorateGeneric(table.select('tfoot tr'), _options['tfoot tr']);
            }
            if (_options['tr td']) {
                var allRows = table.select('tr');
                if (allRows.length) {
                    for (var i = 0; i < allRows.length; i++) {
                        decorateGeneric(allRows[i].getElementsByTagName('TD'), _options['tr td']);
                    }
                }
            }
        }
    }

    /**
     * Set "odd", "even" and "last" CSS classes for list items
     * @see decorateGeneric()
     */
    function decorateList(list, nonRecursive) {
        if ($(list)) {
            if (typeof(nonRecursive) == 'undefined') {
                var items = $(list).select('li')
            }
            else {
                var items = $(list).childElements();
            }
            decorateGeneric(items, ['odd', 'even', 'last']);
        }
    }

    /**
     * Set "odd", "even" and "last" CSS classes for list items
     * @see decorateGeneric()
     */
    function decorateDataList(list) {
        list = $(list);
        if (list) {
            decorateGeneric(list.select('dt'), ['odd', 'even', 'last']);
            decorateGeneric(list.select('dd'), ['odd', 'even', 'last']);
        }
    }

    /**
     * Parse SID and produces the correct URL
     */
    function parseSidUrl(baseUrl, urlExt) {
        var sidPos = baseUrl.indexOf('/?SID=');
        var sid = '';
        urlExt = (urlExt != undefined) ? urlExt : '';

        if(sidPos > -1) {
            sid = '?' + baseUrl.substring(sidPos + 2);
            baseUrl = baseUrl.substring(0, sidPos + 1);
        }

        return baseUrl+urlExt+sid;
    }

    /**
     * Formats currency using patern
     * format - JSON (pattern, decimal, decimalsDelimeter, groupsDelimeter)
     * showPlus - true (always show '+'or '-'),
     *      false (never show '-' even if number is negative)
     *      null (show '-' if number is negative)
     */

    function formatCurrency(price, format, showPlus){
        var precision = isNaN(format.precision = Math.abs(format.precision)) ? 2 : format.precision;
        var requiredPrecision = isNaN(format.requiredPrecision = Math.abs(format.requiredPrecision)) ? 2 : format.requiredPrecision;

        //precision = (precision > requiredPrecision) ? precision : requiredPrecision;
        //for now we don't need this difference so precision is requiredPrecision
        precision = requiredPrecision;

        var integerRequired = isNaN(format.integerRequired = Math.abs(format.integerRequired)) ? 1 : format.integerRequired;

        var decimalSymbol = format.decimalSymbol == undefined ? "," : format.decimalSymbol;
        var groupSymbol = format.groupSymbol == undefined ? "." : format.groupSymbol;
        var groupLength = format.groupLength == undefined ? 3 : format.groupLength;

        var s = '';

        if (showPlus == undefined || showPlus == true) {
            s = price < 0 ? "-" : ( showPlus ? "+" : "");
        } else if (showPlus == false) {
            s = '';
        }

        var i = parseInt(price = Math.abs(+price || 0).toFixed(precision)) + "";
        var pad = (i.length < integerRequired) ? (integerRequired - i.length) : 0;
        while (pad) { i = '0' + i; pad--; }
        j = (j = i.length) > groupLength ? j % groupLength : 0;
        re = new RegExp("(\\d{" + groupLength + "})(?=\\d)", "g");

        /**
         * replace(/-/, 0) is only for fixing Safari bug which appears
         * when Math.abs(0).toFixed() executed on "0" number.
         * Result is "0.-0" :(
         */
        var r = (j ? i.substr(0, j) + groupSymbol : "") + i.substr(j).replace(re, "$1" + groupSymbol) + (precision ? decimalSymbol + Math.abs(price - i).toFixed(precision).replace(/-/, 0).slice(2) : "")
        var pattern = '';
        if (format.pattern.indexOf('{sign}') == -1) {
            pattern = s + format.pattern;
        } else {
            pattern = format.pattern.replace('{sign}', s);
        }

        return pattern.replace('%s', r).replace(/^\s\s*/, '').replace(/\s\s*$/, '');
    };

    function expandDetails(el, childClass) {
        if (Element.hasClassName(el,'show-details')) {
            $$(childClass).each(function(item){item.hide()});
            Element.removeClassName(el,'show-details');
        }
        else {
            $$(childClass).each(function(item){item.show()});
            Element.addClassName(el,'show-details');
        }
    }

    // Version 1.0
    var isIE = navigator.appVersion.match(/MSIE/) == "MSIE";

    if (!window.Varien)
        var Varien = new Object();

    Varien.showLoading = function(){
        Element.show('loading-process');
    }
    Varien.hideLoading = function(){
        Element.hide('loading-process');
    }
    Varien.GlobalHandlers = {
        onCreate: function() {
            Varien.showLoading();
        },

        onComplete: function() {
            if(Ajax.activeRequestCount == 0) {
                Varien.hideLoading();
            }
        }
    };

    Ajax.Responders.register(Varien.GlobalHandlers);

    /**
     * Quick Search form client model
     */
    Varien.searchForm = Class.create();
    Varien.searchForm.prototype = {
        initialize : function(form, field, emptyText){
            this.form   = $(form);
            this.field  = $(field);
            this.emptyText = emptyText;

            Event.observe(this.form,  'submit', this.submit.bind(this));
            Event.observe(this.field, 'focus', this.focus.bind(this));
            Event.observe(this.field, 'blur', this.blur.bind(this));
            this.blur();
        },

        submit : function(event){
            if (this.field.value == this.emptyText || this.field.value == ''){
                Event.stop(event);
                return false;
            }
            return true;
        },

        focus : function(event){
            if(this.field.value==this.emptyText){
                this.field.value='';
            }

        },

        blur : function(event){
            if(this.field.value==''){
                this.field.value=this.emptyText;
            }
        },

        initAutocomplete : function(url, destinationElement){
            new Ajax.Autocompleter(
                    this.field,
                    destinationElement,
                    url,
                    {
                        paramName: this.field.name,
                        method: 'get',
                        minChars: 2,
                        updateElement: this._selectAutocompleteItem.bind(this),
                        onShow : function(element, update) {
                            if(!update.style.position || update.style.position=='absolute') {
                                update.style.position = 'absolute';
                                Position.clone(element, update, {
                                    setHeight: false,
                                    offsetTop: element.offsetHeight
                                });
                            }
                            Effect.Appear(update,{duration:0});
                        }

                    }
            );
        },

        _selectAutocompleteItem : function(element){
            if(element.title){
                this.field.value = element.title;
            }
            this.form.submit();
        }
    }

    Varien.Tabs = Class.create();
    Varien.Tabs.prototype = {
        initialize: function(selector) {
            var self=this;
            $$(selector+' a').each(this.initTab.bind(this));
        },

        initTab: function(el) {
            el.href = 'javascript:void(0)';
            if ($(el.parentNode).hasClassName('active')) {
                this.showContent(el);
            }
            el.observe('click', this.showContent.bind(this, el));
        },

        showContent: function(a) {
            var li = $(a.parentNode), ul = $(li.parentNode);
            ul.getElementsBySelector('li', 'ol').each(function(el){
                var contents = $(el.id+'_contents');
                if (el==li) {
                    el.addClassName('active');
                    contents.show();
                } else {
                    el.removeClassName('active');
                    contents.hide();
                }
            });
        }
    }

    Varien.DateElement = Class.create();
    Varien.DateElement.prototype = {
        initialize: function(type, content, required, format) {
            if (type == 'id') {
                // id prefix
                this.day    = $(content + 'day');
                this.month  = $(content + 'month');
                this.year   = $(content + 'year');
                this.full   = $(content + 'full');
                this.advice = $(content + 'date-advice');
            } else if (type == 'container') {
                // content must be container with data
                this.day    = content.day;
                this.month  = content.month;
                this.year   = content.year;
                this.full   = content.full;
                this.advice = content.advice;
            } else {
                return;
            }

            this.required = required;
            this.format   = format;

            this.day.addClassName('validate-custom');
            this.day.validate = this.validate.bind(this);
            this.month.addClassName('validate-custom');
            this.month.validate = this.validate.bind(this);
            this.year.addClassName('validate-custom');
            this.year.validate = this.validate.bind(this);

            this.setDateRange(false, false);
            this.year.setAttribute('autocomplete','off');

            this.advice.hide();
        },
        validate: function() {
            var error = false,
                    day = parseInt(this.day.value.replace(/^0*/, '')) || 0,
                    month = parseInt(this.month.value.replace(/^0*/, '')) || 0,
                    year = parseInt(this.year.value) || 0;
            if (!day && !month && !year) {
                if (this.required) {
                    error = 'This date is a required value.';
                } else {
                    this.full.value = '';
                }
            } else if (!day || !month || !year) {
                error = 'Please enter a valid full date';
            } else {
                var date = new Date, countDaysInMonth = 0, errorType = null;
                date.setYear(year);date.setMonth(month-1);date.setDate(32);
                countDaysInMonth = 32 - date.getDate();
                if(!countDaysInMonth || countDaysInMonth>31) countDaysInMonth = 31;

                if (day<1 || day>countDaysInMonth) {
                    errorType = 'day';
                    error = 'Please enter a valid day (1-%d).';
                } else if (month<1 || month>12) {
                    errorType = 'month';
                    error = 'Please enter a valid month (1-12).';
                } else {
                    if(day % 10 == day) this.day.value = '0'+day;
                    if(month % 10 == month) this.month.value = '0'+month;
                    this.full.value = this.format.replace(/%[mb]/i, this.month.value).replace(/%[de]/i, this.day.value).replace(/%y/i, this.year.value);
                    var testFull = this.month.value + '/' + this.day.value + '/'+ this.year.value;
                    var test = new Date(testFull);
                    if (isNaN(test)) {
                        error = 'Please enter a valid date.';
                    } else {
                        this.setFullDate(test);
                    }
                }
                var valueError = false;
                if (!error && !this.validateData()){//(year<1900 || year>curyear) {
                    errorType = this.validateDataErrorType;//'year';
                    valueError = this.validateDataErrorText;//'Please enter a valid year (1900-%d).';
                    error = valueError;
                }
            }

            if (error !== false) {
                try {
                    error = Translator.translate(error);
                }
                catch (e) {}
                if (!valueError) {
                    this.advice.innerHTML = error.replace('%d', countDaysInMonth);
                } else {
                    this.advice.innerHTML = this.errorTextModifier(error);
                }
                this.advice.show();
                return false;
            }

            // fixing elements class
            this.day.removeClassName('validation-failed');
            this.month.removeClassName('validation-failed');
            this.year.removeClassName('validation-failed');

            this.advice.hide();
            return true;
        },
        validateData: function() {
            var year = this.fullDate.getFullYear();
            var date = new Date;
            this.curyear = date.getFullYear();
            return (year>=1900 && year<=this.curyear);
        },
        validateDataErrorType: 'year',
        validateDataErrorText: 'Please enter a valid year (1900-%d).',
        errorTextModifier: function(text) {
            return text.replace('%d', this.curyear);
        },
        setDateRange: function(minDate, maxDate) {
            this.minDate = minDate;
            this.maxDate = maxDate;
        },
        setFullDate: function(date) {
            this.fullDate = date;
        }
    };

    Varien.DOB = Class.create();
    Varien.DOB.prototype = {
        initialize: function(selector, required, format) {
            var el = $$(selector)[0];
            var container       = {};
            container.day       = Element.select(el, '.dob-day input')[0];
            container.month     = Element.select(el, '.dob-month input')[0];
            container.year      = Element.select(el, '.dob-year input')[0];
            container.full      = Element.select(el, '.dob-full input')[0];
            container.advice    = Element.select(el, '.validation-advice')[0];

            new Varien.DateElement('container', container, required, format);
        }
    };

    Varien.dateRangeDate = Class.create();
    Varien.dateRangeDate.prototype = Object.extend(new Varien.DateElement(), {
        validateData: function() {
            var validate = true;
            if (this.minDate || this.maxValue) {
                if (this.minDate) {
                    this.minDate = new Date(this.minDate);
                    this.minDate.setHours(0);
                    if (isNaN(this.minDate)) {
                        this.minDate = new Date('1/1/1900');
                    }
                    validate = validate && (this.fullDate >= this.minDate)
                }
                if (this.maxDate) {
                    this.maxDate = new Date(this.maxDate)
                    this.minDate.setHours(0);
                    if (isNaN(this.maxDate)) {
                        this.maxDate = new Date();
                    }
                    validate = validate && (this.fullDate <= this.maxDate)
                }
                if (this.maxDate && this.minDate) {
                    this.validateDataErrorText = 'Please enter a valid date between %s and %s';
                } else if (this.maxDate) {
                    this.validateDataErrorText = 'Please enter a valid date less than or equal to %s';
                } else if (this.minDate) {
                    this.validateDataErrorText = 'Please enter a valid date equal to or greater than %s';
                } else {
                    this.validateDataErrorText = '';
                }
            }
            return validate;
        },
        validateDataErrorText: 'Date should be between %s and %s',
        errorTextModifier: function(text) {
            if (this.minDate) {
                text = text.sub('%s', this.dateFormat(this.minDate));
            }
            if (this.maxDate) {
                text = text.sub('%s', this.dateFormat(this.maxDate));
            }
            return text;
        },
        dateFormat: function(date) {
            return (date.getMonth() + 1) + '/' + date.getDate() + '/' + date.getFullYear();
        }
    });

    Varien.FileElement = Class.create();
    Varien.FileElement.prototype = {
        initialize: function (id) {
            this.fileElement = $(id);
            this.hiddenElement = $(id + '_value');

            this.fileElement.observe('change', this.selectFile.bind(this));
        },
        selectFile: function(event) {
            this.hiddenElement.value = this.fileElement.getValue();
        }
    };

    Validation.addAllThese([
        ['validate-custom', ' ', function(v,elm) {
            return elm.validate();
        }]
    ]);

    function truncateOptions() {
        $$('.truncated').each(function(element){
            Event.observe(element, 'mouseover', function(){
                if (element.down('div.truncated_full_value')) {
                    element.down('div.truncated_full_value').addClassName('show')
                }
            });
            Event.observe(element, 'mouseout', function(){
                if (element.down('div.truncated_full_value')) {
                    element.down('div.truncated_full_value').removeClassName('show')
                }
            });

        });
    }
    Event.observe(window, 'load', function(){
        truncateOptions();
    });

    Element.addMethods({
        getInnerText: function(element)
        {
            element = $(element);
            if(element.innerText && !Prototype.Browser.Opera) {
                return element.innerText
            }
            return element.innerHTML.stripScripts().unescapeHTML().replace(/[\n\r\s]+/g, ' ').strip();
        }
    });

    /*
     if (!("console" in window) || !("firebug" in console))
     {
     var names = ["log", "debug", "info", "warn", "error", "assert", "dir", "dirxml",
     "group", "groupEnd", "time", "timeEnd", "count", "trace", "profile", "profileEnd"];

     window.console = {};
     for (var i = 0; i < names.length; ++i)
     window.console[names[i]] = function() {}
     }
     */

    /**
     * Executes event handler on the element. Works with event handlers attached by Prototype,
     * in a browser-agnostic fashion.
     * @param element The element object
     * @param event Event name, like 'change'
     *
     * @example fireEvent($('my-input', 'click'));
     */
    function fireEvent(element, event) {
        if (document.createEvent) {
            // dispatch for all browsers except IE before version 9
            var evt = document.createEvent("HTMLEvents");
            evt.initEvent(event, true, true ); // event type, bubbling, cancelable
            return element.dispatchEvent(evt);
        } else {
            // dispatch for IE before version 9
            var evt = document.createEventObject();
            return element.fireEvent('on' + event, evt)
        }
    }

    /**
     * Returns more accurate results of floating-point modulo division
     * E.g.:
     * 0.6 % 0.2 = 0.19999999999999996
     * modulo(0.6, 0.2) = 0
     *
     * @param dividend
     * @param divisor
     */
    function modulo(dividend, divisor)
    {
        var epsilon = divisor / 10000;
        var remainder = dividend % divisor;

        if (Math.abs(remainder - divisor) < epsilon || Math.abs(remainder) < epsilon) {
            remainder = 0;
        }

        return remainder;
    }

    /**
     * createContextualFragment is not supported in IE9. Adding its support.
     */
    if ((typeof Range != "undefined") && !Range.prototype.createContextualFragment)
    {
        Range.prototype.createContextualFragment = function(html)
        {
            var frag = document.createDocumentFragment(),
                    div = document.createElement("div");
            frag.appendChild(div);
            div.outerHTML = html;
            return frag;
        };
    }
    </script> <script type="text/javascript"  style="display:none">/**
     * Magento
     *
     * NOTICE OF LICENSE
     *
     * This source file is subject to the Academic Free License (AFL 3.0)
     * that is bundled with this package in the file LICENSE_AFL.txt.
     * It is also available through the world-wide-web at this URL:
     * http://opensource.org/licenses/afl-3.0.php
     * If you did not receive a copy of the license and are unable to
     * obtain it through the world-wide-web, please send an email
     * to license@magentocommerce.com so we can send you a copy immediately.
     *
     * DISCLAIMER
     *
     * Do not edit or add to this file if you wish to upgrade Magento to newer
     * versions in the future. If you wish to customize Magento for your
     * needs please refer to http://www.magentocommerce.com for more information.
     *
     * @category    Varien
     * @package     js
     * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
     * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
     */
    VarienForm = Class.create();
    VarienForm.prototype = {
        initialize: function(formId, firstFieldFocus){
            this.form       = $(formId);
            if (!this.form) {
                return;
            }
            this.cache      = $A();
            this.currLoader = false;
            this.currDataIndex = false;
            this.validator  = new Validation(this.form);
            this.elementFocus   = this.elementOnFocus.bindAsEventListener(this);
            this.elementBlur    = this.elementOnBlur.bindAsEventListener(this);
            this.childLoader    = this.onChangeChildLoad.bindAsEventListener(this);
            this.highlightClass = 'highlight';
            this.extraChildParams = '';
            this.firstFieldFocus= firstFieldFocus || false;
            this.bindElements();
            if(this.firstFieldFocus){
                try{
                    Form.Element.focus(Form.findFirstElement(this.form))
                }
                catch(e){}
            }
        },

        submit : function(url){
            if(this.validator && this.validator.validate()){
                this.form.submit();
            }
            return false;
        },

        bindElements:function (){
            var elements = Form.getElements(this.form);
            for (var row in elements) {
                if (elements[row].id) {
                    Event.observe(elements[row],'focus',this.elementFocus);
                    Event.observe(elements[row],'blur',this.elementBlur);
                }
            }
        },

        elementOnFocus: function(event){
            var element = Event.findElement(event, 'fieldset');
            if(element){
                Element.addClassName(element, this.highlightClass);
            }
        },

        elementOnBlur: function(event){
            var element = Event.findElement(event, 'fieldset');
            if(element){
                Element.removeClassName(element, this.highlightClass);
            }
        },

        setElementsRelation: function(parent, child, dataUrl, first){
            if (parent=$(parent)) {
                // TODO: array of relation and caching
                if (!this.cache[parent.id]){
                    this.cache[parent.id] = $A();
                    this.cache[parent.id]['child']     = child;
                    this.cache[parent.id]['dataUrl']   = dataUrl;
                    this.cache[parent.id]['data']      = $A();
                    this.cache[parent.id]['first']      = first || false;
                }
                Event.observe(parent,'change',this.childLoader);
            }
        },

        onChangeChildLoad: function(event){
            element = Event.element(event);
            this.elementChildLoad(element);
        },

        elementChildLoad: function(element, callback){
            this.callback = callback || false;
            if (element.value) {
                this.currLoader = element.id;
                this.currDataIndex = element.value;
                if (this.cache[element.id]['data'][element.value]) {
                    this.setDataToChild(this.cache[element.id]['data'][element.value]);
                }
                else{
                    new Ajax.Request(this.cache[this.currLoader]['dataUrl'],{
                        method: 'post',
                        parameters: {"parent":element.value},
                        onComplete: this.reloadChildren.bind(this)
                    });
                }
            }
        },

        reloadChildren: function(transport){
            var data = eval('(' + transport.responseText + ')');
            this.cache[this.currLoader]['data'][this.currDataIndex] = data;
            this.setDataToChild(data);
        },

        setDataToChild: function(data){
            if (data.length) {
                var child = $(this.cache[this.currLoader]['child']);
                if (child){
                    var html = '<select name="'+child.name+'" id="'+child.id+'" class="'+child.className+'" title="'+child.title+'" '+this.extraChildParams+'>';
                    if(this.cache[this.currLoader]['first']){
                        html+= '<option value="">'+this.cache[this.currLoader]['first']+'</option>';
                    }
                    for (var i in data){
                        if(data[i].value) {
                            html+= '<option value="'+data[i].value+'"';
                            if(child.value && (child.value == data[i].value || child.value == data[i].label)){
                                html+= ' selected';
                            }
                            html+='>'+data[i].label+'</option>';
                        }
                    }
                    html+= '</select>';
                    Element.insert(child, {before: html});
                    Element.remove(child);
                }
            }
            else{
                var child = $(this.cache[this.currLoader]['child']);
                if (child){
                    var html = '<input type="text" name="'+child.name+'" id="'+child.id+'" class="'+child.className+'" title="'+child.title+'" '+this.extraChildParams+'>';
                    Element.insert(child, {before: html});
                    Element.remove(child);
                }
            }

            this.bindElements();
            if (this.callback) {
                this.callback();
            }
        }
    }

    RegionUpdater = Class.create();
    RegionUpdater.prototype = {
        initialize: function (countryEl, regionTextEl, regionSelectEl, regions, disableAction, zipEl)
        {
            this.countryEl = $(countryEl);
            this.regionTextEl = $(regionTextEl);
            this.regionSelectEl = $(regionSelectEl);
            this.zipEl = $(zipEl);
            this.config = regions['config'];
            delete regions.config;
            this.regions = regions;

            this.disableAction = (typeof disableAction=='undefined') ? 'hide' : disableAction;
            this.zipOptions = (typeof zipOptions=='undefined') ? false : zipOptions;

            if (this.regionSelectEl.options.length<=1) {
                this.update();
            }

            Event.observe(this.countryEl, 'change', this.update.bind(this));
        },

        _checkRegionRequired: function()
        {
            var label, wildCard;
            var elements = [this.regionTextEl, this.regionSelectEl];
            var that = this;
            if (typeof this.config == 'undefined') {
                return;
            }
            var regionRequired = this.config.regions_required.indexOf(this.countryEl.value) >= 0;

            elements.each(function(currentElement) {
                Validation.reset(currentElement);
                label = $$('label[for="' + currentElement.id + '"]')[0];
                if (label) {
                    wildCard = label.down('em') || label.down('span.required');
                    if (!that.config.show_all_regions) {
                        if (regionRequired) {
                            label.up().show();
                        } else {
                            label.up().hide();
                        }
                    }
                }

                if (label && wildCard) {
                    if (!regionRequired) {
                        wildCard.hide();
                        if (label.hasClassName('required')) {
                            label.removeClassName('required');
                        }
                    } else if (regionRequired) {
                        wildCard.show();
                        if (!label.hasClassName('required')) {
                            label.addClassName('required')
                        }
                    }
                }

                if (!regionRequired) {
                    if (currentElement.hasClassName('required-entry')) {
                        currentElement.removeClassName('required-entry');
                    }
                    if ('select' == currentElement.tagName.toLowerCase() &&
                            currentElement.hasClassName('validate-select')) {
                        currentElement.removeClassName('validate-select');
                    }
                } else {
                    if (!currentElement.hasClassName('required-entry')) {
                        currentElement.addClassName('required-entry');
                    }
                    if ('select' == currentElement.tagName.toLowerCase() &&
                            !currentElement.hasClassName('validate-select')) {
                        currentElement.addClassName('validate-select');
                    }
                }
            });
        },

        update: function()
        {
            if (this.regions[this.countryEl.value]) {
                var i, option, region, def;

                def = this.regionSelectEl.getAttribute('defaultValue');
                if (this.regionTextEl) {
                    if (!def) {
                        def = this.regionTextEl.value.toLowerCase();
                    }
                    this.regionTextEl.value = '';
                }

                this.regionSelectEl.options.length = 1;
                for (regionId in this.regions[this.countryEl.value]) {
                    region = this.regions[this.countryEl.value][regionId];

                    option = document.createElement('OPTION');
                    option.value = regionId;
                    option.text = region.name.stripTags();
                    option.title = region.name;

                    if (this.regionSelectEl.options.add) {
                        this.regionSelectEl.options.add(option);
                    } else {
                        this.regionSelectEl.appendChild(option);
                    }

                    if (regionId==def || (region.name && region.name.toLowerCase()==def) ||
                            (region.name && region.code.toLowerCase()==def)
                    ) {
                        this.regionSelectEl.value = regionId;
                    }
                }

                if (this.disableAction=='hide') {
                    if (this.regionTextEl) {
                        this.regionTextEl.style.display = 'none';
                    }

                    this.regionSelectEl.style.display = '';
                } else if (this.disableAction=='disable') {
                    if (this.regionTextEl) {
                        this.regionTextEl.disabled = true;
                    }
                    this.regionSelectEl.disabled = false;
                }
                this.setMarkDisplay(this.regionSelectEl, true);
            } else {
                if (this.disableAction=='hide') {
                    if (this.regionTextEl) {
                        this.regionTextEl.style.display = '';
                    }
                    this.regionSelectEl.style.display = 'none';
                    Validation.reset(this.regionSelectEl);
                } else if (this.disableAction=='disable') {
                    if (this.regionTextEl) {
                        this.regionTextEl.disabled = false;
                    }
                    this.regionSelectEl.disabled = true;
                } else if (this.disableAction=='nullify') {
                    this.regionSelectEl.options.length = 1;
                    this.regionSelectEl.value = '';
                    this.regionSelectEl.selectedIndex = 0;
                    this.lastCountryId = '';
                }
                this.setMarkDisplay(this.regionSelectEl, false);
            }

            this._checkRegionRequired();
            // Make Zip and its label required/optional
            var zipUpdater = new ZipUpdater(this.countryEl.value, this.zipEl);
            zipUpdater.update();
        },

        setMarkDisplay: function(elem, display){
            elem = $(elem);
            var labelElement = elem.up(0).down('label > span.required') ||
                    elem.up(1).down('label > span.required') ||
                    elem.up(0).down('label.required > em') ||
                    elem.up(1).down('label.required > em');
            if(labelElement) {
                inputElement = labelElement.up().next('input');
                if (display) {
                    labelElement.show();
                    if (inputElement) {
                        inputElement.addClassName('required-entry');
                    }
                } else {
                    labelElement.hide();
                    if (inputElement) {
                        inputElement.removeClassName('required-entry');
                    }
                }
            }
        }
    }

    ZipUpdater = Class.create();
    ZipUpdater.prototype = {
        initialize: function(country, zipElement)
        {
            this.country = country;
            this.zipElement = $(zipElement);
        },

        update: function()
        {
            // Country ISO 2-letter codes must be pre-defined
            if (typeof optionalZipCountries == 'undefined') {
                return false;
            }

            // Ajax-request and normal content load compatibility
            if (this.zipElement != undefined) {
                this._setPostcodeOptional();
            } else {
                Event.observe(window, "load", this._setPostcodeOptional.bind(this));
            }
        },

        _setPostcodeOptional: function()
        {
            this.zipElement = $(this.zipElement);
            if (this.zipElement == undefined) {
                return false;
            }

            // find label
            var label = $$('label[for="' + this.zipElement.id + '"]')[0];
            if (label != undefined) {
                var wildCard = label.down('em') || label.down('span.required');
            }

            // Make Zip and its label required/optional
            if (optionalZipCountries.indexOf(this.country) != -1) {
                while (this.zipElement.hasClassName('required-entry')) {
                    this.zipElement.removeClassName('required-entry');
                }
                if (wildCard != undefined) {
                    wildCard.hide();
                }
            } else {
                this.zipElement.addClassName('required-entry');
                if (wildCard != undefined) {
                    wildCard.show();
                }
            }
        }
    }
    </script> <script type="text/javascript"  style="display:none">/**
     * Magento
     *
     * NOTICE OF LICENSE
     *
     * This source file is subject to the Academic Free License (AFL 3.0)
     * that is bundled with this package in the file LICENSE_AFL.txt.
     * It is also available through the world-wide-web at this URL:
     * http://opensource.org/licenses/afl-3.0.php
     * If you did not receive a copy of the license and are unable to
     * obtain it through the world-wide-web, please send an email
     * to license@magentocommerce.com so we can send you a copy immediately.
     *
     * DISCLAIMER
     *
     * Do not edit or add to this file if you wish to upgrade Magento to newer
     * versions in the future. If you wish to customize Magento for your
     * needs please refer to http://www.magentocommerce.com for more information.
     *
     * @category    Varien
     * @package     js
     * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
     * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
     */

    /**
     * @classDescription simple Navigation with replacing old handlers
     * @param {String} id id of ul element with navigation lists
     * @param {Object} settings object with settings
     */
    var mainNav = function() {

        var main = {
            obj_nav :   $(arguments[0]) || $("nav"),

            settings :  {
                show_delay      :   0,
                hide_delay      :   0,
                _ie6            :   /MSIE 6.+Win/.test(navigator.userAgent),
                _ie7            :   /MSIE 7.+Win/.test(navigator.userAgent)
            },

            init :  function(obj, level) {
                obj.lists = obj.childElements();
                obj.lists.each(function(el,ind){
                    main.handlNavElement(el);
                    if((main.settings._ie6 || main.settings._ie7) && level){
                        main.ieFixZIndex(el, ind, obj.lists.size());
                    }
                });
                if(main.settings._ie6 && !level){
                    document.execCommand("BackgroundImageCache", false, true);
                }
            },

            handlNavElement :   function(list) {
                if(list !== undefined){
                    list.onmouseover = function(){
                        main.fireNavEvent(this,true);
                    };
                    list.onmouseout = function(){
                        main.fireNavEvent(this,false);
                    };
                    if(list.down("ul")){
                        main.init(list.down("ul"), true);
                    }
                }
            },

            ieFixZIndex : function(el, i, l) {
                if(el.tagName.toString().toLowerCase().indexOf("iframe") == -1){
                    el.style.zIndex = l - i;
                } else {
                    el.onmouseover = "null";
                    el.onmouseout = "null";
                }
            },

            fireNavEvent :  function(elm,ev) {
                if(ev){
                    elm.addClassName("over");
                    elm.down("a").addClassName("over");
                    if (elm.childElements()[1]) {
                        main.show(elm.childElements()[1]);
                    }
                } else {
                    elm.removeClassName("over");
                    elm.down("a").removeClassName("over");
                    if (elm.childElements()[1]) {
                        main.hide(elm.childElements()[1]);
                    }
                }
            },

            show : function (sub_elm) {
                if (sub_elm.hide_time_id) {
                    clearTimeout(sub_elm.hide_time_id);
                }
                sub_elm.show_time_id = setTimeout(function() {
                    if (!sub_elm.hasClassName("shown-sub")) {
                        sub_elm.addClassName("shown-sub");
                    }
                }, main.settings.show_delay);
            },

            hide : function (sub_elm) {
                if (sub_elm.show_time_id) {
                    clearTimeout(sub_elm.show_time_id);
                }
                sub_elm.hide_time_id = setTimeout(function(){
                    if (sub_elm.hasClassName("shown-sub")) {
                        sub_elm.removeClassName("shown-sub");
                    }
                }, main.settings.hide_delay);
            }

        };
        if (arguments[1]) {
            main.settings = Object.extend(main.settings, arguments[1]);
        }
        if (main.obj_nav) {
            main.init(main.obj_nav, false);
        }
    };

    document.observe("dom:loaded", function() {
        //run navigation without delays and with default id="#nav"
        //mainNav();

        //run navigation with delays
        mainNav("nav", {"show_delay":"100","hide_delay":"100"});
    });
    </script> <script type="text/javascript"  style="display:none">/**
     * Magento
     *
     * NOTICE OF LICENSE
     *
     * This source file is subject to the Academic Free License (AFL 3.0)
     * that is bundled with this package in the file LICENSE_AFL.txt.
     * It is also available through the world-wide-web at this URL:
     * http://opensource.org/licenses/afl-3.0.php
     * If you did not receive a copy of the license and are unable to
     * obtain it through the world-wide-web, please send an email
     * to license@magentocommerce.com so we can send you a copy immediately.
     *
     * DISCLAIMER
     *
     * Do not edit or add to this file if you wish to upgrade Magento to newer
     * versions in the future. If you wish to customize Magento for your
     * needs please refer to http://www.magentocommerce.com for more information.
     *
     * @category    Mage
     * @package     js
     * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
     * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
     */

    var Translate = Class.create();
    Translate.prototype = {
        initialize: function(data){
            this.data = $H(data);
        },

        translate : function(){
            var args = arguments;
            var text = arguments[0];

            if(this.data.get(text)){
                return this.data.get(text);
            }
            return text;
        },
        add : function() {
            if (arguments.length > 1) {
                this.data.set(arguments[0], arguments[1]);
            } else if (typeof arguments[0] =='object') {
                $H(arguments[0]).each(function (pair){
                    this.data.set(pair.key, pair.value);
                }.bind(this));
            }
        }
    }
    </script> <script type="text/javascript"  style="display:none">/**
     * Magento
     *
     * NOTICE OF LICENSE
     *
     * This source file is subject to the Academic Free License (AFL 3.0)
     * that is bundled with this package in the file LICENSE_AFL.txt.
     * It is also available through the world-wide-web at this URL:
     * http://opensource.org/licenses/afl-3.0.php
     * If you did not receive a copy of the license and are unable to
     * obtain it through the world-wide-web, please send an email
     * to license@magentocommerce.com so we can send you a copy immediately.
     *
     * DISCLAIMER
     *
     * Do not edit or add to this file if you wish to upgrade Magento to newer
     * versions in the future. If you wish to customize Magento for your
     * needs please refer to http://www.magentocommerce.com for more information.
     *
     * @category    Mage
     * @package     js
     * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
     * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
     */
    // old school cookie functions grabbed off the web

    if (!window.Mage) var Mage = {};

    Mage.Cookies = {};
    Mage.Cookies.expires  = null;
    Mage.Cookies.path     = '/';
    Mage.Cookies.domain   = null;
    Mage.Cookies.secure   = false;
    Mage.Cookies.set = function(name, value){
        var argv = arguments;
        var argc = arguments.length;
        var expires = (argc > 2) ? argv[2] : Mage.Cookies.expires;
        var path = (argc > 3) ? argv[3] : Mage.Cookies.path;
        var domain = (argc > 4) ? argv[4] : Mage.Cookies.domain;
        var secure = (argc > 5) ? argv[5] : Mage.Cookies.secure;
        document.cookie = name + "=" + escape (value) +
                ((expires == null) ? "" : ("; expires=" + expires.toGMTString())) +
                ((path == null) ? "" : ("; path=" + path)) +
                ((domain == null) ? "" : ("; domain=" + domain)) +
                ((secure == true) ? "; secure" : "");
    };

    Mage.Cookies.get = function(name){
        var arg = name + "=";
        var alen = arg.length;
        var clen = document.cookie.length;
        var i = 0;
        var j = 0;
        while(i < clen){
            j = i + alen;
            if (document.cookie.substring(i, j) == arg)
                return Mage.Cookies.getCookieVal(j);
            i = document.cookie.indexOf(" ", i) + 1;
            if(i == 0)
                break;
        }
        return null;
    };

    Mage.Cookies.clear = function(name) {
        if(Mage.Cookies.get(name)){
            document.cookie = name + "=" +
                    "; expires=Thu, 01-Jan-70 00:00:01 GMT";
        }
    };

    Mage.Cookies.getCookieVal = function(offset){
        var endstr = document.cookie.indexOf(";", offset);
        if(endstr == -1){
            endstr = document.cookie.length;
        }
        return unescape(document.cookie.substring(offset, endstr));
    };
    </script> <script type="text/javascript"  style="display:none">/**
     * Lightbox
     *
     * This libary is used to create a lightbox in a web application. This library
     * requires the Prototype 1.6 library and Script.aculo.us core, effects, and dragdrop
     * libraries. To use, add a div containing the content to be displayed anywhere on
     * the page. To create the lightbox, add the following code:
     *
     * var test;
     *
     * Event.observe(window, 'load', function () {
* test = new Lightbox('idOfMyDiv');
* });
     *
     * Event.observe('lightboxLink', 'click', function () {
* test.open();
* });
     *
     * Event.observe('closeLink', 'click', function () {
* test.close();
* });
     *
     */
    var Lightbox = Class.create({
                open : function () {
                    this._centerWindow(this.container);
                    this._fade('open', this.container);
                },
                close : function () {
                    this._fade('close', this.container);
                },
                _fade : function fadeBg(userAction,whichDiv){
                    if(userAction=='close'){
                        new Effect.Opacity('bg_fade',
                                {duration:.2,
                                    from:0.6,
                                    to:0,
                                    afterFinish:this._makeInvisible,
                                    afterUpdate:this._hideLayer(whichDiv)});
                    }else{
                        new Effect.Opacity('bg_fade',
                                {duration:.2,
                                    from:0,
                                    to:0.6,
                                    beforeUpdate:this._makeVisible,
                                    afterFinish:this._showLayer(whichDiv)});
                    }
                },
                _makeVisible : function makeVisible(){
                    $("bg_fade").style.visibility="visible";
                },
                _makeInvisible : function makeInvisible(){
                    $("bg_fade").style.visibility="hidden";
                },
                _showLayer : function showLayer(userAction){
                    $(userAction).style.display="block";
                },
                _hideLayer : function hideLayer(userAction){
                    $(userAction).style.display="none";
                },
                _centerWindow : function centerWindow(element) {
                    var windowHeight = parseFloat($(element).getHeight())/2;
                    var windowWidth = parseFloat($(element).getWidth())/2;
                    if(typeof window.innerHeight != 'undefined') {
                        $(element).style.top = Math.round(document.body.offsetTop + ((window.innerHeight - $(element).getHeight()))/2)+'px';
                        $(element).style.left = Math.round(document.body.offsetLeft + ((window.innerWidth - $(element).getWidth()))/2)+'px';
                    } else {
                        $(element).style.top = Math.round(document.body.offsetTop + ((document.documentElement.offsetHeight - $(element).getHeight()))/2)+'px';
                        $(element).style.left = Math.round(document.body.offsetLeft + ((document.documentElement.offsetWidth - $(element).getWidth()))/2)+'px';
                    }
                },
                initialize : function(containerDiv) {
                    this.container = containerDiv;
                    if($('bg_fade') == null) {
                        var screen = new Element('div', {'id': 'bg_fade'});
                        document.body.appendChild(screen);
                    }
                    this._hideLayer(this.container);
                }
            }); </script> <script type="text/javascript" src="http://www.vinoseleccion.com/js/jquery/jquery.min.js"></script> <script type="text/javascript"  style="display:none">/**
     * Magento
     *
     * NOTICE OF LICENSE
     *
     * This source file is subject to the Academic Free License (AFL 3.0)
     * that is bundled with this package in the file LICENSE_AFL.txt.
     * It is also available through the world-wide-web at this URL:
     * http://opensource.org/licenses/afl-3.0.php
     * If you did not receive a copy of the license and are unable to
     * obtain it through the world-wide-web, please send an email
     * to license@magentocommerce.com so we can send you a copy immediately.
     *
     * DISCLAIMER
     *
     * Do not edit or add to this file if you wish to upgrade Magento to newer
     * versions in the future. If you wish to customize Magento for your
     * needs please refer to http://www.magentocommerce.com for more information.
     *
     * @category    Varien
     * @package     js
     * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
     * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
     */
    if(typeof Product=='undefined') {
        var Product = {};
    }

    /********************* IMAGE ZOOMER ***********************/

    Product.Zoom = Class.create();
    /**
     * Image zoom control
     *
     * @author      Magento Core Team <core@magentocommerce.com>
     */
    Product.Zoom.prototype = {
        initialize: function(imageEl, trackEl, handleEl, zoomInEl, zoomOutEl, hintEl){
            this.containerEl = $(imageEl).parentNode;
            this.imageEl = $(imageEl);
            this.handleEl = $(handleEl);
            this.trackEl = $(trackEl);
            this.hintEl = $(hintEl);

            this.containerDim = Element.getDimensions(this.containerEl);
            this.imageDim = Element.getDimensions(this.imageEl);

            this.imageDim.ratio = this.imageDim.width/this.imageDim.height;

            this.floorZoom = 1;

            if (this.imageDim.width > this.imageDim.height) {
                this.ceilingZoom = this.imageDim.width / this.containerDim.width;
            } else {
                this.ceilingZoom = this.imageDim.height / this.containerDim.height;
            }

            if (this.imageDim.width <= this.containerDim.width
                    && this.imageDim.height <= this.containerDim.height) {
                this.trackEl.up().hide();
                this.hintEl.hide();
                this.containerEl.removeClassName('product-image-zoom');
                return;
            }

            this.imageX = 0;
            this.imageY = 0;
            this.imageZoom = 1;

            this.sliderSpeed = 0;
            this.sliderAccel = 0;
            this.zoomBtnPressed = false;

            this.showFull = false;

            this.selects = document.getElementsByTagName('select');

            this.draggable = new Draggable(imageEl, {
                starteffect:false,
                reverteffect:false,
                endeffect:false,
                snap:this.contain.bind(this)
            });

            this.slider = new Control.Slider(handleEl, trackEl, {
                axis:'horizontal',
                minimum:0,
                maximum:Element.getDimensions(this.trackEl).width,
                alignX:0,
                increment:1,
                sliderValue:0,
                onSlide:this.scale.bind(this),
                onChange:this.scale.bind(this)
            });

            this.scale(0);

            Event.observe(this.imageEl, 'dblclick', this.toggleFull.bind(this));

            Event.observe($(zoomInEl), 'mousedown', this.startZoomIn.bind(this));
            Event.observe($(zoomInEl), 'mouseup', this.stopZooming.bind(this));
            Event.observe($(zoomInEl), 'mouseout', this.stopZooming.bind(this));

            Event.observe($(zoomOutEl), 'mousedown', this.startZoomOut.bind(this));
            Event.observe($(zoomOutEl), 'mouseup', this.stopZooming.bind(this));
            Event.observe($(zoomOutEl), 'mouseout', this.stopZooming.bind(this));
        },

        toggleFull: function () {
            this.showFull = !this.showFull;

            //Hide selects for IE6 only
            if (typeof document.body.style.maxHeight == "undefined")  {
                for (i=0; i<this.selects.length; i++) {
                    this.selects[i].style.visibility = this.showFull ? 'hidden' : 'visible';
                }
            }
            val_scale = !this.showFull ? this.slider.value : 1;
            this.scale(val_scale);

            this.trackEl.style.visibility = this.showFull ? 'hidden' : 'visible';
            this.containerEl.style.overflow = this.showFull ? 'visible' : 'hidden';
            this.containerEl.style.zIndex = this.showFull ? '1000' : '9';

            return this;
        },

        scale: function (v) {
            var centerX  = (this.containerDim.width*(1-this.imageZoom)/2-this.imageX)/this.imageZoom;
            var centerY  = (this.containerDim.height*(1-this.imageZoom)/2-this.imageY)/this.imageZoom;
            var overSize = (this.imageDim.width > this.containerDim.width || this.imageDim.height > this.containerDim.height);

            this.imageZoom = this.floorZoom+(v*(this.ceilingZoom-this.floorZoom));

            if (overSize) {
                if (this.imageDim.width > this.containerDim.width) {
                    this.imageEl.style.width = (this.imageZoom*this.containerDim.width)+'px';
                } else if (this.imageDim.height > this.containerDim.height) {
                    this.imageEl.style.height = (this.imageZoom*this.containerDim.height)+'px';
                }

                if(this.containerDim.ratio){
                    this.imageEl.style.height = (this.imageZoom*this.containerDim.width*this.containerDim.ratio)+'px'; // for safari
                }
            } else {
                this.slider.setDisabled();
            }

            this.imageX = this.containerDim.width*(1-this.imageZoom)/2-centerX*this.imageZoom;
            this.imageY = this.containerDim.height*(1-this.imageZoom)/2-centerY*this.imageZoom;

            this.contain(this.imageX, this.imageY, this.draggable);

            return true;
        },

        startZoomIn: function()
        {
            if (!this.slider.disabled) {
                this.zoomBtnPressed = true;
                this.sliderAccel = .002;
                this.periodicalZoom();
                this.zoomer = new PeriodicalExecuter(this.periodicalZoom.bind(this), .05);
            }
            return this;
        },

        startZoomOut: function()
        {
            if (!this.slider.disabled) {
                this.zoomBtnPressed = true;
                this.sliderAccel = -.002;
                this.periodicalZoom();
                this.zoomer = new PeriodicalExecuter(this.periodicalZoom.bind(this), .05);
            }
            return this;
        },

        stopZooming: function()
        {
            if (!this.zoomer || this.sliderSpeed==0) {
                return;
            }
            this.zoomBtnPressed = false;
            this.sliderAccel = 0;
        },

        periodicalZoom: function()
        {
            if (!this.zoomer) {
                return this;
            }

            if (this.zoomBtnPressed) {
                this.sliderSpeed += this.sliderAccel;
            } else {
                this.sliderSpeed /= 1.5;
                if (Math.abs(this.sliderSpeed)<.001) {
                    this.sliderSpeed = 0;
                    this.zoomer.stop();
                    this.zoomer = null;
                }
            }
            this.slider.value += this.sliderSpeed;

            this.slider.setValue(this.slider.value);
            this.scale(this.slider.value);

            return this;
        },

        contain: function (x,y,draggable) {

            var dim = Element.getDimensions(draggable.element);

            var xMin = 0, xMax = this.containerDim.width-dim.width;
            var yMin = 0, yMax = this.containerDim.height-dim.height;

            x = x>xMin ? xMin : x;
            x = x<xMax ? xMax : x;
            y = y>yMin ? yMin : y;
            y = y<yMax ? yMax : y;

            if (this.containerDim.width > dim.width) {
                x = (this.containerDim.width/2) - (dim.width/2);
            }

            if (this.containerDim.height > dim.height) {
                y = (this.containerDim.height/2) - (dim.height/2);
            }

            this.imageX = x;
            this.imageY = y;

            this.imageEl.style.left = this.imageX+'px';
            this.imageEl.style.top = this.imageY+'px';

            return [x,y];
        }
    }

    /**************************** CONFIGURABLE PRODUCT **************************/
    Product.Config = Class.create();
    Product.Config.prototype = {
        initialize: function(config){
            this.config     = config;
            this.taxConfig  = this.config.taxConfig;
            this.settings   = $$('.super-attribute-select');
            this.state      = new Hash();
            this.priceTemplate = new Template(this.config.template);
            this.prices     = config.prices;

            this.settings.each(function(element){
                Event.observe(element, 'change', this.configure.bind(this))
            }.bind(this));

            // fill state
            this.settings.each(function(element){
                var attributeId = element.id.replace(/[a-z]*/, '');
                if(attributeId && this.config.attributes[attributeId]) {
                    element.config = this.config.attributes[attributeId];
                    element.attributeId = attributeId;
                    this.state[attributeId] = false;
                }
            }.bind(this))

            // Init settings dropdown
            var childSettings = [];
            for(var i=this.settings.length-1;i>=0;i--){
                var prevSetting = this.settings[i-1] ? this.settings[i-1] : false;
                var nextSetting = this.settings[i+1] ? this.settings[i+1] : false;
                if(i==0){
                    this.fillSelect(this.settings[i])
                }
                else {
                    this.settings[i].disabled=true;
                }
                $(this.settings[i]).childSettings = childSettings.clone();
                $(this.settings[i]).prevSetting   = prevSetting;
                $(this.settings[i]).nextSetting   = nextSetting;
                childSettings.push(this.settings[i]);
            }

            // Set default values - from config and overwrite them by url values
            if (config.defaultValues) {
                this.values = config.defaultValues;
            }

            var separatorIndex = window.location.href.indexOf('#');
            if (separatorIndex != -1) {
                var paramsStr = window.location.href.substr(separatorIndex+1);
                var urlValues = paramsStr.toQueryParams();
                if (!this.values) {
                    this.values = {};
                }
                for (var i in urlValues) {
                    this.values[i] = urlValues[i];
                }
            }

            this.configureForValues();
            document.observe("dom:loaded", this.configureForValues.bind(this));
        },

        configureForValues: function () {
            if (this.values) {
                this.settings.each(function(element){
                    var attributeId = element.attributeId;
                    element.value = (typeof(this.values[attributeId]) == 'undefined')? '' : this.values[attributeId];
                    this.configureElement(element);
                }.bind(this));
            }
        },

        configure: function(event){
            var element = Event.element(event);
            this.configureElement(element);
        },

        configureElement : function(element) {
            this.reloadOptionLabels(element);
            if(element.value){
                this.state[element.config.id] = element.value;
                if(element.nextSetting){
                    element.nextSetting.disabled = false;
                    this.fillSelect(element.nextSetting);
                    this.resetChildren(element.nextSetting);
                }
            }
            else {
                this.resetChildren(element);
            }
            this.reloadPrice();
//      Calculator.updatePrice();
        },

        reloadOptionLabels: function(element){
            var selectedPrice;
            if(element.options[element.selectedIndex].config){
                selectedPrice = parseFloat(element.options[element.selectedIndex].config.price)
            }
            else{
                selectedPrice = 0;
            }
            for(var i=0;i<element.options.length;i++){
                if(element.options[i].config){
                    element.options[i].text = this.getOptionLabel(element.options[i].config, element.options[i].config.price-selectedPrice);
                }
            }
        },

        resetChildren : function(element){
            if(element.childSettings) {
                for(var i=0;i<element.childSettings.length;i++){
                    element.childSettings[i].selectedIndex = 0;
                    element.childSettings[i].disabled = true;
                    if(element.config){
                        this.state[element.config.id] = false;
                    }
                }
            }
        },

        fillSelect: function(element){
            var attributeId = element.id.replace(/[a-z]*/, '');
            var options = this.getAttributeOptions(attributeId);
            this.clearSelect(element);
            element.options[0] = new Option(this.config.chooseText, '');

            var prevConfig = false;
            if(element.prevSetting){
                prevConfig = element.prevSetting.options[element.prevSetting.selectedIndex];
            }

            if(options) {
                var index = 1;
                for(var i=0;i<options.length;i++){
                    var allowedProducts = [];
                    if(prevConfig) {
                        for(var j=0;j<options[i].products.length;j++){
                            if(prevConfig.config.allowedProducts
                                    && prevConfig.config.allowedProducts.indexOf(options[i].products[j])>-1){
                                allowedProducts.push(options[i].products[j]);
                            }
                        }
                    } else {
                        allowedProducts = options[i].products.clone();
                    }

                    if(allowedProducts.size()>0){
                        options[i].allowedProducts = allowedProducts;
                        element.options[index] = new Option(this.getOptionLabel(options[i], options[i].price), options[i].id);
                        element.options[index].config = options[i];
                        index++;
                    }
                }
            }
        },

        getOptionLabel: function(option, price){
            var price = parseFloat(price);
            if (this.taxConfig.includeTax) {
                var tax = price / (100 + this.taxConfig.defaultTax) * this.taxConfig.defaultTax;
                var excl = price - tax;
                var incl = excl*(1+(this.taxConfig.currentTax/100));
            } else {
                var tax = price * (this.taxConfig.currentTax / 100);
                var excl = price;
                var incl = excl + tax;
            }

            if (this.taxConfig.showIncludeTax || this.taxConfig.showBothPrices) {
                price = incl;
            } else {
                price = excl;
            }

            var str = option.label;
            if(price){
                if (this.taxConfig.showBothPrices) {
                    str+= ' ' + this.formatPrice(excl, true) + ' (' + this.formatPrice(price, true) + ' ' + this.taxConfig.inclTaxTitle + ')';
                } else {
                    str+= ' ' + this.formatPrice(price, true);
                }
            }
            return str;
        },

        formatPrice: function(price, showSign){
            var str = '';
            price = parseFloat(price);
            if(showSign){
                if(price<0){
                    str+= '-';
                    price = -price;
                }
                else{
                    str+= '+';
                }
            }

            var roundedPrice = (Math.round(price*100)/100).toString();

            if (this.prices && this.prices[roundedPrice]) {
                str+= this.prices[roundedPrice];
            }
            else {
                str+= this.priceTemplate.evaluate({price:price.toFixed(2)});
            }
            return str;
        },

        clearSelect: function(element){
            for(var i=element.options.length-1;i>=0;i--){
                element.remove(i);
            }
        },

        getAttributeOptions: function(attributeId){
            if(this.config.attributes[attributeId]){
                return this.config.attributes[attributeId].options;
            }
        },

        reloadPrice: function(){
            var price    = 0;
            var oldPrice = 0;
            for(var i=this.settings.length-1;i>=0;i--){
                var selected = this.settings[i].options[this.settings[i].selectedIndex];
                if(selected.config){
                    price    += parseFloat(selected.config.price);
                    oldPrice += parseFloat(selected.config.oldPrice);
                }
            }

            optionsPrice.changePrice('config', {'price': price, 'oldPrice': oldPrice});
            optionsPrice.reload();

            return price;

            if($('product-price-'+this.config.productId)){
                $('product-price-'+this.config.productId).innerHTML = price;
            }
            this.reloadOldPrice();
        },

        reloadOldPrice: function(){
            if ($('old-price-'+this.config.productId)) {

                var price = parseFloat(this.config.oldPrice);
                for(var i=this.settings.length-1;i>=0;i--){
                    var selected = this.settings[i].options[this.settings[i].selectedIndex];
                    if(selected.config){
                        var parsedOldPrice = parseFloat(selected.config.oldPrice);
                        price += isNaN(parsedOldPrice) ? 0 : parsedOldPrice;
                    }
                }
                if (price < 0)
                    price = 0;
                price = this.formatPrice(price);

                if($('old-price-'+this.config.productId)){
                    $('old-price-'+this.config.productId).innerHTML = price;
                }

            }
        }
    }


    /**************************** SUPER PRODUCTS ********************************/

    Product.Super = {};
    Product.Super.Configurable = Class.create();

    Product.Super.Configurable.prototype = {
        initialize: function(container, observeCss, updateUrl, updatePriceUrl, priceContainerId) {
            this.container = $(container);
            this.observeCss = observeCss;
            this.updateUrl = updateUrl;
            this.updatePriceUrl = updatePriceUrl;
            this.priceContainerId = priceContainerId;
            this.registerObservers();
        },
        registerObservers: function() {
            var elements = this.container.getElementsByClassName(this.observeCss);
            elements.each(function(element){
                Event.observe(element, 'change', this.update.bindAsEventListener(this));
            }.bind(this));
            return this;
        },
        update: function(event) {
            var elements = this.container.getElementsByClassName(this.observeCss);
            var parameters = Form.serializeElements(elements, true);

            new Ajax.Updater(this.container, this.updateUrl + '?ajax=1', {
                parameters:parameters,
                onComplete:this.registerObservers.bind(this)
            });
            var priceContainer = $(this.priceContainerId);
            if(priceContainer) {
                new Ajax.Updater(priceContainer, this.updatePriceUrl + '?ajax=1', {
                    parameters:parameters
                });
            }
        }
    }

    /**************************** PRICE RELOADER ********************************/
    Product.OptionsPrice = Class.create();
    Product.OptionsPrice.prototype = {
        initialize: function(config) {
            this.productId          = config.productId;
            this.priceFormat        = config.priceFormat;
            this.includeTax         = config.includeTax;
            this.defaultTax         = config.defaultTax;
            this.currentTax         = config.currentTax;
            this.productPrice       = config.productPrice;
            this.showIncludeTax     = config.showIncludeTax;
            this.showBothPrices     = config.showBothPrices;
            this.productOldPrice    = config.productOldPrice;
            this.priceInclTax       = config.priceInclTax;
            this.priceExclTax       = config.priceExclTax;
            this.skipCalculate      = config.skipCalculate;//@deprecated after 1.5.1.0
            this.duplicateIdSuffix  = config.idSuffix;
            this.specialTaxPrice    = config.specialTaxPrice;
            this.tierPrices         = config.tierPrices;
            this.tierPricesInclTax  = config.tierPricesInclTax;

            this.oldPlusDisposition = config.oldPlusDisposition;
            this.plusDisposition    = config.plusDisposition;
            this.plusDispositionTax = config.plusDispositionTax;

            this.oldMinusDisposition = config.oldMinusDisposition;
            this.minusDisposition    = config.minusDisposition;

            this.exclDisposition     = config.exclDisposition;

            this.optionPrices   = {};
            this.customPrices   = {};
            this.containers     = {};

            this.displayZeroPrice   = true;

            this.initPrices();
        },

        setDuplicateIdSuffix: function(idSuffix) {
            this.duplicateIdSuffix = idSuffix;
        },

        initPrices: function() {
            this.containers[0] = 'product-price-' + this.productId;
            this.containers[1] = 'bundle-price-' + this.productId;
            this.containers[2] = 'price-including-tax-' + this.productId;
            this.containers[3] = 'price-excluding-tax-' + this.productId;
            this.containers[4] = 'old-price-' + this.productId;
        },

        changePrice: function(key, price) {
            this.optionPrices[key] = price;
        },

        addCustomPrices: function(key, price) {
            this.customPrices[key] = price;
        },
        getOptionPrices: function() {
            var price = 0;
            var nonTaxable = 0;
            var oldPrice = 0;
            var priceInclTax = 0;
            var currentTax = this.currentTax;
            $H(this.optionPrices).each(function(pair) {
                if ('undefined' != typeof(pair.value.price) && 'undefined' != typeof(pair.value.oldPrice)) {
                    price += parseFloat(pair.value.price);
                    oldPrice += parseFloat(pair.value.oldPrice);
                } else if (pair.key == 'nontaxable') {
                    nonTaxable = pair.value;
                } else if (pair.key == 'priceInclTax') {
                    priceInclTax += pair.value;
                } else if (pair.key == 'optionsPriceInclTax') {
                    priceInclTax += pair.value * (100 + currentTax) / 100;
                } else {
                    price += parseFloat(pair.value);
                    oldPrice += parseFloat(pair.value);
                }
            });
            var result = [price, nonTaxable, oldPrice, priceInclTax];
            return result;
        },

        reload: function() {
            var price;
            var formattedPrice;
            var optionPrices = this.getOptionPrices();
            var nonTaxable = optionPrices[1];
            var optionOldPrice = optionPrices[2];
            var priceInclTax = optionPrices[3];
            optionPrices = optionPrices[0];

            $H(this.containers).each(function(pair) {
                var _productPrice;
                var _plusDisposition;
                var _minusDisposition;
                var _priceInclTax;
                if ($(pair.value)) {
                    if (pair.value == 'old-price-'+this.productId && this.productOldPrice != this.productPrice) {
                        _productPrice = this.productOldPrice;
                        _plusDisposition = this.oldPlusDisposition;
                        _minusDisposition = this.oldMinusDisposition;
                    } else {
                        _productPrice = this.productPrice;
                        _plusDisposition = this.plusDisposition;
                        _minusDisposition = this.minusDisposition;
                    }
                    _priceInclTax = priceInclTax;

                    if (pair.value == 'old-price-'+this.productId && optionOldPrice !== undefined) {
                        price = optionOldPrice+parseFloat(_productPrice);
                    } else if (this.specialTaxPrice == 'true' && this.priceInclTax !== undefined && this.priceExclTax !== undefined) {
                        price = optionPrices+parseFloat(this.priceExclTax);
                        _priceInclTax += this.priceInclTax;
                    } else {
                        price = optionPrices+parseFloat(_productPrice);
                        _priceInclTax += parseFloat(_productPrice) * (100 + this.currentTax) / 100;
                    }

                    if (this.specialTaxPrice == 'true') {
                        var excl = price;
                        var incl = _priceInclTax;
                    } else if (this.includeTax == 'true') {
                        // tax = tax included into product price by admin
                        var tax = price / (100 + this.defaultTax) * this.defaultTax;
                        var excl = price - tax;
                        var incl = excl*(1+(this.currentTax/100));
                    } else {
                        var tax = price * (this.currentTax / 100);
                        var excl = price;
                        var incl = excl + tax;
                    }

                    var subPrice = 0;
                    var subPriceincludeTax = 0;
                    Object.values(this.customPrices).each(function(el){
                        if (el.excludeTax && el.includeTax) {
                            subPrice += parseFloat(el.excludeTax);
                            subPriceincludeTax += parseFloat(el.includeTax);
                        } else {
                            subPrice += parseFloat(el.price);
                            subPriceincludeTax += parseFloat(el.price);
                        }
                    });
                    excl += subPrice;
                    incl += subPriceincludeTax;

                    if (typeof this.exclDisposition == 'undefined') {
                        excl += parseFloat(_plusDisposition);
                    }

                    incl += parseFloat(_plusDisposition) + parseFloat(this.plusDispositionTax);
                    excl -= parseFloat(_minusDisposition);
                    incl -= parseFloat(_minusDisposition);

                    //adding nontaxlable part of options
                    excl += parseFloat(nonTaxable);
                    incl += parseFloat(nonTaxable);

                    if (pair.value == 'price-including-tax-'+this.productId) {
                        price = incl;
                    } else if (pair.value == 'price-excluding-tax-'+this.productId) {
                        price = excl;
                    } else if (pair.value == 'old-price-'+this.productId) {
                        if (this.showIncludeTax || this.showBothPrices) {
                            price = incl;
                        } else {
                            price = excl;
                        }
                    } else {
                        if (this.showIncludeTax) {
                            price = incl;
                        } else {
                            price = excl;
                        }
                    }

                    if (price < 0) price = 0;

                    if (price > 0 || this.displayZeroPrice) {
                        formattedPrice = this.formatPrice(price);
                    } else {
                        formattedPrice = '';
                    }

                    if ($(pair.value).select('.price')[0]) {
                        $(pair.value).select('.price')[0].innerHTML = formattedPrice;
                        if ($(pair.value+this.duplicateIdSuffix) && $(pair.value+this.duplicateIdSuffix).select('.price')[0]) {
                            $(pair.value+this.duplicateIdSuffix).select('.price')[0].innerHTML = formattedPrice;
                        }
                    } else {
                        $(pair.value).innerHTML = formattedPrice;
                        if ($(pair.value+this.duplicateIdSuffix)) {
                            $(pair.value+this.duplicateIdSuffix).innerHTML = formattedPrice;
                        }
                    }
                };
            }.bind(this));

            for (var i = 0; i < this.tierPrices.length; i++) {
                $$('.price.tier-' + i).each(function (el) {
                    var price = this.tierPrices[i] + parseFloat(optionPrices);
                    el.innerHTML = this.formatPrice(price);
                }, this);
                $$('.price.tier-' + i + '-incl-tax').each(function (el) {
                    var price = this.tierPricesInclTax[i] + parseFloat(optionPrices);
                    el.innerHTML = this.formatPrice(price);
                }, this);
                $$('.benefit').each(function (el) {
                    var parsePrice = function (html) {
                        return parseFloat(/\d+\.?\d*/.exec(html));
                    };
                    var container = $(this.containers[3]) ? this.containers[3] : this.containers[0];
                    var price = parsePrice($(container).innerHTML);
                    var tierPrice = $$('.price.tier-' + i);
                    tierPrice = tierPrice.length ? parseInt(tierPrice[0].innerHTML, 10) : 0;
                    var $percent = Selector.findChildElements(el, ['.percent.tier-' + i]);
                    $percent.each(function (el) {
                        el.innerHTML = Math.ceil(100 - ((100 / price) * tierPrice));
                    });
                }, this);
            }

        },
        formatPrice: function(price) {
            return formatCurrency(price, this.priceFormat);
        }
    }
    </script> <script type="text/javascript"  style="display:none">/**
     * Magento
     *
     * NOTICE OF LICENSE
     *
     * This source file is subject to the Academic Free License (AFL 3.0)
     * that is bundled with this package in the file LICENSE_AFL.txt.
     * It is also available through the world-wide-web at this URL:
     * http://opensource.org/licenses/afl-3.0.php
     * If you did not receive a copy of the license and are unable to
     * obtain it through the world-wide-web, please send an email
     * to license@magentocommerce.com so we can send you a copy immediately.
     *
     * DISCLAIMER
     *
     * Do not edit or add to this file if you wish to upgrade Magento to newer
     * versions in the future. If you wish to customize Magento for your
     * needs please refer to http://www.magentocommerce.com for more information.
     *
     * @category    Varien
     * @package     js
     * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
     * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
     */
    if (typeof Product == 'undefined') {
        var Product = {};
    }

    /**************************** CONFIGURABLE PRODUCT **************************/
    Product.Config = Class.create();
    Product.Config.prototype = {
        initialize: function(config){
            this.config     = config;
            this.taxConfig  = this.config.taxConfig;
            if (config.containerId) {
                this.settings   = $$('#' + config.containerId + ' ' + '.super-attribute-select');
            } else {
                this.settings   = $$('.super-attribute-select');
            }
            this.state      = new Hash();
            this.priceTemplate = new Template(this.config.template);
            this.prices     = config.prices;

            // Set default values from config
            if (config.defaultValues) {
                this.values = config.defaultValues;
            }

            // Overwrite defaults by url
            var separatorIndex = window.location.href.indexOf('#');
            if (separatorIndex != -1) {
                var paramsStr = window.location.href.substr(separatorIndex+1);
                var urlValues = paramsStr.toQueryParams();
                if (!this.values) {
                    this.values = {};
                }
                for (var i in urlValues) {
                    this.values[i] = urlValues[i];
                }
            }

            // Overwrite defaults by inputs values if needed
            if (config.inputsInitialized) {
                this.values = {};
                this.settings.each(function(element) {
                    if (element.value) {
                        var attributeId = element.id.replace(/[a-z]*/, '');
                        this.values[attributeId] = element.value;
                    }
                }.bind(this));
            }

            // Put events to check select reloads
            this.settings.each(function(element){
                Event.observe(element, 'change', this.configure.bind(this))
            }.bind(this));

            // fill state
            this.settings.each(function(element){
                var attributeId = element.id.replace(/[a-z]*/, '');
                if(attributeId && this.config.attributes[attributeId]) {
                    element.config = this.config.attributes[attributeId];
                    element.attributeId = attributeId;
                    this.state[attributeId] = false;
                }
            }.bind(this))

            // Init settings dropdown
            var childSettings = [];
            for(var i=this.settings.length-1;i>=0;i--){
                var prevSetting = this.settings[i-1] ? this.settings[i-1] : false;
                var nextSetting = this.settings[i+1] ? this.settings[i+1] : false;
                if (i == 0){
                    this.fillSelect(this.settings[i])
                } else {
                    this.settings[i].disabled = true;
                }
                $(this.settings[i]).childSettings = childSettings.clone();
                $(this.settings[i]).prevSetting   = prevSetting;
                $(this.settings[i]).nextSetting   = nextSetting;
                childSettings.push(this.settings[i]);
            }

            // Set values to inputs
            this.configureForValues();
            document.observe("dom:loaded", this.configureForValues.bind(this));
        },

        configureForValues: function () {
            if (this.values) {
                this.settings.each(function(element){
                    var attributeId = element.attributeId;
                    element.value = (typeof(this.values[attributeId]) == 'undefined')? '' : this.values[attributeId];
                    this.configureElement(element);
                }.bind(this));
            }
        },

        configure: function(event){
            var element = Event.element(event);
            this.configureElement(element);
        },

        configureElement : function(element) {
            this.reloadOptionLabels(element);
            if(element.value){
                this.state[element.config.id] = element.value;
                if(element.nextSetting){
                    element.nextSetting.disabled = false;
                    this.fillSelect(element.nextSetting);
                    this.resetChildren(element.nextSetting);
                }
            }
            else {
                this.resetChildren(element);
            }
            this.reloadPrice();
        },

        reloadOptionLabels: function(element){
            var selectedPrice;
            if(element.options[element.selectedIndex].config && !this.config.stablePrices){
                selectedPrice = parseFloat(element.options[element.selectedIndex].config.price)
            }
            else{
                selectedPrice = 0;
            }
            for(var i=0;i<element.options.length;i++){
                if(element.options[i].config){
                    element.options[i].text = this.getOptionLabel(element.options[i].config, element.options[i].config.price-selectedPrice);
                }
            }
        },

        resetChildren : function(element){
            if(element.childSettings) {
                for(var i=0;i<element.childSettings.length;i++){
                    element.childSettings[i].selectedIndex = 0;
                    element.childSettings[i].disabled = true;
                    if(element.config){
                        this.state[element.config.id] = false;
                    }
                }
            }
        },

        fillSelect: function(element){
            var attributeId = element.id.replace(/[a-z]*/, '');
            var options = this.getAttributeOptions(attributeId);
            this.clearSelect(element);
            element.options[0] = new Option(this.config.chooseText, '');

            var prevConfig = false;
            if(element.prevSetting){
                prevConfig = element.prevSetting.options[element.prevSetting.selectedIndex];
            }

            if(options) {
                var index = 1;
                for(var i=0;i<options.length;i++){
                    var allowedProducts = [];
                    if(prevConfig) {
                        for(var j=0;j<options[i].products.length;j++){
                            if(prevConfig.config.allowedProducts
                                    && prevConfig.config.allowedProducts.indexOf(options[i].products[j])>-1){
                                allowedProducts.push(options[i].products[j]);
                            }
                        }
                    } else {
                        allowedProducts = options[i].products.clone();
                    }

                    if(allowedProducts.size()>0){
                        options[i].allowedProducts = allowedProducts;
                        element.options[index] = new Option(this.getOptionLabel(options[i], options[i].price), options[i].id);
                        if (typeof options[i].price != 'undefined') {
                            element.options[index].setAttribute('price', options[i].price);
                        }
                        element.options[index].config = options[i];
                        index++;
                    }
                }
            }
        },

        getOptionLabel: function(option, price){
            var price = parseFloat(price);
            if (this.taxConfig.includeTax) {
                var tax = price / (100 + this.taxConfig.defaultTax) * this.taxConfig.defaultTax;
                var excl = price - tax;
                var incl = excl*(1+(this.taxConfig.currentTax/100));
            } else {
                var tax = price * (this.taxConfig.currentTax / 100);
                var excl = price;
                var incl = excl + tax;
            }

            if (this.taxConfig.showIncludeTax || this.taxConfig.showBothPrices) {
                price = incl;
            } else {
                price = excl;
            }

            var str = option.label;
            if(price){
                if (this.taxConfig.showBothPrices) {
                    str+= ' ' + this.formatPrice(excl, true) + ' (' + this.formatPrice(price, true) + ' ' + this.taxConfig.inclTaxTitle + ')';
                } else {
                    str+= ' ' + this.formatPrice(price, true);
                }
            }
            return str;
        },

        formatPrice: function(price, showSign){
            var str = '';
            price = parseFloat(price);
            if(showSign){
                if(price<0){
                    str+= '-';
                    price = -price;
                }
                else{
                    str+= '+';
                }
            }

            var roundedPrice = (Math.round(price*100)/100).toString();

            if (this.prices && this.prices[roundedPrice]) {
                str+= this.prices[roundedPrice];
            }
            else {
                str+= this.priceTemplate.evaluate({price:price.toFixed(2)});
            }
            return str;
        },

        clearSelect: function(element){
            for(var i=element.options.length-1;i>=0;i--){
                element.remove(i);
            }
        },

        getAttributeOptions: function(attributeId){
            if(this.config.attributes[attributeId]){
                return this.config.attributes[attributeId].options;
            }
        },

        reloadPrice: function(){
            if (this.config.disablePriceReload) {
                return;
            }
            var price    = 0;
            var oldPrice = 0;
            for(var i=this.settings.length-1;i>=0;i--){
                var selected = this.settings[i].options[this.settings[i].selectedIndex];
                if(selected.config){
                    price    += parseFloat(selected.config.price);
                    oldPrice += parseFloat(selected.config.oldPrice);
                }
            }

            optionsPrice.changePrice('config', {'price': price, 'oldPrice': oldPrice});
            optionsPrice.reload();

            return price;

            if($('product-price-'+this.config.productId)){
                $('product-price-'+this.config.productId).innerHTML = price;
            }
            this.reloadOldPrice();
        },

        reloadOldPrice: function(){
            if (this.config.disablePriceReload) {
                return;
            }
            if ($('old-price-'+this.config.productId)) {

                var price = parseFloat(this.config.oldPrice);
                for(var i=this.settings.length-1;i>=0;i--){
                    var selected = this.settings[i].options[this.settings[i].selectedIndex];
                    if(selected.config){
                        price+= parseFloat(selected.config.price);
                    }
                }
                if (price < 0)
                    price = 0;
                price = this.formatPrice(price);

                if($('old-price-'+this.config.productId)){
                    $('old-price-'+this.config.productId).innerHTML = price;
                }

            }
        }
    }
    </script> <script type="text/javascript"  style="display:none">/*  Copyright Mihai Bazon, 2002-2005 | www.bazon.net/mishoo
     * -----------------------------------------------------------
     *
     * The DHTML Calendar, version 1.0 "It is happening again"
     *
     * Details and latest version at:
     * www.dynarch.com/projects/calendar
     *
     * This script is developed by Dynarch.com.  Visit us at www.dynarch.com.
     *
     * This script is distributed under the GNU Lesser General Public License.
     * Read the entire license text here: http://www.gnu.org/licenses/lgpl.html
     */

    // $Id: calendar.js,v 1.51 2005/03/07 16:44:31 mishoo Exp $

    /** The Calendar object constructor. */
    Calendar = function (firstDayOfWeek, dateStr, onSelected, onClose) {
        // member variables
        this.activeDiv = null;
        this.currentDateEl = null;
        this.getDateStatus = null;
        this.getDateToolTip = null;
        this.getDateText = null;
        this.timeout = null;
        this.onSelected = onSelected || null;
        this.onClose = onClose || null;
        this.dragging = false;
        this.hidden = false;
        this.minYear = 1970;
        this.maxYear = 2050;
        this.dateFormat = Calendar._TT["DEF_DATE_FORMAT"];
        this.ttDateFormat = Calendar._TT["TT_DATE_FORMAT"];
        this.isPopup = true;
        this.weekNumbers = true;
        this.firstDayOfWeek = typeof firstDayOfWeek == "number" ? firstDayOfWeek : Calendar._FD; // 0 for Sunday, 1 for Monday, etc.
        this.showsOtherMonths = false;
        this.dateStr = dateStr;
        this.ar_days = null;
        this.showsTime = false;
        this.time24 = true;
        this.yearStep = 2;
        this.hiliteToday = true;
        this.multiple = null;
        // HTML elements
        this.table = null;
        this.element = null;
        this.tbody = null;
        this.firstdayname = null;
        // Combo boxes
        this.monthsCombo = null;
        this.yearsCombo = null;
        this.hilitedMonth = null;
        this.activeMonth = null;
        this.hilitedYear = null;
        this.activeYear = null;
        // Information
        this.dateClicked = false;

        // one-time initializations
        if (typeof Calendar._SDN == "undefined") {
            // table of short day names
            if (typeof Calendar._SDN_len == "undefined")
                Calendar._SDN_len = 3;
            var ar = new Array();
            for (var i = 8; i > 0;) {
                ar[--i] = Calendar._DN[i].substr(0, Calendar._SDN_len);
            }
            Calendar._SDN = ar;
            // table of short month names
            if (typeof Calendar._SMN_len == "undefined")
                Calendar._SMN_len = 3;
            ar = new Array();
            for (var i = 12; i > 0;) {
                ar[--i] = Calendar._MN[i].substr(0, Calendar._SMN_len);
            }
            Calendar._SMN = ar;
        }
    };

    // ** constants

    /// "static", needed for event handlers.
    Calendar._C = null;

    /// detect a special case of "web browser"
    Calendar.is_ie = ( /msie/i.test(navigator.userAgent) &&
    !/opera/i.test(navigator.userAgent) );

    Calendar.is_ie5 = ( Calendar.is_ie && /msie 5\.0/i.test(navigator.userAgent) );

    /// detect Opera browser
    Calendar.is_opera = /opera/i.test(navigator.userAgent);

    /// detect KHTML-based browsers
    Calendar.is_khtml = /Konqueror|Safari|KHTML/i.test(navigator.userAgent);

    /// detect Gecko browsers
    Calendar.is_gecko = navigator.userAgent.match(/gecko/i);

    // BEGIN: UTILITY FUNCTIONS; beware that these might be moved into a separate
    //        library, at some point.

    // Returns CSS property for element
    Calendar.getStyle = function(element, style) {
        if (element.currentStyle) {
            var y = element.currentStyle[style];
        } else if (window.getComputedStyle) {
            var y = document.defaultView.getComputedStyle(element,null).getPropertyValue(style);
        }

        return y;
    };

    /*
     * Different ways to find element's absolute position
     */
    Calendar.getAbsolutePos = function(element) {

        var res = new Object();
        res.x = 0; res.y = 0;

        // variant 1 (working best, copy-paste from prototype library)
        do {
            res.x += element.offsetLeft || 0;
            res.y += element.offsetTop  || 0;
            element = element.offsetParent;
            if (element) {
                if (element.tagName.toUpperCase() == 'BODY') break;
                var p = Calendar.getStyle(element, 'position');
                if ((p !== 'static') && (p !== 'relative')) break;
            }
        } while (element);

        return res;

        // variant 2 (good solution, but lost in IE8)
        if (element !== null) {
            res.x = element.offsetLeft;
            res.y = element.offsetTop;

            var offsetParent = element.offsetParent;
            var parentNode = element.parentNode;

            while (offsetParent !== null) {
                res.x += offsetParent.offsetLeft;
                res.y += offsetParent.offsetTop;

                if (offsetParent != document.body && offsetParent != document.documentElement) {
                    res.x -= offsetParent.scrollLeft;
                    res.y -= offsetParent.scrollTop;
                }
                //next lines are necessary to support FireFox problem with offsetParent
                if (Calendar.is_gecko) {
                    while (offsetParent != parentNode && parentNode !== null) {
                        res.x -= parentNode.scrollLeft;
                        res.y -= parentNode.scrollTop;
                        parentNode = parentNode.parentNode;
                    }
                }
                parentNode = offsetParent.parentNode;
                offsetParent = offsetParent.offsetParent;
            }
        }
        return res;

        // variant 2 (not working)

//    var SL = 0, ST = 0;
//    var is_div = /^div$/i.test(el.tagName);
//    if (is_div && el.scrollLeft)
//        SL = el.scrollLeft;
//    if (is_div && el.scrollTop)
//        ST = el.scrollTop;
//    var r = { x: el.offsetLeft - SL, y: el.offsetTop - ST };
//    if (el.offsetParent) {
//        var tmp = this.getAbsolutePos(el.offsetParent);
//        r.x += tmp.x;
//        r.y += tmp.y;
//    }
//    return r;
    };

    Calendar.isRelated = function (el, evt) {
        var related = evt.relatedTarget;
        if (!related) {
            var type = evt.type;
            if (type == "mouseover") {
                related = evt.fromElement;
            } else if (type == "mouseout") {
                related = evt.toElement;
            }
        }
        while (related) {
            if (related == el) {
                return true;
            }
            related = related.parentNode;
        }
        return false;
    };

    Calendar.removeClass = function(el, className) {
        if (!(el && el.className)) {
            return;
        }
        var cls = el.className.split(" ");
        var ar = new Array();
        for (var i = cls.length; i > 0;) {
            if (cls[--i] != className) {
                ar[ar.length] = cls[i];
            }
        }
        el.className = ar.join(" ");
    };

    Calendar.addClass = function(el, className) {
        Calendar.removeClass(el, className);
        el.className += " " + className;
    };

    // FIXME: the following 2 functions totally suck, are useless and should be replaced immediately.
    Calendar.getElement = function(ev) {
        var f = Calendar.is_ie ? window.event.srcElement : ev.currentTarget;
        while (f.nodeType != 1 || /^div$/i.test(f.tagName))
            f = f.parentNode;
        return f;
    };

    Calendar.getTargetElement = function(ev) {
        var f = Calendar.is_ie ? window.event.srcElement : ev.target;
        while (f.nodeType != 1)
            f = f.parentNode;
        return f;
    };

    Calendar.stopEvent = function(ev) {
        ev || (ev = window.event);
        if (Calendar.is_ie) {
            ev.cancelBubble = true;
            ev.returnValue = false;
        } else {
            ev.preventDefault();
            ev.stopPropagation();
        }
        return false;
    };

    Calendar.addEvent = function(el, evname, func) {
        if (el.attachEvent) { // IE
            el.attachEvent("on" + evname, func);
        } else if (el.addEventListener) { // Gecko / W3C
            el.addEventListener(evname, func, true);
        } else {
            el["on" + evname] = func;
        }
    };

    Calendar.removeEvent = function(el, evname, func) {
        if (el.detachEvent) { // IE
            el.detachEvent("on" + evname, func);
        } else if (el.removeEventListener) { // Gecko / W3C
            el.removeEventListener(evname, func, true);
        } else {
            el["on" + evname] = null;
        }
    };

    Calendar.createElement = function(type, parent) {
        var el = null;
        if (document.createElementNS) {
            // use the XHTML namespace; IE won't normally get here unless
            // _they_ "fix" the DOM2 implementation.
            el = document.createElementNS("http://www.w3.org/1999/xhtml", type);
        } else {
            el = document.createElement(type);
        }
        if (typeof parent != "undefined") {
            parent.appendChild(el);
        }
        return el;
    };

    // END: UTILITY FUNCTIONS

    // BEGIN: CALENDAR STATIC FUNCTIONS

    /** Internal -- adds a set of events to make some element behave like a button. */
    Calendar._add_evs = function(el) {
        with (Calendar) {
            addEvent(el, "mouseover", dayMouseOver);
            addEvent(el, "mousedown", dayMouseDown);
            addEvent(el, "mouseout", dayMouseOut);
            if (is_ie) {
                addEvent(el, "dblclick", dayMouseDblClick);
                el.setAttribute("unselectable", true);
            }
        }
    };

    Calendar.findMonth = function(el) {
        if (typeof el.month != "undefined") {
            return el;
        } else if (typeof el.parentNode.month != "undefined") {
            return el.parentNode;
        }
        return null;
    };

    Calendar.findYear = function(el) {
        if (typeof el.year != "undefined") {
            return el;
        } else if (typeof el.parentNode.year != "undefined") {
            return el.parentNode;
        }
        return null;
    };

    Calendar.showMonthsCombo = function () {
        var cal = Calendar._C;
        if (!cal) {
            return false;
        }
        var cal = cal;
        var cd = cal.activeDiv;
        var mc = cal.monthsCombo;
        if (cal.hilitedMonth) {
            Calendar.removeClass(cal.hilitedMonth, "hilite");
        }
        if (cal.activeMonth) {
            Calendar.removeClass(cal.activeMonth, "active");
        }
        var mon = cal.monthsCombo.getElementsByTagName("div")[cal.date.getMonth()];
        Calendar.addClass(mon, "active");
        cal.activeMonth = mon;
        var s = mc.style;
        s.display = "block";
        if (cd.navtype < 0)
            s.left = cd.offsetLeft + "px";
        else {
            var mcw = mc.offsetWidth;
            if (typeof mcw == "undefined")
            // Konqueror brain-dead techniques
                mcw = 50;
            s.left = (cd.offsetLeft + cd.offsetWidth - mcw) + "px";
        }
        s.top = (cd.offsetTop + cd.offsetHeight) + "px";
    };

    Calendar.showYearsCombo = function (fwd) {
        var cal = Calendar._C;
        if (!cal) {
            return false;
        }
        var cal = cal;
        var cd = cal.activeDiv;
        var yc = cal.yearsCombo;
        if (cal.hilitedYear) {
            Calendar.removeClass(cal.hilitedYear, "hilite");
        }
        if (cal.activeYear) {
            Calendar.removeClass(cal.activeYear, "active");
        }
        cal.activeYear = null;
        var Y = cal.date.getFullYear() + (fwd ? 1 : -1);
        var yr = yc.firstChild;
        var show = false;
        for (var i = 12; i > 0; --i) {
            if (Y >= cal.minYear && Y <= cal.maxYear) {
                yr.innerHTML = Y;
                yr.year = Y;
                yr.style.display = "block";
                show = true;
            } else {
                yr.style.display = "none";
            }
            yr = yr.nextSibling;
            Y += fwd ? cal.yearStep : -cal.yearStep;
        }
        if (show) {
            var s = yc.style;
            s.display = "block";
            if (cd.navtype < 0)
                s.left = cd.offsetLeft + "px";
            else {
                var ycw = yc.offsetWidth;
                if (typeof ycw == "undefined")
                // Konqueror brain-dead techniques
                    ycw = 50;
                s.left = (cd.offsetLeft + cd.offsetWidth - ycw) + "px";
            }
            s.top = (cd.offsetTop + cd.offsetHeight) + "px";
        }
    };

    // event handlers

    Calendar.tableMouseUp = function(ev) {
        var cal = Calendar._C;
        if (!cal) {
            return false;
        }
        if (cal.timeout) {
            clearTimeout(cal.timeout);
        }
        var el = cal.activeDiv;
        if (!el) {
            return false;
        }
        var target = Calendar.getTargetElement(ev);
        ev || (ev = window.event);
        Calendar.removeClass(el, "active");
        if (target == el || target.parentNode == el) {
            Calendar.cellClick(el, ev);
        }
        var mon = Calendar.findMonth(target);
        var date = null;
        if (mon) {
            date = new CalendarDateObject(cal.date);
            if (mon.month != date.getMonth()) {
                date.setMonth(mon.month);
                cal.setDate(date);
                cal.dateClicked = false;
                cal.callHandler();
            }
        } else {
            var year = Calendar.findYear(target);
            if (year) {
                date = new CalendarDateObject(cal.date);
                if (year.year != date.getFullYear()) {
                    date.setFullYear(year.year);
                    cal.setDate(date);
                    cal.dateClicked = false;
                    cal.callHandler();
                }
            }
        }
        with (Calendar) {
            removeEvent(document, "mouseup", tableMouseUp);
            removeEvent(document, "mouseover", tableMouseOver);
            removeEvent(document, "mousemove", tableMouseOver);
            cal._hideCombos();
            _C = null;
            return stopEvent(ev);
        }
    };

    Calendar.tableMouseOver = function (ev) {
        var cal = Calendar._C;
        if (!cal) {
            return;
        }
        var el = cal.activeDiv;
        var target = Calendar.getTargetElement(ev);
        if (target == el || target.parentNode == el) {
            Calendar.addClass(el, "hilite active");
            Calendar.addClass(el.parentNode, "rowhilite");
        } else {
            if (typeof el.navtype == "undefined" || (el.navtype != 50 && (el.navtype == 0 || Math.abs(el.navtype) > 2)))
                Calendar.removeClass(el, "active");
            Calendar.removeClass(el, "hilite");
            Calendar.removeClass(el.parentNode, "rowhilite");
        }
        ev || (ev = window.event);
        if (el.navtype == 50 && target != el) {
            var pos = Calendar.getAbsolutePos(el);
            var w = el.offsetWidth;
            var x = ev.clientX;
            var dx;
            var decrease = true;
            if (x > pos.x + w) {
                dx = x - pos.x - w;
                decrease = false;
            } else
                dx = pos.x - x;

            if (dx < 0) dx = 0;
            var range = el._range;
            var current = el._current;
            var count = Math.floor(dx / 10) % range.length;
            for (var i = range.length; --i >= 0;)
                if (range[i] == current)
                    break;
            while (count-- > 0)
                if (decrease) {
                    if (--i < 0)
                        i = range.length - 1;
                } else if ( ++i >= range.length )
                    i = 0;
            var newval = range[i];
            el.innerHTML = newval;

            cal.onUpdateTime();
        }
        var mon = Calendar.findMonth(target);
        if (mon) {
            if (mon.month != cal.date.getMonth()) {
                if (cal.hilitedMonth) {
                    Calendar.removeClass(cal.hilitedMonth, "hilite");
                }
                Calendar.addClass(mon, "hilite");
                cal.hilitedMonth = mon;
            } else if (cal.hilitedMonth) {
                Calendar.removeClass(cal.hilitedMonth, "hilite");
            }
        } else {
            if (cal.hilitedMonth) {
                Calendar.removeClass(cal.hilitedMonth, "hilite");
            }
            var year = Calendar.findYear(target);
            if (year) {
                if (year.year != cal.date.getFullYear()) {
                    if (cal.hilitedYear) {
                        Calendar.removeClass(cal.hilitedYear, "hilite");
                    }
                    Calendar.addClass(year, "hilite");
                    cal.hilitedYear = year;
                } else if (cal.hilitedYear) {
                    Calendar.removeClass(cal.hilitedYear, "hilite");
                }
            } else if (cal.hilitedYear) {
                Calendar.removeClass(cal.hilitedYear, "hilite");
            }
        }
        return Calendar.stopEvent(ev);
    };

    Calendar.tableMouseDown = function (ev) {
        if (Calendar.getTargetElement(ev) == Calendar.getElement(ev)) {
            return Calendar.stopEvent(ev);
        }
    };

    Calendar.calDragIt = function (ev) {
        var cal = Calendar._C;
        if (!(cal && cal.dragging)) {
            return false;
        }
        var posX;
        var posY;
        if (Calendar.is_ie) {
            posY = window.event.clientY + document.body.scrollTop;
            posX = window.event.clientX + document.body.scrollLeft;
        } else {
            posX = ev.pageX;
            posY = ev.pageY;
        }
        cal.hideShowCovered();
        var st = cal.element.style;
        st.left = (posX - cal.xOffs) + "px";
        st.top = (posY - cal.yOffs) + "px";
        return Calendar.stopEvent(ev);
    };

    Calendar.calDragEnd = function (ev) {
        var cal = Calendar._C;
        if (!cal) {
            return false;
        }
        cal.dragging = false;
        with (Calendar) {
            removeEvent(document, "mousemove", calDragIt);
            removeEvent(document, "mouseup", calDragEnd);
            tableMouseUp(ev);
        }
        cal.hideShowCovered();
    };

    Calendar.dayMouseDown = function(ev) {
        var el = Calendar.getElement(ev);
        if (el.disabled) {
            return false;
        }
        var cal = el.calendar;
        cal.activeDiv = el;
        Calendar._C = cal;
        if (el.navtype != 300) with (Calendar) {
            if (el.navtype == 50) {
                el._current = el.innerHTML;
                addEvent(document, "mousemove", tableMouseOver);
            } else
                addEvent(document, Calendar.is_ie5 ? "mousemove" : "mouseover", tableMouseOver);
            addClass(el, "hilite active");
            addEvent(document, "mouseup", tableMouseUp);
        } else if (cal.isPopup) {
            cal._dragStart(ev);
        }
        if (el.navtype == -1 || el.navtype == 1) {
            if (cal.timeout) clearTimeout(cal.timeout);
            cal.timeout = setTimeout("Calendar.showMonthsCombo()", 250);
        } else if (el.navtype == -2 || el.navtype == 2) {
            if (cal.timeout) clearTimeout(cal.timeout);
            cal.timeout = setTimeout((el.navtype > 0) ? "Calendar.showYearsCombo(true)" : "Calendar.showYearsCombo(false)", 250);
        } else {
            cal.timeout = null;
        }
        return Calendar.stopEvent(ev);
    };

    Calendar.dayMouseDblClick = function(ev) {
        Calendar.cellClick(Calendar.getElement(ev), ev || window.event);
        if (Calendar.is_ie) {
            document.selection.empty();
        }
    };

    Calendar.dayMouseOver = function(ev) {
        var el = Calendar.getElement(ev);
        if (Calendar.isRelated(el, ev) || Calendar._C || el.disabled) {
            return false;
        }
        if (el.ttip) {
            if (el.ttip.substr(0, 1) == "_") {
                el.ttip = el.caldate.print(el.calendar.ttDateFormat) + el.ttip.substr(1);
            }
            el.calendar.tooltips.innerHTML = el.ttip;
        }
        if (el.navtype != 300) {
            Calendar.addClass(el, "hilite");
            if (el.caldate) {
                Calendar.addClass(el.parentNode, "rowhilite");
            }
        }
        return Calendar.stopEvent(ev);
    };

    Calendar.dayMouseOut = function(ev) {
        with (Calendar) {
            var el = getElement(ev);
            if (isRelated(el, ev) || _C || el.disabled)
                return false;
            removeClass(el, "hilite");
            if (el.caldate)
                removeClass(el.parentNode, "rowhilite");
            if (el.calendar)
                el.calendar.tooltips.innerHTML = _TT["SEL_DATE"];
            return stopEvent(ev);
        }
    };

    /**
     *  A generic "click" handler :) handles all types of buttons defined in this
     *  calendar.
     */
    Calendar.cellClick = function(el, ev) {
        var cal = el.calendar;
        var closing = false;
        var newdate = false;
        var date = null;
        if (typeof el.navtype == "undefined") {
            if (cal.currentDateEl) {
                Calendar.removeClass(cal.currentDateEl, "selected");
                Calendar.addClass(el, "selected");
                closing = (cal.currentDateEl == el);
                if (!closing) {
                    cal.currentDateEl = el;
                }
            }
            cal.date.setDateOnly(el.caldate);
            date = cal.date;
            var other_month = !(cal.dateClicked = !el.otherMonth);
            if (!other_month && !cal.currentDateEl)
                cal._toggleMultipleDate(new CalendarDateObject(date));
            else
                newdate = !el.disabled;
            // a date was clicked
            if (other_month)
                cal._init(cal.firstDayOfWeek, date);
        } else {
            if (el.navtype == 200) {
                Calendar.removeClass(el, "hilite");
                cal.callCloseHandler();
                return;
            }
            date = new CalendarDateObject(cal.date);
            if (el.navtype == 0)
                date.setDateOnly(new CalendarDateObject()); // TODAY
            // unless "today" was clicked, we assume no date was clicked so
            // the selected handler will know not to close the calenar when
            // in single-click mode.
            // cal.dateClicked = (el.navtype == 0);
            cal.dateClicked = false;
            var year = date.getFullYear();
            var mon = date.getMonth();
            function setMonth(m) {
                var day = date.getDate();
                var max = date.getMonthDays(m);
                if (day > max) {
                    date.setDate(max);
                }
                date.setMonth(m);
            };
            switch (el.navtype) {
                case 400:
                    Calendar.removeClass(el, "hilite");
                    var text = Calendar._TT["ABOUT"];
                    if (typeof text != "undefined") {
                        text += cal.showsTime ? Calendar._TT["ABOUT_TIME"] : "";
                    } else {
                        // FIXME: this should be removed as soon as lang files get updated!
                        text = "Help and about box text is not translated into this language.\n" +
                                "If you know this language and you feel generous please update\n" +
                                "the corresponding file in \"lang\" subdir to match calendar-en.js\n" +
                                "and send it back to <mihai_bazon@yahoo.com> to get it into the distribution  ;-)\n\n" +
                                "Thank you!\n" +
                                "http://dynarch.com/mishoo/calendar.epl\n";
                    }
                    alert(text);
                    return;
                case -2:
                    if (year > cal.minYear) {
                        date.setFullYear(year - 1);
                    }
                    break;
                case -1:
                    if (mon > 0) {
                        setMonth(mon - 1);
                    } else if (year-- > cal.minYear) {
                        date.setFullYear(year);
                        setMonth(11);
                    }
                    break;
                case 1:
                    if (mon < 11) {
                        setMonth(mon + 1);
                    } else if (year < cal.maxYear) {
                        date.setFullYear(year + 1);
                        setMonth(0);
                    }
                    break;
                case 2:
                    if (year < cal.maxYear) {
                        date.setFullYear(year + 1);
                    }
                    break;
                case 100:
                    cal.setFirstDayOfWeek(el.fdow);
                    return;
                case 50:
                    var range = el._range;
                    var current = el.innerHTML;
                    for (var i = range.length; --i >= 0;)
                        if (range[i] == current)
                            break;
                    if (ev && ev.shiftKey) {
                        if (--i < 0)
                            i = range.length - 1;
                    } else if ( ++i >= range.length )
                        i = 0;
                    var newval = range[i];
                    el.innerHTML = newval;
                    cal.onUpdateTime();
                    return;
                case 0:
                    // TODAY will bring us here
                    if ((typeof cal.getDateStatus == "function") &&
                            cal.getDateStatus(date, date.getFullYear(), date.getMonth(), date.getDate())) {
                        return false;
                    }
                    break;
            }
            if (!date.equalsTo(cal.date)) {
                cal.setDate(date);
                newdate = true;
            } else if (el.navtype == 0)
                newdate = closing = true;
        }
        if (newdate) {
            ev && cal.callHandler();
        }
        if (closing) {
            Calendar.removeClass(el, "hilite");
            ev && cal.callCloseHandler();
        }
    };

    // END: CALENDAR STATIC FUNCTIONS

    // BEGIN: CALENDAR OBJECT FUNCTIONS

    /**
     *  This function creates the calendar inside the given parent.  If _par is
     *  null than it creates a popup calendar inside the BODY element.  If _par is
     *  an element, be it BODY, then it creates a non-popup calendar (still
     *  hidden).  Some properties need to be set before calling this function.
     */
    Calendar.prototype.create = function (_par) {
        var parent = null;
        if (! _par) {
            // default parent is the document body, in which case we create
            // a popup calendar.
            parent = document.getElementsByTagName("body")[0];
            this.isPopup = true;
        } else {
            parent = _par;
            this.isPopup = false;
        }
        this.date = this.dateStr ? new CalendarDateObject(this.dateStr) : new CalendarDateObject();

        var table = Calendar.createElement("table");
        this.table = table;
        table.cellSpacing = 0;
        table.cellPadding = 0;
        table.calendar = this;
        Calendar.addEvent(table, "mousedown", Calendar.tableMouseDown);

        var div = Calendar.createElement("div");
        this.element = div;
        div.className = "calendar";
        if (this.isPopup) {
            div.style.position = "absolute";
            div.style.display = "none";
        }
        div.appendChild(table);

        var thead = Calendar.createElement("thead", table);
        var cell = null;
        var row = null;

        var cal = this;
        var hh = function (text, cs, navtype) {
            cell = Calendar.createElement("td", row);
            cell.colSpan = cs;
            cell.className = "button";
            if (navtype != 0 && Math.abs(navtype) <= 2)
                cell.className += " nav";
            Calendar._add_evs(cell);
            cell.calendar = cal;
            cell.navtype = navtype;
            cell.innerHTML = "<div unselectable='on'>" + text + "</div>";
            return cell;
        };

        row = Calendar.createElement("tr", thead);
        var title_length = 6;
        (this.isPopup) && --title_length;
        (this.weekNumbers) && ++title_length;

        hh("?", 1, 400).ttip = Calendar._TT["INFO"];
        this.title = hh("", title_length, 300);
        this.title.className = "title";
        if (this.isPopup) {
            this.title.ttip = Calendar._TT["DRAG_TO_MOVE"];
            this.title.style.cursor = "move";
            hh("&#x00d7;", 1, 200).ttip = Calendar._TT["CLOSE"];
        }

        row = Calendar.createElement("tr", thead);
        row.className = "headrow";

        this._nav_py = hh("&#x00ab;", 1, -2);
        this._nav_py.ttip = Calendar._TT["PREV_YEAR"];

        this._nav_pm = hh("&#x2039;", 1, -1);
        this._nav_pm.ttip = Calendar._TT["PREV_MONTH"];

        this._nav_now = hh(Calendar._TT["TODAY"], this.weekNumbers ? 4 : 3, 0);
        this._nav_now.ttip = Calendar._TT["GO_TODAY"];

        this._nav_nm = hh("&#x203a;", 1, 1);
        this._nav_nm.ttip = Calendar._TT["NEXT_MONTH"];

        this._nav_ny = hh("&#x00bb;", 1, 2);
        this._nav_ny.ttip = Calendar._TT["NEXT_YEAR"];

        // day names
        row = Calendar.createElement("tr", thead);
        row.className = "daynames";
        if (this.weekNumbers) {
            cell = Calendar.createElement("td", row);
            cell.className = "name wn";
            cell.innerHTML = Calendar._TT["WK"];
        }
        for (var i = 7; i > 0; --i) {
            cell = Calendar.createElement("td", row);
            if (!i) {
                cell.navtype = 100;
                cell.calendar = this;
                Calendar._add_evs(cell);
            }
        }
        this.firstdayname = (this.weekNumbers) ? row.firstChild.nextSibling : row.firstChild;
        this._displayWeekdays();

        var tbody = Calendar.createElement("tbody", table);
        this.tbody = tbody;

        for (i = 6; i > 0; --i) {
            row = Calendar.createElement("tr", tbody);
            if (this.weekNumbers) {
                cell = Calendar.createElement("td", row);
            }
            for (var j = 7; j > 0; --j) {
                cell = Calendar.createElement("td", row);
                cell.calendar = this;
                Calendar._add_evs(cell);
            }
        }

        if (this.showsTime) {
            row = Calendar.createElement("tr", tbody);
            row.className = "time";

            cell = Calendar.createElement("td", row);
            cell.className = "time";
            cell.colSpan = 2;
            cell.innerHTML = Calendar._TT["TIME"] || "&nbsp;";

            cell = Calendar.createElement("td", row);
            cell.className = "time";
            cell.colSpan = this.weekNumbers ? 4 : 3;

            (function(){
                function makeTimePart(className, init, range_start, range_end) {
                    var part = Calendar.createElement("span", cell);
                    part.className = className;
                    part.innerHTML = init;
                    part.calendar = cal;
                    part.ttip = Calendar._TT["TIME_PART"];
                    part.navtype = 50;
                    part._range = [];
                    if (typeof range_start != "number")
                        part._range = range_start;
                    else {
                        for (var i = range_start; i <= range_end; ++i) {
                            var txt;
                            if (i < 10 && range_end >= 10) txt = '0' + i;
                            else txt = '' + i;
                            part._range[part._range.length] = txt;
                        }
                    }
                    Calendar._add_evs(part);
                    return part;
                };
                var hrs = cal.date.getHours();
                var mins = cal.date.getMinutes();
                var t12 = !cal.time24;
                var pm = (hrs > 12);
                if (t12 && pm) hrs -= 12;
                var H = makeTimePart("hour", hrs, t12 ? 1 : 0, t12 ? 12 : 23);
                var span = Calendar.createElement("span", cell);
                span.innerHTML = ":";
                span.className = "colon";
                var M = makeTimePart("minute", mins, 0, 59);
                var AP = null;
                cell = Calendar.createElement("td", row);
                cell.className = "time";
                cell.colSpan = 2;
                if (t12)
                    AP = makeTimePart("ampm", pm ? "pm" : "am", ["am", "pm"]);
                else
                    cell.innerHTML = "&nbsp;";

                cal.onSetTime = function() {
                    var pm, hrs = this.date.getHours(),
                            mins = this.date.getMinutes();
                    if (t12) {
                        pm = (hrs >= 12);
                        if (pm) hrs -= 12;
                        if (hrs == 0) hrs = 12;
                        AP.innerHTML = pm ? "pm" : "am";
                    }
                    H.innerHTML = (hrs < 10) ? ("0" + hrs) : hrs;
                    M.innerHTML = (mins < 10) ? ("0" + mins) : mins;
                };

                cal.onUpdateTime = function() {
                    var date = this.date;
                    var h = parseInt(H.innerHTML, 10);
                    if (t12) {
                        if (/pm/i.test(AP.innerHTML) && h < 12)
                            h += 12;
                        else if (/am/i.test(AP.innerHTML) && h == 12)
                            h = 0;
                    }
                    var d = date.getDate();
                    var m = date.getMonth();
                    var y = date.getFullYear();
                    date.setHours(h);
                    date.setMinutes(parseInt(M.innerHTML, 10));
                    date.setFullYear(y);
                    date.setMonth(m);
                    date.setDate(d);
                    this.dateClicked = false;
                    this.callHandler();
                };
            })();
        } else {
            this.onSetTime = this.onUpdateTime = function() {};
        }

        var tfoot = Calendar.createElement("tfoot", table);

        row = Calendar.createElement("tr", tfoot);
        row.className = "footrow";

        cell = hh(Calendar._TT["SEL_DATE"], this.weekNumbers ? 8 : 7, 300);
        cell.className = "ttip";
        if (this.isPopup) {
            cell.ttip = Calendar._TT["DRAG_TO_MOVE"];
            cell.style.cursor = "move";
        }
        this.tooltips = cell;

        div = Calendar.createElement("div", this.element);
        this.monthsCombo = div;
        div.className = "combo";
        for (i = 0; i < Calendar._MN.length; ++i) {
            var mn = Calendar.createElement("div");
            mn.className = Calendar.is_ie ? "label-IEfix" : "label";
            mn.month = i;
            mn.innerHTML = Calendar._SMN[i];
            div.appendChild(mn);
        }

        div = Calendar.createElement("div", this.element);
        this.yearsCombo = div;
        div.className = "combo";
        for (i = 12; i > 0; --i) {
            var yr = Calendar.createElement("div");
            yr.className = Calendar.is_ie ? "label-IEfix" : "label";
            div.appendChild(yr);
        }

        this._init(this.firstDayOfWeek, this.date);
        parent.appendChild(this.element);
    };

    /** keyboard navigation, only for popup calendars */
    Calendar._keyEvent = function(ev) {
        var cal = window._dynarch_popupCalendar;
        if (!cal || cal.multiple)
            return false;
        (Calendar.is_ie) && (ev = window.event);
        var act = (Calendar.is_ie || ev.type == "keypress"),
                K = ev.keyCode;
        if (ev.ctrlKey) {
            switch (K) {
                case 37: // KEY left
                    act && Calendar.cellClick(cal._nav_pm);
                    break;
                case 38: // KEY up
                    act && Calendar.cellClick(cal._nav_py);
                    break;
                case 39: // KEY right
                    act && Calendar.cellClick(cal._nav_nm);
                    break;
                case 40: // KEY down
                    act && Calendar.cellClick(cal._nav_ny);
                    break;
                default:
                    return false;
            }
        } else switch (K) {
            case 32: // KEY space (now)
                Calendar.cellClick(cal._nav_now);
                break;
            case 27: // KEY esc
                act && cal.callCloseHandler();
                break;
            case 37: // KEY left
            case 38: // KEY up
            case 39: // KEY right
            case 40: // KEY down
                if (act) {
                    var prev, x, y, ne, el, step;
                    prev = K == 37 || K == 38;
                    step = (K == 37 || K == 39) ? 1 : 7;
                    function setVars() {
                        el = cal.currentDateEl;
                        var p = el.pos;
                        x = p & 15;
                        y = p >> 4;
                        ne = cal.ar_days[y][x];
                    };setVars();
                    function prevMonth() {
                        var date = new CalendarDateObject(cal.date);
                        date.setDate(date.getDate() - step);
                        cal.setDate(date);
                    };
                    function nextMonth() {
                        var date = new CalendarDateObject(cal.date);
                        date.setDate(date.getDate() + step);
                        cal.setDate(date);
                    };
                    while (1) {
                        switch (K) {
                            case 37: // KEY left
                                if (--x >= 0)
                                    ne = cal.ar_days[y][x];
                                else {
                                    x = 6;
                                    K = 38;
                                    continue;
                                }
                                break;
                            case 38: // KEY up
                                if (--y >= 0)
                                    ne = cal.ar_days[y][x];
                                else {
                                    prevMonth();
                                    setVars();
                                }
                                break;
                            case 39: // KEY right
                                if (++x < 7)
                                    ne = cal.ar_days[y][x];
                                else {
                                    x = 0;
                                    K = 40;
                                    continue;
                                }
                                break;
                            case 40: // KEY down
                                if (++y < cal.ar_days.length)
                                    ne = cal.ar_days[y][x];
                                else {
                                    nextMonth();
                                    setVars();
                                }
                                break;
                        }
                        break;
                    }
                    if (ne) {
                        if (!ne.disabled)
                            Calendar.cellClick(ne);
                        else if (prev)
                            prevMonth();
                        else
                            nextMonth();
                    }
                }
                break;
            case 13: // KEY enter
                if (act)
                    Calendar.cellClick(cal.currentDateEl, ev);
                break;
            default:
                return false;
        }
        return Calendar.stopEvent(ev);
    };

    /**
     *  (RE)Initializes the calendar to the given date and firstDayOfWeek
     */
    Calendar.prototype._init = function (firstDayOfWeek, date) {
        var today = new CalendarDateObject(),
                TY = today.getFullYear(),
                TM = today.getMonth(),
                TD = today.getDate();
        this.table.style.visibility = "hidden";
        var year = date.getFullYear();
        if (year < this.minYear) {
            year = this.minYear;
            date.setFullYear(year);
        } else if (year > this.maxYear) {
            year = this.maxYear;
            date.setFullYear(year);
        }
        this.firstDayOfWeek = firstDayOfWeek;
        this.date = new CalendarDateObject(date);
        var month = date.getMonth();
        var mday = date.getDate();
        var no_days = date.getMonthDays();

        // calendar voodoo for computing the first day that would actually be
        // displayed in the calendar, even if it's from the previous month.
        // WARNING: this is magic. ;-)
        date.setDate(1);
        var day1 = (date.getDay() - this.firstDayOfWeek) % 7;
        if (day1 < 0)
            day1 += 7;
        date.setDate(-day1);
        date.setDate(date.getDate() + 1);

        var row = this.tbody.firstChild;
        var MN = Calendar._SMN[month];
        var ar_days = this.ar_days = new Array();
        var weekend = Calendar._TT["WEEKEND"];
        var dates = this.multiple ? (this.datesCells = {}) : null;
        for (var i = 0; i < 6; ++i, row = row.nextSibling) {
            var cell = row.firstChild;
            if (this.weekNumbers) {
                cell.className = "day wn";
                cell.innerHTML = date.getWeekNumber();
                cell = cell.nextSibling;
            }
            row.className = "daysrow";
            var hasdays = false, iday, dpos = ar_days[i] = [];
            for (var j = 0; j < 7; ++j, cell = cell.nextSibling, date.setDate(iday + 1)) {
                iday = date.getDate();
                var wday = date.getDay();
                cell.className = "day";
                cell.pos = i << 4 | j;
                dpos[j] = cell;
                var current_month = (date.getMonth() == month);
                if (!current_month) {
                    if (this.showsOtherMonths) {
                        cell.className += " othermonth";
                        cell.otherMonth = true;
                    } else {
                        cell.className = "emptycell";
                        cell.innerHTML = "&nbsp;";
                        cell.disabled = true;
                        continue;
                    }
                } else {
                    cell.otherMonth = false;
                    hasdays = true;
                }
                cell.disabled = false;
                cell.innerHTML = this.getDateText ? this.getDateText(date, iday) : iday;
                if (dates)
                    dates[date.print("%Y%m%d")] = cell;
                if (this.getDateStatus) {
                    var status = this.getDateStatus(date, year, month, iday);
                    if (this.getDateToolTip) {
                        var toolTip = this.getDateToolTip(date, year, month, iday);
                        if (toolTip)
                            cell.title = toolTip;
                    }
                    if (status === true) {
                        cell.className += " disabled";
                        cell.disabled = true;
                    } else {
                        if (/disabled/i.test(status))
                            cell.disabled = true;
                        cell.className += " " + status;
                    }
                }
                if (!cell.disabled) {
                    cell.caldate = new CalendarDateObject(date);
                    cell.ttip = "_";
                    if (!this.multiple && current_month
                            && iday == mday && this.hiliteToday) {
                        cell.className += " selected";
                        this.currentDateEl = cell;
                    }
                    if (date.getFullYear() == TY &&
                            date.getMonth() == TM &&
                            iday == TD) {
                        cell.className += " today";
                        cell.ttip += Calendar._TT["PART_TODAY"];
                    }
                    if (weekend.indexOf(wday.toString()) != -1)
                        cell.className += cell.otherMonth ? " oweekend" : " weekend";
                }
            }
            if (!(hasdays || this.showsOtherMonths))
                row.className = "emptyrow";
        }
        this.title.innerHTML = Calendar._MN[month] + ", " + year;
        this.onSetTime();
        this.table.style.visibility = "visible";
        this._initMultipleDates();
        // PROFILE
        // this.tooltips.innerHTML = "Generated in " + ((new CalendarDateObject()) - today) + " ms";
    };

    Calendar.prototype._initMultipleDates = function() {
        if (this.multiple) {
            for (var i in this.multiple) {
                var cell = this.datesCells[i];
                var d = this.multiple[i];
                if (!d)
                    continue;
                if (cell)
                    cell.className += " selected";
            }
        }
    };

    Calendar.prototype._toggleMultipleDate = function(date) {
        if (this.multiple) {
            var ds = date.print("%Y%m%d");
            var cell = this.datesCells[ds];
            if (cell) {
                var d = this.multiple[ds];
                if (!d) {
                    Calendar.addClass(cell, "selected");
                    this.multiple[ds] = date;
                } else {
                    Calendar.removeClass(cell, "selected");
                    delete this.multiple[ds];
                }
            }
        }
    };

    Calendar.prototype.setDateToolTipHandler = function (unaryFunction) {
        this.getDateToolTip = unaryFunction;
    };

    /**
     *  Calls _init function above for going to a certain date (but only if the
     *  date is different than the currently selected one).
     */
    Calendar.prototype.setDate = function (date) {
        if (!date.equalsTo(this.date)) {
            this._init(this.firstDayOfWeek, date);
        }
    };

    /**
     *  Refreshes the calendar.  Useful if the "disabledHandler" function is
     *  dynamic, meaning that the list of disabled date can change at runtime.
     *  Just * call this function if you think that the list of disabled dates
     *  should * change.
     */
    Calendar.prototype.refresh = function () {
        this._init(this.firstDayOfWeek, this.date);
    };

    /** Modifies the "firstDayOfWeek" parameter (pass 0 for Synday, 1 for Monday, etc.). */
    Calendar.prototype.setFirstDayOfWeek = function (firstDayOfWeek) {
        this._init(firstDayOfWeek, this.date);
        this._displayWeekdays();
    };

    /**
     *  Allows customization of what dates are enabled.  The "unaryFunction"
     *  parameter must be a function object that receives the date (as a JS Date
     *  object) and returns a boolean value.  If the returned value is true then
     *  the passed date will be marked as disabled.
     */
    Calendar.prototype.setDateStatusHandler = Calendar.prototype.setDisabledHandler = function (unaryFunction) {
        this.getDateStatus = unaryFunction;
    };

    /** Customization of allowed year range for the calendar. */
    Calendar.prototype.setRange = function (a, z) {
        this.minYear = a;
        this.maxYear = z;
    };

    /** Calls the first user handler (selectedHandler). */
    Calendar.prototype.callHandler = function () {
        if (this.onSelected) {
            this.onSelected(this, this.date.print(this.dateFormat));
        }
    };

    /** Calls the second user handler (closeHandler). */
    Calendar.prototype.callCloseHandler = function () {
        if (this.onClose) {
            this.onClose(this);
        }
        this.hideShowCovered();
    };

    /** Removes the calendar object from the DOM tree and destroys it. */
    Calendar.prototype.destroy = function () {
        var el = this.element.parentNode;
        el.removeChild(this.element);
        Calendar._C = null;
        window._dynarch_popupCalendar = null;
    };

    /**
     *  Moves the calendar element to a different section in the DOM tree (changes
     *  its parent).
     */
    Calendar.prototype.reparent = function (new_parent) {
        var el = this.element;
        el.parentNode.removeChild(el);
        new_parent.appendChild(el);
    };

    // This gets called when the user presses a mouse button anywhere in the
    // document, if the calendar is shown.  If the click was outside the open
    // calendar this function closes it.
    Calendar._checkCalendar = function(ev) {
        var calendar = window._dynarch_popupCalendar;
        if (!calendar) {
            return false;
        }
        var el = Calendar.is_ie ? Calendar.getElement(ev) : Calendar.getTargetElement(ev);
        for (; el != null && el != calendar.element; el = el.parentNode);
        if (el == null) {
            // calls closeHandler which should hide the calendar.
            window._dynarch_popupCalendar.callCloseHandler();
            return Calendar.stopEvent(ev);
        }
    };

    /** Shows the calendar. */
    Calendar.prototype.show = function () {
        var rows = this.table.getElementsByTagName("tr");
        for (var i = rows.length; i > 0;) {
            var row = rows[--i];
            Calendar.removeClass(row, "rowhilite");
            var cells = row.getElementsByTagName("td");
            for (var j = cells.length; j > 0;) {
                var cell = cells[--j];
                Calendar.removeClass(cell, "hilite");
                Calendar.removeClass(cell, "active");
            }
        }
        this.element.style.display = "block";
        this.hidden = false;
        if (this.isPopup) {
            window._dynarch_popupCalendar = this;
            Calendar.addEvent(document, "keydown", Calendar._keyEvent);
            Calendar.addEvent(document, "keypress", Calendar._keyEvent);
            Calendar.addEvent(document, "mousedown", Calendar._checkCalendar);
        }
        this.hideShowCovered();
    };

    /**
     *  Hides the calendar.  Also removes any "hilite" from the class of any TD
     *  element.
     */
    Calendar.prototype.hide = function () {
        if (this.isPopup) {
            Calendar.removeEvent(document, "keydown", Calendar._keyEvent);
            Calendar.removeEvent(document, "keypress", Calendar._keyEvent);
            Calendar.removeEvent(document, "mousedown", Calendar._checkCalendar);
        }
        this.element.style.display = "none";
        this.hidden = true;
        this.hideShowCovered();
    };

    /**
     *  Shows the calendar at a given absolute position (beware that, depending on
     *  the calendar element style -- position property -- this might be relative
     *  to the parent's containing rectangle).
     */
    Calendar.prototype.showAt = function (x, y) {
        var s = this.element.style;
        s.left = x + "px";
        s.top = y + "px";
        this.show();
    };

    /** Shows the calendar near a given element. */
    Calendar.prototype.showAtElement = function (el, opts) {
        var self = this;
        var p = Calendar.getAbsolutePos(el);
        if (!opts || typeof opts != "string") {
            this.showAt(p.x, p.y + el.offsetHeight);
            return true;
        }
        function fixPosition(box) {
            if (box.x < 0)
                box.x = 0;
            if (box.y < 0)
                box.y = 0;
            var cp = document.createElement("div");
            var s = cp.style;
            s.position = "absolute";
            s.right = s.bottom = s.width = s.height = "0px";
            document.body.appendChild(cp);
            var br = Calendar.getAbsolutePos(cp);
            document.body.removeChild(cp);
            if (Calendar.is_ie) {
                br.y += document.documentElement.scrollTop;
                br.x += document.documentElement.scrollLeft;
            } else {
                br.y += window.scrollY;
                br.x += window.scrollX;
            }
            var tmp = box.x + box.width - br.x;
            if (tmp > 0) box.x -= tmp;
            tmp = box.y + box.height - br.y;
            if (tmp > 0) box.y -= tmp;
        };
        this.element.style.display = "block";
        Calendar.continuation_for_the_fucking_khtml_browser = function() {
            var w = self.element.offsetWidth;
            var h = self.element.offsetHeight;
            self.element.style.display = "none";
            var valign = opts.substr(0, 1);
            var halign = "l";
            if (opts.length > 1) {
                halign = opts.substr(1, 1);
            }
            // vertical alignment
            switch (valign) {
                case "T": p.y -= h; break;
                case "B": p.y += el.offsetHeight; break;
                case "C": p.y += (el.offsetHeight - h) / 2; break;
                case "t": p.y += el.offsetHeight - h; break;
                case "b": break; // already there
            }
            // horizontal alignment
            switch (halign) {
                case "L": p.x -= w; break;
                case "R": p.x += el.offsetWidth; break;
                case "C": p.x += (el.offsetWidth - w) / 2; break;
                case "l": p.x += el.offsetWidth - w; break;
                case "r": break; // already there
            }
            p.width = w;
            p.height = h + 40;
            self.monthsCombo.style.display = "none";
            fixPosition(p);
            self.showAt(p.x, p.y);
        };
        if (Calendar.is_khtml)
            setTimeout("Calendar.continuation_for_the_fucking_khtml_browser()", 10);
        else
            Calendar.continuation_for_the_fucking_khtml_browser();
    };

    /** Customizes the date format. */
    Calendar.prototype.setDateFormat = function (str) {
        this.dateFormat = str;
    };

    /** Customizes the tooltip date format. */
    Calendar.prototype.setTtDateFormat = function (str) {
        this.ttDateFormat = str;
    };

    /**
     *  Tries to identify the date represented in a string.  If successful it also
     *  calls this.setDate which moves the calendar to the given date.
     */
    Calendar.prototype.parseDate = function(str, fmt) {
        if (!fmt)
            fmt = this.dateFormat;
        this.setDate(Date.parseDate(str, fmt));
    };

    Calendar.prototype.hideShowCovered = function () {
        if (!Calendar.is_ie && !Calendar.is_opera)
            return;
        function getVisib(obj){
            var value = obj.style.visibility;
            if (!value) {
                if (document.defaultView && typeof (document.defaultView.getComputedStyle) == "function") { // Gecko, W3C
                    if (!Calendar.is_khtml)
                        value = document.defaultView.
                        getComputedStyle(obj, "").getPropertyValue("visibility");
                    else
                        value = '';
                } else if (obj.currentStyle) { // IE
                    value = obj.currentStyle.visibility;
                } else
                    value = '';
            }
            return value;
        };

        var tags = new Array("applet", "iframe", "select");
        var el = this.element;

        var p = Calendar.getAbsolutePos(el);
        var EX1 = p.x;
        var EX2 = el.offsetWidth + EX1;
        var EY1 = p.y;
        var EY2 = el.offsetHeight + EY1;

        for (var k = tags.length; k > 0; ) {
            var ar = document.getElementsByTagName(tags[--k]);
            var cc = null;

            for (var i = ar.length; i > 0;) {
                cc = ar[--i];

                p = Calendar.getAbsolutePos(cc);
                var CX1 = p.x;
                var CX2 = cc.offsetWidth + CX1;
                var CY1 = p.y;
                var CY2 = cc.offsetHeight + CY1;

                if (this.hidden || (CX1 > EX2) || (CX2 < EX1) || (CY1 > EY2) || (CY2 < EY1)) {
                    if (!cc.__msh_save_visibility) {
                        cc.__msh_save_visibility = getVisib(cc);
                    }
                    cc.style.visibility = cc.__msh_save_visibility;
                } else {
                    if (!cc.__msh_save_visibility) {
                        cc.__msh_save_visibility = getVisib(cc);
                    }
                    cc.style.visibility = "hidden";
                }
            }
        }
    };

    /** Internal function; it displays the bar with the names of the weekday. */
    Calendar.prototype._displayWeekdays = function () {
        var fdow = this.firstDayOfWeek;
        var cell = this.firstdayname;
        var weekend = Calendar._TT["WEEKEND"];
        for (var i = 0; i < 7; ++i) {
            cell.className = "day name";
            var realday = (i + fdow) % 7;
            if (i) {
                cell.ttip = Calendar._TT["DAY_FIRST"].replace("%s", Calendar._DN[realday]);
                cell.navtype = 100;
                cell.calendar = this;
                cell.fdow = realday;
                Calendar._add_evs(cell);
            }
            if (weekend.indexOf(realday.toString()) != -1) {
                Calendar.addClass(cell, "weekend");
            }
            cell.innerHTML = Calendar._SDN[(i + fdow) % 7];
            cell = cell.nextSibling;
        }
    };

    /** Internal function.  Hides all combo boxes that might be displayed. */
    Calendar.prototype._hideCombos = function () {
        this.monthsCombo.style.display = "none";
        this.yearsCombo.style.display = "none";
    };

    /** Internal function.  Starts dragging the element. */
    Calendar.prototype._dragStart = function (ev) {
        if (this.dragging) {
            return;
        }
        this.dragging = true;
        var posX;
        var posY;
        if (Calendar.is_ie) {
            posY = window.event.clientY + document.body.scrollTop;
            posX = window.event.clientX + document.body.scrollLeft;
        } else {
            posY = ev.clientY + window.scrollY;
            posX = ev.clientX + window.scrollX;
        }
        var st = this.element.style;
        this.xOffs = posX - parseInt(st.left);
        this.yOffs = posY - parseInt(st.top);
        with (Calendar) {
            addEvent(document, "mousemove", calDragIt);
            addEvent(document, "mouseup", calDragEnd);
        }
    };

    // BEGIN: DATE OBJECT PATCHES

    /** Adds the number of days array to the Date object. */
    Date._MD = new Array(31,28,31,30,31,30,31,31,30,31,30,31);

    /** Constants used for time computations */
    Date.SECOND = 1000 /* milliseconds */;
    Date.MINUTE = 60 * Date.SECOND;
    Date.HOUR   = 60 * Date.MINUTE;
    Date.DAY    = 24 * Date.HOUR;
    Date.WEEK   =  7 * Date.DAY;

    Date.parseDate = function(str, fmt) {
        var today = new CalendarDateObject();
        var y = 0;
        var m = -1;
        var d = 0;

        // translate date into en_US, because split() cannot parse non-latin stuff
        var a = str;
        var i;
        for (i = 0; i < Calendar._MN.length; i++) {
            a = a.replace(Calendar._MN[i], enUS.m.wide[i]);
        }
        for (i = 0; i < Calendar._SMN.length; i++) {
            a = a.replace(Calendar._SMN[i], enUS.m.abbr[i]);
        }
        a = a.replace(Calendar._am, 'am');
        a = a.replace(Calendar._am.toLowerCase(), 'am');
        a = a.replace(Calendar._pm, 'pm');
        a = a.replace(Calendar._pm.toLowerCase(), 'pm');

        a = a.split(/\W+/);

        var b = fmt.match(/%./g);
        var i = 0, j = 0;
        var hr = 0;
        var min = 0;
        for (i = 0; i < a.length; ++i) {
            if (!a[i])
                continue;
            switch (b[i]) {
                case "%d":
                case "%e":
                    d = parseInt(a[i], 10);
                    break;

                case "%m":
                    m = parseInt(a[i], 10) - 1;
                    break;

                case "%Y":
                case "%y":
                    y = parseInt(a[i], 10);
                    (y < 100) && (y += (y > 29) ? 1900 : 2000);
                    break;

                case "%b":
                    for (j = 0; j < 12; ++j) {
                        if (enUS.m.abbr[j].substr(0, a[i].length).toLowerCase() == a[i].toLowerCase()) { m = j; break; }
                    }
                    break;

                case "%B":
                    for (j = 0; j < 12; ++j) {
                        if (enUS.m.wide[j].substr(0, a[i].length).toLowerCase() == a[i].toLowerCase()) { m = j; break; }
                    }
                    break;

                case "%H":
                case "%I":
                case "%k":
                case "%l":
                    hr = parseInt(a[i], 10);
                    break;

                case "%P":
                case "%p":
                    if (/pm/i.test(a[i]) && hr < 12)
                        hr += 12;
                    else if (/am/i.test(a[i]) && hr >= 12)
                        hr -= 12;
                    break;

                case "%M":
                    min = parseInt(a[i], 10);
                    break;
            }
        }
        if (isNaN(y)) y = today.getFullYear();
        if (isNaN(m)) m = today.getMonth();
        if (isNaN(d)) d = today.getDate();
        if (isNaN(hr)) hr = today.getHours();
        if (isNaN(min)) min = today.getMinutes();
        if (y != 0 && m != -1 && d != 0)
            return new CalendarDateObject(y, m, d, hr, min, 0);
        y = 0; m = -1; d = 0;
        for (i = 0; i < a.length; ++i) {
            if (a[i].search(/[a-zA-Z]+/) != -1) {
                var t = -1;
                for (j = 0; j < 12; ++j) {
                    if (Calendar._MN[j].substr(0, a[i].length).toLowerCase() == a[i].toLowerCase()) { t = j; break; }
                }
                if (t != -1) {
                    if (m != -1) {
                        d = m+1;
                    }
                    m = t;
                }
            } else if (parseInt(a[i], 10) <= 12 && m == -1) {
                m = a[i]-1;
            } else if (parseInt(a[i], 10) > 31 && y == 0) {
                y = parseInt(a[i], 10);
                (y < 100) && (y += (y > 29) ? 1900 : 2000);
            } else if (d == 0) {
                d = a[i];
            }
        }
        if (y == 0)
            y = today.getFullYear();
        if (m != -1 && d != 0)
            return new CalendarDateObject(y, m, d, hr, min, 0);
        return today;
    };

    /** Returns the number of days in the current month */
    Date.prototype.getMonthDays = function(month) {
        var year = this.getFullYear();
        if (typeof month == "undefined") {
            month = this.getMonth();
        }
        if (((0 == (year%4)) && ( (0 != (year%100)) || (0 == (year%400)))) && month == 1) {
            return 29;
        } else {
            return Date._MD[month];
        }
    };

    /** Returns the number of day in the year. */
    Date.prototype.getDayOfYear = function() {
        var now = new CalendarDateObject(this.getFullYear(), this.getMonth(), this.getDate(), 0, 0, 0);
        var then = new CalendarDateObject(this.getFullYear(), 0, 0, 0, 0, 0);
        var time = now - then;
        return Math.floor(time / Date.DAY);
    };

    /** Returns the number of the week in year, as defined in ISO 8601. */
    Date.prototype.getWeekNumber = function() {
        var d = new CalendarDateObject(this.getFullYear(), this.getMonth(), this.getDate(), 0, 0, 0);
        var DoW = d.getDay();
        d.setDate(d.getDate() - (DoW + 6) % 7 + 3); // Nearest Thu
        var ms = d.valueOf(); // GMT
        d.setMonth(0);
        d.setDate(4); // Thu in Week 1
        return Math.round((ms - d.valueOf()) / (7 * 864e5)) + 1;
    };

    /** Checks date and time equality */
    Date.prototype.equalsTo = function(date) {
        return ((this.getFullYear() == date.getFullYear()) &&
        (this.getMonth() == date.getMonth()) &&
        (this.getDate() == date.getDate()) &&
        (this.getHours() == date.getHours()) &&
        (this.getMinutes() == date.getMinutes()));
    };

    /** Set only the year, month, date parts (keep existing time) */
    Date.prototype.setDateOnly = function(date) {
        var tmp = new CalendarDateObject(date);
        this.setDate(1);
        this.setFullYear(tmp.getFullYear());
        this.setMonth(tmp.getMonth());
        this.setDate(tmp.getDate());
    };

    /** Prints the date in a string according to the given format. */
    Date.prototype.print = function (str) {
        var m = this.getMonth();
        var d = this.getDate();
        var y = this.getFullYear();
        var wn = this.getWeekNumber();
        var w = this.getDay();
        var s = {};
        var hr = this.getHours();
        var pm = (hr >= 12);
        var ir = (pm) ? (hr - 12) : hr;
        var dy = this.getDayOfYear();
        if (ir == 0)
            ir = 12;
        var min = this.getMinutes();
        var sec = this.getSeconds();
        s["%a"] = Calendar._SDN[w]; // abbreviated weekday name [FIXME: I18N]
        s["%A"] = Calendar._DN[w]; // full weekday name
        s["%b"] = Calendar._SMN[m]; // abbreviated month name [FIXME: I18N]
        s["%B"] = Calendar._MN[m]; // full month name
        // FIXME: %c : preferred date and time representation for the current locale
        s["%C"] = 1 + Math.floor(y / 100); // the century number
        s["%d"] = (d < 10) ? ("0" + d) : d; // the day of the month (range 01 to 31)
        s["%e"] = d; // the day of the month (range 1 to 31)
        // FIXME: %D : american date style: %m/%d/%y
        // FIXME: %E, %F, %G, %g, %h (man strftime)
        s["%H"] = (hr < 10) ? ("0" + hr) : hr; // hour, range 00 to 23 (24h format)
        s["%I"] = (ir < 10) ? ("0" + ir) : ir; // hour, range 01 to 12 (12h format)
        s["%j"] = (dy < 100) ? ((dy < 10) ? ("00" + dy) : ("0" + dy)) : dy; // day of the year (range 001 to 366)
        s["%k"] = hr;        // hour, range 0 to 23 (24h format)
        s["%l"] = ir;        // hour, range 1 to 12 (12h format)
        s["%m"] = (m < 9) ? ("0" + (1+m)) : (1+m); // month, range 01 to 12
        s["%M"] = (min < 10) ? ("0" + min) : min; // minute, range 00 to 59
        s["%n"] = "\n";        // a newline character
        s["%p"] = pm ? Calendar._pm.toUpperCase() : Calendar._am.toUpperCase();
        s["%P"] = pm ? Calendar._pm.toLowerCase() : Calendar._am.toLowerCase();
        // FIXME: %r : the time in am/pm notation %I:%M:%S %p
        // FIXME: %R : the time in 24-hour notation %H:%M
        s["%s"] = Math.floor(this.getTime() / 1000);
        s["%S"] = (sec < 10) ? ("0" + sec) : sec; // seconds, range 00 to 59
        s["%t"] = "\t";        // a tab character
        // FIXME: %T : the time in 24-hour notation (%H:%M:%S)
        s["%U"] = s["%W"] = s["%V"] = (wn < 10) ? ("0" + wn) : wn;
        s["%u"] = w + 1;    // the day of the week (range 1 to 7, 1 = MON)
        s["%w"] = w;        // the day of the week (range 0 to 6, 0 = SUN)
        // FIXME: %x : preferred date representation for the current locale without the time
        // FIXME: %X : preferred time representation for the current locale without the date
        s["%y"] = ('' + y).substr(2, 2); // year without the century (range 00 to 99)
        s["%Y"] = y;        // year with the century
        s["%%"] = "%";        // a literal '%' character

        var re = /%./g;
        if (!Calendar.is_ie5 && !Calendar.is_khtml)
            return str.replace(re, function (par) { return s[par] || par; });

        var a = str.match(re);
        for (var i = 0; i < a.length; i++) {
            var tmp = s[a[i]];
            if (tmp) {
                re = new RegExp(a[i], 'g');
                str = str.replace(re, tmp);
            }
        }

        return str;
    };

    Date.prototype.__msh_oldSetFullYear = Date.prototype.setFullYear;
    Date.prototype.setFullYear = function(y) {
        var d = new CalendarDateObject(this);
        d.__msh_oldSetFullYear(y);
        if (d.getMonth() != this.getMonth())
            this.setDate(28);
        this.__msh_oldSetFullYear(y);
    };

    CalendarDateObject.prototype = new Date();
    CalendarDateObject.prototype.constructor = CalendarDateObject;
    CalendarDateObject.prototype.parent = Date.prototype;
    function CalendarDateObject() {
        var dateObj;
        if (arguments.length > 1) {
            dateObj = eval("new this.parent.constructor("+Array.prototype.slice.call(arguments).join(",")+");");
        } else if (arguments.length > 0) {
            dateObj = new this.parent.constructor(arguments[0]);
        } else {
            dateObj = new this.parent.constructor();
            if (typeof(CalendarDateObject._SERVER_TIMZEONE_SECONDS) != "undefined") {
                dateObj.setTime((CalendarDateObject._SERVER_TIMZEONE_SECONDS + dateObj.getTimezoneOffset()*60)*1000);
            }
        }
        return dateObj;
    }

    // END: DATE OBJECT PATCHES


    // global object that remembers the calendar
    window._dynarch_popupCalendar = null;
    </script> <script type="text/javascript"  style="display:none">/*  Copyright Mihai Bazon, 2002, 2003  |  http://dynarch.com/mishoo/
     * ---------------------------------------------------------------------------
     *
     * The DHTML Calendar
     *
     * Details and latest version at:
     * http://dynarch.com/mishoo/calendar.epl
     *
     * This script is distributed under the GNU Lesser General Public License.
     * Read the entire license text here: http://www.gnu.org/licenses/lgpl.html
     *
     * This file defines helper functions for setting up the calendar.  They are
     * intended to help non-programmers get a working calendar on their site
     * quickly.  This script should not be seen as part of the calendar.  It just
     * shows you what one can do with the calendar, while in the same time
     * providing a quick and simple method for setting it up.  If you need
     * exhaustive customization of the calendar creation process feel free to
     * modify this code to suit your needs (this is recommended and much better
     * than modifying calendar.js itself).
     */
    Calendar.setup=function(params){function param_default(pname,def){if(typeof params[pname]=="undefined"){params[pname]=def;}};param_default("inputField",null);param_default("displayArea",null);param_default("button",null);param_default("eventName","click");param_default("ifFormat","%Y/%m/%d");param_default("daFormat","%Y/%m/%d");param_default("singleClick",true);param_default("disableFunc",null);param_default("dateStatusFunc",params["disableFunc"]);param_default("dateText",null);param_default("firstDay",null);param_default("align","Br");param_default("range",[1900,2999]);param_default("weekNumbers",true);param_default("flat",null);param_default("flatCallback",null);param_default("onSelect",null);param_default("onClose",null);param_default("onUpdate",null);param_default("date",null);param_default("showsTime",false);param_default("timeFormat","24");param_default("electric",true);param_default("step",2);param_default("position",null);param_default("cache",false);param_default("showOthers",false);param_default("multiple",null);var tmp=["inputField","displayArea","button"];for(var i in tmp){if(typeof params[tmp[i]]=="string"){params[tmp[i]]=document.getElementById(params[tmp[i]]);}}if(!(params.flat||params.multiple||params.inputField||params.displayArea||params.button)){alert("Calendar.setup:\n  Nothing to setup (no fields found).  Please check your code");return false;}function onSelect(cal){var p=cal.params;var update=(cal.dateClicked||p.electric);if(update&&p.inputField){p.inputField.value=cal.date.print(p.ifFormat);if(typeof p.inputField.onchange=="function")p.inputField.onchange();if(typeof fireEvent == 'function')fireEvent(p.inputField, "change");}if(update&&p.displayArea)p.displayArea.innerHTML=cal.date.print(p.daFormat);if(update&&typeof p.onUpdate=="function")p.onUpdate(cal);if(update&&p.flat){if(typeof p.flatCallback=="function")p.flatCallback(cal);}if(update&&p.singleClick&&cal.dateClicked)cal.callCloseHandler();};if(params.flat!=null){if(typeof params.flat=="string")params.flat=document.getElementById(params.flat);if(!params.flat){alert("Calendar.setup:\n  Flat specified but can't find parent.");return false;}var cal=new Calendar(params.firstDay,params.date,params.onSelect||onSelect);cal.showsOtherMonths=params.showOthers;cal.showsTime=params.showsTime;cal.time24=(params.timeFormat=="24");cal.params=params;cal.weekNumbers=params.weekNumbers;cal.setRange(params.range[0],params.range[1]);cal.setDateStatusHandler(params.dateStatusFunc);cal.getDateText=params.dateText;if(params.ifFormat){cal.setDateFormat(params.ifFormat);}if(params.inputField&&typeof params.inputField.value=="string"){cal.parseDate(params.inputField.value);}cal.create(params.flat);cal.show();return false;}var triggerEl=params.button||params.displayArea||params.inputField;triggerEl["on"+params.eventName]=function(){var dateEl=params.inputField||params.displayArea;var dateFmt=params.inputField?params.ifFormat:params.daFormat;var mustCreate=false;var cal=window.calendar;if(dateEl)params.date=Date.parseDate(dateEl.value||dateEl.innerHTML,dateFmt);if(!(cal&&params.cache)){window.calendar=cal=new Calendar(params.firstDay,params.date,params.onSelect||onSelect,params.onClose||function(cal){cal.hide();});cal.showsTime=params.showsTime;cal.time24=(params.timeFormat=="24");cal.weekNumbers=params.weekNumbers;mustCreate=true;}else{if(params.date)cal.setDate(params.date);cal.hide();}if(params.multiple){cal.multiple={};for(var i=params.multiple.length;--i>=0;){var d=params.multiple[i];var ds=d.print("%Y%m%d");cal.multiple[ds]=d;}}cal.showsOtherMonths=params.showOthers;cal.yearStep=params.step;cal.setRange(params.range[0],params.range[1]);cal.params=params;cal.setDateStatusHandler(params.dateStatusFunc);cal.getDateText=params.dateText;cal.setDateFormat(dateFmt);if(mustCreate)cal.create();cal.refresh();if(!params.position)cal.showAtElement(params.button||params.displayArea||params.inputField,params.align);else cal.showAt(params.position[0],params.position[1]);return false;};return cal;};</script> <script type="text/javascript" src="http://www.vinoseleccion.com/skin/frontend/default/ge/js/modernizr.min.js"></script> <script type="text/javascript"  style="display:none">/*!
     * selectivizr v1.0.2 - (c) Keith Clark, freely distributable under the terms of the MIT license.
     * selectivizr.com
     */
    (function(j){function A(a){return a.replace(B,h).replace(C,function(a,d,b){for(var a=b.split(","),b=0,e=a.length;b<e;b++){var s=D(a[b].replace(E,h).replace(F,h))+o,l=[];a[b]=s.replace(G,function(a,b,c,d,e){if(b){if(l.length>0){var a=l,f,e=s.substring(0,e).replace(H,i);if(e==i||e.charAt(e.length-1)==o)e+="*";try{f=t(e)}catch(k){}if(f){e=0;for(c=f.length;e<c;e++){for(var d=f[e],h=d.className,j=0,m=a.length;j<m;j++){var g=a[j];if(!RegExp("(^|\\s)"+g.className+"(\\s|$)").test(d.className)&&g.b&&(g.b===!0||g.b(d)===!0))h=u(h,g.className,!0)}d.className=h}}l=[]}return b}else{if(b=c?I(c):!v||v.test(d)?{className:w(d),b:!0}:null)return l.push(b),"."+b.className;return a}})}return d+a.join(",")})}function I(a){var c=!0,d=w(a.slice(1)),b=a.substring(0,5)==":not(",e,f;b&&(a=a.slice(5,-1));var l=a.indexOf("(");l>-1&&(a=a.substring(0,l));if(a.charAt(0)==":")switch(a.slice(1)){case "root":c=function(a){return b?a!=p:a==p};break;case "target":if(m==8){c=function(a){function c(){var d=location.hash,e=d.slice(1);return b?d==i||a.id!=e:d!=i&&a.id==e}k(j,"hashchange",function(){g(a,d,c())});return c()};break}return!1;case "checked":c=function(a){J.test(a.type)&&k(a,"propertychange",function(){event.propertyName=="checked"&&g(a,d,a.checked!==b)});return a.checked!==b};break;case "disabled":b=!b;case "enabled":c=function(c){if(K.test(c.tagName))return k(c,"propertychange",function(){event.propertyName=="$disabled"&&g(c,d,c.a===b)}),q.push(c),c.a=c.disabled,c.disabled===b;return a==":enabled"?b:!b};break;case "focus":e="focus",f="blur";case "hover":e||(e="mouseenter",f="mouseleave");c=function(a){k(a,b?f:e,function(){g(a,d,!0)});k(a,b?e:f,function(){g(a,d,!1)});return b};break;default:if(!L.test(a))return!1}return{className:d,b:c}}function w(a){return M+"-"+(m==6&&N?O++:a.replace(P,function(a){return a.charCodeAt(0)}))}function D(a){return a.replace(x,h).replace(Q,o)}function g(a,c,d){var b=a.className,c=u(b,c,d);if(c!=b)a.className=c,a.parentNode.className+=i}function u(a,c,d){var b=RegExp("(^|\\s)"+c+"(\\s|$)"),e=b.test(a);return d?e?a:a+o+c:e?a.replace(b,h).replace(x,h):a}function k(a,c,d){a.attachEvent("on"+c,d)}function r(a,c){if(/^https?:\/\//i.test(a))return c.substring(0,c.indexOf("/",8))==a.substring(0,a.indexOf("/",8))?a:null;if(a.charAt(0)=="/")return c.substring(0,c.indexOf("/",8))+a;var d=c.split(/[?#]/)[0];a.charAt(0)!="?"&&d.charAt(d.length-1)!="/"&&(d=d.substring(0,d.lastIndexOf("/")+1));return d+a}function y(a){if(a)return n.open("GET",a,!1),n.send(),(n.status==200?n.responseText:i).replace(R,i).replace(S,function(c,d,b,e,f){return y(r(b||f,a))}).replace(T,function(c,d,b){d=d||i;return" url("+d+r(b,a)+d+") "});return i}function U(){var a,c;a=f.getElementsByTagName("BASE");for(var d=a.length>0?a[0].href:f.location.href,b=0;b<f.styleSheets.length;b++)if(c=f.styleSheets[b],c.href!=i&&(a=r(c.href,d)))c.cssText=A(y(a));q.length>0&&setInterval(function(){for(var a=0,c=q.length;a<c;a++){var b=q[a];if(b.disabled!==b.a)b.disabled?(b.disabled=!1,b.a=!0,b.disabled=!0):b.a=b.disabled}},250)}if(!/*@cc_on!@*/true){var f=document,p=f.documentElement,n=function(){if(j.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){return null}}(),m=/MSIE (\d+)/.exec(navigator.userAgent)[1];if(!(f.compatMode!="CSS1Compat"||m<6||m>8||!n)){var z={NW:"*.Dom.select",MooTools:"$$",DOMAssistant:"*.$",Prototype:"$$",YAHOO:"*.util.Selector.query",Sizzle:"*",jQuery:"*",dojo:"*.query"},t,q=[],O=0,N=!0,M="slvzr",R=/(\/\*[^*]*\*+([^\/][^*]*\*+)*\/)\s*/g,S=/@import\s*(?:(?:(?:url\(\s*(['"]?)(.*)\1)\s*\))|(?:(['"])(.*)\3))[^;]*;/g,T=/\burl\(\s*(["']?)(?!data:)([^"')]+)\1\s*\)/g,L=/^:(empty|(first|last|only|nth(-last)?)-(child|of-type))$/,B=/:(:first-(?:line|letter))/g,C=/(^|})\s*([^\{]*?[\[:][^{]+)/g,G=/([ +~>])|(:[a-z-]+(?:\(.*?\)+)?)|(\[.*?\])/g,H=/(:not\()?:(hover|enabled|disabled|focus|checked|target|active|visited|first-line|first-letter)\)?/g,P=/[^\w-]/g,K=/^(INPUT|SELECT|TEXTAREA|BUTTON)$/,J=/^(checkbox|radio)$/,v=m>6?/[\$\^*]=(['"])\1/:null,E=/([(\[+~])\s+/g,F=/\s+([)\]+~])/g,Q=/\s+/g,x=/^\s*((?:[\S\s]*\S)?)\s*$/,i="",o=" ",h="$1";(function(a,c){function d(){try{p.doScroll("left")}catch(a){setTimeout(d,50);return}b("poll")}function b(d){if(!(d.type=="readystatechange"&&f.readyState!="complete")&&((d.type=="load"?a:f).detachEvent("on"+d.type,b,!1),!e&&(e=!0)))c.call(a,d.type||d)}var e=!1,g=!0;if(f.readyState=="complete")c.call(a,i);else{if(f.createEventObject&&p.doScroll){try{g=!a.frameElement}catch(h){}g&&d()}k(f,"readystatechange",b);k(a,"load",b)}})(j,function(){for(var a in z){var c,d,b=j;if(j[a]){for(c=z[a].replace("*",a).split(".");(d=c.shift())&&(b=b[d]););if(typeof b=="function"){t=b;U();break}}}})}}})(this);</script> <script type="text/javascript"  style="display:none">/*!
     * jCarousel - Riding carousels with jQuery
     *   http://sorgalla.com/jcarousel/
     *
     * Copyright (c) 2006 Jan Sorgalla (http://sorgalla.com)
     * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
     * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
     *
     * Built on top of the jQuery library
     *   http://jquery.com
     *
     * Inspired by the "Carousel Component" by Bill Scott
     *   http://billwscott.com/carousel/
     */

    (function(i){var q={vertical:false,rtl:false,start:1,offset:1,size:null,scroll:3,visible:null,animation:"normal",easing:"swing",auto:0,wrap:null,initCallback:null,reloadCallback:null,itemLoadCallback:null,itemFirstInCallback:null,itemFirstOutCallback:null,itemLastInCallback:null,itemLastOutCallback:null,itemVisibleInCallback:null,itemVisibleOutCallback:null,buttonNextHTML:"<div></div>",buttonPrevHTML:"<div></div>",buttonNextEvent:"click",buttonPrevEvent:"click",buttonNextCallback:null,buttonPrevCallback:null, itemFallbackDimension:null},r=false;i(window).bind("load.jcarousel",function(){r=true});i.jcarousel=function(a,c){this.options=i.extend({},q,c||{});this.autoStopped=this.locked=false;this.buttonPrevState=this.buttonNextState=this.buttonPrev=this.buttonNext=this.list=this.clip=this.container=null;if(!c||c.rtl===undefined)this.options.rtl=(i(a).attr("dir")||i("html").attr("dir")||"").toLowerCase()=="rtl";this.wh=!this.options.vertical?"width":"height";this.lt=!this.options.vertical?this.options.rtl? "right":"left":"top";for(var b="",d=a.className.split(" "),f=0;f<d.length;f++)if(d[f].indexOf("jcarousel-skin")!=-1){i(a).removeClass(d[f]);b=d[f];break}if(a.nodeName.toUpperCase()=="UL"||a.nodeName.toUpperCase()=="OL"){this.list=i(a);this.container=this.list.parent();if(this.container.hasClass("jcarousel-clip")){if(!this.container.parent().hasClass("jcarousel-container"))this.container=this.container.wrap("<div></div>");this.container=this.container.parent()}else if(!this.container.hasClass("jcarousel-container"))this.container= this.list.wrap("<div></div>").parent()}else{this.container=i(a);this.list=this.container.find("ul,ol").eq(0)}b!==""&&this.container.parent()[0].className.indexOf("jcarousel-skin")==-1&&this.container.wrap('<div class=" '+b+'"></div>');this.clip=this.list.parent();if(!this.clip.length||!this.clip.hasClass("jcarousel-clip"))this.clip=this.list.wrap("<div></div>").parent();this.buttonNext=i(".jcarousel-next",this.container);if(this.buttonNext.size()===0&&this.options.buttonNextHTML!==null)this.buttonNext= this.clip.after(this.options.buttonNextHTML).next();this.buttonNext.addClass(this.className("jcarousel-next"));this.buttonPrev=i(".jcarousel-prev",this.container);if(this.buttonPrev.size()===0&&this.options.buttonPrevHTML!==null)this.buttonPrev=this.clip.after(this.options.buttonPrevHTML).next();this.buttonPrev.addClass(this.className("jcarousel-prev"));this.clip.addClass(this.className("jcarousel-clip")).css({overflow:"hidden",position:"relative"});this.list.addClass(this.className("jcarousel-list")).css({overflow:"hidden", position:"relative",top:0,margin:0,padding:0}).css(this.options.rtl?"right":"left",0);this.container.addClass(this.className("jcarousel-container")).css({position:"relative"});!this.options.vertical&&this.options.rtl&&this.container.addClass("jcarousel-direction-rtl").attr("dir","rtl");var j=this.options.visible!==null?Math.ceil(this.clipping()/this.options.visible):null;b=this.list.children("li");var e=this;if(b.size()>0){var g=0,k=this.options.offset;b.each(function(){e.format(this,k++);g+=e.dimension(this, j)});this.list.css(this.wh,g+100+"px");if(!c||c.size===undefined)this.options.size=b.size()}this.container.css("display","block");this.buttonNext.css("display","block");this.buttonPrev.css("display","block");this.funcNext=function(){e.next()};this.funcPrev=function(){e.prev()};this.funcResize=function(){e.reload()};this.options.initCallback!==null&&this.options.initCallback(this,"init");if(!r&&i.browser.safari){this.buttons(false,false);i(window).bind("load.jcarousel",function(){e.setup()})}else this.setup()}; var h=i.jcarousel;h.fn=h.prototype={jcarousel:"0.2.7"};h.fn.extend=h.extend=i.extend;h.fn.extend({setup:function(){this.prevLast=this.prevFirst=this.last=this.first=null;this.animating=false;this.tail=this.timer=null;this.inTail=false;if(!this.locked){this.list.css(this.lt,this.pos(this.options.offset)+"px");var a=this.pos(this.options.start,true);this.prevFirst=this.prevLast=null;this.animate(a,false);i(window).unbind("resize.jcarousel",this.funcResize).bind("resize.jcarousel",this.funcResize)}}, reset:function(){this.list.empty();this.list.css(this.lt,"0px");this.list.css(this.wh,"10px");this.options.initCallback!==null&&this.options.initCallback(this,"reset");this.setup()},reload:function(){this.tail!==null&&this.inTail&&this.list.css(this.lt,h.intval(this.list.css(this.lt))+this.tail);this.tail=null;this.inTail=false;this.options.reloadCallback!==null&&this.options.reloadCallback(this);if(this.options.visible!==null){var a=this,c=Math.ceil(this.clipping()/this.options.visible),b=0,d=0; this.list.children("li").each(function(f){b+=a.dimension(this,c);if(f+1<a.first)d=b});this.list.css(this.wh,b+"px");this.list.css(this.lt,-d+"px")}this.scroll(this.first,false)},lock:function(){this.locked=true;this.buttons()},unlock:function(){this.locked=false;this.buttons()},size:function(a){if(a!==undefined){this.options.size=a;this.locked||this.buttons()}return this.options.size},has:function(a,c){if(c===undefined||!c)c=a;if(this.options.size!==null&&c>this.options.size)c=this.options.size;for(var b= a;b<=c;b++){var d=this.get(b);if(!d.length||d.hasClass("jcarousel-item-placeholder"))return false}return true},get:function(a){return i(".jcarousel-item-"+a,this.list)},add:function(a,c){var b=this.get(a),d=0,f=i(c);if(b.length===0){var j,e=h.intval(a);for(b=this.create(a);;){j=this.get(--e);if(e<=0||j.length){e<=0?this.list.prepend(b):j.after(b);break}}}else d=this.dimension(b);if(f.get(0).nodeName.toUpperCase()=="LI"){b.replaceWith(f);b=f}else b.empty().append(c);this.format(b.removeClass(this.className("jcarousel-item-placeholder")), a);f=this.options.visible!==null?Math.ceil(this.clipping()/this.options.visible):null;d=this.dimension(b,f)-d;a>0&&a<this.first&&this.list.css(this.lt,h.intval(this.list.css(this.lt))-d+"px");this.list.css(this.wh,h.intval(this.list.css(this.wh))+d+"px");return b},remove:function(a){var c=this.get(a);if(!(!c.length||a>=this.first&&a<=this.last)){var b=this.dimension(c);a<this.first&&this.list.css(this.lt,h.intval(this.list.css(this.lt))+b+"px");c.remove();this.list.css(this.wh,h.intval(this.list.css(this.wh))- b+"px")}},next:function(){this.tail!==null&&!this.inTail?this.scrollTail(false):this.scroll((this.options.wrap=="both"||this.options.wrap=="last")&&this.options.size!==null&&this.last==this.options.size?1:this.first+this.options.scroll)},prev:function(){this.tail!==null&&this.inTail?this.scrollTail(true):this.scroll((this.options.wrap=="both"||this.options.wrap=="first")&&this.options.size!==null&&this.first==1?this.options.size:this.first-this.options.scroll)},scrollTail:function(a){if(!(this.locked|| this.animating||!this.tail)){this.pauseAuto();var c=h.intval(this.list.css(this.lt));c=!a?c-this.tail:c+this.tail;this.inTail=!a;this.prevFirst=this.first;this.prevLast=this.last;this.animate(c)}},scroll:function(a,c){if(!(this.locked||this.animating)){this.pauseAuto();this.animate(this.pos(a),c)}},pos:function(a,c){var b=h.intval(this.list.css(this.lt));if(this.locked||this.animating)return b;if(this.options.wrap!="circular")a=a<1?1:this.options.size&&a>this.options.size?this.options.size:a;for(var d= this.first>a,f=this.options.wrap!="circular"&&this.first<=1?1:this.first,j=d?this.get(f):this.get(this.last),e=d?f:f-1,g=null,k=0,l=false,m=0;d?--e>=a:++e<a;){g=this.get(e);l=!g.length;if(g.length===0){g=this.create(e).addClass(this.className("jcarousel-item-placeholder"));j[d?"before":"after"](g);if(this.first!==null&&this.options.wrap=="circular"&&this.options.size!==null&&(e<=0||e>this.options.size)){j=this.get(this.index(e));if(j.length)g=this.add(e,j.clone(true))}}j=g;m=this.dimension(g);if(l)k+= m;if(this.first!==null&&(this.options.wrap=="circular"||e>=1&&(this.options.size===null||e<=this.options.size)))b=d?b+m:b-m}f=this.clipping();var p=[],o=0,n=0;j=this.get(a-1);for(e=a;++o;){g=this.get(e);l=!g.length;if(g.length===0){g=this.create(e).addClass(this.className("jcarousel-item-placeholder"));j.length===0?this.list.prepend(g):j[d?"before":"after"](g);if(this.first!==null&&this.options.wrap=="circular"&&this.options.size!==null&&(e<=0||e>this.options.size)){j=this.get(this.index(e));if(j.length)g= this.add(e,j.clone(true))}}j=g;m=this.dimension(g);if(m===0)throw Error("jCarousel: No width/height set for items. This will cause an infinite loop. Aborting...");if(this.options.wrap!="circular"&&this.options.size!==null&&e>this.options.size)p.push(g);else if(l)k+=m;n+=m;if(n>=f)break;e++}for(g=0;g<p.length;g++)p[g].remove();if(k>0){this.list.css(this.wh,this.dimension(this.list)+k+"px");if(d){b-=k;this.list.css(this.lt,h.intval(this.list.css(this.lt))-k+"px")}}k=a+o-1;if(this.options.wrap!="circular"&& this.options.size&&k>this.options.size)k=this.options.size;if(e>k){o=0;e=k;for(n=0;++o;){g=this.get(e--);if(!g.length)break;n+=this.dimension(g);if(n>=f)break}}e=k-o+1;if(this.options.wrap!="circular"&&e<1)e=1;if(this.inTail&&d){b+=this.tail;this.inTail=false}this.tail=null;if(this.options.wrap!="circular"&&k==this.options.size&&k-o+1>=1){d=h.margin(this.get(k),!this.options.vertical?"marginRight":"marginBottom");if(n-d>f)this.tail=n-f-d}if(c&&a===this.options.size&&this.tail){b-=this.tail;this.inTail= true}for(;a-- >e;)b+=this.dimension(this.get(a));this.prevFirst=this.first;this.prevLast=this.last;this.first=e;this.last=k;return b},animate:function(a,c){if(!(this.locked||this.animating)){this.animating=true;var b=this,d=function(){b.animating=false;a===0&&b.list.css(b.lt,0);if(!b.autoStopped&&(b.options.wrap=="circular"||b.options.wrap=="both"||b.options.wrap=="last"||b.options.size===null||b.last<b.options.size||b.last==b.options.size&&b.tail!==null&&!b.inTail))b.startAuto();b.buttons();b.notify("onAfterAnimation"); if(b.options.wrap=="circular"&&b.options.size!==null)for(var f=b.prevFirst;f<=b.prevLast;f++)if(f!==null&&!(f>=b.first&&f<=b.last)&&(f<1||f>b.options.size))b.remove(f)};this.notify("onBeforeAnimation");if(!this.options.animation||c===false){this.list.css(this.lt,a+"px");d()}else this.list.animate(!this.options.vertical?this.options.rtl?{right:a}:{left:a}:{top:a},this.options.animation,this.options.easing,d)}},startAuto:function(a){if(a!==undefined)this.options.auto=a;if(this.options.auto===0)return this.stopAuto(); if(this.timer===null){this.autoStopped=false;var c=this;this.timer=window.setTimeout(function(){c.next()},this.options.auto*1E3)}},stopAuto:function(){this.pauseAuto();this.autoStopped=true},pauseAuto:function(){if(this.timer!==null){window.clearTimeout(this.timer);this.timer=null}},buttons:function(a,c){if(a==null){a=!this.locked&&this.options.size!==0&&(this.options.wrap&&this.options.wrap!="first"||this.options.size===null||this.last<this.options.size);if(!this.locked&&(!this.options.wrap||this.options.wrap== "first")&&this.options.size!==null&&this.last>=this.options.size)a=this.tail!==null&&!this.inTail}if(c==null){c=!this.locked&&this.options.size!==0&&(this.options.wrap&&this.options.wrap!="last"||this.first>1);if(!this.locked&&(!this.options.wrap||this.options.wrap=="last")&&this.options.size!==null&&this.first==1)c=this.tail!==null&&this.inTail}var b=this;if(this.buttonNext.size()>0){this.buttonNext.unbind(this.options.buttonNextEvent+".jcarousel",this.funcNext);a&&this.buttonNext.bind(this.options.buttonNextEvent+ ".jcarousel",this.funcNext);this.buttonNext[a?"removeClass":"addClass"](this.className("jcarousel-next-disabled")).attr("disabled",a?false:true);this.options.buttonNextCallback!==null&&this.buttonNext.data("jcarouselstate")!=a&&this.buttonNext.each(function(){b.options.buttonNextCallback(b,this,a)}).data("jcarouselstate",a)}else this.options.buttonNextCallback!==null&&this.buttonNextState!=a&&this.options.buttonNextCallback(b,null,a);if(this.buttonPrev.size()>0){this.buttonPrev.unbind(this.options.buttonPrevEvent+ ".jcarousel",this.funcPrev);c&&this.buttonPrev.bind(this.options.buttonPrevEvent+".jcarousel",this.funcPrev);this.buttonPrev[c?"removeClass":"addClass"](this.className("jcarousel-prev-disabled")).attr("disabled",c?false:true);this.options.buttonPrevCallback!==null&&this.buttonPrev.data("jcarouselstate")!=c&&this.buttonPrev.each(function(){b.options.buttonPrevCallback(b,this,c)}).data("jcarouselstate",c)}else this.options.buttonPrevCallback!==null&&this.buttonPrevState!=c&&this.options.buttonPrevCallback(b, null,c);this.buttonNextState=a;this.buttonPrevState=c},notify:function(a){var c=this.prevFirst===null?"init":this.prevFirst<this.first?"next":"prev";this.callback("itemLoadCallback",a,c);if(this.prevFirst!==this.first){this.callback("itemFirstInCallback",a,c,this.first);this.callback("itemFirstOutCallback",a,c,this.prevFirst)}if(this.prevLast!==this.last){this.callback("itemLastInCallback",a,c,this.last);this.callback("itemLastOutCallback",a,c,this.prevLast)}this.callback("itemVisibleInCallback", a,c,this.first,this.last,this.prevFirst,this.prevLast);this.callback("itemVisibleOutCallback",a,c,this.prevFirst,this.prevLast,this.first,this.last)},callback:function(a,c,b,d,f,j,e){if(!(this.options[a]==null||typeof this.options[a]!="object"&&c!="onAfterAnimation")){var g=typeof this.options[a]=="object"?this.options[a][c]:this.options[a];if(i.isFunction(g)){var k=this;if(d===undefined)g(k,b,c);else if(f===undefined)this.get(d).each(function(){g(k,this,d,b,c)});else{a=function(m){k.get(m).each(function(){g(k, this,m,b,c)})};for(var l=d;l<=f;l++)l!==null&&!(l>=j&&l<=e)&&a(l)}}}},create:function(a){return this.format("<li></li>",a)},format:function(a,c){a=i(a);for(var b=a.get(0).className.split(" "),d=0;d<b.length;d++)b[d].indexOf("jcarousel-")!=-1&&a.removeClass(b[d]);a.addClass(this.className("jcarousel-item")).addClass(this.className("jcarousel-item-"+c)).css({"float":this.options.rtl?"right":"left","list-style":"none"}).attr("jcarouselindex",c);return a},className:function(a){return a+" "+a+(!this.options.vertical? "-horizontal":"-vertical")},dimension:function(a,c){var b=a.jquery!==undefined?a[0]:a,d=!this.options.vertical?(b.offsetWidth||h.intval(this.options.itemFallbackDimension))+h.margin(b,"marginLeft")+h.margin(b,"marginRight"):(b.offsetHeight||h.intval(this.options.itemFallbackDimension))+h.margin(b,"marginTop")+h.margin(b,"marginBottom");if(c==null||d==c)return d;d=!this.options.vertical?c-h.margin(b,"marginLeft")-h.margin(b,"marginRight"):c-h.margin(b,"marginTop")-h.margin(b,"marginBottom");i(b).css(this.wh, d+"px");return this.dimension(b)},clipping:function(){return!this.options.vertical?this.clip[0].offsetWidth-h.intval(this.clip.css("borderLeftWidth"))-h.intval(this.clip.css("borderRightWidth")):this.clip[0].offsetHeight-h.intval(this.clip.css("borderTopWidth"))-h.intval(this.clip.css("borderBottomWidth"))},index:function(a,c){if(c==null)c=this.options.size;return Math.round(((a-1)/c-Math.floor((a-1)/c))*c)+1}});h.extend({defaults:function(a){return i.extend(q,a||{})},margin:function(a,c){if(!a)return 0; var b=a.jquery!==undefined?a[0]:a;if(c=="marginRight"&&i.browser.safari){var d={display:"block","float":"none",width:"auto"},f,j;i.swap(b,d,function(){f=b.offsetWidth});d.marginRight=0;i.swap(b,d,function(){j=b.offsetWidth});return j-f}return h.intval(i.css(b,c))},intval:function(a){a=parseInt(a,10);return isNaN(a)?0:a}});i.fn.jcarousel=function(a){if(typeof a=="string"){var c=i(this).data("jcarousel"),b=Array.prototype.slice.call(arguments,1);return c[a].apply(c,b)}else return this.each(function(){i(this).data("jcarousel", new h(this,a))})}})(jQuery);
    </script> <script type="text/javascript" src="http://www.vinoseleccion.com/skin/frontend/default/ge/js/custom.js"></script> <script type="text/javascript"  style="display:none">// -----------------------------------------------------------------------------------
    //
    //    Lightbox v2.04
    //    by Lokesh Dhakar - http://www.lokeshdhakar.com
    //    Last Modification: 2/9/08
    //
    //    For more information, visit:
    //    http://lokeshdhakar.com/projects/lightbox2/
    //
    //    Licensed under the Creative Commons Attribution 2.5 License - http://creativecommons.org/licenses/by/2.5/
    //      - Free for use in both personal and commercial projects
    //        - Attribution requires leaving author name, author link, and the license info intact.
    //
    //  Thanks: Scott Upton(uptonic.com), Peter-Paul Koch(quirksmode.com), and Thomas Fuchs(mir.aculo.us) for ideas, libs, and snippets.
    //          Artemy Tregubenko (arty.name) for cleanup and help in updating to latest ver of proto-aculous.
    //
    // -----------------------------------------------------------------------------------

    var Lightbox = Class.create();

    Lightbox.prototype = {
        imageArray: [],
        activeImage: undefined,
        options: {
            overlayOpacity: 0.8,   // controls transparency of shadow overlay
            animate: true,         // toggles resizing animations
            resizeSpeed: 7,        // controls the speed of the image resizing animations (1=slowest and 10=fastest)
            borderSize: 10,
            // When grouping images this is used to write: Image # of #.
            // Change it for non-english localization
            labelImage: "Image",
            labelOf: "of"
        },

        // initialize()
        // Constructor runs on completion of the DOM loading. Calls updateImageList and then
        // the function inserts html at the bottom of the page which is used to display the shadow
        // overlay and the image container.
        //
        initialize: function(params) {
            Object.extend(this.options, params || {});
            this.animating = false;
            this.keyboardAction = this.keyboardAction.bindAsEventListener(this);

            if (this.options.resizeSpeed > 10) this.options.resizeSpeed = 10;
            if (this.options.resizeSpeed < 1)  this.options.resizeSpeed = 1;

            this.resizeDuration = this.options.animate ? ((11 - this.options.resizeSpeed) * 0.15) : 0;
            this.overlayDuration = this.options.animate ? 0.2 : 0;  // shadow fade in/out duration

            // When Lightbox starts it will resize itself from 250 by 250 to the current image dimension.
            // If animations are turned off, it will be hidden as to prevent a flicker of a
            // white 250 by 250 box.
            var size = (this.options.animate ? 250 : 1) + 'px';

            this.pageScroll = document.viewport.getScrollOffsets();
            this.pageHeight = document.viewport.getHeight();


            // Code inserts html at the bottom of the page that looks similar to this:
            //
            //  <div id="overlay"></div>
            //  <div id="lightbox">
            //      <div id="outerImageContainer">
            //          <div id="imageContainer">
            //              <img id="lightboxImage">
            //              <div style="" id="hoverNav">
            //                  <a href="#" id="prevLink"></a>
            //                  <a href="#" id="nextLink"></a>
            //              </div>
            //              <div id="loading">
            //                  <a href="#" id="loadingLink">
            //                      <img src="images/loading.gif">
            //                  </a>
            //              </div>
            //          </div>
            //      </div>
            //      <div id="imageDataContainer">
            //          <div id="imageData">
            //              <div id="imageDetails">
            //                  <span id="caption"></span>
            //                  <span id="numberDisplay"></span>
            //              </div>
            //              <div id="bottomNav">
            //                  <a href="#" id="bottomNavClose">
            //                      <img src="images/close.gif">
            //                  </a>
            //              </div>
            //          </div>
            //      </div>
            //  </div>


            var objBody = $$('body')[0];

            objBody.appendChild(Builder.node('div',{id:'overlay'}));

            objBody.appendChild(Builder.node('div',{id:'lightbox'}, [
                Builder.node('div',{id:'outerImageContainer'},
                        Builder.node('div',{id:'imageContainer', style: 'padding: ' + this.options.borderSize + 'px'}, [
                            Builder.node('img',{id:'lightboxImage'}),
                            Builder.node('div',{id:'hoverNav'}, [
                                Builder.node('a',{id:'prevLink', href: '#' }),
                                Builder.node('a',{id:'nextLink', href: '#' })
                            ]),
                            Builder.node('div',{id:'loading'},
                                    Builder.node('a',{id:'loadingLink', href: '#' },
                                            Builder.node('img', {src: this.options.fileLoadingImage})
                                    )
                            )
                        ])
                ),
                Builder.node('div', {id:'imageDataContainer'},
                        Builder.node('div',{id:'imageData'}, [
                            Builder.node('div',{id:'imageDetails'}, [
                                Builder.node('span',{id:'caption'}),
                                Builder.node('span',{id:'numberDisplay'})
                            ]),
                            Builder.node('div',{id:'bottomNav'},
                                    Builder.node('a',{id:'bottomNavClose', href: '#' },
                                            Builder.node('img', { src: this.options.fileBottomNavCloseImage })
                                    )
                            )
                        ])
                )
            ]));

            $('overlay').hide().observe('click', (function() { this.end(); }).bind(this));
            $('lightbox').hide().observe('click', (function(event) { if (event.element().id == 'lightbox') this.end(); }).bind(this));
            $('outerImageContainer').setStyle({ width: size, height: size });
            $('prevLink').observe('click', (function(event) { event.stop(); this.changeImage(this.activeImage - 1); }).bindAsEventListener(this));
            $('nextLink').observe('click', (function(event) { event.stop(); this.changeImage(this.activeImage + 1); }).bindAsEventListener(this));
            $('loadingLink').observe('click', (function(event) { event.stop(); this.end(); }).bind(this));
            $('bottomNavClose').observe('click', (function(event) { event.stop(); this.end(); }).bind(this));

            var th = this;
            var ids =
                    'overlay lightbox outerImageContainer imageContainer lightboxImage hoverNav prevLink nextLink loading loadingLink ' +
                    'imageDataContainer imageData imageDetails caption numberDisplay bottomNav bottomNavClose';
            $w(ids).each(function(id){
                th[id] = $(id);
            });

            this.updateImageList();
        },

        //
        // updateImageList()
        // Loops through anchor tags looking for 'lightbox' references and applies onclick
        // events to appropriate links. You can rerun after dynamically adding images w/ajax.
        //
        updateImageList: function() {
            this.updateImageList = Prototype.emptyFunction;
            document.observe('click', (function(event){
                var target = event.findElement('a[rel^=lightbox]') || event.findElement('area[rel^=lightbox]');
                if (target) {
                    event.stop();
                    this.start(target);
                }
            }).bind(this));
        },

        //
        //  start()
        //  Display overlay and lightbox. If image is part of a set, add siblings to imageArray.
        //
        start: function(imageLink) {
            if (this.animating) {
                return false;
            }
            $$('select', 'object', 'embed').each(function(node){ node.style.visibility = 'hidden' });

            // stretch overlay to fill page and fade in
            var arrayPageSize = this.getPageSize();
            this.overlay.setStyle({ width: arrayPageSize[0] + 'px', height: arrayPageSize[1] + 'px' });

            new Effect.Appear(this.overlay, { duration: this.overlayDuration, from: 0.0, to: this.options.overlayOpacity });

            this.imageArray = [];
            var imageNum = 0;

            if ((imageLink.rel == 'lightbox')){
                // if image is NOT part of a set, add single image to imageArray
                this.imageArray.push([imageLink.href, imageLink.title]);
            } else {
                // if image is part of a set..
                this.imageArray =
                        $$(imageLink.tagName + '[href][rel="' + imageLink.rel + '"]').
                        collect(function(anchor){ return [anchor.href, anchor.title]; }).
                        uniq();
                while (this.imageArray[imageNum][0] != imageLink.href) { imageNum++; }
            }

            // calculate top and left offset for the lightbox
            var lightboxTop = this.pageScroll[1] + (this.pageHeight / 10);
            var lightboxLeft = this.pageScroll[0];
            this.lightbox.setStyle({ top: lightboxTop + 'px', left: lightboxLeft + 'px' }).show();

            this.changeImage(imageNum);
        },

        //
        //  changeImage()
        //  Hide most elements and preload image in preparation for resizing image container.
        //
        changeImage: function(imageNum) {
            this.activeImage = imageNum; // update global var

            // hide elements during transition
            if (this.options.animate) this.loading.show();
            this.lightboxImage.hide();
            this.hoverNav.hide();
            this.prevLink.hide();
            this.nextLink.hide();
            // HACK: Opera9 does not currently support scriptaculous opacity and appear fx
            this.imageDataContainer.setStyle({opacity: .0001});
            this.numberDisplay.hide();

            var imgPreloader = new Image();
            // once image is preloaded, resize image container
            imgPreloader.onload = (function(){
                this.lightboxImage.src = this.imageArray[this.activeImage][0];
                this.resizeImageContainer(imgPreloader.width, imgPreloader.height);
            }).bind(this);
            imgPreloader.src = this.imageArray[this.activeImage][0];
        },

        //
        //  resizeImageContainer()
        //
        resizeImageContainer: function(imgWidth, imgHeight) {
            // get current width and height
            var widthCurrent  = this.outerImageContainer.getWidth() || (this.options.animate ? 250 : 1);
            var heightCurrent = this.outerImageContainer.getHeight() || (this.options.animate ? 250 : 1);

            // get new width and height
            var widthNew  = (imgWidth  + this.options.borderSize * 2);
            var heightNew = (imgHeight + this.options.borderSize * 2);

            // scalars based on change from old to new
            var xScale = (widthNew  / widthCurrent)  * 100;
            var yScale = (heightNew / heightCurrent) * 100;

            // calculate size difference between new and old image, and resize if necessary
            var wDiff = widthCurrent - widthNew;
            var hDiff = heightCurrent - heightNew;

            if (hDiff != 0) {
                this.animating = true;
                new Effect.Scale(this.outerImageContainer, yScale, {
                    scaleX: false,
                    duration: this.resizeDuration,
                    queue: 'front',
                    afterFinish: function() {
                        this.outerImageContainer.setStyle({ height: heightNew + 'px' }); //invalid height fix;
                        this.animating = false;
                    }.bind(this)
                });
            }
            if (wDiff != 0) {
                this.animating = true;
                new Effect.Scale(this.outerImageContainer, xScale, {
                    scaleY : false,
                    duration : this.resizeDuration,
                    delay : this.resizeDuration,
                    afterFinish: function() {
                        this.outerImageContainer.setStyle({ width: widthNew + 'px' }); //invalid width fix;
                        this.animating = false;
                    }.bind(this)
                });
            }

            // if new and old image are same size and no scaling transition is necessary,
            // do a quick pause to prevent image flicker.
            var timeout = 0;
            if ((hDiff == 0) && (wDiff == 0)){
                timeout = 100;
                if (Prototype.Browser.IE) timeout = 250;
            }
            (function(){
                this.prevLink.setStyle({ height: imgHeight + 'px' });
                this.nextLink.setStyle({ height: imgHeight + 'px' });
                this.imageDataContainer.setStyle({ width: widthNew + 'px' });
                this.showImage();
            }).bind(this).delay(timeout / 1000);
        },

        //
        //  showImage()
        //  Display image and begin preloading neighbors.
        //
        showImage: function(){
            this.loading.hide();
            new Effect.Appear(this.lightboxImage, {
                duration: this.resizeDuration,
                queue: 'end',
                afterFinish: (function(){ this.updateDetails(); }).bind(this)
            });
            this.preloadNeighborImages();
        },

        //
        //  updateDetails()
        //  Display caption, image number, and bottom nav.
        //
        updateDetails: function() {

            // if caption is not null
            if (this.imageArray[this.activeImage][1] != ""){
                this.caption.update(this.imageArray[this.activeImage][1]).show();
            }

            // if image is part of set display 'Image x of x'
            if (this.imageArray.length > 1){
                this.numberDisplay.update( this.options.labelImage + ' ' + (this.activeImage + 1) + ' ' + this.options.labelOf + '  ' + this.imageArray.length).show();
            }

            new Effect.Parallel(
                    [
                        new Effect.SlideDown(this.imageDataContainer, { sync: true, duration: this.resizeDuration, from: 0.0, to: 1.0 }),
                        new Effect.Appear(this.imageDataContainer, { sync: true, duration: this.resizeDuration })
                    ],
                    {
                        duration: this.resizeDuration,
                        afterFinish: (function() {
                            // update overlay size and update nav
                            var arrayPageSize = this.getPageSize();
                            this.overlay.setStyle({ height: arrayPageSize[1] + 'px' });
                            this.updateNav();
                        }).bind(this)
                    }
            );
        },

        //
        //  updateNav()
        //  Display appropriate previous and next hover navigation.
        //
        updateNav: function() {

            this.hoverNav.show();

            // if not first image in set, display prev image button
            if (this.activeImage > 0) this.prevLink.show();

            // if not last image in set, display next image button
            if (this.activeImage < (this.imageArray.length - 1)) this.nextLink.show();

            this.enableKeyboardNav();
        },

        //
        //  enableKeyboardNav()
        //
        enableKeyboardNav: function() {
            document.observe('keydown', this.keyboardAction);
        },

        //
        //  disableKeyboardNav()
        //
        disableKeyboardNav: function() {
            document.stopObserving('keydown', this.keyboardAction);
        },

        //
        //  keyboardAction()
        //
        keyboardAction: function(event) {
            var keycode = event.keyCode;

            var escapeKey;
            if (event.DOM_VK_ESCAPE) {  // mozilla
                escapeKey = event.DOM_VK_ESCAPE;
            } else { // ie
                escapeKey = 27;
            }

            var key = String.fromCharCode(keycode).toLowerCase();

            if (key.match(/x|o|c/) || (keycode == escapeKey)){ // close lightbox
                this.end();
            } else if ((key == 'p') || (keycode == 37)){ // display previous image
                if (this.activeImage != 0){
                    this.disableKeyboardNav();
                    this.changeImage(this.activeImage - 1);
                }
            } else if ((key == 'n') || (keycode == 39)){ // display next image
                if (this.activeImage != (this.imageArray.length - 1)){
                    this.disableKeyboardNav();
                    this.changeImage(this.activeImage + 1);
                }
            }
        },

        //
        //  preloadNeighborImages()
        //  Preload previous and next images.
        //
        preloadNeighborImages: function(){
            var preloadNextImage, preloadPrevImage;
            if (this.imageArray.length > this.activeImage + 1){
                preloadNextImage = new Image();
                preloadNextImage.src = this.imageArray[this.activeImage + 1][0];
            }
            if (this.activeImage > 0){
                preloadPrevImage = new Image();
                preloadPrevImage.src = this.imageArray[this.activeImage - 1][0];
            }

        },

        //
        //  end()
        //
        end: function() {
            this.disableKeyboardNav();
            this.lightbox.hide();
            new Effect.Fade(this.overlay, { duration: this.overlayDuration });
            $$('select', 'object', 'embed').each(function(node){ node.style.visibility = 'visible' });
        },

        //
        //  getPageSize()
        //
        getPageSize: function() {

            var xScroll, yScroll;

            if (window.innerHeight && window.scrollMaxY) {
                xScroll = window.innerWidth + window.scrollMaxX;
                yScroll = window.innerHeight + window.scrollMaxY;
            } else if (document.body.scrollHeight > document.body.offsetHeight){ // all but Explorer Mac
                xScroll = document.body.scrollWidth;
                yScroll = document.body.scrollHeight;
            } else { // Explorer Mac...would also work in Explorer 6 Strict, Mozilla and Safari
                xScroll = document.body.offsetWidth;
                yScroll = document.body.offsetHeight;
            }

            var windowWidth, windowHeight;

            if (self.innerHeight) {    // all except Explorer
                if(document.documentElement.clientWidth){
                    windowWidth = document.documentElement.clientWidth;
                } else {
                    windowWidth = self.innerWidth;
                }
                windowHeight = self.innerHeight;
            } else if (document.documentElement && document.documentElement.clientHeight) { // Explorer 6 Strict Mode
                windowWidth = document.documentElement.clientWidth;
                windowHeight = document.documentElement.clientHeight;
            } else if (document.body) { // other Explorers
                windowWidth = document.body.clientWidth;
                windowHeight = document.body.clientHeight;
            }

            // for small pages with total height less then height of the viewport
            if(yScroll < windowHeight){
                pageHeight = windowHeight;
            } else {
                pageHeight = yScroll;
            }

            // for small pages with total width less then width of the viewport
            if(xScroll < windowWidth){
                pageWidth = xScroll;
            } else {
                pageWidth = windowWidth;
            }

            return [pageWidth,pageHeight];
        }
    }</script> <script type="text/javascript"  style="display:none">// jQuery autoComplete v1.0.5
    // https://github.com/Pixabay/jQuery-autoComplete
    !function(e){e.fn.autoComplete=function(t){var s=e.extend({},e.fn.autoComplete.defaults,t);return"string"==typeof t?(this.each(function(){var s=e(this);"destroy"==t&&(e(window).off("resize.autocomplete",s.updateSC),s.off("keydown.autocomplete keyup.autocomplete"),s.data("autocomplete")?s.attr("autocomplete",s.data("autocomplete")):s.removeAttr("autocomplete"),e(s.data("el")).remove(),s.removeData("el").removeData("autocomplete"))}),this):this.each(function(){function t(e){var t=a.val();if(a.cache[t]=e,e.length&&t.length>=s.minChars){var o="";for(i=0;i<e.length;i++)o+=s.renderItem(e[i],t);a.sc.html(o),a.updateSC(0)}else a.sc.hide()}var a=e(this);a.sc=e('<div class="autocomplete-suggestions"></div>').addClass(s.menuClass),a.data("el",a.sc).data("autocomplete",a.attr("autocomplete")),a.attr("autocomplete","off"),a.cache={},a.last_val="",a.updateSC=function(t,s){if(a.sc.css({top:a.offset().top+a.outerHeight(),left:a.offset().left,width:a.outerWidth()}),!t&&(a.sc.show(),a.sc.maxHeight||(a.sc.maxHeight=parseInt(a.sc.css("max-height"))),a.sc.suggestionHeight||(a.sc.suggestionHeight=e(".autocomplete-suggestion",a.sc).first().outerHeight()),a.sc.suggestionHeight))if(s){var o=a.sc.scrollTop(),l=s.offset().top-a.sc.offset().top;l+a.sc.suggestionHeight-a.sc.maxHeight>0?a.sc.scrollTop(l+a.sc.suggestionHeight+o-a.sc.maxHeight):0>l&&a.sc.scrollTop(l+o)}else a.sc.scrollTop(0)},e(window).on("resize.autocomplete",a.updateSC),a.sc.appendTo("body"),a.sc.on("mouseleave.autocomplete",".autocomplete-suggestion",function(){e(".autocomplete-suggestion.selected").removeClass("selected")}),a.sc.on("mouseenter.autocomplete",".autocomplete-suggestion",function(){e(".autocomplete-suggestion.selected").removeClass("selected"),e(this).addClass("selected")}),a.sc.on("mousedown.autocomplete",".autocomplete-suggestion",function(){var t=e(this).data("val");a.val(t),s.onSelect(t),setTimeout(function(){a.focus()},10)}),a.blur(function(){a.last_val=a.val(),a.sc.hide()}),a.on("keydown.autocomplete",function(t){if(40==t.which&&a.sc.html()){var s,o=e(".autocomplete-suggestion.selected",a.sc);return o.length?(s=o.next(".autocomplete-suggestion"),s.length?(o.removeClass("selected"),a.val(s.addClass("selected").data("val"))):(o.removeClass("selected"),a.val(a.last_val),s=0)):(s=e(".autocomplete-suggestion",a.sc).first(),a.val(s.addClass("selected").data("val"))),a.updateSC(0,s),!1}if(38==t.which&&a.sc.html()){var s,o=e(".autocomplete-suggestion.selected",a.sc);if(o.length){var s=o.prev(".autocomplete-suggestion");s.length?(o.removeClass("selected"),a.val(s.addClass("selected").data("val"))):(o.removeClass("selected"),a.val(a.last_val),s=0)}else s=e(".autocomplete-suggestion",a.sc).last(),a.val(s.addClass("selected").data("val"));return a.updateSC(0,s),!1}27==t.which&&a.val(a.last_val).sc.hide()}),a.on("keyup.autocomplete",function(o){if(!~e.inArray(o.which,[27,38,40,37,39])){var l=a.val();if(l.length>=s.minChars){if(l!=a.last_val){if(a.last_val=l,clearTimeout(a.timer),s.cache){if(l in a.cache)return void t(a.cache[l]);for(i=1;i<l.length-s.minChars;i++){var c=l.slice(0,l.length-i);if(c in a.cache&&!a.cache[c].length)return void t([])}}a.timer=setTimeout(function(){s.source(l,t)},s.delay)}}else a.last_val=l,a.sc.hide()}})})},e.fn.autoComplete.defaults={source:0,minChars:3,delay:100,cache:1,menuClass:"",renderItem:function(e,t){var s=new RegExp("("+t.split(" ").join("|")+")","gi");return'<div class="autocomplete-suggestion" data-val="'+e+'">'+e.replace(s,"<b>$1</b>")+"</div>"},onSelect:function(){}}}(jQuery);
    </script> <script type="text/javascript"  style="display:none">function wpShowMenuPopup(objMenu, event, popupId)
    {
        if (typeof wpCustommenuTimerHide[popupId] != 'undefined') clearTimeout(wpCustommenuTimerHide[popupId]);
        objMenu = $(objMenu.id); var popup = $(popupId); if (!popup) return;
        if (!!wpActiveMenu) {
            wpHideMenuPopup(objMenu, event, wpActiveMenu.popupId, wpActiveMenu.menuId);
        }
        wpActiveMenu = {menuId: objMenu.id, popupId: popupId};
        if (!objMenu.hasClassName('active')) {
            wpCustommenuTimerShow[popupId] = setTimeout(function() {
                objMenu.addClassName('active');
                var popupWidth = CUSTOMMENU_POPUP_WIDTH;
                if (!popupWidth) popupWidth = popup.getWidth();
                var pos = wpPopupPos(objMenu, popupWidth);
                popup.style.top = pos.top + 'px';
                popup.style.left = pos.left + 'px';
                wpSetPopupZIndex(popup);
                if (CUSTOMMENU_POPUP_WIDTH)
                    popup.style.width = CUSTOMMENU_POPUP_WIDTH + 'px';
                // --- Static Block width ---
                var block2 = $(popupId).select('div.block2');
                if (typeof block2[0] != 'undefined') {
                    var wStart = block2[0].id.indexOf('_w');
                    if (wStart > -1) {
                        var w = block2[0].id.substr(wStart+2);
                    } else {
                        var w = 0;
                        $(popupId).select('div.block1 div.column').each(function(item) {
                            w += $(item).getWidth();
                        });
                    }
                    if (w) block2[0].style.width = w + 'px';
                }
                // --- change href ---
                var wpMenuAnchor = $(objMenu.select('a')[0]);
                wpChangeTopMenuHref(wpMenuAnchor);
                // --- show popup ---
                popup.style.display = 'block';
                //jQuery('#' + popupId).stop(true, true).fadeIn();
            }, CUSTOMMENU_POPUP_DELAY_BEFORE_DISPLAYING);
        }
    }

    function wpHideMenuPopup(element, event, popupId, menuId)
    {
        if (typeof wpCustommenuTimerShow[popupId] != 'undefined') clearTimeout(wpCustommenuTimerShow[popupId]);
        var element = $(element); var objMenu = $(menuId) ;var popup = $(popupId); if (!popup) return;
        var wpCurrentMouseTarget = getCurrentMouseTarget(event);
        if (!!wpCurrentMouseTarget) {
            if (!wpIsChildOf(element, wpCurrentMouseTarget) && element != wpCurrentMouseTarget) {
                if (!wpIsChildOf(popup, wpCurrentMouseTarget) && popup != wpCurrentMouseTarget) {
                    if (objMenu.hasClassName('active')) {
                        wpCustommenuTimerHide[popupId] = setTimeout(function() {
                            objMenu.removeClassName('active');
                            // --- change href ---
                            var wpMenuAnchor = $(objMenu.select('a')[0]);
                            wpChangeTopMenuHref(wpMenuAnchor);
                            // --- hide popup ---
                            popup.style.display = 'none';
                            //jQuery('#' + popupId).stop(true, true).fadeOut();
                        }, CUSTOMMENU_POPUP_DELAY_BEFORE_HIDING);
                    }
                }
            }
        }
    }

    function wpPopupOver(element, event, popupId, menuId)
    {
        if (typeof wpCustommenuTimerHide[popupId] != 'undefined') clearTimeout(wpCustommenuTimerHide[popupId]);
    }

    function wpPopupPos(objMenu, w)
    {
        var pos = objMenu.cumulativeOffset();
        var wraper = $('custommenu');
        var posWraper = wraper.cumulativeOffset();
        var xTop = pos.top - posWraper.top
        if (CUSTOMMENU_POPUP_TOP_OFFSET) {
            xTop += CUSTOMMENU_POPUP_TOP_OFFSET;
        } else {
            xTop += objMenu.getHeight();
        }
        var res = {'top': xTop};
        if (CUSTOMMENU_RTL_MODE) {
            var xLeft = pos.left - posWraper.left - w + objMenu.getWidth();
            if (xLeft < 0) xLeft = 0;
            res.left = xLeft;
        } else {
            var wWraper = wraper.getWidth();
            var xLeft = pos.left - posWraper.left;
            if ((xLeft + w) > wWraper) xLeft = wWraper - w;
            if (xLeft < 0) xLeft = 0;
            res.left = xLeft;
        }
        return res;
    }

    function wpChangeTopMenuHref(wpMenuAnchor)
    {
        var wpValue = wpMenuAnchor.href;
        wpMenuAnchor.href = wpMenuAnchor.rel;
        wpMenuAnchor.rel = wpValue;
    }

    function wpIsChildOf(parent, child)
    {
        if (child != null) {
            while (child.parentNode) {
                if ((child = child.parentNode) == parent) {
                    return true;
                }
            }
        }
        return false;
    }

    function wpSetPopupZIndex(popup)
    {
        $$('.wp-custom-menu-popup').each(function(item){
            item.style.zIndex = '9999';
        });
        popup.style.zIndex = '10000';
    }

    function getCurrentMouseTarget(xEvent)
    {
        var wpCurrentMouseTarget = null;
        if (xEvent.toElement) {
            wpCurrentMouseTarget = xEvent.toElement;
        } else if (xEvent.relatedTarget) {
            wpCurrentMouseTarget = xEvent.relatedTarget;
        }
        return wpCurrentMouseTarget;
    }
    /*
     Event.observe(document, 'click', function (event) {
     if (!!wpActiveMenu) {
     var element = event.element();
     if (!!element) {
     var menuObj = $(wpActiveMenu.menuId);
     var popupObj = $(wpActiveMenu.popupId);
     if (!wpIsChildOf(menuObj, element) && menuObj != element) {
     if (!wpIsChildOf(popupObj, element) && popupObj != element) {
     wpHideMenuPopup(element, event, wpActiveMenu.popupId, wpActiveMenu.menuId);
     wpActiveMenu = null;
     }
     }
     }
     }
     });
     */
    </script><link href="http://www.vinoseleccion.com/rss/catalog/new/store_id/1/" title="Nuevos productos" rel="alternate" type="application/rss+xml" /> <!--[if lt IE 8]><link rel="stylesheet" type="text/css" href="http://www.vinoseleccion.com/media/css/d35995353628ff3b9fe913c090e83e91.css" media="all" /> <![endif]--><script type="text/javascript"> //<![CDATA[
    Mage.Cookies.path     = '/';
    Mage.Cookies.domain   = '.vinoseleccion.com';
    //]]> </script><script type="text/javascript"> //<![CDATA[
    optionalZipCountries = ["IE","PA","HK","MO"];
    //]]> </script> <script type="text/javascript"> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-1902141-3', 'www.vinoseleccion.com');
    ga('set', 'anonymizeIp', false);
    ga('require', 'displayfeatures');
    ga('send', 'pageview'); </script><link rel="canonical" href="http://www.vinoseleccion.com/finca-resalso-2015/" /> <script type="text/javascript">//<![CDATA[
    var Translator = new Translate({"Please select an option.":"Por favor, seleccione una opci\u00f3n.","This is a required field.":"Campo requerido.","Please enter a valid number in this field.":"Por favor, escriba un n\u00famero v\u00e1lido en este campo.","Please use letters only (a-z or A-Z) in this field.":"Por favor, utilice s\u00f3lo letras (a-z o A-Z) en este campo.","Please use only letters (a-z), numbers (0-9) or underscore(_) in this field, first character should be a letter.":"Por favor, use s\u00f3lo letras (a-z), n\u00fameros (0-9) o guiones bajos(_) en este campo. El primer car\u00e1cter debe ser una letra.","Please enter a valid phone number. For example (123) 456-7890 or 123-456-7890.":"Por favor, escriba un n\u00famero de tel\u00e9fono v\u00e1lido.","Please enter a valid date.":"Por favor, escriba una fecha v\u00e1lida.","Please enter a valid email address. For example johndoe@domain.com.":"Por favor, escriba una direcci\u00f3n de correo v\u00e1lida. Por ejemplo perez@dominio.com","Please enter 6 or more characters. Leading or trailing spaces will be ignored.":"Por favor, escriba 6 o m\u00e1s caracteres. Los espacios al principio y al final ser\u00e1n ignorados.","Please enter 7 or more characters. Password should contain both numeric and alphabetic characters.":"Por favor introduzca al menos 7 caracteres. La contrase\u00f1a debe contener n\u00fameros y letras.","Please make sure your passwords match.":"Aseg\u00farese de que sus contrase\u00f1as coinciden.","Please enter a valid URL. For example http:\/\/www.example.com or www.example.com":"Por favor, escriba una URL v\u00e1lida. Por ejemplo http:\/\/www.ejemplo.com o www.ejemplo.com","Please enter a valid social security number. For example 123-45-6789.":"Por favor, escriba un n\u00famero v\u00e1lido de seguridad social.","Please enter a valid zip code. For example 90602 or 90602-1234.":"Por favor, escriba un c\u00f3digo postal v\u00e1lido.","Please enter a valid zip code.":"Por favor, escriba un c\u00f3digo postal v\u00e1lido.","Please use this date format: dd\/mm\/yyyy. For example 17\/03\/2006 for the 17th of March, 2006.":"Por favor, use este formato de fecha: dd\/mm\/aaaa. Por ejemplo, 17\/03\/2006 para 17 de marzo de 2006.","Please enter a valid $ amount. For example $100.00.":"Por favor, escriba un importe v\u00e1lido.","Please select one of the above options.":"Por favor, seleccione una de las opciones arriba.","Please select one of the options.":"Por favor, seleccione una de las opciones.","Please select State\/Province.":"Por favor, seleccione Estado\/Provincia","Please enter a number greater than 0 in this field.":"Por favor, escriba un n\u00famero mayor que 0 en este campo.","Please enter a valid credit card number.":"Por favor, escriba un n\u00famero de tarjeta de cr\u00e9dito v\u00e1lido.","Credit card number does not match credit card type.":"El n\u00famero de cuenta introducido no concuerda con el tipo de tarjeta.","Card type does not match credit card number.":"El tipo de tarjeta no concuerda con el n\u00famero de cuenta introducido.","Incorrect credit card expiration date.":"Fecha de caducidad incorrecta.","Please wait, loading...":"Por favor, espere. Cargando...","This date is a required value.":"Campo requerido","Please enter a valid day (1-%d).":"Por favor, introduce el d\u00eda correcto (1-%d).","Please enter a valid month (1-12).":"Por favor, introduzca un mes v\u00e1lido (1-12)","Please enter a valid year (1900-%d).":"Por favor, introduce un a\u00f1o correcto (1900-%d).","Please enter a valid full date":"Por favor, ingrese una fecha v\u00e1lida.","Please enter a valid date between %s and %s":"Por favor, introduce una fecha entre %s y %s.","Please enter a valid date equal to or greater than %s":"Por favor, introduce una fecha igual o mayor que %s.","Please enter a valid date less than or equal to %s":"Por favor, introduce una fecha meno o igual a %s.","Complete":"Completa","Add Products":"A\u00f1adir productos","Please choose to register or to checkout as a guest":"Por favor, elija registrarse o comprar como invitado","Please specify payment method.":"Por favor, especifique forma de pago."});
    //]]></script> <script type="text/javascript"> var _smartsupp = _smartsupp || {};
    _smartsupp.key = 'c79eedbaf0d8e575033b006a22dfc56a406403ee';
    window.smartsupp||(function(d) {
        var s,c,o=smartsupp=function(){ o._.push(arguments)};o._=[];
        s=d.getElementsByTagName('script')[0];c=d.createElement('script');
        c.type='text/javascript';c.charset='utf-8';c.async=true;
        c.src='//www.smartsuppchat.com/loader.js?';s.parentNode.insertBefore(c,s);
    })(document); </script> <script type="text/javascript"> setTimeout(function(){var a=document.createElement("script");
        var b=document.getElementsByTagName("script")[0];
        a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0026/6218.js?"+Math.floor(new Date().getTime()/3600000);
        a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1); </script></head><body class=" catalog-product-view catalog-product-view product-finca-resalso-2015"><div class="wrapper"> <noscript><div class="global-site-notice noscript"><div class="notice-inner"><p> <strong>JavaScript seems to be disabled in your browser.</strong><br /> You must have JavaScript enabled in your browser to utilize the functionality of this website.</p></div></div> </noscript><div class="page"><div class="header-container"><div class="header" > <a href="http://www.vinoseleccion.com/" title="Vinoselección. El placer del vino." class="logo"> <img src="http://www.vinoseleccion.com/skin/frontend/default/ge/images/logo.png" alt="Vinoselección. El placer del vino." /> </a><div class="quick-access"><div class="block block-header-cart"><div class="block-title"> <span class="cart-icon"></span><span>Mi carrito</span></div><div class="block-content"><div class="summary"><p><span class="amount">0</span> artículos</p></div></div> <a class="cart-top-link" href="http://www.vinoseleccion.com/checkout/cart/"></a></div><ul class="links"><li class="first last" ><a href="https://www.vinoseleccion.com/customer/account/" title="Mi cuenta" >Mi cuenta</a></li></ul><form id="search_mini_form" action="http://www.vinoseleccion.com/catalogsearch/result/" method="get"><div class="form-search"> <label for="search" class="accessible-hide">Search:</label> <input id="search" type="text" name="q" value="" class="input-text" maxlength="128" placeholder="Bodega, tipos, uvas, cosechas, precios, ..."/> <button type="submit" title="Buscar" class="button"><span><span>Buscar</span></span></button><div id="search_autocomplete" class="search-autocomplete"></div> <script type="text/javascript"> //<![CDATA[
if( Modernizr.input.placeholder ) {
    var searchForm = new Varien.searchForm('search_mini_form', 'search', 'Bodega, tipos, uvas, cosechas, precios, ..');
    searchForm.initAutocomplete('http://www.vinoseleccion.com/catalogsearch/ajax/suggest/', 'search_autocomplete');
}
//]]> </script></div></form></div></div><div class="home-top-menu"><div class="social-wrapper"><div class="block social-header"><div class="block-content"><ul><li><a class="fb" title="Facebook" href="https://www.facebook.com/vinoseleccion" target="_blank">Facebook</a></li><li><a class="tw" title="Twitter" href="https://twitter.com/vinoseleccion" target="_blank">Twitter</a></li><li><a class="rss" title="RSS" href="/index.php/rss/" target="_blank">RSS</a></li></ul><p class="phone"><em class="icon-phone"></em>91 453 93 00</p></div></div></div><ul><li><a id="tienda" title="Tienda Vinoselecci&oacute;n" href="http://www.vinoseleccion.com/">Tienda</a></li><li><a id="club-vinos" title="Nuestras Selecciones" href="http://www.vinoseleccion.com/nuestras-selecciones">Nuestras Selecciones</a></li><li><a id="saber-de-vinos" title="Saber de vinos" href="http://www.vinoseleccion.com/saber-de-vinos"> Saber de vinos </a></li><li class="iberia"><a title="Iberia" href="http://www.vinoseleccion.com/iberia">Iberia</a></li></ul><ul id="selecciones" class="selecciones"><li><a href="http://www.vinoseleccion.com/nuestras-selecciones/seleccion-mensual">Selecci&oacute;n Mensual</a></li><li><a href="http://www.vinoseleccion.com/nuestras-selecciones/seleccion-privada">Selecci&oacute;n Privada</a></li><li><a href="http://www.vinoseleccion.com/nuestras-selecciones/obras-maestras-del-vino">Obras Maestras</a></li><li><a href="http://www.vinoseleccion.com/nuestras-selecciones/vinos-del-mundo">Vinos del Mundo</a></li><li><a href="http://www.vinoseleccion.com/nuestras-selecciones">+Ver Todas</a></li></ul><ul id="iberia_sub" class="iberia_sub"><li><a href="http://www.vinoseleccion.com/iberia/bodega-clase-business-iberia">Bodega Clase Business Iberia</a></li><li><a href="http://www.vinoseleccion.com/iberia/obtencion-avios">Obtener Avios</a></li><li><a href="http://www.vinoseleccion.com/iberia/comprar-con-avios">Comprar con Avios</a></li></ul><ul id="saber_sub" class="saber_sub"><li><a href="http://www.vinoseleccion.com/saber-de-vinos/elaboraciones-del-vino">Elaboraciones</a></li><li><a href="http://www.vinoseleccion.com/saber-de-vinos/servicio-del-vino">Servicio del vino</a></li><li><a href="http://www.vinoseleccion.com/saber-de-vinos/club-de-vinos">Club de vinos</a></li><li><a href="http://www.vinoseleccion.com/saber-de-vinos/historia-del-vino">Historia</a></li><li><a href="http://www.vinoseleccion.com/saber-de-vinos/diccionario-del-vino">Diccionario</a></li><li><a href="http://www.vinoseleccion.com/saber-de-vinos/curso-de-cata">Curso de Cata</a></li></ul></div></div><div class="nav-container"><div id="custommenu" class=""><div id="menu3" class="menu" onmouseover="wpShowMenuPopup(this, event, 'popup3');" onmouseout="wpHideMenuPopup(this, event, 'popup3', 'menu3')"><div class="parentMenu"> <a href="javascript:void(0);" rel="http://www.vinoseleccion.com/vinos"> <span>Vinos</span> </a></div></div><div id="popup3" class="wp-custom-menu-popup" onmouseout="wpHideMenuPopup(this, event, 'popup3', 'menu3')" onmouseover="wpPopupOver(this, event, 'popup3', 'menu3')"><div id="wp_custom_menu_3" class="block2"><div class="column"><div class="itemMenu level1"><a class="itemMenuName level1" title="Tipos de vino" href="/tipos-de-vino" target="_self">Tipos de vino</a><div class="itemSubMenu level1"><div class="itemMenu level2"><a class="itemMenuName level2" title="Vino Tinto" href="/vinos/filtro/wine-type/1_2_3_4_5" target="_self">Vino tinto</a> <a class="itemMenuName level2" title="Vino blanco" href="/tipos-de-vino/blanco" target="_self">Vino blanco</a> <a class="itemMenuName level2" title="Vino rosado" href="/tipos-de-vino/rosado" target="_self">Vino rosado</a> <a class="itemMenuName level2" title="Vino espumoso" href="/tipos-de-vino/espumoso" target="_self">Vino espumoso</a> <a class="itemMenuName level2" title="Vino generoso" href="/tipos-de-vino/generosos" target="_self">Vino generoso</a></div></div></div> <br /><div class="itemMenu level1"><a class="itemMenuName level1" title="Regiones" href="/regiones" target="_self">Regiones</a><div class="itemSubMenu level1"><div class="itemMenu level2"><a class="itemMenuName level2" title="Rioja" href="/regiones/rioja" target="_self">Rioja</a> <a class="itemMenuName level2" title="Ribera del Duero" href="/regiones/ribera-del-duero" target="_self">Ribera del Duero</a> <a class="itemMenuName level2" title="Toro" href="/regiones/toro" target="_self">Toro</a> <a class="itemMenuName level2" title="Rias Baixas" href="/regiones/rias-baixas" target="_self">Rias Baixas</a> <a class="itemMenuName level2" title="Ver todas las Regiones" href="/regiones" target="_self">+ Ver todas</a></div></div></div></div><div class="column"><div class="itemMenu level1"><a class="itemMenuName level1 no-padding" title="Bodegas" href="/bodegas">Bodegas</a> <a class="itemMenuName level1 no-padding" title="Variedades de uva" href="/variedades-de-uva">Variedades de uva</a> <a title="Cosechas" href="/cosechas">Cosechas</a> <a title="En&oacute;logos" href="/enologos">En&oacute;logos</a> <a title="Bodegueros" href="/bodegueros">Bodegueros</a> <a title="Concursos de vino" href="/concursos">Concursos</a> <a title="Puntuaciones" href="/puntuaciones">Puntuaciones</a> <a href="/precios-de-vinos">Precios de vinos</a></div></div><div class="column"><div class="itemMenu level1"><h2 class="itemMenuTitlte">Vinos especiales</h2> <a class="itemMenuName level1 no-padding" title="Vinos para el verano" href="http://www.vinoseleccion.com/vinos-para-el-verano">Vinos para el verano</a> <a class="itemMenuName level1 no-padding" title="Vinos para sorprender" href="http://www.vinoseleccion.com/vinos-para-sorprender">Vinos para sorprender</a> <a class="itemMenuName level1 no-padding" title="Vinos para una ocasi&oacute;n especial" href="http://www.vinoseleccion.com/vinos-para-una-ocasion-especial">Vinos para una ocasi&oacute;n especial</a> <a class="itemMenuName level1 no-padding" title="Vinos para regalar" href="http://www.vinoseleccion.com/vinos-para-regalar">Vinos para regalar</a> <a class="itemMenuName level1 no-padding" title="Vinos para disfrutar una vez en la vida" href="http://www.vinoseleccion.com/vinos-para-disfrutar-una-vez-en-la-vida">Vinos para disfrutar una vez en la vida</a> <a title="Vinos m&aacute;s vendidos" href="http://www.vinoseleccion.com/vinos-mas-vendidos">Vinos m&aacute;s vendidos</a> <a class="itemMenuName level1 no-padding" title="Vinos m&aacute;s buscados" href="http://www.vinoseleccion.com/vinos-mas-buscados">Vinos m&aacute;s buscados</a></div></div><div class="column" style="width: 235px;"><a href="http://www.vinoseleccion.com/microsite/socio"> <img title="&iexcl;D&iacute;gaselo a sus amigos!" src="http://www.vinoseleccion.com/media/wysiwyg/sociocaptasocionua/socio-capta-socio-nua.jpg" alt="&iexcl;D&iacute;gaselo a sus amigos!" width="235" height="317" /> </a></div></div></div><div id="menu4" class="menu" onmouseover="wpShowMenuPopup(this, event, 'popup4');" onmouseout="wpHideMenuPopup(this, event, 'popup4', 'menu4')"><div class="parentMenu"> <a href="javascript:void(0);" rel="http://www.vinoseleccion.com/grandes-vinos"> <span>Grandes Vinos</span> </a></div></div><div id="popup4" class="wp-custom-menu-popup" onmouseout="wpHideMenuPopup(this, event, 'popup4', 'menu4')" onmouseover="wpPopupOver(this, event, 'popup4', 'menu4')"><div class="block1"><div class="column first last odd"><div class="itemMenu level1"><a class="itemMenuName level1" href="http://www.vinoseleccion.com/grandes-vinos/grandes-vinos-espanoles"><span>Grandes vinos españoles</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/grandes-vinos/grandes-vinos-internacionales"><span>Grandes vinos internacionales</span></a></div></div><div class="clearBoth"></div></div></div><div id="menu53" class="menu" onmouseover="wpShowMenuPopup(this, event, 'popup53');" onmouseout="wpHideMenuPopup(this, event, 'popup53', 'menu53')"><div class="parentMenu"> <a href="javascript:void(0);" rel="http://www.vinoseleccion.com/gourmet"> <span>Gourmet</span> </a></div></div><div id="popup53" class="wp-custom-menu-popup" onmouseout="wpHideMenuPopup(this, event, 'popup53', 'menu53')" onmouseover="wpPopupOver(this, event, 'popup53', 'menu53')"><div class="block1"><div class="column first last odd"><div class="itemMenu level1"><a class="itemMenuName level1" href="http://www.vinoseleccion.com/gourmet/quesos"><span>Quesos</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/gourmet/jamones-y-embutidos"><span>Jamones y embutidos</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/gourmet/aperitivos-y-entrantes"><span>Aperitivos y entrantes</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/gourmet/platos-principales"><span>Platos principales</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/gourmet/condimentos"><span>Condimentos</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/gourmet/dulces-y-postres"><span>Dulces y postres</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/gourmet/otras-bebidas"><span>Otras bebidas</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/gourmet/conservas-vegetales-y-del-mar"><span>Conservas vegetales y del mar</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/gourmet/pates-y-foies"><span>Patés y foies</span></a></div></div><div class="clearBoth"></div></div></div><div id="menu6" class="menu" onmouseover="wpShowMenuPopup(this, event, 'popup6');" onmouseout="wpHideMenuPopup(this, event, 'popup6', 'menu6')"><div class="parentMenu"> <a href="javascript:void(0);" rel="http://www.vinoseleccion.com/enoturismo"> <span>Enoturismo</span> </a></div></div><div id="popup6" class="wp-custom-menu-popup" onmouseout="wpHideMenuPopup(this, event, 'popup6', 'menu6')" onmouseover="wpPopupOver(this, event, 'popup6', 'menu6')"><div class="block1"><div class="column first last odd"><div class="itemMenu level1"><a class="itemMenuName level1" href="http://www.vinoseleccion.com/enoturismo/escape-al-vino"><span>Escape al vino</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/enoturismo/cursos"><span>Cursos</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/enoturismo/cenas"><span>Cenas</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/enoturismo/eventos"><span>Eventos</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/enoturismo/viajes"><span>Viajes</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/enoturismo/otros"><span>Otros</span></a></div></div><div class="clearBoth"></div></div></div><div id="menu7" class="menu" onmouseover="wpShowMenuPopup(this, event, 'popup7');" onmouseout="wpHideMenuPopup(this, event, 'popup7', 'menu7')"><div class="parentMenu"> <a href="javascript:void(0);" rel="http://www.vinoseleccion.com/accesorios"> <span>Accesorios</span> </a></div></div><div id="popup7" class="wp-custom-menu-popup" onmouseout="wpHideMenuPopup(this, event, 'popup7', 'menu7')" onmouseover="wpPopupOver(this, event, 'popup7', 'menu7')"><div class="block1"><div class="column first last odd"><div class="itemMenu level1"><a class="itemMenuName level1" href="http://www.vinoseleccion.com/accesorios/sacacorchos"><span>Sacacorchos</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/accesorios/botelleros"><span>Botelleros</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/accesorios/copas"><span>Copas</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/accesorios/decantadores"><span>Decantadores</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/accesorios/secadores-de-copas"><span>Secadores de copas</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/accesorios/tapones"><span>Tapones</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/accesorios/frascas"><span>Frascas</span></a><a class="itemMenuName level1" href="http://www.vinoseleccion.com/accesorios/queseras"><span>Queseras</span></a></div></div><div class="clearBoth"></div></div></div><div id="menu26908" class="menu"><div class="parentMenu"> <a href="http://www.vinoseleccion.com/ofertas"> <span>Ofertas</span> </a></div></div><div class="clearBoth"></div></div></div> <script type="text/javascript"> //<![CDATA[
var CUSTOMMENU_POPUP_WIDTH = 0;
var CUSTOMMENU_POPUP_TOP_OFFSET = 0;
var CUSTOMMENU_POPUP_DELAY_BEFORE_DISPLAYING = 0;
var CUSTOMMENU_POPUP_DELAY_BEFORE_HIDING = 0;
var CUSTOMMENU_RTL_MODE = 0;
var wpCustommenuTimerShow = {};
var wpCustommenuTimerHide = {};
var wpActiveMenu = null;
//]]> </script><div class="main-container col1-layout"><div class="main"><div class="breadcrumbs"><ul><li class="home"> <a href="http://www.vinoseleccion.com/" title="Ir a la página de Inicio">Inicio</a> <i class="icon-sep"></i></li><li class="product last"> Finca Resalso 2015</li></ul></div><div class="col-main"> <script type="text/javascript"> var optionsPrice = new Product.OptionsPrice([]); </script><div id="messages_product_view"></div><div class="product-view"><div class="product-essential"><div class="no-display"> <input type="hidden" name="product" value="25452" /> <input type="hidden" name="related_product" id="related-products-field" value="" /></div><div class="product-shop"><div class="product-name"><h1>Finca Resalso 2015</h1><h2>Un viñedo con historia</h2></div><div class="std description"><p>Los vinos de Emilio Moro est&aacute;n entre las referencias imprescindibles de Ribera del Duero y gozan de prestigio internacional. <strong>Finca Resalso 2015</strong> es una demostraci&oacute;n del potencial de la tinto fino (tempranillo) cuando se cultiva en vi&ntilde;edos especiales.</p></div><div class="add-to-cart-wrapper grouped"><table class="data-table grouped-items-table" id="super-product-table"><col /><col /><col width="1" /><thead><tr><th>Formato</th><th class="a-left">Precio</th><th class="a-left">Und.</th></tr></thead><tbody><tr><td class="format"> 1 botella <span class="reference">Ref. 20552</span></td><td class="a-left"><div class="price-box"> <span class="regular-price" id="product-price-25453"> <span class="price">7,75 €</span> </span></div></td><td class="a-left"><form action="http://www.vinoseleccion.com/checkout/cart/add/uenc/aHR0cDovL3d3dy52aW5vc2VsZWNjaW9uLmNvbTo4MDgwL2ZpbmNhLXJlc2Fsc28tMjAxNQ,,/product/25453/" method="post"> <input type="text" name="qty" maxlength="12" value="1" title="Cantidad" class="input-text qty" /> <span class="add-to-cart"> <button type="button" title="" class="button btn-cart" onclick="groupedAddToCart(this)"><span><i class="icon"></i><span>Añadir al carrito</span></span></button> </span></form></td></tr><tr><td class="format">6 botellas <span class="reference">Ref. 20552</span></td><td class="a-left"><div class="price-box price-red"><span class="regular-price" id="product-price-<?php echo $_product->getId(); ?>"><span class="price">46,50 €</span></span></div></td><td class="a-left"><form action="http://www.vinoseleccion.com/checkout/cart/add/uenc/aHR0cDovL3d3dy52aW5vc2VsZWNjaW9uLmNvbTo4MDgwL2ZpbmNhLXJlc2Fsc28tMjAxNQ,,/product/25453/" method="post"> <input type="text" name="qty" maxlength="12" value="6" title="Cantidad" class="input-text qty" /> <span class="add-to-cart"> <button type="button" title="" class="button btn-cart" onclick="groupedAddToCart(this)"><span><i class="icon"></i><span>Añadir al carrito</span></span></button> </span></form></td></tr></tbody></table> <script type="text/javascript">decorateTable('super-product-table')</script></div><div class="small-steps"><div class="home-steps"><p class="step1"><em class="icon"></em><span>Desde 1973, especialistas en vino</span></p><p class="step2"><em class="icon"></em><span>Presente en 7 pa&iacute;ses con m&aacute;s de 160.000 clientes</span></p><p class="step3"><em class="icon"></em><span>M&aacute;s de 500 vinos a <br />los mejores precios</span></p><p class="step4"><em class="icon"></em><span class="special">&iexcl;Y lo m&aacute;s importante!</span> <span>Si no est&aacute; satisfecho le devolvemos su dinero</span></p></div></div><div class="product-actions"><div class="product-share"><p>Compartir:</p><ul><li class="share-fb"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://www.vinoseleccion.com/finca-resalso-2015&amp;t=Finca Resalso 2015 | Comprar vino | vinoseleccion.com" title="Share in Facebook" target="_blank">Share in Facebook</a></li><li class="share-tw"> <a href="http://twitter.com/home/?status=Finca Resalso 2015 - Comprar vino - vinoseleccion.com http://www.vinoseleccion.com/finca-resalso-2015" title="Share in Twitter" target="_blank">Share in Twitter</a></li><li class="share-gp"> <a href="https://plus.google.com/share?url=http://www.vinoseleccion.com/finca-resalso-2015" title="Share in Google+" target="_blank">Share in Google+</a></li><li class="email-friend"> <a href="http://www.vinoseleccion.com/sendfriend/product/send/id/25452/">Envíe un correo sobre el producto</a></li><li class="print"> <a href="javascript:window.print()" title="Print this Page">Print this Page</a></li></ul></div></div><div class="general-features"><h2>Caracter&iacute;sticas generales</h2><div class="content"><ul><li><strong>Tipo de Vino:</strong> <a href='http://www.vinoseleccion.com/tipos-de-vino/tinto-con-crianza'>Tinto con crianza</a></li><li><strong>Bodega:</strong> <a href='http://www.vinoseleccion.com/bodegas-emilio-moro'>Bodegas Emilio Moro</a></li><li><strong>Regiones:</strong> <a href='http://www.vinoseleccion.com/regiones/ribera-del-duero'>D.O. Ribera del Duero</a></li><li><strong>Variedad de Uva:</strong> 100% <a href='http://www.vinoseleccion.com/variedades-de-uva/tempranillo'>Tempranillo</a></li><li><strong>Enólogo:</strong> <a href='http://www.vinoseleccion.com/enologos/alvaro-maestro'>Álvaro Maestro</a></li><li><strong>Bodeguero:</strong> <a href='http://www.vinoseleccion.com/bodegueros/jose-moro'>José Moro</a></li><li><strong>Tipo de barrica:</strong> Barricas de roble francés</li><li><strong>Tipo de botella:</strong> Bordelesa</li><li><strong>Permanencia en Barrica:</strong> 4 meses</li><li><strong>Capacidad (cl):</strong> 75</li><li><strong>Servicio:</strong> Temperatura de 16º C</li><li><strong>Graduación (% vol.):</strong> 14</li></ul></div></div></div><div class="product-img-box"><a href="http://www.vinoseleccion.com/media/catalog/product/cache/1/image/500x500/9df78eab33525d08d6e5fb8d27136e95/f/i/finca-resalso-tinto-con-crianza-2015-001.jpg"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          rel="lightbox[rotation]"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          title="Finca Resalso 2015"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          onclick="return false;"
><img src="http://www.vinoseleccion.com/media/catalog/product/cache/1/image/220x445/9df78eab33525d08d6e5fb8d27136e95/f/i/finca-resalso-tinto-con-crianza-2015-001.jpg" alt="Finca Resalso 2015"
/></a><div class="more-views"  id="catalog-product-view-images"><h4>Más vistas</h4><ul><li class="active"> <a href="http://www.vinoseleccion.com/media/catalog/product/cache/1/image/500x500/9df78eab33525d08d6e5fb8d27136e95/f/i/finca-resalso-tinto-con-crianza-2015-001.jpg"
                                                                                                              title="Finca Resalso 2015"
                                                                                                              data-url="http://www.vinoseleccion.com/media/catalog/product/cache/1/thumbnail/445x312/9df78eab33525d08d6e5fb8d27136e95/f/i/finca-resalso-tinto-con-crianza-2015-001.jpg"
                                                                                                              rel="lightbox[rotation]"
><img src="http://www.vinoseleccion.com/media/catalog/product/cache/1/thumbnail/43x111/9df78eab33525d08d6e5fb8d27136e95/f/i/finca-resalso-tinto-con-crianza-2015-001.jpg" alt="Finca Resalso 2015"
/></a></li></ul></div><script type="text/javascript"> function initLightbox(){
    new Lightbox({
        fileLoadingImage: 'http://www.vinoseleccion.com/skin/frontend/default/default/images/lightbox/loading.gif',
        fileBottomNavCloseImage: 'http://www.vinoseleccion.com/skin/frontend/default/default/images/lightbox/closelabel.gif',
        overlayOpacity: 0.8,
        animate: 1,
        resizeSpeed: 7,
        borderSize: 10,
        labelImage: 'Image',
        labelOf: 'of'
    });
}if (Prototype.Browser.IE) {
    Event.observe(window, 'load', function(){ //KB927917 fix
        initLightbox();
    });
} else {
    document.observe("dom:loaded", function(){
        initLightbox();
    });
} </script></div> <script type="text/javascript"> //<![CDATA[
var productAddToCartForm = new VarienForm('product_addtocart_form');
productAddToCartForm.submit = function(button, url) {
    if (this.validator.validate()) {
        var form = this.form;
        var oldUrl = form.action;
        if (url) {
            form.action = url;
        }
        var e = null;
        try {
            this.form.submit();
        } catch (e) {
        }
        this.form.action = oldUrl;
        if (e) {
            throw e;
        }
        if (button && button != 'undefined') {
            button.disabled = true;
        }
    }
}.bind(productAddToCartForm);
productAddToCartForm.submitLight = function(button, url){
    if(this.validator) {
        var nv = Validation.methods;
        delete Validation.methods['required-entry'];
        delete Validation.methods['validate-one-required'];
        delete Validation.methods['validate-one-required-by-name'];
// Remove custom datetime validators
        for (var methodName in Validation.methods) {
            if (methodName.match(/^validate-datetime-.*/i)) {
                delete Validation.methods[methodName];
            }
        }
        if (this.validator.validate()) {
            if (url) {
                this.form.action = url;
            }
            this.form.submit();
        }
        Object.extend(Validation.methods, nv);
    }
}.bind(productAddToCartForm);
function groupedAddToCart(button){
    var form = button.form;
    try {
        form.submit();
    } catch (e) {
    }
}
//]]> </script></div><div class="product-collateral tabs" data-function="tabs"><div class="content" data-tab="id-tab-0"><h2 data-obj="title">Información general</h2><p>Emilio Moro es una bodega familiar ubicada en el privilegiado entorno de Pesquera de Duero y ligada a varias generaciones de viticultores, ha realizado un excelente trabajo de selecci&oacute;n clonal de tinto fino (tempranillo) para contar con los mejores frutos de la D.O. Ribera del Duero. Finca Resalso es un vi&ntilde;edo muy especial plantado en 1932, el a&ntilde;o en el que naci&oacute; Emilio Moro. Con sus uvas de tinto fino (tempranillo) se elabora <strong>Finca Resalso 2015</strong>. <br /><br /> <strong>Bodegas Emilio Moro</strong>, fundada en 1987, est&aacute; entre las firmas responsables de que la Ribera del Duero est&eacute; hoy considerada como una de las regiones vitivin&iacute;colas m&aacute;s importantes del mundo. Sus responsables, Jos&eacute; y Javier Moro, representan a la tercera generaci&oacute;n de una notable familia de viticultores. Juntos han creado algunos de los mejores vinos de nuestro pa&iacute;s y entre ellos destaca la gama Malleolus con su Sanchomart&iacute;n a la cabeza. <br /><br /> Finca Resalso 2015 es un <strong>Ribera del Duero</strong> carnoso y potente, que debe su elegancia a una corta pero delicada crianza en barricas de roble de la mejor calidad.</p></div><div class="content" data-tab="id-tab-1"><h2 data-obj="title">Notas de cata</h2><p>De color rojo picota de buena capa.</p><p>Con muy buena intensidad en nariz, limpio, dominan aromas de fruta roja (fresa, grosella), hierbas arom&aacute;ticas, bals&aacute;micos (mentolados), recuerdos de after eight, caf&eacute;, torrefactos y fondo floral (violeta).</p><p>Muy sabroso en boca, equilibrado, frutal, jugoso, con un amable y fluido paso de boca, taninos finos, arom&aacute;tico y con un expresivo y largo final de boca.</p> Ideal para acompañar unas lentejas con chorizo o unas patatas con costillas.</div></div><div class="banner-right"><p><a title="&iquest;Es su primer pedido?" href="/sacacorchos-vacu-vin"><img title="Sacacorchos de Regalo" src="http://www.vinoseleccion.com/media/wysiwyg/banner-side_1.jpg" alt="&iquest;Es su primer pedido?" /></a></p></div><div class="printing-tabs"><h2 data-obj="title">Información general</h2><p>Emilio Moro es una bodega familiar ubicada en el privilegiado entorno de Pesquera de Duero y ligada a varias generaciones de viticultores, ha realizado un excelente trabajo de selecci&oacute;n clonal de tinto fino (tempranillo) para contar con los mejores frutos de la D.O. Ribera del Duero. Finca Resalso es un vi&ntilde;edo muy especial plantado en 1932, el a&ntilde;o en el que naci&oacute; Emilio Moro. Con sus uvas de tinto fino (tempranillo) se elabora <strong>Finca Resalso 2015</strong>. <br /><br /> <strong>Bodegas Emilio Moro</strong>, fundada en 1987, est&aacute; entre las firmas responsables de que la Ribera del Duero est&eacute; hoy considerada como una de las regiones vitivin&iacute;colas m&aacute;s importantes del mundo. Sus responsables, Jos&eacute; y Javier Moro, representan a la tercera generaci&oacute;n de una notable familia de viticultores. Juntos han creado algunos de los mejores vinos de nuestro pa&iacute;s y entre ellos destaca la gama Malleolus con su Sanchomart&iacute;n a la cabeza. <br /><br /> Finca Resalso 2015 es un <strong>Ribera del Duero</strong> carnoso y potente, que debe su elegancia a una corta pero delicada crianza en barricas de roble de la mejor calidad.</p><h2 data-obj="title">Notas de cata</h2><p>De color rojo picota de buena capa.</p><p>Con muy buena intensidad en nariz, limpio, dominan aromas de fruta roja (fresa, grosella), hierbas arom&aacute;ticas, bals&aacute;micos (mentolados), recuerdos de after eight, caf&eacute;, torrefactos y fondo floral (violeta).</p><p>Muy sabroso en boca, equilibrado, frutal, jugoso, con un amable y fluido paso de boca, taninos finos, arom&aacute;tico y con un expresivo y largo final de boca.</p> Ideal para acompañar unas lentejas con chorizo o unas patatas con costillas.</div></div><div class="home-product-list"><h2 class="subtitle">Nuestras recomendaciones&hellip;</h2><ul class="products-grid"><li class="item  first grouped"><h3 class="product-name"><a href="http://www.vinoseleccion.com/monte-real-de-familia-reserva-2010" title="Monte Real de Familia Tinto Reserva 2010">Monte Real de Familia Tinto Reserva 2010</a></h3> <a href="http://www.vinoseleccion.com/monte-real-de-familia-reserva-2010" title="Monte Real de Familia Tinto Reserva 2010" class="product-image"><img src="http://www.vinoseleccion.com/media/catalog/product/cache/1/small_image/76x184/9df78eab33525d08d6e5fb8d27136e95/m/o/monte-real-2010_2_1.jpg" alt="Monte Real de Familia Tinto Reserva 2010" /></a><div class="sticker" style="top:47px; background:url('http://www.vinoseleccion.com/media/sticker/image/e/t/etiqueta-35-rojo.png') no-repeat 0 0;"> 35% dto</div><p class="sdesc"><a href='http://www.vinoseleccion.com/tipos-de-vino/tinto-reserva'>Tinto Reserva</a> | <a href='http://www.vinoseleccion.com/bodegas-riojanas'>Bodegas Riojanas</a> | <a href='http://www.vinoseleccion.com/regiones/rioja'>D.O.Ca. Rioja</a></p><p class="desc">Monte Real de Familia Reserva 2010 es un tinto&hellip;</p><div class="actions-box"><div class="actions"> <span class="bot-icon">1</span><div class="price-box price-red"><span class="regular-price" id="product-price-25256"><span class="price">8,00 €</span></span></div> <button type="button" title="A&ntilde;adir al carrito" class="button btn-cart" onclick="setLocation('')"><span><span>A&ntilde;adir al carrito</span></span></button></div><div class="actions last"> <span class="bot-icon more">6</span><div class="price-box price-red"><span class="regular-price" id="product-price-25121"><span class="price">45,00 €</span></span></div> <button type="button" title="A&ntilde;adir al carrito" class="button btn-cart" onclick="setLocation('')"><span><span>A&ntilde;adir al carrito</span></span></button></div></li><li class="item grouped"><h3 class="product-name"><a href="http://www.vinoseleccion.com/cyan-de-matarromera-2013" title="Cyan de Matarromera 2013">Cyan de Matarromera 2013</a></h3> <a href="http://www.vinoseleccion.com/cyan-de-matarromera-2013" title="Cyan de Matarromera 2013" class="product-image"><img src="http://www.vinoseleccion.com/media/catalog/product/cache/1/small_image/76x184/9df78eab33525d08d6e5fb8d27136e95/c/y/cyan-de-matarromera-tinto-con-crianza-2013-001_2.jpg" alt="Cyan de Matarromera 2013" /></a><p class="sdesc"><a href='http://www.vinoseleccion.com/tipos-de-vino/tinto-con-crianza'>Tinto con crianza</a> | <a href='http://www.vinoseleccion.com/bodegas-cyan'>Bodegas Cyan</a> | <a href='http://www.vinoseleccion.com/regiones/toro'>D.O. Toro</a></p><p class="desc">Si a la concentraci&oacute;n de la uva tinta de Toro le sumamos la&hellip;</p><div class="actions-box"><div class="actions"> <span class="bot-icon">1</span><div class="price-box price-red"><span class="regular-price" id="product-price-25260"><span class="price">7,70 €</span></span></div> <button type="button" title="A&ntilde;adir al carrito" class="button btn-cart" onclick="setLocation('')"><span><span>A&ntilde;adir al carrito</span></span></button></div><div class="actions last"> <span class="bot-icon more">6</span><div class="price-box price-red"><span class="regular-price" id="product-price-25165"><span class="price">45,00 €</span></span></div> <button type="button" title="A&ntilde;adir al carrito" class="button btn-cart" onclick="setLocation('')"><span><span>A&ntilde;adir al carrito</span></span></button></div></li><li class="item grouped"><h3 class="product-name"><a href="http://www.vinoseleccion.com/protos-club-tinto-crianza-2013" title="Protos Club Tinto Crianza 2013">Protos Club Tinto Crianza 2013</a></h3> <a href="http://www.vinoseleccion.com/protos-club-tinto-crianza-2013" title="Protos Club Tinto Crianza 2013" class="product-image"><img src="http://www.vinoseleccion.com/media/catalog/product/cache/1/small_image/76x184/9df78eab33525d08d6e5fb8d27136e95/p/r/protos-club-tinto-crianza-2013-001.jpg" alt="Protos Club Tinto Crianza 2013" /></a><div class="sticker" style="top:47px; background:url('http://www.vinoseleccion.com/media/sticker/image/_/0/_0003_exclusivo_1.png') no-repeat 0 0;"> Exclusivo - negro</div><p class="sdesc"><a href='http://www.vinoseleccion.com/tipos-de-vino/tinto-crianza'>Tinto Crianza</a> | <a href='http://www.vinoseleccion.com/bodegas-protos'>Bodegas Protos</a> | <a href='http://www.vinoseleccion.com/regiones/ribera-del-duero'>D.O. Ribera del Duero</a></p><p class="desc">Con casi 90 a&ntilde;os de trayectoria, Protos es una de las&hellip;</p><div class="actions-box"><div class="actions"> <span class="bot-icon">1</span><div class="price-box price-red"><span class="regular-price" id="product-price-25433"><span class="price">15,50 €</span></span></div> <button type="button" title="A&ntilde;adir al carrito" class="button btn-cart" onclick="setLocation('')"><span><span>A&ntilde;adir al carrito</span></span></button></div><div class="actions last"> <span class="bot-icon more">4</span><div class="price-box price-red"><span class="regular-price" id="product-price-25325"><span class="price">62,00 €</span></span></div> <button type="button" title="A&ntilde;adir al carrito" class="button btn-cart" onclick="setLocation('')"><span><span>A&ntilde;adir al carrito</span></span></button></div></li><li class="item  last grouped"><h3 class="product-name"><a href="http://www.vinoseleccion.com/vi-a-sastre-coleccion-privada-2014" title="Viña Sastre Colección Privada 2014">Viña Sastre Colección Privada 2014</a></h3> <a href="http://www.vinoseleccion.com/vi-a-sastre-coleccion-privada-2014" title="Viña Sastre Colección Privada 2014" class="product-image"><img src="http://www.vinoseleccion.com/media/catalog/product/cache/1/small_image/76x184/9df78eab33525d08d6e5fb8d27136e95/v/i/vi_a-sastre-colecci_n-privada-tinto-con-crianza-2014-001.jpg" alt="Viña Sastre Colección Privada 2014" /></a><div class="sticker" style="top:47px; background:url('http://www.vinoseleccion.com/media/sticker/image/_/0/_0016_25_-dto..png') no-repeat 0 0;"> 25% dto</div><p class="sdesc"><a href='http://www.vinoseleccion.com/tipos-de-vino/tinto-con-crianza'>Tinto con crianza</a> | <a href='http://www.vinoseleccion.com/bodegas-hermanos-sastre'>Bodegas Hermanos Sastre</a> | <a href='http://www.vinoseleccion.com/regiones/ribera-del-duero'>D.O. Ribera del Duero</a></p><p class="desc">Vi&ntilde;a Sastre Colecci&oacute;n Privada 2014&hellip;</p><div class="actions-box"><div class="actions"> <span class="bot-icon">1</span><div class="price-box price-red"><span class="regular-price" id="product-price-25431"><span class="price">10,00 €</span></span></div> <button type="button" title="A&ntilde;adir al carrito" class="button btn-cart" onclick="setLocation('')"><span><span>A&ntilde;adir al carrito</span></span></button></div><div class="actions last"> <span class="bot-icon more">6</span><div class="price-box price-red"><span class="regular-price" id="product-price-25391"><span class="price">50,00 €</span></span></div> <button type="button" title="A&ntilde;adir al carrito" class="button btn-cart" onclick="setLocation('')"><span><span>A&ntilde;adir al carrito</span></span></button></div></li></ul></div> <script type="text/javascript"> var specificTabToOpen = false; </script> <script type="text/javascript"> var lifetime = 3600;
var expireAt = Mage.Cookies.expires;
if (lifetime > 0) {
    expireAt = new Date();
    expireAt.setTime(expireAt.getTime() + lifetime * 1000);
}
Mage.Cookies.set('external_no_cache', 1, expireAt); </script></div></div></div><div class="postcontent_first"><div class="banner-colecciones" style="margin-bottom: 30px;"><h2 style="text-align: left;">Colecciones</h2><ul><li><h3><a title="Comprar colecci&oacute;n vinos de Rioja" href="/coleccion-vino-rioja">Rioja</a></h3> <a title="Comprar colecci&oacute;n vinos de Rioja" href="/coleccion-vino-rioja"><img title="Colecci&oacute;n de vinos de Rioja" src="http://www.vinoseleccion.com/media/wysiwyg/coleccion-rioja-we296/coleccion-rioja-we287-pq.jpg" alt="Colecci&oacute;n de vinos de Rioja" width="210" height="146" /></a><br /><p class="price">45,50 &euro;</p><p class="desc">Caja de 6 botellas</p> <a class="block-link" title="M&aacute;s informaci&oacute;n sobre esta colecci&oacute;n de vinos de Rioja" href="/coleccion-vino-rioja">+ informaci&oacute;n</a><p class="dto">30% dto.</p></li><li><h3><a title="Comprar colecci&oacute;n vinos de Ribera del Duero" href="/coleccion-vino-ribera-del-duero">Ribera del Duero</a></h3> <a title="Comprar colecci&oacute;n vinos de Ribera del Duero" href="/coleccion-vino-ribera-del-duero"><img title="Colecci&oacute;n Vinos Ribera del Duero" src="http://www.vinoseleccion.com/media/wysiwyg/coleccion-ribera-duero-we304/coleccion-ribera-we304-pq.jpg" alt="Colecci&oacute;n Vinos Ribera del Duero" width="210" height="146" /></a><br /><p class="price">46,80 &euro;</p><p class="desc">Caja de 6 botellas</p> <a class="block-link" title="M&aacute;s informaci&oacute;n sobre esta colecci&oacute;n de vinos de la Ribera del Duero" href="/coleccion-vino-ribera-del-duero">+ informaci&oacute;n</a><p class="dto">40% dto.</p></li><li><h3><a title="Comprar coleccion vinos blancos" href="/coleccion-vinos-blancos">Blancos</a></h3> <a title="Comprar colecci&oacute;n vinos blancos" href="/coleccion-vinos-blancos"><img title="Colecci&oacute;n de vinos blancos" src="http://www.vinoseleccion.com/media/wysiwyg/coleccion-blancos-we303/coleccion-blancos-we303-pq.jpg" alt="Colecci&oacute;n de vinos blancos" width="210" height="146" /></a><br /><p class="price">39 &euro;</p><p class="desc">Caja de 6 botellas</p> <a class="block-link" title="M&aacute;s informaci&oacute;n sobre esta colecci&oacute;n de vinos blancos" href="/coleccion-vinos-blancos">+ informaci&oacute;n</a><p class="dto">30% dto.</p></li><li class="last"><h3><a href="/coleccion-otras-ddoo">Otras D.D.O.O</a></h3> <a title="" href="/coleccion-otras-ddoo"><img title="Colecci&oacute;n Otras D.D.O.O" src="http://www.vinoseleccion.com/media/wysiwyg/coleccion-otras-ddoo-we288/coleccion-otras-ddoo-we288-pq.jpg" alt="Colecci&oacute;n otras D.D.O.O" width="210" height="146" /></a><p class="price">46,45 &euro;</p><p class="desc">Caja de 6 botellas</p> <a class="block-link" title="" href="/coleccion-otras-ddoo">+ informaci&oacute;n</a><p class="dto">40% dto.</p></li></ul></div></div><div class="postcontent"><div class="banners-postcontent"><a href="http://sobremesa.es/" target="_blank"><img src="http://www.vinoseleccion.com/media/wysiwyg/banner-postcontent-2.jpg" alt="" /></a><a href="http://microsites.vinoseleccion.com/guiasocio/index.html" target="_blank"><img title="La gu&iacute;a del socio" src="http://www.vinoseleccion.com/media/wysiwyg/banner-postcontent-3-.jpg" alt="La gu&iacute;a del socio" width="306" height="90" /></a></div></div><div class="footer-container"><div class="footer"><div class="left"><div class="block contact-footer"><div class="block-title dark"><h2>Cont&aacute;ctenos</h2></div><div class="block-content"><p class="phone"><em class="icon"></em>91 453 93 00</p><p class="phone"><em class="icon"></em>686 100 500</p><p class="address"><em class="icon"></em>C/ Guzm&aacute;n el Bueno, 133<br /> 28003 Madrid</p><p class="mail"><em class="icon"></em><a title="sociosvs@vinoseleccion.com" href="mailto:sociosvs@vinoseleccion.com">sociosvs@vinoseleccion.com</a></p></div></div><div class="block block-subscribe"><div class="block-title"> <strong><span>Ofertas y novedades</span></strong></div><form action="https://www.vinoseleccion.com/newsletter/subscriber/new/" method="post" id="newsletter-validate-detail"><div class="block-content"><p>Manténgase informado de nuestras promociones</p><div class="form-subscribe-header"> <label for="newsletter">Suscríbase a nuestro boletín</label></div><div class="input-box"> <input type="text" name="email" id="newsletter" title="Apuntarse a nuestro boletín de noticias" class="input-text required-entry validate-email" placeholder="Correo electrónico" /></div><div class="policy"><p>Al facilitarnos su correo electrónico confirma que es mayor de 18 años y se ha leido y acepta la <a href="/politica-privacidad">política de privacidad</a>.</p></div><div class="actions"> <button type="submit" title="Enviar" class="button"><span><span>Enviar</span></span></button></div></div></form> <script type="text/javascript"> //<![CDATA[
var newsletterSubscriberFormDetail = new VarienForm('newsletter-validate-detail');
//]]> </script></div><div class="block social-footer"><div class="block-content"><ul><li><a class="fb" title="Facebook" href="https://www.facebook.com/vinoseleccion" target="_blank">Facebook</a></li><li><a class="tw" title="Twitter" href="https://twitter.com/vinoseleccion" target="_blank">Twitter</a></li><li><a class="rss" title="RSS" href="/index.php/rss/">RSS</a></li><li><a class="youtube" title="Youtube" href="https://www.youtube.com/user/VINOSELECCION" target="_blank">YouTube</a></li><li><a class="gplus" title="Google +" href="https://plus.google.com/+vinoseleccion/" target="_blank">Google+</a></li></ul></div> <br /><div style="cursor: pointer;" onclick="window.open('http://internationalwineclubsassociation.com/','_blank');"><img onmouseover="this.src='https://www.vinoseleccion.com/media/wysiwyg/miembro-de-la-iwca-web-color.png';" onmouseout="this.src='https://www.vinoseleccion.com/media/wysiwyg/miembro-de-la-iwca-web.png';" src="https://www.vinoseleccion.com/media/wysiwyg/miembro-de-la-iwca-web.png" alt="" /></div></div></div><div class="right"><div class="block most-search-footer"><div class="block-title dark"><h2>Lo m&aacute;s buscado</h2></div><div class="block-content"><ul class="links"><li><a title="Precios de Vinos" href="/precios-de-vinos">Precios de Vinos</a></li><li><a title="Condado de Haza" href="/bodegas-condado-de-haza">Condado de Haza</a></li><li><a title="Pesquera" href="/pesquera">Pesquera</a></li><li><a title="Vega Sicilia" href="/vega-sicilia">Vega Sicilia</a></li><li><a title="Matarromera" href="/bodega-matarromera">Matarromera</a></li><li><a title="Protos" href="/bodegas-protos">Protos</a></li><li><a title="Vino Rioja" href="/regiones/rioja">Vino Rioja</a></li><li><a title="Vinos Ribera del Duero" href="/regiones/ribera-del-duero">Vinos Ribera del Duero</a></li><li><a title="Vinos de Toro" href="/regiones/toro">Vinos de Toro</a></li></ul></div></div><div class="block about-us-footer"><div class="block-title dark"><h2>Sobre nosotros</h2></div><div class="block-content"><ul class="links"><li><a title="Qu&eacute; es Vinoselecci&oacute;n" href="/que-es-vinoseleccion">Qu&eacute; es Vinoselecci&oacute;n</a></li><li><a title="Mi cuenta" href="/customer/account/login/">Mi cuenta</a></li><li><a title="Reg&iacute;strate" href="/customer/account/create/">Reg&iacute;strese</a></li><li><a title="Contacto" href="/contacto">Contacto</a></li></ul></div></div><div class="block internacional-footer"><div class="block-title dark"><h2>Internacional</h2></div><div class="block-content"><ul class="links"><li><a title="United Kingdom" href="http://www.vinoseleccion.co.uk" target="_blank">United Kingdom</a></li><li><a title="Deutschland" href="http://www.vinoseleccion.de" target="_blank">Deutschland</a></li><li><a title="Netherlands" href="http://www.vinoseleccion.nl" target="_blank">Netherlands</a></li><li><a title="France" href="http://www.vinoseleccion.fr" target="_blank">France</a></li></ul></div></div></div></div></div><div class="subfooter-container"><div class="subfooter"><ul class="left"><li><a title="Aviso legal" href="/aviso-legal">Aviso legal</a></li><li><a title="Pol&iacute;tica de privacidad" href="/politica-privacidad">Pol&iacute;tica de privacidad</a></li><li><a title="Condiciones de venta" href="/condiciones-venta">Condiciones de venta</a></li><li><a title="Pol&iacute;tica de cookies" href="/politica-cookies">Pol&iacute;tica de cookies</a></li><li class="last"><a title="Inversores y Accionistas" href="https://www.vinoseleccion.com/inversores-y-accionistas">Inversores y Accionistas</a></li></ul><div class="copy right">Copyright &copy; Vinoselección S.A.</div></div></div></div></div></body></html>